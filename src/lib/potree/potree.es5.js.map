{"version":3,"sources":["potree.js"],"names":["Potree","version","major","minor","suffix","console","log","pointBudget","framenumber","Shaders","webgl","shaders","vaos","vbos","scriptPath","document","currentScript","src","URL","href","slice","error","resourcePath","timerQueries","timerQueriesEnabled","startQuery","name","gl","undefined","ext","getExtension","query","createQueryEXT","beginQueryEXT","TIME_ELAPSED_EXT","push","endQuery","endQueryEXT","resolveQueries","queries","length","available","getQueryObjectEXT","QUERY_RESULT_AVAILABLE_EXT","disjoint","viewer","renderer","getContext","getParameter","GPU_DISJOINT_EXT","timeElapsed","QUERY_RESULT_EXT","miliseconds","shift","MOUSE","LEFT","RIGHT","MIDDLE","Points","boundingBox","THREE","Box3","numPoints","data","points","currentSize","additionalSize","newSize","thisAttributes","Object","keys","otherAttributes","attributes","Set","attribute","includes","type","constructor","merged","set","elementsPerPoint","expanded","union","loadPointCloud","path","callback","loaded","pointcloud","indexOf","GreyhoundLoader","load","geometry","PointCloudOctree","POCLoader","bind","PointCloudArena4DGeometry","PointCloudArena4D","updatePointClouds","pointclouds","camera","lru","LRU","i","j","profileRequests","update","result","updateVisibility","updateMaterial","material","visibleNodes","updateVisibleBounds","getLRU","freeMemory","updateVisibilityStructures","frustums","camObjPositions","priorityQueue","BinaryHeap","x","weight","initialized","numVisibleNodes","numVisiblePoints","deepestVisibleLevel","visibleGeometry","updateMatrixWorld","frustum","Frustum","viewI","matrixWorldInverse","world","matrixWorld","proj","projectionMatrix","fm","Matrix4","multiply","setFromMatrix","view","worldI","getInverse","camMatrixObject","camObjPos","Vector3","setFromMatrixPosition","visible","root","node","Number","MAX_VALUE","isTreeNode","hideDescendants","sceneNode","boundingBoxNodes","getDEMWorkerInstance","DEMWorkerInstance","workerPath","workerPool","getWorker","createDEMMesh","dem","box","steps","triangles","u0","u1","v0","v1","x0","getSize","x1","y0","y","y1","h00","height","min","h10","h01","h11","every","isFinite","n","BufferGeometry","positions","Float32Array","addAttribute","BufferAttribute","computeBoundingSphere","computeVertexNormals","MeshNormalMaterial","side","DoubleSide","mesh","Mesh","position","copy","scene","add","createDEMMeshNode","demNode","tileSize","imgData","Uint8Array","boxSize","u","v","pos","index","Infinity","max","Math","img","utils","pixelsArrayToImage","screenshot","debugDIV","$","body","append","empty","unloadedGeometry","lowestSpacing","s","loadedToGPUThisFrame","size","element","pop","parent","getBoundingBox","insideFrustum","intersectsBox","maxLevel","level","getLevel","getNumPoints","numClipBoxes","clipMode","ClipMode","CLIP_OUTSIDE","box2","clone","applyMatrix4","intersectsClipBoxes","clipBoxes","clipBox","clipMatrixWorld","matrix","clipBoxWorld","spacing","geometryNode","isGeometryNode","isLoaded","toTreeNode","touch","updateMatrix","multiplyMatrices","showBoundingBox","boundingBoxNode","boxHelper","Box3Helper","children","getChildren","child","sphere","getBoundingSphere","distance","center","distanceTo","radius","fov","PI","slope","tan","projFactor","domElement","clientHeight","screenPixelRadius","minimumNodePixelSize","maxDEMLevel","candidates","filter","p","generateDEM","DEM","updatingNodes","DEMNode","fill","mipMap","mipMapNeedsUpdate","sourceSize","mipSize","parseInt","mipSource","mipData","mipMapLevel","uv","a","b","floor","ceil","i0","i1","j0","j1","wh00","wh01","wh10","wh11","wsum","h","heightAtMipMapLevel","c","traverse","stack","nodeBoxSize","childIndices","childBox","map","list","currentHeight","childIndex","z","working","equals","vn","demVersion","projectedBox","projectedBoxSize","targetNodes","expandAndFindByBox","onmessage","e","ix","iy","createMipMap","array","message","toArray","buffer","transferables","postMessage","PointCloudTreeNode","PointCloudTree","Object3D","WorkerPool","workers","url","worker","Worker","EventDispatcher","prototype","removeEventListeners","_listeners","PerspectiveCamera","zoomTo","factor","boundingSphere","bs","_factor","fovr","aspect","distanceFactor","abs","sin","offset","getWorldDirection","multiplyScalar","Ray","distanceToPlaneWithNegative","plane","denominator","normal","dot","direction","distanceToPoint","origin","t","constant","pco","PointCloudOctreeGeometry","xhr","XMLHttpRequest","open","onreadystatechange","readyState","status","fMno","JSON","parse","responseText","Version","octreeDir","hierarchyStepSize","pointAttributes","lx","ly","lz","ux","uy","uz","tightBoundingBox","sub","projection","tightBoundingSphere","loader","LasLazLoader","BinaryLoader","scale","PointAttributes","nodes","PointCloudOctreeGeometryNode","hasChildren","upTo","hierarchy","charAt","parentName","substring","parentNode","createChildAABB","pow","addChild","send","loadPointAttributes","mno","fpa","pa","pointAttribute","PointAttribute","aabb","subVectors","PointAttributeNames","POSITION_CARTESIAN","COLOR_PACKED","COLOR_FLOATS_1","COLOR_FLOATS_255","NORMAL_FLOATS","FILLER","INTENSITY","CLASSIFICATION","NORMAL_SPHEREMAPPED","NORMAL_OCT16","NORMAL","PointAttributeTypes","DATA_TYPE_DOUBLE","ordinal","DATA_TYPE_FLOAT","DATA_TYPE_INT8","DATA_TYPE_UINT8","DATA_TYPE_INT16","DATA_TYPE_UINT16","DATA_TYPE_INT32","DATA_TYPE_UINT32","DATA_TYPE_INT64","DATA_TYPE_UINT64","obj","numElements","byteSize","RGBA_PACKED","RGB_PACKED","FILLER_1B","pointAttributeName","hasColors","hasNormals","scope","getURL","equalOrHigher","responseType","overrideMimeType","response","byteLength","pcoGeometry","buffers","attributeBuffers","fromArray","returnWorker","property","hasOwnProperty","indicesAttribute","Uint8BufferAttribute","indices","normalized","mean","loading","numNodesLoading","networkToNative","val","GreyhoundBinaryLoader","NUM_POINTS_BYTES","DataView","getUint32","bb","nodeOffset","getCenter","schema","normalize","GreyhoundUtils","replace","regex","RegExp","results","exec","window","location","decodeURIComponent","forEach","item","cb","reduce","serverURL","baseDepth","stringify","fetchBinary","err","Error","numBytes","pointSize","pointSizeFrom","colorNorm","intensityNorm","getUint16","color","intensity","loadInfoJSON","HIERARCHY_STEP_SIZE","split","fetch","greyhoundInfo","bounds","boundsConforming","width","depth","Array","isArray","getQueryParam","parseFloat","red","green","blue","entry","pgg","PointCloudGreyhoundGeometry","createSchema","srs","PointCloudGreyhoundGeometryNode","getNormalization","V3","dHalfLength","xHalfLength","yHalfLength","zHalfLength","cmin","cmax","toLowerCase","lf","LASFile","handler","LasLazBatcher","Promise","resolve","cancellable","then","isOpen","catch","CancellationError","close","getHeader","header","skip","totalRead","totalToRead","pointsCount","reader","readData","LASDecoder","pointsFormatId","pointsStructSize","count","mins","maxs","progressCB","hasMoreData","versionAsString","isCompressed","delay","lasBuffer","endsWith","str","colors","intensities","classifications","classification","returnNumbers","returnNumber","numberOfReturns","pointSourceIDs","Uint16Array","pointSourceID","arrayb","pointFormatID","Gradients","RAINBOW","Color","SPECTRAL","PLASMA","YELLOW_GREEN","VIRIDIS","INFERNO","GRAYSCALE","Classification","Vector4","PointSizeType","FIXED","ATTENUATED","ADAPTIVE","PointShape","SQUARE","CIRCLE","PARABOLOID","PointColorType","RGB","COLOR","DEPTH","HEIGHT","ELEVATION","INTENSITY_GRADIENT","LOD","LEVEL_OF_DETAIL","POINT_INDEX","RETURN_NUMBER","SOURCE","PHONG","RGB_HEIGHT","COMPOSITE","DISABLED","HIGHLIGHT_INSIDE","TreeType","OCTREE","KDTREE","PointCloudMaterial","parameters","visibleNodesTexture","generateDataTexture","minFilter","NearestFilter","magFilter","minSize","maxSize","treeType","_pointSizeType","_shape","_pointColorType","_useClipBox","_clipMode","_weighted","_depthMap","_gradient","_classification","DEFAULT","gradientTexture","generateGradientTexture","classificationTexture","generateClassificationTexture","lights","fog","_treeType","_useEDL","_defaultIntensityRangeChanged","_defaultElevationRangeChanged","value","uniforms","vnStart","blendHardness","blendDepthSupplement","screenWidth","screenHeight","near","far","uColor","opacity","octreeSize","bbSize","heightMin","heightMax","clipBoxCount","pcIndex","gradient","classificationLUT","toModel","depthMap","diffuse","transition","intensityRange","intensityGamma","intensityContrast","intensityBrightness","rgbGamma","rgbContrast","rgbBrightness","wRGB","wIntensity","wElevation","wClassification","wReturnNumber","wSourceID","defaultAttributeValues","vertexShader","getDefines","fragmentShader","vertexColors","VertexColors","blending","NoBlending","transparent","depthTest","depthWrite","useEDL","AdditiveBlending","depthFunc","AlwaysDepth","weighted","needsUpdate","defines","pointSizeType","shape","doUpdate","updateShaderSource","inverse","elements","isNaN","dispatchEvent","target","isEqual","key","recomputeClassification","canvas","createElement","context","rect","ctxGradient","createLinearGradient","step","addColorStop","getHexString","fillStyle","texture","Texture","w","DataTexture","RGBAFormat","RawShaderMaterial","EyeDomeLightingMaterial","Material","call","_neighbourCount","neighbours","neighbourCount","cos","edlStrength","colorMap","setValues","ShaderMaterial","PC","pointColorType","vs","fs","defineProperty","get","BlurMaterial","InputHandler","interactiveScenes","inputListeners","drag","mouse","Vector2","selection","hoveredElements","pressedKeys","wheelDelta","speed","logMessages","tabIndex","addEventListener","event","preventDefault","onMouseClick","onMouseDown","onMouseUp","onMouseMove","onMouseWheel","onDoubleClick","onKeyDown","onKeyUp","onTouchStart","onTouchEnd","onTouchMove","listener","touches","getBoundingClientRect","pageX","left","pageY","top","startDragging","inputListener","changedTouches","lastDrag","end","keyCode","deselectAll","consumed","hovered","object","find","el","point","viewStart","noMovement","getNormalizedDrag","button","selectable","isSelected","toggleSelection","clientX","clientY","buttons","getHoveredElements","currentlyHoveredObjects","previouslyHoveredObjects","now","prev","delta","detail","ndelta","sign","hoveredElement","args","start","startView","getMousePointCloudIntersection","oldSelection","splice","scenes","concat","interactableListeners","interactables","traverseVisible","hasInteractableListener","nmouse","clientWidth","vector","unproject","raycaster","Raycaster","ray","linePrecision","intersections","intersectObjects","diff","FirstPersonControls","sceneControls","Scene","rotationSpeed","moveSpeed","FORWARD","charCodeAt","BACKWARD","UP","DOWN","fadeFactor","yawDelta","pitchDelta","translationDelta","translationWorldDelta","tweens","startHandled","getMoveSpeed","ndrag","drop","scroll","setMoveSpeed","dblclick","zoomToLocation","I","targetRadius","minimumJumpDistance","nodesOnRay","lastNode","d","cameraTargetPosition","addVectors","controlsTargetPosition","animationDuration","easing","TWEEN","Easing","Quartic","Out","tween","Tween","to","startPos","targetPos","startRadius","onUpdate","onComplete","changes","changeHappens","some","stop","ih","inputHandler","moveForward","moveBackward","moveLeft","moveRight","moveUp","moveDown","yaw","pitch","translate","translateWorld","attenuation","GeoControls","enabled","track","trackPos","rotateSpeed","BOTTOM","A","S","D","W","Q","E","R","F","rotateStart","rotateEnd","rotateDelta","panStart","panEnd","panDelta","panOffset","phiDelta","thetaDelta","pan","shiftDown","lastPosition","STATE","NONE","ROTATE","SPEEDCHANGE","PAN","state","position0","changeEvent","startEvent","endEvent","setTrack","setTrackPos","_preserveRelativeRotation","preserveRelativeRotation","newTrackPos","oldTrackPos","newTangent","getTangentAt","oldTangent","tangentDiffNormal","crossVectors","angle","angleTo","rot","makeRotationAxis","dir","lookAt","axis","controls","translation","getTrackPos","rotateLeft","rotateUp","panLeft","te","panUp","panForward","getLength","deltaX","deltaY","targetDistance","right","bottom","warn","rotation","order","multiplier","moveForwardMouse","rotLeft","rotRight","raiseCamera","lowerCamera","makeRotationY","res","quaternion","setFromRotationMatrix","proposeTransformEvent","oldPosition","newPosition","objections","counterProposals","cp","getPointAt","reset","noZoom","shiftKey","create","OrbitControls","radiusDelta","stopTweens","resolvedRadius","previousTouch","touchStart","touchEnd","touchMove","curr","prevDX","prevDY","prevDist","sqrt","currDX","currDY","currDist","newRadius","progression","pivot","getPivot","V","panDistance","px","py","EarthControls","zoomDelta","camStart","pivotIndicator","sg","SphereGeometry","sm","Plane","setFromNormalAndCoplanarPoint","distanceToPlane","movedBy","newCamPos","originalPitch","tmpView","pivotToCam","pivotToCamTarget","getSide","applyAxisAngle","newCam","newCamTarget","fade","resolvedPos","jumpDistance","targetDir","newPos","pixelHeight","pr","projectedRadius","LRUItem","previous","next","first","last","items","contains","id","remove","lruItem","getLRUItem","toString","string","pointLoadLimit","disposeDescendants","current","dispose","Annotation","title","description","cameraPosition","cameraTarget","keepOpen","descriptionVisible","showDescription","actions","isHighlighted","_visible","__visible","_display","_expand","collapseThreshold","iconClose","elTitlebar","elTitle","elDescription","elDescriptionClose","clickTitle","hasView","moveHere","click","Action","action","pairWith","showIn","css","elButton","icon","onclick","annotation","hover","setHighlighted","mouseenter","mouseleave","on","display","descendants","descendant","expandByPoint","updateBounds","expand","annotations","highlighted","fadeIn","hasPosTargetView","hasRadiusView","endTarget","endPosition","camTargetDistance","endRadius","parentElement","removeChild","show","hide","traverseDescendants","tooltip","newIcon","oldIcon","Actions","ToggleAnnotationVisibility","setIcon","ProfileData","profile","segments","startGround","endGround","up","forward","N","cutPlane","halfPlane","segment","ProfileRequest","maxDepth","temporaryResult","pointsServed","highestLevelServed","initialize","nodeIntersectsProfile","maxNodesPerUpdate","intersectedNodes","getPointsInsideProfile","onProgress","request","onFinish","totalMileage","sv","setZ","segmentDir","accepted","mileage","acceptedPositions","nodeMatrix","makeTranslation","centerDistance","svp","localMileage","bufferedAttribute","filteredBuffer","itemSize","subarray","Float64Array","cancelRequested","onCancel","PointCloudOctreeNode","octree","visiblePointsTarget","loadQueue","visibleBounds","getBoundingBoxWorld","computeTransformedBoundingBox","bWidth","bMin","bMax","frustumCulled","onBeforeRender","_this","group","program","useProgram","getUniforms","setValue","visibleNodeTextureOffsets","disposeListener","oneTimeDisposeHandlers","leafNodes","isLeaf","updateVisibilityTexture","image","Map","sort","na","nb","substr","vArrayIndex","bbWorld","bsWorld","ray1","ray2","intersectsSphere","_ray","force","matrixAutoUpdate","matrixWorldNeedsUpdate","transform","tBox","projectedBoundingBox","Box2","ps","getProfile","project","_start","_end","_mileage","_boundingBox","xAxis","alpha","acos","toOrigin","alignWithX","applyMileage","inside","pointsFound","values","distanceToSphere","params","pickWindowSize","pickOutsideClipRegion","pickState","renderTarget","WebGLRenderTarget","LinearFilter","format","pickMaterial","setClipBoxes","setSize","setRenderTarget","pixelPos","addScalar","setScissor","setScissorTest","setTest","setMask","setBlending","clearTarget","tempNodes","tempNode","autoUpdate","render","clamp","number","pixelCount","readRenderTargetPixels","pixels","ibuffer","Uint32Array","hit","pIndex","pc","positionArray","nodesLoadTimes","IDCount","getHierarchyPath","numParts","loadHierachyThenPoints","loadPoints","hbuffer","getUint8","decoded","snode","mask","childName","childChildren","childNumPoints","currentNode","hurl","assign","baseLoaded","greyhoundBounds","greyhoundOffset","boundsString","loadHierarchyThenPoints","makeBitMask","parseChildrenCounts","base","swd","nwd","swu","nwu","sed","ned","seu","neu","greyhoundHierarchy","depthBegin","depthEnd","that","file","features","handleFinish","shapefile","source","read","done","toFixed","protocol","hostname","pathname","req","vertices","setFromPoints","nStr","x2","rgx","test","code","blob","Blob","createObjectURL","innerWidth","innerHeight","urls","materialArray","MeshBasicMaterial","BackSide","TextureLoader","progress","skyGeometry","CubeGeometry","skybox","LineBasicMaterial","Geometry","line","LineSegments","LinePieces","receiveShadow","gauss","exp","chroma","r","random","RGBFormat","setFromCamera","selectedPointcloud","closestDistance","closestIntersection","closestPoint","pick","imageData","createImageData","putImageData","Image","toDataURL","planes","negRadius","minDistance","g","search","newValue","history","replaceState","screenPass","screenScene","screenQuad","PlaneBufferGeometry","Camera","Features","ftCanvas","_vertexShaderPrecisionHighpFloat","getShaderPrecisionFormat","VERTEX_SHADER","HIGH_FLOAT","_vertexShaderPrecisionMediumpFloat","MEDIUM_FLOAT","_vertexShaderPrecisionLowpFloat","LOW_FLOAT","_fragmentShaderPrecisionHighpFloat","FRAGMENT_SHADER","_fragmentShaderPrecisionMediumpFloat","_fragmentShaderPrecisionLowpFloat","highpAvailable","precision","mediumpAvailable","SHADER_INTERPOLATION","isSupported","supported","MAX_VARYING_VECTORS","SHADER_SPLATS","SHADER_EDL","TextSprite","text","spriteMaterial","SpriteMaterial","sprite","Sprite","borderThickness","fontface","fontsize","borderColor","backgroundColor","textColor","setText","setTextColor","setBorderColor","setBackgroundColor","font","metrics","measureText","textWidth","margin","spriteWidth","spriteHeight","strokeStyle","lineWidth","roundRect","strokeText","fillText","ctx","beginPath","moveTo","lineTo","quadraticCurveTo","closePath","stroke","AnimationPath","spline","Spline","reparametrizeByArcLength","total","getPoint","metersPerSecond","Linear","None","samples","vmLength","versionMajor","versionMinor","newerThan","Measure","counter","_showDistances","_showCoordinates","_showArea","_closed","_showAngles","_showHeight","maxMarkers","MAX_SAFE_INTEGER","sphereGeometry","lengthUnit","spheres","edges","sphereLabels","edgeLabels","angleLabels","coordinateLabels","heightEdge","heightLabel","lineGeometry","lineMaterial","LineDashedMaterial","dashSize","gapSize","Line","areaLabel","sphereMaterial","MeshLambertMaterial","shading","SmoothShading","createSphereMaterial","linewidth","edge","edgeLabel","angleLabel","coordinateLabel","setPosition","mouseover","emissive","setHex","measurement","setMarker","edgeIndex","measure","area","p1","p2","closed","cornerPoint","point1","point2","v2","getAngleBetweenLines","labelPos","msg","addCommas","showCoordinates","lastIndex","centroid","divideScalar","nextIndex","previousIndex","nextPoint","previousPoint","verticesNeedUpdate","showDistances","dist","showAngles","showHeight","sorted","lowPoint","highPoint","heightLabelPosition","showArea","getArea","intersects","raycast","MeasuringTool","sceneMeasurement","light","PointLight","registerInteractiveScene","onRemove","onAdd","removeEventListener","cancel","removeLastMarker","insertionCallback","addMarker","removeMarker","addMeasurement","measurements","getWorldPosition","labels","label","screenPos","round","lowpoint","lowScreen","startScreen","endScreen","toPixelCoordinates","lowEL","startEL","endEL","distances","lToS","sToE","lineDistances","lineDistancesNeedUpdate","Profile","boxes","_modifiable","lineColor","getSegments","matrices","boxGeometry","BoxGeometry","boxMaterial","leftIndex","rightIndex","leftVertex","rightVertex","leftEdge","rightEdge","leftBox","rightBox","leftEdgeLength","rightEdgeLength","leftEdgeCenter","rightEdgeCenter","ProfileTool","sceneProfile","setWidth","addProfile","profiles","TransformationTool","sceneTransform","translationNode","rotationNode","scaleNode","TRANSFORMATION_MODES","TRANSLATE","SCALE","mode","menu","HoverMenu","setMode","addItem","HoverMenuItem","renderArea","createArrow","shaftGeometry","shaftMaterial","shaft","headGeometry","CylinderGeometry","headMaterial","head","arrow","intersectionStart","objectStart","Line3","camOnLine","closestPointToPoint","dragPlane","intersectPlane","iOnLine","arrowX","arrowY","arrowZ","createCircle","circle","applyEuler","from","cross","rotateOnAxis","roll","createHandle","scaleStart","oldDistance","newDistance","tbox","wp","getSelectionBoundingBox","Volume","_clip","clip","modifiable","computeBoundingBox","boxFrameGeometry","l","dimension","frame","volumeWorldPos","is","VolumeTool","sceneVolume","volume","volumes","removeVolume","addVolume","pp","getVolume","setIndex","GeoJSONExporter","coords","feature","coordinates","properties","labelPoint","labelArea","m","f","measurementToFeatures","geojson","DXFExporter","dxfSection","geomCode","xMax","yMax","zMax","measurementPointSection","measurementPolylineSection","dxfHeader","dxfBody","measurementSection","dxf","CSVExporter","headerValues","join","LASExporter","diagonal","setString","charCode","ArrayBuffer","u8View","setUint16","setUint32","setFloat64","boffset","pz","rt","setUint8","PointCloudArena4DNode","kdtree","PointCloud","sizeType","levels","la","lb","visibleNodeNames","b1","b2","b3","PointCloudArena4DGeometryNode","nodesLoading","iIndices","getFloat32","numNodes","provider","_spacing","Name","Provider","Nodes","BoundingBox","Spacing","Sphere","loadHierarchy","Date","getTime","hasLeft","hasRight","splitX","splitY","splitZ","parentBBSize","parseDuration","ProgressBar","_progress","_message","maxOpacity","elProgress","elProgressMessage","innerHTML","style","marginLeft","borderRadius","border","padding","textAlign","pointerEvents","appendChild","View","_pitch","maxPitch","minPitch","navigationMode","atan2","scenePointCloud","sceneBG","cameraBG","referenceFrame","fpControls","orbitControls","earthControls","geoControls","directionalLight","fromSpacing","pHeight","pFromSpacing","lpos","intersectBox","removeMeasurement","removeProfile","DirectionalLight","AmbientLight","grid","createGrid","createBackgroundTexture","bg","Viewer","potreeMap","potreeDescription","pointCloudLoadedCallback","onPointCloudLoaded","server","isFlipYZ","useDEMCollisions","minNodeSize","edlRadius","LENGTH_UNITS","METER","FEET","INCH","showAnnotations","freeze","mapView","progressBar","stats","Stats","potreeRenderer","edlRenderer","measuringTool","profileTool","volumeTool","transformationTool","clock","Clock","background","initThree","setScene","createControls","onPointcloudAdded","hasEventListener","setFOV","setEDLEnabled","setEDLRadius","setEDLStrength","setClipMode","setPointBudget","setShowBoundingBox","setFreeze","setNavigationMode","setBackground","scaleFactor","loadSettingsFromURL","requestAnimationFrame","loop","oldScene","detach","onAnnotationAdded","weightClassification","materialName","materialID","dialog","pointcloudBox","boxWorld","fitToScreen","getParameterByName","setPointSize","setOpacity","setMaterial","sizing","setPointSizing","quality","setQuality","tokens","disableAnnotations","enableAnnotations","sidebar","isVisible","toggle","sidebarContainer","imgMenuToggle","toggleSidebar","classList","imgMapToggle","toggleMap","insertBefore","MapView","init","i18n","lng","resGetPath","preload","getAsync","debug","initSidebar","elProfile","profileWindow","ProfileWindow","profileWindowController","ProfileWindowController","draggable","handle","containment","resizable","handles","lang","setLng","WebGLRenderer","premultipliedAlpha","sortObjects","autoClear","focus","loadSkybox","getShowAnnotations","renderAreaWidth","renderAreaHeight","screenSize","zIndex","containsPoint","timestamp","visiblePoints","ordered","capIndex","cap","somethingChanged","getControls","removeInputListener","addInputListener","boxInverse","boxPosition","updateAnnotations","sceneProjection","begin","getDelta","EDLRenderer","PotreeRenderer","updateProjectionMatrix","clear","setClearColor","clearDepth","edlMaterial","attributeMaterials","rtColor","FloatType","depthTexture","DepthTexture","UnsignedIntType","needsResize","initEDL","resize","useLogarithmicDepthBuffer","elRoot","svg","d3","select","mouseIsDown","geometryPool","geometries","maxPoints","setDrawRange","materialPool","materials","csvIcon","attr","lasIcon","initTHREE","initSVG","initListeners","mousedown","mouseup","mousemove","newMouse","autoFit","cPos","scaleX","invert","scaleY","ncPos","pixelRadius","elevation","selectPoint","pickSphere","info","html","selectedPoint","onWheel","updateScales","uri","btoa","toLAS","u8view","binString","String","fromCharCode","closest","attributeData","OrthographicCamera","offsetLeft","selectAll","linear","domain","range","orient","innerTickSize","outerTickSize","tickPadding","ticks","yAxis","getMaterial","getGeometry","model","materialChanged","listeners","posBuffer","sx","sy","entries","returnMaterial","returnGeometry","fadeOut","threshold","scheduledRecomputeTime","requests","_recompute","recompute","addPoints","getPointsInProfile","progressHandler","proj4","defs","webMapService","mapProjectionName","mapProjection","extentsLayer","cameraLayer","toolLayer","sourcesLayer","sourcesLabelLayer","createAnnotationStyle","ol","Style","Circle","Stroke","Fill","createLabelStyle","Text","setVisible","elMap","elTooltip","getExtentsLayer","getCameraLayer","getToolLayer","getSourcesLayer","getSourcesLabelLayer","annotationsLayer","getAnnotationsLayer","mousePositionControl","control","MousePosition","coordinateFormat","coordinate","createStringXY","undefinedHTML","DownloadSelectionControl","opt_options","options","btToggleTiles","getVisible","showSources","float","link","download","this_","handleDownload","selectedFeatures","getArray","host","alert","stopImmediatePropagation","cloudjsurl","sourceurl","content","className","Control","inherits","defaults","attributionOptions","collapsible","extend","layers","layer","Tile","OSM","olCenter","zoom","dragBoxLayer","Vector","addLayer","interaction","Select","addInteraction","getFeatures","dragBox","DragBox","condition","events","platformModifierKeyOnly","pixel","evt","forEachFeatureAtPixel","onHover","onClick","extent","getExtent","getSource","forEachFeatureIntersectingExtent","mapPos","toMap","Feature","geom","Point","setStyle","getCoordinates","getPixelFromCoordinate","addFeature","gExtent","LineString","featureVector","gCamera","minResolution","maxResolution","toScene","bottomLeft","bottomRight","topRight","topLeft","mapExtent","getMapExtent","mapCenter","pointMap","setSceneProjection","getMapCenter","getView","setCenter","setCoordinates","fit","constrainResolution","getJSON","sources","mapBounds","p3","p4","Polygon","pm","mapSize","resized","updateSize","getResolution","campos","camdir","sceneLookAt","geoPos","geoLookAt","mapLookAt","mapDir","mapLength","mapSide","createToolIcon","initToolbar","elToolbar","slideDown","startInsertion","removeAllMeasurements","initClassificationList","elClassificationList","addClassificationItem","inputID","elInput","setClassificationVisibility","checked","initAccordion","each","addClass","slideToggle","initAppearance","slider","getPointBudget","slide","ui","getFOV","getEDLRadius","getEDLStrength","getBackground","prop","getEDLEnabled","initNavigation","elNavigation","sldMoveSpeed","lblMoveSpeed","setTopView","setFrontView","setLeftView","speedRange","toLinearSpeed","toExpSpeed","initAnnotationDetails","annotationPanel","registeredEvents","rebuild","registeredEvent","dispatcher","chkEnable","container","elMain","elExpand","elIcon","mouseout","iconChanged","childContainer","annotationsChanged","initMeasurementDetails","trackedItems","removeIconPath","mlist","createCoordinatesTable","table","row","createAttributesTable","elTable","MeasurePanel","elPanel","elContentContainer","_update","DistancePanel","typename","elContent","elRemove","elCoordiantesContainer","totalDistance","getTotalDistance","elDistanceTable","elDistance","elTotal","PointPanel","elAttributesContainer","AreaPanel","elArea","AnglePanel","angles","getAngle","elAlpha","elBetta","elGamma","HeightPanel","elHeightLabel","ProfilePanel","labelID","sliderID","elShow2DProfile","setProfile","elDownloadButton","elWidthLabel","elWidthSlider","startValue","spinner","numberFormat","getWidth","spin","change","incremental","increments","widthListener","coordinatesTable","validate","input","cells","cell","updateCallback","assignValue","removeCommas","num","removeClass","coordinateComponent","which","focusout","getSegmentMatrices","minLOD","maxLOD","pcs","urlIsAbsolute","elMessage","workerID","observe","withCredentials","nowLoaded","duration","seconds","DONE","VolumePanel","elClip","elVisible","elX","elY","elZ","elLength","elWidth","elHeight","elBeta","isNumeric","toRadians","destroyed","toDegrees","beta","gamma","TYPE","DISTANCE","panel","AREA","POINT","ANGLE","PROFILE","VOLUME","getType","OTHER","trackMeasurement","stopTracking","destroy","onremove","scenelistener","trackScene","trackedItem","elActionsB","elDownload","initSceneList","scenelist","selectmenu","my","at","collision","selectedValue","setLengthUnit","initUIElements","pcMaterial","scenePanel","sldPointSize","lblPointSize","strSizeType","opt","sldOpacity","lblOpacity","inputVis","materialTransition","weightRGB","weightIntensity","weightElevation","weightReturnNumber","weightSourceID","spectrum","flat","showInput","preferredFormat","cancelText","chooseText","move","cRGB","toRgb","tc","setRGB","updateHeightRange","updateIntensityRange","log2","contrast","brightness","elMaterialList","option","elOption","updateMaterialPanel","toMaterialID","blockWeights","blockElevation","blockRGB","blockColor","blockIntensity","blockTransition","toMaterialName","buildSceneList","lastPos","lastTarget","strCamPos","strCamTarget","initSettings","getMinNodeSize","setMinNodeSize","toClipModeCode","toClipModeString","getClipMode","perfectScrollbar","circumference","arrange","menuItems","GLProgram","createProgram","recompile","createShader","shaderSource","compileShader","success","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","attachShader","linkProgram","getProgramParameter","LINK_STATUS","detachShader","deleteShader","ACTIVE_UNIFORMS","uniform","getActiveUniform","loc","getUniformLocation"],"mappings":"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","file":"potree.es5.js","sourcesContent":["\n\n\nfunction Potree(){\n\n}\nPotree.version = {\n\tmajor: 1,\n\tminor: 5,\n\tsuffix: \"RC\"\n};\n\nconsole.log(\"Potree \" + Potree.version.major + \".\" + Potree.version.minor + Potree.version.suffix);\n\nPotree.pointBudget = 1*1000*1000;\n\nPotree.framenumber = 0;\n\n// contains WebWorkers with base64 encoded code\n//Potree.workers = {};\n\nPotree.Shaders = {};\n\nPotree.webgl = {\n\tshaders: {},\n\tvaos: {},\n\tvbos: {}\n};\n\nPotree.scriptPath = null;\nif(document.currentScript.src){\n\t\tPotree.scriptPath = new URL(document.currentScript.src + \"/..\").href;\n        if (Potree.scriptPath.slice(-1) === '/') {\n            Potree.scriptPath = Potree.scriptPath.slice(0, -1);\n        }\n}else{\n\tconsole.error(\"Potree was unable to find its script path using document.currentScript. Is Potree included with a script tag? Does your browser support this function?\");\n}\n\nPotree.resourcePath = Potree.scriptPath + \"/resources\";\n\n\nPotree.timerQueries = {};\n\nPotree.timerQueriesEnabled = false;\n\nPotree.startQuery = function(name, gl){\n\tif(!Potree.timerQueriesEnabled){\n\t\treturn null;\n\t}\n\t\n\tif(Potree.timerQueries[name] === undefined){\n\t\tPotree.timerQueries[name] = [];\n\t}\n\t\n\tlet ext = gl.getExtension(\"EXT_disjoint_timer_query\");\n\tlet query = ext.createQueryEXT();\n\text.beginQueryEXT(ext.TIME_ELAPSED_EXT, query);\n\t\n\tPotree.timerQueries[name].push(query);\n\t\n\treturn query;\n};\n\nPotree.endQuery = function(query, gl){\n\tif(!Potree.timerQueriesEnabled){\n\t\treturn;\n\t}\n\t\n\tlet ext = gl.getExtension(\"EXT_disjoint_timer_query\");\n\text.endQueryEXT(ext.TIME_ELAPSED_EXT);\n};\n\nPotree.resolveQueries = function(gl){\n\tif(!Potree.timerQueriesEnabled){\n\t\treturn;\n\t}\n\t\n\tlet ext = gl.getExtension(\"EXT_disjoint_timer_query\");\n\t\n\tfor(let name in Potree.timerQueries){\n\t\tlet queries = Potree.timerQueries[name];\n\t\t\n\t\tif(queries.length > 0){\n\t\t\tlet query = queries[0];\n\t\t\t\n\t\t\tlet available = ext.getQueryObjectEXT(query, ext.QUERY_RESULT_AVAILABLE_EXT);\n\t\t\tlet disjoint = viewer.renderer.getContext().getParameter(ext.GPU_DISJOINT_EXT);\n\t\t\t\n\t\t\tif (available && !disjoint) {\n\t\t\t\t// See how much time the rendering of the object took in nanoseconds.\n\t\t\t\tlet timeElapsed = ext.getQueryObjectEXT(query, ext.QUERY_RESULT_EXT);\n\t\t\t\tlet miliseconds = timeElapsed / (1000 * 1000);\n\t\t\t\n\t\t\t\tconsole.log(name + \": \" + miliseconds + \"ms\");\n\t\t\t\tqueries.shift();\n\t\t\t}\n\t\t}\n\t\t\n\t\tif(queries.length === 0){\n\t\t\tdelete Potree.timerQueries[name];\n\t\t}\n\t}\n};\n\n\nPotree.MOUSE = {\n\tLEFT:   0b0001,\n\tRIGHT:  0b0010,\n\tMIDDLE: 0b0100\n};\n\nPotree.Points = class Points{\n\t\n\tconstructor(){\n\t\t\n\t\tthis.boundingBox = new THREE.Box3();\n\t\tthis.numPoints = 0;\n\t\tthis.data = {};\n\t\t\n\t}\n\t\n\tadd(points){\n\t\t\n\t\tlet currentSize = this.numPoints;\n\t\tlet additionalSize = points.numPoints;\n\t\tlet newSize = currentSize + additionalSize;\n\t\t\n\t\tlet thisAttributes = Object.keys(this.data);\n\t\tlet otherAttributes = Object.keys(points.data);\n\t\tlet attributes = new Set([...thisAttributes, ...otherAttributes]);\n\t\t\n\t\tfor(let attribute of attributes){\n\t\t\tif(thisAttributes.includes(attribute) && otherAttributes.includes(attribute)){\n\t\t\t\t\n\t\t\t\t// attribute in both, merge\n\t\t\t\tlet type = this.data[attribute].constructor;\n\t\t\t\tlet merged = new type(this.data[attribute].length + points.data[attribute].length);\n\t\t\t\tmerged.set(this.data[attribute], 0);\n\t\t\t\tmerged.set(points.data[attribute], this.data[attribute].length);\n\t\t\t\tthis.data[attribute] = merged;\n\t\t\t\t\n\t\t\t}else if(thisAttributes.includes(attribute) && !otherAttributes.includes(attribute)){\n\t\t\t\t\n\t\t\t\t// attribute only in this; take over this and expand to new size\n\t\t\t\tlet elementsPerPoint = this.data[attribute].length / this.numPoints;\n\t\t\t\tlet type = this.data[attribute].constructor;\n\t\t\t\tlet expanded = new type(elementsPerPoint * newSize);\n\t\t\t\texpanded.set(this.data[attribute], 0);\n\t\t\t\tthis.data[attribute] = expanded;\n\t\t\t\t\n\t\t\t}else if(!thisAttributes.includes(attribute) && otherAttributes.includes(attribute)){\n\t\t\t\t\n\t\t\t\t// attribute only in points to be added; take over new points and expand to new size\n\t\t\t\tlet elementsPerPoint = points.data[attribute].length / points.numPoints;\n\t\t\t\tlet type = points.data[attribute].constructor;\n\t\t\t\tlet expanded = new type(elementsPerPoint * newSize);\n\t\t\t\texpanded.set(points.data[attribute], elementsPerPoint * currentSize);\n\t\t\t\tthis.data[attribute] = expanded;\n\t\t\t\t\n\t\t\t}\n\t\t}\n\t\t\n\t\tthis.numPoints = newSize;\n\t\t\n\t\tthis.boundingBox.union(points.boundingBox);\n\t}\n\t\n};\n\n\nPotree.loadPointCloud = function(path, name, callback){\n\t\n\tlet loaded = function(pointcloud){\n\t\tpointcloud.name = name;\n\t\t\n\t\tcallback({type: \"pointcloud_loaded\", pointcloud: pointcloud});\n\t};\n\t\n\t// load pointcloud\n\tif(!path){\n\t\t\n\t}else if(path.indexOf(\"greyhound://\") === 0){\n\t\t// We check if the path string starts with 'greyhound:', if so we assume it's a greyhound server URL.\n\t\tPotree.GreyhoundLoader.load(path, function(geometry) {\n\t\t\tif(!geometry){\n\t\t\t\tcallback({type: \"loading_failed\"});\n\t\t\t}else{\n\t\t\t\tlet pointcloud = new Potree.PointCloudOctree(geometry);\n\t\t\t\tloaded(pointcloud);\n\t\t\t}\n\t\t});\n\t}else if(path.indexOf(\"cloud.js\") > 0){\n\t\tPotree.POCLoader.load(path, function(geometry){\n\t\t\tif(!geometry){\n\t\t\t\tcallback({type: \"loading_failed\"});\n\t\t\t}else{\n\t\t\t\tlet pointcloud = new Potree.PointCloudOctree(geometry);\n\t\t\t\tloaded(pointcloud);\n\t\t\t}\n\t\t}.bind(this));\n\t}else if(path.indexOf(\".vpc\") > 0){\n\t\tPotree.PointCloudArena4DGeometry.load(path, function(geometry){\n\t\t\tif(!geometry){\n\t\t\t\tcallback({type: \"loading_failed\"});\n\t\t\t}else{\n\t\t\t\tlet pointcloud = new Potree.PointCloudArena4D(geometry);\n\t\t\t\tloaded(pointcloud);\n\t\t\t}\n\t\t});\n\t}else{\n\t\tcallback({\"type\": \"loading_failed\"});\n\t}\n};\n\nPotree.updatePointClouds = function(pointclouds, camera, renderer){\n\n\tif(!Potree.lru){\n\t\tPotree.lru = new LRU();\n\t}\n\n\tfor(let i = 0; i < pointclouds.length; i++){\n\t\tlet pointcloud = pointclouds[i];\n\t\tfor(let j = 0; j < pointcloud.profileRequests.length; j++){\n\t\t\tpointcloud.profileRequests[j].update();\n\t\t}\n\t}\n\t\n\tlet result = Potree.updateVisibility(pointclouds, camera, renderer);\n\t\n\tfor(let i = 0; i < pointclouds.length; i++){\n\t\tlet pointcloud = pointclouds[i];\n\t\tpointcloud.updateMaterial(pointcloud.material, pointcloud.visibleNodes, camera, renderer);\n\t\tpointcloud.updateVisibleBounds();\n\t}\n\n\tPotree.getLRU().freeMemory();\n\n\treturn result;\n};\n\nPotree.getLRU = function(){\n\tif(!Potree.lru){\n\t\tPotree.lru = new LRU();\n\t}\n\n\treturn Potree.lru;\n};\n\n\nfunction updateVisibilityStructures(pointclouds, camera, renderer){\n\tlet frustums = [];\n\tlet camObjPositions = [];\n\tlet priorityQueue = new BinaryHeap(function(x){return 1 / x.weight;});\n\t\n\tfor(let i = 0; i < pointclouds.length; i++){\n\t\tlet pointcloud = pointclouds[i];\n\t\t\n\t\tif(!pointcloud.initialized()){\n\t\t\tcontinue;\n\t\t}\n\n\t\tpointcloud.numVisibleNodes = 0;\n\t\tpointcloud.numVisiblePoints = 0;\n\t\tpointcloud.deepestVisibleLevel = 0;\n\t\tpointcloud.visibleNodes = [];\n\t\tpointcloud.visibleGeometry = [];\n\n\t\t// frustum in object space\n\t\tcamera.updateMatrixWorld();\n\t\tlet frustum = new THREE.Frustum();\n\t\tlet viewI = camera.matrixWorldInverse;\n\t\tlet world = pointcloud.matrixWorld;\n\t\tlet proj = camera.projectionMatrix;\n\t\tlet fm = new THREE.Matrix4().multiply(proj).multiply(viewI).multiply(world);\n\t\tfrustum.setFromMatrix( fm );\n\t\tfrustums.push(frustum);\n\n\t\t// camera position in object space\n\t\tlet view = camera.matrixWorld;\n\t\tlet worldI = new THREE.Matrix4().getInverse(world);\n\t\tlet camMatrixObject = new THREE.Matrix4().multiply(worldI).multiply(view);\n\t\tlet camObjPos = new THREE.Vector3().setFromMatrixPosition( camMatrixObject );\n\t\tcamObjPositions.push(camObjPos);\n\n\t\tif(pointcloud.visible && pointcloud.root !== null){\n\t\t\tpriorityQueue.push({pointcloud: i, node: pointcloud.root, weight: Number.MAX_VALUE});\n\t\t}\n\n\t\t// hide all previously visible nodes\n\t\t//if(pointcloud.root instanceof Potree.PointCloudOctreeNode){\n\t\t//\tpointcloud.hideDescendants(pointcloud.root.sceneNode);\n\t\t//}\n\t\tif(pointcloud.root.isTreeNode()){\n\t\t\tpointcloud.hideDescendants(pointcloud.root.sceneNode);\n\t\t}\n\t\t\n\t\tfor(let j = 0; j < pointcloud.boundingBoxNodes.length; j++){\n\t\t\tpointcloud.boundingBoxNodes[j].visible = false;\n\t\t}\n\t}\n\t\n\treturn {\n\t\t\"frustums\": frustums,\n\t\t\"camObjPositions\" : camObjPositions,\n\t\t\"priorityQueue\": priorityQueue\n\t};\n}\n\nPotree.getDEMWorkerInstance = function(){\n\tif(!Potree.DEMWorkerInstance){\n\t\tlet workerPath = Potree.scriptPath + \"/workers/DEMWorker.js\";\n\t\tPotree.DEMWorkerInstance = Potree.workerPool.getWorker(workerPath);\n\t}\n\t\n\treturn Potree.DEMWorkerInstance;\n}\n\nfunction createDEMMesh(dem){\n\t\n\tlet box = dem.boundingBox;\n\n\tlet steps = 256;\n\tlet triangles =  [];\n\tfor(let i = 0; i < steps; i++){\n\t\tfor(let j = 0; j < steps; j++){\n\t\t\tlet u0 = i / steps;\n\t\t\tlet u1 = (i+1) / steps;\n\t\t\tlet v0 = j / steps;\n\t\t\tlet v1 = (j+1) / steps;\n\t\t\t\n\t\t\t//let x0 = box.min.x + u0 * box.getSize().x;\n\t\t\t//let x1 = box.min.x + u1 * box.getSize().x;\n\t\t\t//let y0 = box.min.y + v0 * box.getSize().y;\n\t\t\t//let y1 = box.min.y + v1 * box.getSize().y;\n\t\t\t//\n\t\t\t//let h00 = dem.height(new THREE.Vector3(x0, y0, 0));\n\t\t\t//let h10 = dem.height(new THREE.Vector3(x1, y0, 0));\n\t\t\t//let h01 = dem.height(new THREE.Vector3(x0, y1, 0));\n\t\t\t//let h11 = dem.height(new THREE.Vector3(x1, y1, 0));\n\t\t\t\n\t\t\tlet x0 = u0 * box.getSize().x;\n\t\t\tlet x1 = u1 * box.getSize().x;\n\t\t\tlet y0 = v0 * box.getSize().y;\n\t\t\tlet y1 = v1 * box.getSize().y;\n\t\t\t\n\t\t\t//let h00 = demNode.data[(i+0) + tileSize * (j+0)];\n\t\t\t//let h10 = demNode.data[(i+1) + tileSize * (j+0)];\n\t\t\t//let h01 = demNode.data[(i+0) + tileSize * (j+1)];\n\t\t\t//let h11 = demNode.data[(i+1) + tileSize * (j+1)];\n\t\t\t\n\t\t\tlet h00 = dem.height(new THREE.Vector3(box.min.x + x0, box.min.y + y0));\n\t\t\tlet h10 = dem.height(new THREE.Vector3(box.min.x + x1, box.min.y + y0));\n\t\t\tlet h01 = dem.height(new THREE.Vector3(box.min.x + x0, box.min.y + y1));\n\t\t\tlet h11 = dem.height(new THREE.Vector3(box.min.x + x1, box.min.y + y1));\n\t\t\t\n\t\t\tif(![h00, h10, h01, h11].every(n => isFinite(n))){\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t\n\t\t\ttriangles.push(x0, y0, h00);\n\t\t\ttriangles.push(x0, y1, h01);\n\t\t\ttriangles.push(x1, y0, h10);\n\t\t\t\n\t\t\ttriangles.push(x0, y1, h01);\n\t\t\ttriangles.push(x1, y1, h11);\n\t\t\ttriangles.push(x1, y0, h10);\n\t\t}\n\t}\n    \n\tlet geometry = new THREE.BufferGeometry();\n\tlet positions = new Float32Array(triangles);\n\tgeometry.addAttribute( 'position', new THREE.BufferAttribute(positions, 3));\n\tgeometry.computeBoundingSphere();\n\tgeometry.computeVertexNormals();\n\tlet material = new THREE.MeshNormalMaterial({side: THREE.DoubleSide});\n\tlet mesh = new THREE.Mesh(geometry, material);\n\tmesh.position.copy(box.min);\n\t//mesh.position.copy(pointcloud.position);\n\tviewer.scene.scene.add(mesh);\n}\n\nfunction createDEMMeshNode(dem, demNode){\n\t\n\tlet box = demNode.box;\n\tlet tileSize = dem.tileSize * 1;\n\t\n\tlet triangles =  [];\n\tfor(let i = 0; i < tileSize; i++){\n\t\t//for(let j = 0; j < 1; j++){\n\t\tfor(let j = 0; j < tileSize; j++){\n\t\t\tlet u0 = i / tileSize;\n\t\t\tlet u1 = (i+1) / tileSize;\n\t\t\tlet v0 = j / tileSize;\n\t\t\tlet v1 = (j+1) / tileSize;\n\t\t\t\n\t\t\tlet x0 = u0 * box.getSize().x;\n\t\t\tlet x1 = u1 * box.getSize().x;\n\t\t\tlet y0 = v0 * box.getSize().y;\n\t\t\tlet y1 = v1 * box.getSize().y;\n\t\t\t\n\t\t\t//let h00 = demNode.data[(i+0) + tileSize * (j+0)];\n\t\t\t//let h10 = demNode.data[(i+1) + tileSize * (j+0)];\n\t\t\t//let h01 = demNode.data[(i+0) + tileSize * (j+1)];\n\t\t\t//let h11 = demNode.data[(i+1) + tileSize * (j+1)];\n\t\t\t\n\t\t\tlet h00 = demNode.height(new THREE.Vector3(box.min.x + x0, box.min.y + y0));\n\t\t\tlet h10 = demNode.height(new THREE.Vector3(box.min.x + x1, box.min.y + y0));\n\t\t\tlet h01 = demNode.height(new THREE.Vector3(box.min.x + x0, box.min.y + y1));\n\t\t\tlet h11 = demNode.height(new THREE.Vector3(box.min.x + x1, box.min.y + y1));\n\t\t\t\n\t\t\tif(![h00, h10, h01, h11].every(n => isFinite(n))){\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t\n\t\t\ttriangles.push(x0, y0, h00);\n\t\t\ttriangles.push(x0, y1, h01);\n\t\t\ttriangles.push(x1, y0, h10);\n\t\t\t\n\t\t\ttriangles.push(x0, y1, h01);\n\t\t\ttriangles.push(x1, y1, h11);\n\t\t\ttriangles.push(x1, y0, h10);\n\t\t}\n\t}\n    \n\tlet geometry = new THREE.BufferGeometry();\n\tlet positions = new Float32Array(triangles);\n\tgeometry.addAttribute( 'position', new THREE.BufferAttribute(positions, 3));\n\tgeometry.computeBoundingSphere();\n\tgeometry.computeVertexNormals();\n\tlet material = new THREE.MeshNormalMaterial({side: THREE.DoubleSide});\n\tlet mesh = new THREE.Mesh(geometry, material);\n\tmesh.position.copy(box.min);\n\t//mesh.position.copy(pointcloud.position);\n\tviewer.scene.scene.add(mesh);\n\t\n\t{ // DEBUG code\n\t\t//let data = demNode.data;\n\t\t\n\t\tlet steps = 64;\n\t\tlet data = new Float32Array(steps * steps);\n\t\tlet imgData = new Uint8Array(data.length * 4);\n\t\tlet box = demNode.box;\n\t\tlet boxSize = box.getSize();\n\t\tfor(let i = 0; i < steps; i++){\n\t\t\tfor(let j = 0; j < steps; j++){\n\t\t\t\tlet [u, v] = [i / (steps - 1), j / (steps - 1)];\n\t\t\t\tlet pos = new THREE.Vector3(\n\t\t\t\t\tu * boxSize.x + box.min.x,\n\t\t\t\t\tv * boxSize.y + box.min.y,\n\t\t\t\t\t0\n\t\t\t\t);\n\t\t\t\t\n\t\t\t\tlet height = demNode.height(pos);\n\t\t\t\t\n\t\t\t\tlet index = i + steps * j;\n\t\t\t\tdata[index] = height\n\t\t\t\t\n\t\t\t\t//let index = i + steps * j;\n\t\t\t\t//imgData[4*index + 0] = 255 * (height - min) / (max - min);\n\t\t\t\t//imgData[4*index + 1] = 100;\n\t\t\t\t//imgData[4*index + 2] = 0;\n\t\t\t\t//imgData[4*index + 3] = 255;\n\t\t\t}\n\t\t}\n\t\t\n\t\tlet [min, max] = [Infinity, -Infinity];\n\t\tfor(let height of data){\n\t\t\tif(!isFinite(height)){\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t\n\t\t\tmin = Math.min(min, height);\n\t\t\tmax = Math.max(max, height);\n\t\t}\n\t\t\n\t\tfor(let i = 0; i < data.length; i++){\n\t\t\timgData[4*i + 0] = 255 * (data[i] - min) / (max - min);\n\t\t\timgData[4*i + 1] = 100;\n\t\t\timgData[4*i + 2] = 0;\n\t\t\timgData[4*i + 3] = 255;\n\t\t}\n\t\t\n\t\tlet img = Potree.utils.pixelsArrayToImage(imgData, steps, steps);\n\t\t\n\t\tlet screenshot = img.src;\n\t\t\n\t\tif(!this.debugDIV){\n\t\t\tthis.debugDIV = $(`\n\t\t\t\t<div id=\"pickDebug\" \n\t\t\t\tstyle=\"position: absolute; \n\t\t\t\tright: 400px; width: 300px;\n\t\t\t\tbottom: 44px; width: 300px;\n\t\t\t\tz-index: 1000;\n\t\t\t\t\"></div>`);\n\t\t\t$(document.body).append(this.debugDIV);\n\t\t}\n\t\t\n\t\tthis.debugDIV.empty();\n\t\tthis.debugDIV.append($(`<img src=\"${screenshot}\"\n\t\t\tstyle=\"transform: scaleY(-1); width: 256px; height: 256px;\"/>`));\n\t\t\n\t}\n}\n\nPotree.updateVisibility = function(pointclouds, camera, renderer){\n\tlet numVisibleNodes = 0;\n\tlet numVisiblePoints = 0;\n\t\n\tlet visibleNodes = [];\n\tlet visibleGeometry = [];\n\tlet unloadedGeometry = [];\n\t\n\tlet lowestSpacing = Infinity;\n\t\n\t// calculate object space frustum and cam pos and setup priority queue\n\tlet s = updateVisibilityStructures(pointclouds, camera, renderer);\n\tlet frustums = s.frustums;\n\tlet camObjPositions = s.camObjPositions;\n\tlet priorityQueue = s.priorityQueue;\n\t\n\tlet loadedToGPUThisFrame = 0;\n\t\n\twhile(priorityQueue.size() > 0){\n\t\tlet element = priorityQueue.pop();\n\t\tlet node = element.node;\n\t\tlet parent = element.parent;\n\t\tlet pointcloud = pointclouds[element.pointcloud];\n\t\t\n\t\t//{ // restrict to certain nodes for debugging\n\t\t//\tlet allowedNodes = [\"r\", \"r0\", \"r4\"];\n\t\t//\tif(!allowedNodes.includes(node.name)){\n\t\t//\t\tcontinue;\n\t\t//\t}\n\t\t//}\n\t\t\n\t\tlet box = node.getBoundingBox();\n\t\tlet frustum = frustums[element.pointcloud];\n\t\tlet camObjPos = camObjPositions[element.pointcloud];\n\t\t\n\t\tlet insideFrustum = frustum.intersectsBox(box);\n\t\tlet maxLevel = pointcloud.maxLevel || Infinity;\n\t\tlet level = node.getLevel();\n\t\tlet visible = insideFrustum;\n\t\tvisible = visible && !(numVisiblePoints + node.getNumPoints() > Potree.pointBudget);\n\t\tvisible = visible && level < maxLevel;\n\t\t\n\t\tif (pointcloud.material.numClipBoxes > 0 && visible && pointcloud.material.clipMode == Potree.ClipMode.CLIP_OUTSIDE) {\n\t\t\tlet box2 = box.clone(); \n\t\t\tpointcloud.updateMatrixWorld(true);\n\t\t\tbox2.applyMatrix4(pointcloud.matrixWorld);\n\t\t\tlet intersectsClipBoxes = false;\n\t\t\tfor(let clipBox of pointcloud.material.clipBoxes) {\n\t\t\t\tlet clipMatrixWorld = clipBox.matrix;\n\t\t\t\tlet clipBoxWorld = new THREE.Box3(\n\t\t\t\t\t\tnew THREE.Vector3(-0.5, -0.5, -0.5), \n\t\t\t\t\t\tnew THREE.Vector3(0.5, 0.5, 0.5))\n\t\t\t\t\t.applyMatrix4(clipMatrixWorld);\n\t\t\t\tif (box2.intersectsBox(clipBoxWorld)) {\n\t\t\t\t\tintersectsClipBoxes = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tvisible = visible && intersectsClipBoxes;\n\t\t}\n\t\t\n\t\t//visible = [\"r\", \"r0\", \"r06\", \"r060\"].includes(node.name);\n\t\t//visible = [\"r\"].includes(node.name);\n\t\t\n\t\tif(node.spacing){\n\t\t\tlowestSpacing = Math.min(lowestSpacing, node.spacing);\n\t\t}else if(node.geometryNode && node.geometryNode.spacing){\n\t\t\tlowestSpacing = Math.min(lowestSpacing, node.geometryNode.spacing);\n\t\t}\n\t\t\n\t\tif(numVisiblePoints + node.getNumPoints() > Potree.pointBudget){\n\t\t\tbreak;\n\t\t}\n\t\t\n\t\t\n\t\tif(!visible){\n\t\t\tcontinue;\n\t\t}\n\n\t\tnumVisibleNodes++;\n\t\tnumVisiblePoints += node.getNumPoints();\n\n\t\tpointcloud.numVisibleNodes++;\n\t\tpointcloud.numVisiblePoints += node.getNumPoints();\n\n\t\tif(node.isGeometryNode() && (!parent || parent.isTreeNode())){\n\t\t\tif(node.isLoaded() && loadedToGPUThisFrame < 2){\n\t\t\t\tnode = pointcloud.toTreeNode(node, parent);\n\t\t\t\tloadedToGPUThisFrame++;\n\t\t\t}else{\n\t\t\t\tunloadedGeometry.push(node);\n\t\t\t\tvisibleGeometry.push(node);\n\t\t\t}\n\t\t}\n\n\t\tif(node.isTreeNode()){\n\t\t\tPotree.getLRU().touch(node.geometryNode);\n\t\t\tnode.sceneNode.visible = true;\n\t\t\tnode.sceneNode.material = pointcloud.material;\n\n\t\t\tvisibleNodes.push(node);\n\t\t\tpointcloud.visibleNodes.push(node);\n\n\t\t\tnode.sceneNode.updateMatrix();\n\t\t\tnode.sceneNode.matrixWorld.multiplyMatrices( pointcloud.matrixWorld, node.sceneNode.matrix );\n\n\t\t\tif(pointcloud.showBoundingBox && !node.boundingBoxNode && node.getBoundingBox){\n\t\t\t\tlet boxHelper = new Potree.Box3Helper(node.getBoundingBox());\n\t\t\t\t//let boxHelper = new THREE.BoxHelper(node.sceneNode);\n\t\t\t\tpointcloud.add(boxHelper);\n\t\t\t\tpointcloud.boundingBoxNodes.push(boxHelper);\n\t\t\t\tnode.boundingBoxNode = boxHelper;\n\t\t\t\tnode.boundingBoxNode.matrixWorld.copy(pointcloud.matrixWorld);\n\t\t\t}else if(pointcloud.showBoundingBox){\n\t\t\t\tnode.boundingBoxNode.visible = true;\n\t\t\t\tnode.boundingBoxNode.matrixWorld.copy(pointcloud.matrixWorld);\n\t\t\t}else if(!pointcloud.showBoundingBox && node.boundingBoxNode){\n\t\t\t\tnode.boundingBoxNode.visible = false;\n\t\t\t}\n\t\t\t\n\t\t}\n\n\t\t// add child nodes to priorityQueue\n\t\tlet children = node.getChildren();\n\t\tfor(let i = 0; i < children.length; i++){\n\t\t\tlet child = children[i];\n\t\t\t\n\t\t\tlet sphere = child.getBoundingSphere();\n\t\t\tlet distance = sphere.center.distanceTo(camObjPos);\n\t\t\tlet radius = sphere.radius;\n\t\t\t\n\t\t\tlet fov = (camera.fov * Math.PI) / 180;\n\t\t\tlet slope = Math.tan(fov / 2);\n\t\t\tlet projFactor = (0.5 * renderer.domElement.clientHeight) / (slope * distance);\n\t\t\tlet screenPixelRadius = radius * projFactor;\n\t\t\t\n\t\t\tif(screenPixelRadius < pointcloud.minimumNodePixelSize){\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t\n\t\t\tlet weight = screenPixelRadius;\n\n\t\t\tif(distance - radius < 0){\n\t\t\t\tweight = Number.MAX_VALUE;\n\t\t\t}\n\n\t\t\tpriorityQueue.push({pointcloud: element.pointcloud, node: child, parent: node, weight: weight});\n\t\t}\n\n\n\t}// end priority queue loop\n\t\n\t{ // update DEM\n\t\tlet maxDEMLevel = 4;\n\t\tlet candidates = pointclouds\n\t\t\t.filter(p => (p.generateDEM && p.dem instanceof Potree.DEM));\n\t\tfor(let pointcloud of candidates){\n\t\t\tlet updatingNodes = pointcloud.visibleNodes.filter(n => n.getLevel() <= maxDEMLevel);\n\t\t\tpointcloud.dem.update(updatingNodes);\n\t\t}\n\t}\n\t\n\tfor(let i = 0; i < Math.min(5, unloadedGeometry.length); i++){\n\t\tunloadedGeometry[i].load();\n\t}\n\t\n\t//for(let node of visibleNodes){\n\t//\tlet allowedNodes = [\"r\", \"r0\", \"r4\"];\n\t//\tnode.sceneNode.visible = allowedNodes.includes(node.geometryNode.name);\n\t//\t\n\t//\tif(node.boundingBoxNode){\n\t//\t\tnode.boundingBoxNode.visible = node.boundingBoxNode.visible && node.sceneNode.visible;\n\t//\t}\n\t//}\n\t\n\t\n\t//Potree.updateDEMs(renderer, visibleNodes);\n\n\treturn {\n\t\tvisibleNodes: visibleNodes, \n\t\tnumVisiblePoints: numVisiblePoints,\n\t\tlowestSpacing: lowestSpacing\n\t};\n};\n\n\n\n/*\n//\n// WAY TOO SLOW WITH SYNCHRONOUS READ PIXEL\n//\nPotree.DEMRenderer = class{\n\tconstructor(renderer){\n\t\tthis.renderer = renderer;\n\t\t\n\t\tthis.tileWidth = 64;\n\t\tthis.tileHeight = 64;\n\t\t\n\t\t//this.target = new THREE.WebGLRenderTarget( 64, 64, { \n\t\t//\tminFilter: THREE.NearestFilter, \n\t\t//\tmagFilter: THREE.NearestFilter, \n\t\t//\tformat: THREE.RGBAFormat, \n\t\t//\ttype: THREE.FloatType\n\t\t//} );\n\t\t//this.target.depthTexture = new THREE.DepthTexture();\n        //this.target.depthTexture.type = THREE.UnsignedIntType;\n\t\t\n\t\tthis.targetElevation = new THREE.WebGLRenderTarget( this.tileWidth, this.tileHeight, { \n\t\t\tminFilter: THREE.NearestFilter, \n\t\t\tmagFilter: THREE.NearestFilter, \n\t\t\tformat: THREE.RGBAFormat,\n\t\t\t//type: THREE.FloatType\n\t\t});\n\t\t\n\t\tthis.targetMedian = new THREE.WebGLRenderTarget( this.tileWidth, this.tileHeight, { \n\t\t\tminFilter: THREE.NearestFilter, \n\t\t\tmagFilter: THREE.NearestFilter, \n\t\t\tformat: THREE.RGBAFormat,\n\t\t\t//type: THREE.FloatType\n\t\t});\n\t\n\t\tthis.vsElevation = `\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\t\t\t\n\t\t\tattribute vec3 position;\n\t\t\t\n\t\t\tuniform mat4 modelMatrix;\n\t\t\tuniform mat4 modelViewMatrix;\n\t\t\tuniform mat4 projectionMatrix;\n\t\t\t\n\t\t\tvarying float vElevation;\n\t\t\t\n\t\t\tvoid main(){\n\t\t\t\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\tgl_Position = projectionMatrix * mvPosition;\n\t\t\t\tgl_PointSize = 1.0;\n\t\t\t\t\n\t\t\t\tvElevation = position.z;\n\t\t\t}\n\t\t`;\n\t\n\t\tthis.fsElevation = `\n\t\t\t\t\tprecision mediump float;\n\t\t\t\t\tprecision mediump int;\n\t\t\t\t\t\n\t\t\t\t\tvarying float vElevation;\n\t\t\t\t\t\n\t\t\t\t\tvoid main(){\n\t\t\t\t\t\tgl_FragColor = vec4(vElevation, 0.0, 0.0, 1.0);\n\t\t\t\t\t}\n\t\t`;\n\t\t\n\t\tthis.vsMedian = `\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\t\t\t\n\t\t\tattribute vec3 position;\n\t\t\tattribute vec2 uv;\n\t\t\t\n\t\t\tuniform mat4 modelMatrix;\n\t\t\tuniform mat4 modelViewMatrix;\n\t\t\tuniform mat4 projectionMatrix;\n\t\t\n\t\t\tvarying vec2 vUV;\n\n\t\t\tvoid main() {\n\t\t\t\tvUV = uv;\n\t\t\t\t\n\t\t\t\tvec4 mvPosition = modelViewMatrix * vec4(position,1.0);\n\n\t\t\t\tgl_Position = projectionMatrix * mvPosition;\n\t\t\t}\n\t\t`;\n\t\t\n\t\tthis.fsMedian = `\n\t\t\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\t\t\t\n\t\t\tuniform float uWidth;\n\t\t\tuniform float uHeight;\t\t\t\t\t\n\t\t\tuniform sampler2D uTexture;\n\n\t\t\tvarying vec2 vUV;\n\t\t\t\n\t\t\tvoid main(){\n\t\t\t\tvec2 uv = gl_FragCoord.xy / vec2(uWidth, uHeight);\t\t\t\t\t\t\n\t\t\t\t\n\t\t\t\tvec4 color = texture2D(uTexture, uv);\n\t\t\t\tgl_FragColor = color;\n                if(color.a == 0.0){\n\t\t\t\t\t\n                    vec4 sum;\n                    \n                    float minVal = 1.0 / 0.0;\n                    \n                    float sumA = 0.0;\n\t\t\t\t\tfor(int i = -1; i <= 1; i++){\n\t\t\t\t\t\tfor(int j = -1; j <= 1; j++){\n\t\t\t\t\t\t\tvec2 n = gl_FragCoord.xy + vec2(i, j);\n                            vec2 uv = n / vec2(uWidth, uHeight);\t\n                            vec4 c = texture2D(uTexture, uv);\n                            \n                            if(c.a == 1.0){\n                            \tminVal = min(c.r, minVal);\n                            }\n                            \n                            sumA += c.a;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n                    \n                    if(sumA > 0.0){\n                    \tgl_FragColor = vec4(minVal, 0.0, 0.0, 1.0);\n                    }else{\n                    \tdiscard;   \n                    }\n\t\t\t\t}else{\n\t\t\t\t\t//gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);\n\t\t\t\t\tgl_FragColor = vec4(color.rgb, 1.0);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\n\t\t\t}\n\t\t\n\t\t`;\n\t\t\n\t\tthis.elevationMaterial = new THREE.RawShaderMaterial( {\n\t\t\tvertexShader: this.vsElevation,\n\t\t\tfragmentShader: this.fsElevation,\n\t\t} );\n\t\t\n\t\tthis.medianFilterMaterial = new THREE.RawShaderMaterial( {\n\t\t\tuniforms: {\n\t\t\t\tuWidth: {value: 1.0},\n\t\t\t\tuHeight: {value: 1.0},\n\t\t\t\tuTexture: {type: \"t\", value: this.targetElevation.texture}\n\t\t\t},\n\t\t\tvertexShader: this.vsMedian,\n\t\t\tfragmentShader: this.fsMedian,\n\t\t});\n\t\t\n\t\tthis.camera = new THREE.OrthographicCamera(0, 1, 1, 0, 0, 1);\n\t\t\n\t\t\n\t}\n\t\n\trender(pointcloud, node){\n\t\tif(!node.geometryNode){\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tPotree.timerQueriesEnabled = true;\n\t\tlet start = new Date().getTime();\n\t\tlet queryAll = Potree.startQuery(\"All\", this.renderer.getContext());\n\t\t\n\t\tthis.renderer.setClearColor(0x0000FF, 0);\n\t\tthis.renderer.clearTarget( this.target, true, true, true );\n\t\tthis.renderer.clearTarget(this.targetElevation, true, true, false );\n\t\tthis.renderer.clearTarget(this.targetMedian, true, true, false );\n\t\t\n\t\tlet box = node.geometryNode.boundingBox;\n\t\t\n\t\tthis.camera.up.set(0, 0, 1);\n\t\t//this.camera.rotation.x = Math.PI / 2;\n\t\tthis.camera.left = box.min.x;\n\t\tthis.camera.right = box.max.x;\n\t\tthis.camera.top = box.max.y;\n\t\tthis.camera.bottom = box.min.y;\n\t\tthis.camera.near = -1000;\n\t\tthis.camera.far = 1000;\n\t\tthis.camera.updateProjectionMatrix();\n\t\t\n\t\tlet scene = new THREE.Scene();\n\t\t//let material = new THREE.PointsMaterial({color: 0x00ff00, size: 0.0001});\n\t\tlet material = this.elevationMaterial;\n\t\tlet points = new THREE.Points(node.geometryNode.geometry, material);\n\t\tscene.add(points);\n\t\t\n\t\tthis.renderer.render(points, this.camera, this.targetElevation);\n\t\t\n\t\tthis.medianFilterMaterial.uniforms.uWidth.value = this.targetMedian.width;\n\t\tthis.medianFilterMaterial.uniforms.uHeight.value = this.targetMedian.height;\n\t\tthis.medianFilterMaterial.uniforms.uTexture.value = this.targetElevation.texture;\n\t\t\n\t\tPotree.utils.screenPass.render(this.renderer, this.medianFilterMaterial, this.targetMedian);\n\t\t\n\t\tPotree.endQuery(queryAll, this.renderer.getContext());\n\t\tPotree.resolveQueries(this.renderer.getContext());\n\t\tPotree.timerQueriesEnabled = false;\n\t\t\n\t\t\n\t\tsetTimeout( () => {\n\t\t\tlet start = new Date().getTime();\n\t\t\t\n\t\t\tlet pixelCount = this.tileWidth * this.tileHeight;\n\t\t\tlet buffer = new Uint8Array(4 * pixelCount);\n\t\t\tthis.renderer.readRenderTargetPixels(this.targetMedian, \n\t\t\t\t0, 0, this.tileWidth, this.tileHeight, \n\t\t\t\tbuffer);\n\t\t\t\t\n\t\t\tlet end = new Date().getTime();\n\t\t\tlet duration = end - start;\n\t\t\tconsole.log(`read duration: ${duration}ms`);\n\t\t}, 3000);\n\t\t\t\n\t\tlet end = new Date().getTime();\n\t\tlet duration = end - start;\n\t\t\n\t\tconsole.log(`duration: ${duration}ms`);\n\t\t\n\t\t//{ // open window with image\n\t\t//\n\t\t//\tlet pixelCount = this.tileWidth * this.tileHeight;\n\t\t//\tlet buffer = new Float32Array(4 * pixelCount);\n\t\t//\tthis.renderer.readRenderTargetPixels(this.targetMedian, \n\t\t//\t\t0, 0, this.tileWidth, this.tileHeight, \n\t\t//\t\tbuffer);\n\t\t//\t\t\n\t\t//\tlet uiBuffer = new Uint8Array(4 * pixelCount);\n\t\t//\tfor(let i = 0; i < pixelCount; i++){\n\t\t//\t\tuiBuffer[i] = buffer[i] / 1.0;\n\t\t//\t}\n\t\t//\n\t\t//\tlet img = Potree.utils.pixelsArrayToImage(uiBuffer, this.tileWidth, this.tileHeight);\n\t\t//\tlet screenshot = img.src;\n\t\t//\t\n\t\t//\tif(!this.debugDIV){\n\t\t//\t\tthis.debugDIV = $(`\n\t\t//\t\t\t<div id=\"pickDebug\" \n\t\t//\t\t\tstyle=\"position: absolute; \n\t\t//\t\t\tright: 400px; width: 300px;\n\t\t//\t\t\tbottom: 44px; width: 300px;\n\t\t//\t\t\tz-index: 1000;\n\t\t//\t\t\t\"></div>`);\n\t\t//\t\t$(document.body).append(this.debugDIV);\n\t\t//\t}\n\t\t//\t\n\t\t//\tthis.debugDIV.empty();\n\t\t//\tthis.debugDIV.append($(`<img src=\"${screenshot}\"\n\t\t//\t\tstyle=\"transform: scaleY(-1);\"/>`));\n\t\t//\t//$(this.debugWindow.document).append($(`<img src=\"${screenshot}\"/>`));\n\t\t//\t//this.debugWindow.document.write('<img src=\"'+screenshot+'\"/>');\n\t\t//}\n\t}\n};\n*/\n\n// \n// index is in order xyzxyzxyz \n//\n\nPotree.DEMNode = class DEMNode{\n\tconstructor(name, box, tileSize){\n\t\tthis.name = name;\n\t\tthis.box = box;\n\t\tthis.tileSize = tileSize;\n\t\tthis.level = this.name.length - 1;\n\t\tthis.data = new Float32Array(tileSize * tileSize);\n\t\tthis.data.fill(-Infinity);\n\t\tthis.children = [];\n\t\t\n\t\tthis.mipMap = [this.data];\n\t\tthis.mipMapNeedsUpdate = true;\n\t}\n\t\n\tcreateMipMap(){\n\t\tthis.mipMap = [this.data];\n\t\t\n\t\tlet sourceSize = this.tileSize;\n\t\tlet mipSize = parseInt(sourceSize / 2);\n\t\tlet mipSource = this.data;\n\t\twhile(mipSize > 1){\n\t\t\tlet mipData = new Float32Array(mipSize * mipSize);\n\t\t\t\n\t\t\tfor(let i = 0; i < mipSize; i++){\n\t\t\t\tfor(let j = 0; j < mipSize; j++){\n\t\t\t\t\tlet h00 = mipSource[2*i+0 + 2*j*sourceSize];\n\t\t\t\t\tlet h01 = mipSource[2*i+0 + 2*j*sourceSize + sourceSize];\n\t\t\t\t\tlet h10 = mipSource[2*i+1 + 2*j*sourceSize];\n\t\t\t\t\tlet h11 = mipSource[2*i+1 + 2*j*sourceSize + sourceSize];\n\t\t\t\t\t\n\t\t\t\t\tlet [height, weight] = [0, 0];\n\t\t\t\t\t\n\t\t\t\t\tif(isFinite(h00)){height += h00; weight += 1};\n\t\t\t\t\tif(isFinite(h01)){height += h01; weight += 1};\n\t\t\t\t\tif(isFinite(h10)){height += h10; weight += 1};\n\t\t\t\t\tif(isFinite(h11)){height += h11; weight += 1};\n\t\t\t\t\t\n\t\t\t\t\theight = height / weight;\n\t\t\t\t\t\n\t\t\t\t\t//let hs = [h00, h01, h10, h11].filter(h => isFinite(h));\n\t\t\t\t\t//let height = hs.reduce( (a, v, i) => a + v, 0) / hs.length;\n\t\t\t\t\t\n\t\t\t\t\tmipData[i + j * mipSize] = height;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tthis.mipMap.push(mipData);\n\t\t\t\n\t\t\tmipSource = mipData;\n\t\t\tsourceSize = mipSize;\n\t\t\tmipSize = parseInt(mipSize / 2);\n\t\t}\n\t\t\n\t\tthis.mipMapNeedsUpdate = false;\n\t}\n\t\n\tuv(position){\n\t\tlet boxSize = this.box.getSize();\n\t\t\n\t\tlet u = (position.x - this.box.min.x) / boxSize.x;\n\t\tlet v = (position.y - this.box.min.y) / boxSize.y;\n\t\t\n\t\treturn [u, v];\n\t}\n\t\n\theightAtMipMapLevel(position, mipMapLevel){\n\t\tlet uv = this.uv(position);\n\t\t\n\t\tlet tileSize = parseInt(this.tileSize / parseInt(2 ** mipMapLevel));\n\t\tlet data = this.mipMap[mipMapLevel];\n\t\t\n\t\tlet i = Math.min(uv[0] * tileSize, tileSize - 1);\n\t\tlet j = Math.min(uv[1] * tileSize, tileSize - 1);\n\t\t\n\t\tlet a = i % 1;\n\t\tlet b = j % 1;\n\t\t\n\t\tlet [i0, i1] = [Math.floor(i), Math.ceil(i)];\n\t\tlet [j0, j1] = [Math.floor(j), Math.ceil(j)];\n\t\t\n\t\tlet h00 = data[i0 + tileSize * j0];\n\t\tlet h01 = data[i0 + tileSize * j1];\n\t\tlet h10 = data[i1 + tileSize * j0];\n\t\tlet h11 = data[i1 + tileSize * j1];\n\t\t\n\t\tlet wh00 = isFinite(h00) ? (1 - a) * (1 - b) : 0;\n\t\tlet wh01 = isFinite(h01) ? (1 - a) * b : 0;\n\t\tlet wh10 = isFinite(h10) ? a * (1 - b) : 0;\n\t\tlet wh11 = isFinite(h11) ? a * b : 0;\n\t\t\n\t\tlet wsum = wh00 + wh01 + wh10 + wh11;\n\t\twh00 = wh00 / wsum;\n\t\twh01 = wh01 / wsum;\n\t\twh10 = wh10 / wsum;\n\t\twh11 = wh11 / wsum;\n\t\t\n\t\tif(wsum === 0){\n\t\t\treturn null;\n\t\t}\n\t\t\n\t\tlet h = 0;\n\t\t\n\t\tif(isFinite(h00)) h += h00 * wh00;\n\t\tif(isFinite(h01)) h += h01 * wh01;\n\t\tif(isFinite(h10)) h += h10 * wh10;\n\t\tif(isFinite(h11)) h += h11 * wh11;\n\t\t\n\t\treturn h;\n\t}\n\t\n\theight(position){\n\t\t\n\t\tlet h = null;\n\t\t\n\t\tfor(let i = 0; i < this.mipMap.length; i++){\n\t\t\th = this.heightAtMipMapLevel(position, i);\n\t\t\t\n\t\t\tif(h !== null){\n\t\t\t\treturn h;\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn h;\n\t}\n\t\n\ttraverse(callback, level = 0){\n\t\tcallback(this, level);\n\t\t\n\t\tfor(let child of this.children.filter(c => c !== undefined)){\n\t\t\tchild.traverse(callback, level + 1);\n\t\t}\n\t}\n}\n\nPotree.DEM = class DEM{\n\tconstructor(pointcloud){\n\t\t\n\t\tthis.pointcloud = pointcloud;\n\t\tthis.matrix = null;\n\t\tthis.boundingBox = null;\n\t\tthis.tileSize = 64;\n\t\tthis.root = null;\n\t\tthis.version = 0;\n\t\t\n\t}\n\t\n\t// expands the tree to all nodes that intersect <box> at <level>\n\t// returns the intersecting nodes at <level>\n\texpandAndFindByBox(box, level){\n\t\t\n\t\tif(level === 0){\n\t\t\treturn [this.root];\n\t\t}\n\t\t\n\t\tlet result = [];\n\t\tlet stack = [this.root];\n\t\n\t\twhile(stack.length > 0){\n\t\t\t\n\t\t\tlet node = stack.pop();\n\t\t\tlet nodeBoxSize = node.box.getSize();\n\t\t\n\t\t\t// check which children intersect by transforming min/max to quadrants\n\t\t\tlet min = {\n\t\t\t\tx: (box.min.x - node.box.min.x) / nodeBoxSize.x,\n\t\t\t\ty: (box.min.y - node.box.min.y) / nodeBoxSize.y};\n\t\t\tlet max = {\n\t\t\t\tx: (box.max.x - node.box.max.x) / nodeBoxSize.x,\n\t\t\t\ty: (box.max.y - node.box.max.y) / nodeBoxSize.y};\n\t\t\t\t\n\t\t\tmin.x = min.x < 0.5 ? 0 : 1;\n\t\t\tmin.y = min.y < 0.5 ? 0 : 1;\n\t\t\tmax.x = max.x < 0.5 ? 0 : 1;\n\t\t\tmax.y = max.y < 0.5 ? 0 : 1;\n\t\t\t\n\t\t\tlet childIndices;\n\t\t\tif(min.x === 0 && min.y === 0 && max.x === 1 && max.y === 1){\n\t\t\t\tchildIndices = [0, 1, 2, 3];\n\t\t\t}else if(min.x === max.x && min.y == max.y){\n\t\t\t\tchildIndices = [(min.x << 1) | min.y];\n\t\t\t}else{\n\t\t\t\tchildIndices = [(min.x << 1) | min.y, (max.x << 1) | max.y];\n\t\t\t}\n\t\t\t\n\t\t\tfor(let index of childIndices){\n\t\t\t\tif(node.children[index] === undefined){\n\t\t\t\t\tlet childBox = node.box.clone();\n\t\t\t\t\t\n\t\t\t\t\tif((index & 2) > 0){\n\t\t\t\t\t\tchildBox.min.x += nodeBoxSize.x / 2.0;\n\t\t\t\t\t}else{\n\t\t\t\t\t\tchildBox.max.x -= nodeBoxSize.x / 2.0;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif((index & 1) > 0){\n\t\t\t\t\t\tchildBox.min.y += nodeBoxSize.y / 2.0;\n\t\t\t\t\t}else{\n\t\t\t\t\t\tchildBox.max.y -= nodeBoxSize.y / 2.0;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tlet child = new Potree.DEMNode(node.name + index, childBox, this.tileSize);\n\t\t\t\t\tnode.children[index] = child;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tlet child = node.children[index];\n\t\t\t\t\n\t\t\t\tif(child.level < level){\n\t\t\t\t\tstack.push(child);\n\t\t\t\t}else{\n\t\t\t\t\tresult.push(child);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn result;\n\t}\n\t\n\tchildIndex(uv){\n\t\tlet [x, y] = uv.map(n => n < 0.5 ? 0 : 1);\n\t\t\n\t\tlet index = (x << 1) | y;\n\t\t\n\t\treturn index;\n\t}\n\t\n\theight(position){\n\t\t\n\t\t//return this.root.height(position);\n\t\t\n\t\tif(!this.root){\n\t\t\treturn 0;\n\t\t}\n        \n\t\tlet height = null;\n\t\tlet list = [this.root];\n\t\twhile(true){\n\t\t\tlet node = list[list.length - 1];\n\t\t\t\n\t\t\tlet currentHeight = node.height(position);\n\t\t\t\n\t\t\tif(currentHeight !== null){\n\t\t\t\theight = currentHeight;\n\t\t\t}\n\t\t\t\n\t\t\tlet uv = node.uv(position);\n\t\t\tlet childIndex = this.childIndex(uv);\n\t\t\t\n\t\t\tif(node.children[childIndex]){\n\t\t\t\tlist.push(node.children[childIndex]);\n\t\t\t}else{\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn height + this.pointcloud.position.z;\n\t}\n\t\n\tupdate(visibleNodes){\n\t\t\n\t\tif(Potree.getDEMWorkerInstance().working){\n\t\t\treturn;\n\t\t}\n\t\t\n\t\t// check if point cloud transformation changed\n\t\tif(this.matrix === null || !this.matrix.equals(this.pointcloud.matrixWorld)){\n\t\t\tthis.matrix = this.pointcloud.matrixWorld.clone();\n\t\t\tthis.boundingBox = this.pointcloud.boundingBox.clone().applyMatrix4(this.matrix);\n\t\t\tthis.root = new Potree.DEMNode(\"r\", this.boundingBox, this.tileSize);\n\t\t\tthis.version++;\n\t\t}\n\t\t\n\t\t// find node to update\n\t\tlet node = null;\n\t\tfor(let vn of visibleNodes){\n\t\t\tif(vn.demVersion === undefined || vn.demVersion < this.version){\n\t\t\t\tnode = vn;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif(node === null){\n\t\t\treturn;\n\t\t}\n\t\t\n\t\t\n\t\t// update node\n\t\tlet projectedBox = node.getBoundingBox().clone().applyMatrix4(this.matrix);\n\t\tlet projectedBoxSize = projectedBox.getSize();\n\t\t\n\t\tlet targetNodes = this.expandAndFindByBox(projectedBox, node.getLevel());\n\t\tnode.demVersion = this.version;\n\t\t\n\t\tPotree.getDEMWorkerInstance().onmessage = (e) => {\n\t\t\t\n\t\t\tlet data = new Float32Array(e.data.dem.data);\n\t\t\t\n\t\t\tfor(let demNode of targetNodes){\n\t\t\t\t\n\t\t\t\tlet boxSize = demNode.box.getSize();\n\t\t\t\t\n\t\t\t\tfor(let i = 0; i < this.tileSize; i++){\n\t\t\t\t\tfor(let j = 0; j < this.tileSize; j++){\n\t\t\t\t\t\t\n\t\t\t\t\t\tlet u = (i / (this.tileSize - 1));\n\t\t\t\t\t\tlet v = (j / (this.tileSize - 1));\n\t\t\t\t\t\t\n\t\t\t\t\t\tlet x = demNode.box.min.x + u * boxSize.x;\n\t\t\t\t\t\tlet y = demNode.box.min.y + v * boxSize.y;\n\t\t\t\t\t\t\n\t\t\t\t\t\tlet ix = this.tileSize * (x - projectedBox.min.x) / projectedBoxSize.x;\n\t\t\t\t\t\tlet iy = this.tileSize * (y - projectedBox.min.y) / projectedBoxSize.y;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(ix < 0 || ix > this.tileSize){\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(iy < 0 || iy > this.tileSize){\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tix = Math.min(Math.floor(ix), this.tileSize - 1);\n\t\t\t\t\t\tiy = Math.min(Math.floor(iy), this.tileSize - 1);\n\t\t\t\t\t\t\n\t\t\t\t\t\tdemNode.data[i + this.tileSize * j] = data[ix + this.tileSize * iy];\n\t\t\t\t\t\t\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tdemNode.createMipMap();\n\t\t\t\tdemNode.mipMapNeedsUpdate = true;\n\t\t\t\t\n\t\t\t\tPotree.getDEMWorkerInstance().working = false;\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t// TODO only works somewhat if there is no rotation to the point cloud \n\t\t\t\n\t\t\t//let target = targetNodes[0];\n\t\t\t//target.data = new Float32Array(data);\n\t\t\t//\n\t\t\t//\n\t\t\t////node.dem = e.data.dem;\n\t\t    //\n\t\t\t//Potree.getDEMWorkerInstance().working = false;\n\t\t\t//\n\t\t\t//{ // create scene objects for debugging\n\t\t\t//\t//for(let demNode of targetNodes){\n\t\t\t//\t\tvar bb = new Potree.Box3Helper(box);\n\t\t\t//\t\tviewer.scene.scene.add(bb);\n            //\n\t\t\t//\t\tcreateDEMMesh(this, target);\n\t\t\t//\t//}\n\t\t\t//\t\n\t\t\t//}\n\t\t};\n\t\t\n\t\tlet position = node.geometryNode.geometry.attributes.position.array;\n\t\tlet message = {\n\t\t\tboundingBox: {\n\t\t\t\tmin: node.getBoundingBox().min.toArray(),\n\t\t\t\tmax: node.getBoundingBox().max.toArray()\n\t\t\t},\n\t\t\tposition: new Float32Array(position).buffer\n\t\t};\n\t\tlet transferables = [message.position];\n\t\tPotree.getDEMWorkerInstance().working = true;\n\t\tPotree.getDEMWorkerInstance().postMessage(message, transferables);\n\t\t\n\t\t\n\t}\n\t\n};\n\nPotree.PointCloudTreeNode = class{\n\t\n\tconstructor(){\n\t\t\n\t}\n\t\n\tgetChildren(){\n\t\tthrow \"override function\";\n\t}\n\t\n\tgetBoundingBox(){\n\t\tthrow \"override function\";\n\t}\n\n\tisLoaded(){\n\t\tthrow \"override function\";\n\t}\n\t\n\tisGeometryNode(){\n\t\tthrow \"override function\";\n\t}\n\t\n\tisTreeNode(){\n\t\tthrow \"override function\";\n\t}\n\t\n\tgetLevel(){\n\t\tthrow \"override function\";\n\t}\n\n\tgetBoundingSphere(){\n\t\tthrow \"override function\";\n\t}\n\t\n};\n\n\nPotree.PointCloudTree = class PointCloudTree extends THREE.Object3D{\n\t\n\tconstructor(){\n\t\tsuper();\n\t\t\n\t\tthis.dem = new Potree.DEM(this);\n\t}\n\t\n\tinitialized(){\n\t\treturn this.root !== null;\n\t}\n\n\t\n};\n\n\n\nPotree.WorkerPool = class WorkerPool{\n\n\tconstructor(){\n\t\tthis.workers = {};\n\t}\n\t\n\tgetWorker(url){\n\t\t\n\t\tif(!this.workers[url]){\n\t\t\tthis.workers[url] = [];\n\t\t}\n\n\t\tif(this.workers[url].length === 0){\n\t\t\tlet worker = new Worker(url);\n\t\t\tthis.workers[url].push(worker);\n\t\t}\n\t\t\n\t\tlet worker = this.workers[url].pop();\n\t\t\n\t\treturn worker;\n\t}\n\t\n\treturnWorker(url, worker){\n\t\tthis.workers[url].push(worker);\n\t}\n\t\n};\n\nPotree.workerPool = new Potree.WorkerPool();\n\n\n\n\nPotree.Shaders[\"pointcloud.vs\"] = `\nprecision mediump float;\nprecision mediump int;\n\n\n\n\n#define max_clip_boxes 30\n\nattribute vec3 position;\nattribute vec3 color;\nattribute vec3 normal;\nattribute float intensity;\nattribute float classification;\nattribute float returnNumber;\nattribute float numberOfReturns;\nattribute float pointSourceID;\nattribute vec4 indices;\n//attribute float indices;\n\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\n\nuniform float pcIndex;\n\n//uniform mat4 toModel;\n\nuniform float screenWidth;\nuniform float screenHeight;\nuniform float fov;\nuniform float spacing;\nuniform float near;\nuniform float far;\n\n#if defined use_clip_box\n\tuniform mat4 clipBoxes[max_clip_boxes];\n#endif\n\n\nuniform float heightMin;\nuniform float heightMax;\nuniform float size;\t\t\t\t// pixel size factor\nuniform float minSize;\t\t\t// minimum pixel size\nuniform float maxSize;\t\t\t// maximum pixel size\nuniform float octreeSize;\nuniform vec3 bbSize;\nuniform vec3 uColor;\nuniform float opacity;\nuniform float clipBoxCount;\nuniform float level;\nuniform float vnStart;\n\nuniform vec2 intensityRange;\nuniform float intensityGamma;\nuniform float intensityContrast;\nuniform float intensityBrightness;\nuniform float rgbGamma;\nuniform float rgbContrast;\nuniform float rgbBrightness;\nuniform float transition;\nuniform float wRGB;\nuniform float wIntensity;\nuniform float wElevation;\nuniform float wClassification;\nuniform float wReturnNumber;\nuniform float wSourceID;\n\n\nuniform sampler2D visibleNodes;\nuniform sampler2D gradient;\nuniform sampler2D classificationLUT;\nuniform sampler2D depthMap;\n\nvarying float\tvOpacity;\nvarying vec3\tvColor;\nvarying float\tvLinearDepth;\nvarying float\tvLogDepth;\nvarying vec3\tvViewPosition;\nvarying float \tvRadius;\nvarying vec3\tvWorldPosition;\nvarying vec3\tvNormal;\n\n\n// ---------------------\n// OCTREE\n// ---------------------\n\n#if (defined(adaptive_point_size) || defined(color_type_lod)) && defined(tree_type_octree)\n/**\n * number of 1-bits up to inclusive index position\n * number is treated as if it were an integer in the range 0-255\n *\n */\nfloat numberOfOnes(float number, float index){\n\tfloat tmp = mod(number, pow(2.0, index + 1.0));\n\tfloat numOnes = 0.0;\n\tfor(float i = 0.0; i < 8.0; i++){\n\t\tif(mod(tmp, 2.0) != 0.0){\n\t\t\tnumOnes++;\n\t\t}\n\t\ttmp = floor(tmp / 2.0);\n\t}\n\treturn numOnes;\n}\n\n\n/**\n * checks whether the bit at index is 1\n * number is treated as if it were an integer in the range 0-255\n *\n */\nbool isBitSet(float number, float index){\n\treturn mod(floor(number / pow(2.0, index)), 2.0) != 0.0;\n}\n\n\n/**\n * find the LOD at the point position\n */\nfloat getLOD(){\n\t\n\tvec3 offset = vec3(0.0, 0.0, 0.0);\n\tfloat iOffset = vnStart;\n\tfloat depth = level;\n\tfor(float i = 0.0; i <= 30.0; i++){\n\t\tfloat nodeSizeAtLevel = octreeSize  / pow(2.0, i + level + 0.0);\n\t\t\n\t\tvec3 index3d = (position-offset) / nodeSizeAtLevel;\n\t\tindex3d = floor(index3d + 0.5);\n\t\tfloat index = 4.0 * index3d.x + 2.0 * index3d.y + index3d.z;\n\t\t\n\t\tvec4 value = texture2D(visibleNodes, vec2(iOffset / 2048.0, 0.0));\n\t\tfloat mask = value.r * 255.0;\n\t\tif(isBitSet(mask, index)){\n\t\t\t// there are more visible child nodes at this position\n\t\t\tiOffset = iOffset + value.g * 255.0 * 256.0 + value.b * 255.0 + numberOfOnes(mask, index - 1.0);\n\t\t\tdepth++;\n\t\t}else{\n\t\t\t// no more visible child nodes at this position\n\t\t\treturn depth;\n\t\t}\n\t\t\n\t\toffset = offset + (vec3(1.0, 1.0, 1.0) * nodeSizeAtLevel * 0.5) * index3d;\n        \n\t}\n\t\t\n\treturn depth;\n}\n\nfloat getPointSizeAttenuation(){\n\treturn pow(1.9, getLOD());\n}\n\n\n#endif\n\n\n// ---------------------\n// KD-TREE\n// ---------------------\n\n#if (defined(adaptive_point_size) || defined(color_type_lod)) && defined(tree_type_kdtree)\n\nfloat getLOD(){\n\tvec3 offset = vec3(0.0, 0.0, 0.0);\n\tfloat iOffset = 0.0;\n\tfloat depth = 0.0;\n\t\t\n\t\t\n\tvec3 size = bbSize;\t\n\tvec3 pos = position;\n\t\t\n\tfor(float i = 0.0; i <= 1000.0; i++){\n\t\t\n\t\tvec4 value = texture2D(visibleNodes, vec2(iOffset / 2048.0, 0.0));\n\t\t\n\t\tint children = int(value.r * 255.0);\n\t\tfloat next = value.g * 255.0;\n\t\tint split = int(value.b * 255.0);\n\t\t\n\t\tif(next == 0.0){\n\t\t \treturn depth;\n\t\t}\n\t\t\n\t\tvec3 splitv = vec3(0.0, 0.0, 0.0);\n\t\tif(split == 1){\n\t\t\tsplitv.x = 1.0;\n\t\t}else if(split == 2){\n\t\t \tsplitv.y = 1.0;\n\t\t}else if(split == 4){\n\t\t \tsplitv.z = 1.0;\n\t\t}\n\t\t\n\t\tiOffset = iOffset + next;\n\t\t\n\t\tfloat factor = length(pos * splitv / size);\n\t\tif(factor < 0.5){\n\t\t \t// left\n\t\t    if(children == 0 || children == 2){\n\t\t    \treturn depth;\n\t\t    }\n\t\t}else{\n\t\t  \t// right\n\t\t    pos = pos - size * splitv * 0.5;\n\t\t    if(children == 0 || children == 1){\n\t\t    \treturn depth;\n\t\t    }\n\t\t    if(children == 3){\n\t\t    \tiOffset = iOffset + 1.0;\n\t\t    }\n\t\t}\n\t\tsize = size * ((1.0 - (splitv + 1.0) / 2.0) + 0.5);\n\t\t\n\t\tdepth++;\n\t}\n\t\t\n\t\t\n\treturn depth;\t\n}\n\nfloat getPointSizeAttenuation(){\n\treturn 0.5 * pow(1.3, getLOD());\n}\n\n#endif\n\n// formula adapted from: http://www.dfstudios.co.uk/articles/programming/image-programming-algorithms/image-processing-algorithms-part-5-contrast-adjustment/\nfloat getContrastFactor(float contrast){\n\treturn (1.0158730158730156 * (contrast + 1.0)) / (1.0158730158730156 - contrast);\n}\n\nvec3 getRGB(){\n\tvec3 rgb = color;\n\t\n\trgb = pow(rgb, vec3(rgbGamma));\n\trgb = rgb + rgbBrightness;\n\trgb = (rgb - 0.5) * getContrastFactor(rgbContrast) + 0.5;\n\trgb = clamp(rgb, 0.0, 1.0);\n\t\n\t//rgb = indices.rgb;\n\t//rgb.b = pcIndex / 255.0;\n\t\n\t\n\treturn rgb;\n}\n\nfloat getIntensity(){\n\tfloat w = (intensity - intensityRange.x) / (intensityRange.y - intensityRange.x);\n\tw = pow(w, intensityGamma);\n\tw = w + intensityBrightness;\n\tw = (w - 0.5) * getContrastFactor(intensityContrast) + 0.5;\n\tw = clamp(w, 0.0, 1.0);\n\t\n\treturn w;\n}\n\nvec3 getElevation(){\n\tvec4 world = modelMatrix * vec4( position, 1.0 );\n\tfloat w = (world.z - heightMin) / (heightMax-heightMin);\n\tvec3 cElevation = texture2D(gradient, vec2(w,1.0-w)).rgb;\n\t\n\treturn cElevation;\n}\n\nvec4 getClassification(){\n\tvec2 uv = vec2(classification / 255.0, 0.5);\n\tvec4 classColor = texture2D(classificationLUT, uv);\n\t\n\treturn classColor;\n}\n\nvec3 getReturnNumber(){\n\tif(numberOfReturns == 1.0){\n\t\treturn vec3(1.0, 1.0, 0.0);\n\t}else{\n\t\tif(returnNumber == 1.0){\n\t\t\treturn vec3(1.0, 0.0, 0.0);\n\t\t}else if(returnNumber == numberOfReturns){\n\t\t\treturn vec3(0.0, 0.0, 1.0);\n\t\t}else{\n\t\t\treturn vec3(0.0, 1.0, 0.0);\n\t\t}\n\t}\n}\n\nvec3 getSourceID(){\n\tfloat w = mod(pointSourceID, 10.0) / 10.0;\n\treturn texture2D(gradient, vec2(w,1.0 - w)).rgb;\n}\n\nvec3 getCompositeColor(){\n\tvec3 c;\n\tfloat w;\n\n\tc += wRGB * getRGB();\n\tw += wRGB;\n\t\n\tc += wIntensity * getIntensity() * vec3(1.0, 1.0, 1.0);\n\tw += wIntensity;\n\t\n\tc += wElevation * getElevation();\n\tw += wElevation;\n\t\n\tc += wReturnNumber * getReturnNumber();\n\tw += wReturnNumber;\n\t\n\tc += wSourceID * getSourceID();\n\tw += wSourceID;\n\t\n\tvec4 cl = wClassification * getClassification();\n    c += cl.a * cl.rgb;\n\tw += wClassification * cl.a;\n\n\tc = c / w;\n\t\n\tif(w == 0.0){\n\t\t//c = color;\n\t\tgl_Position = vec4(100.0, 100.0, 100.0, 0.0);\n\t}\n\t\n\treturn c;\n}\n\nvoid main() {\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tvViewPosition = mvPosition.xyz;\n\tgl_Position = projectionMatrix * mvPosition;\n\tvOpacity = opacity;\n\tvLinearDepth = gl_Position.w;\n\tvLogDepth = log2(gl_Position.w);\n\tvNormal = normalize(normalMatrix * normal);\n\n\t// ---------------------\n\t// POINT COLOR\n\t// ---------------------\n\tvec4 cl = getClassification(); \n\t\n\t#ifdef color_type_rgb\n\t\tvColor = getRGB();\n\t#elif defined color_type_height\n\t\tvColor = getElevation();\n\t#elif defined color_type_rgb_height\n\t\tvec3 cHeight = getElevation();\n\t\tvColor = (1.0 - transition) * getRGB() + transition * cHeight;\n\t#elif defined color_type_depth\n\t\tfloat linearDepth = -mvPosition.z ;\n\t\tfloat expDepth = (gl_Position.z / gl_Position.w) * 0.5 + 0.5;\n\t\tvColor = vec3(linearDepth, expDepth, 0.0);\n\t#elif defined color_type_intensity\n\t\tfloat w = getIntensity();\n\t\tvColor = vec3(w, w, w);\n\t#elif defined color_type_intensity_gradient\n\t\tfloat w = getIntensity();\n\t\tvColor = texture2D(gradient, vec2(w,1.0-w)).rgb;\n\t#elif defined color_type_color\n\t\tvColor = uColor;\n\t#elif defined color_type_lod\n\t\tfloat depth = getLOD();\n\t\tfloat w = depth / 5.0;\n\t\tvColor = texture2D(gradient, vec2(w,1.0-w)).rgb;\n\t#elif defined color_type_point_index\n\t\t//vColor = indices.rgb * 255.0;\n\t\tvColor = indices.rgb;\n\t\t\n\t\t//vColor.r = mod(indices, 256.0) / 255.0;\n\t\t//vColor.g = mod(indices / 256.0, 256.0) / 255.0;\n\t\t//vColor.b = 0.0;\n\t\t\n\t#elif defined color_type_classification\n\t\tvColor = cl.rgb;\n\t#elif defined color_type_return_number\n\t\tvColor = getReturnNumber();\n\t#elif defined color_type_source\n\t\tvColor = getSourceID();\n\t#elif defined color_type_normal\n\t\tvColor = (modelMatrix * vec4(normal, 0.0)).xyz;\n\t#elif defined color_type_phong\n\t\tvColor = color;\n\t#elif defined color_type_composite\n\t\tvColor = getCompositeColor();\n\t#endif\n\t\n\t#if !defined color_type_composite\n\t\tif(cl.a == 0.0){\n\t\t\tgl_Position = vec4(100.0, 100.0, 100.0, 0.0);\n\t\t\t\n\t\t\treturn;\n\t\t}\n\t#endif\n\t\n\t// ---------------------\n\t// POINT SIZE\n\t// ---------------------\n\tfloat pointSize = 1.0;\n\t\n\tfloat slope = tan(fov / 2.0);\n\tfloat projFactor =  -0.5 * screenHeight / (slope * vViewPosition.z);\n\t\n\tfloat r = spacing * 1.5;\n\tvRadius = r;\n\t#if defined fixed_point_size\n\t\tpointSize = size;\n\t#elif defined attenuated_point_size\n\t\tpointSize = size * projFactor;\n\t#elif defined adaptive_point_size\n\t\tfloat worldSpaceSize = size * r / getPointSizeAttenuation();\n\t\tpointSize = worldSpaceSize * projFactor;\n\t#endif\n\n\tpointSize = max(minSize, pointSize);\n\tpointSize = min(maxSize, pointSize);\n\t\n\tvRadius = pointSize / projFactor;\n\t\n\tgl_PointSize = pointSize;\n\t\n\t//gl_Position = vec4(1000.0, 1000.0, 1000.0, 1.0);\n\t\n\t\n\t// ---------------------\n\t// CLIPPING\n\t// ---------------------\n\t\n\t#if defined use_clip_box\n\t\tbool insideAny = false;\n\t\tfor(int i = 0; i < max_clip_boxes; i++){\n\t\t\tif(i == int(clipBoxCount)){\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\n\t\t\tvec4 clipPosition = clipBoxes[i] * modelMatrix * vec4( position, 1.0 );\n\t\t\tbool inside = -0.5 <= clipPosition.x && clipPosition.x <= 0.5;\n\t\t\tinside = inside && -0.5 <= clipPosition.y && clipPosition.y <= 0.5;\n\t\t\tinside = inside && -0.5 <= clipPosition.z && clipPosition.z <= 0.5;\n\t\t\tinsideAny = insideAny || inside;\n\t\t}\n\t\tif(!insideAny){\n\t\n\t\t\t#if defined clip_outside\n\t\t\t\tgl_Position = vec4(1000.0, 1000.0, 1000.0, 1.0);\n\t\t\t#elif defined clip_highlight_inside && !defined(color_type_depth)\n\t\t\t\tfloat c = (vColor.r + vColor.g + vColor.b) / 6.0;\n\t\t\t#endif\n\t\t}else{\n\t\t\t#if defined clip_highlight_inside\n\t\t\t\tvColor.r += 0.5;\n\t\t\t\t\n\t\t\t\t//vec3 hsv = rgb2hsv(vColor);\n            \t//hsv.x = hsv.x - 0.3;\n            \t//hsv.z = hsv.z + 0.1;\n            \t//vColor = hsv2rgb(hsv);\n\t\t\t\t\n\t\t\t#endif\n\t\t}\n\t#endif\n\n\t//vColor = indices.rgb * 255.0;\n\t\n}\n`\n\nPotree.Shaders[\"pointcloud.fs\"] = `\nprecision mediump float;\nprecision mediump int;\n\n#if defined paraboloid_point_shape\n\t#extension GL_EXT_frag_depth : enable\n#endif\n\nuniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n\n\nuniform mat4 projectionMatrix;\nuniform float opacity;\n\nuniform float blendHardness;\nuniform float blendDepthSupplement;\nuniform float fov;\nuniform float spacing;\nuniform float near;\nuniform float far;\nuniform float pcIndex;\nuniform float screenWidth;\nuniform float screenHeight;\n\nuniform sampler2D depthMap;\n\nvarying vec3\tvColor;\nvarying float\tvOpacity;\nvarying float\tvLinearDepth;\nvarying float\tvLogDepth;\nvarying vec3\tvViewPosition;\nvarying float\tvRadius;\nvarying vec3\tvNormal;\n\nfloat specularStrength = 1.0;\n\nvoid main() {\n\n\tvec3 color = vColor;\n\tfloat depth = gl_FragCoord.z;\n\n\t#if defined(circle_point_shape) || defined(paraboloid_point_shape) || defined (weighted_splats)\n\t\tfloat u = 2.0 * gl_PointCoord.x - 1.0;\n\t\tfloat v = 2.0 * gl_PointCoord.y - 1.0;\n\t#endif\n\t\n\t#if defined(circle_point_shape) || defined (weighted_splats)\n\t\tfloat cc = u*u + v*v;\n\t\tif(cc > 1.0){\n\t\t\tdiscard;\n\t\t}\n\t#endif\n\t\n\t#if defined weighted_splats\n\t\tvec2 uv = gl_FragCoord.xy / vec2(screenWidth, screenHeight);\n\t\tfloat sDepth = texture2D(depthMap, uv).r;\n\t\tif(vLinearDepth > sDepth + vRadius + blendDepthSupplement){\n\t\t\tdiscard;\n\t\t}\n\t#endif\n\t\t\n\t#if defined color_type_point_index\n\t\tgl_FragColor = vec4(color, pcIndex / 255.0);\n\t#else\n\t\tgl_FragColor = vec4(color, vOpacity);\n\t#endif\n\n\tvec3 normal = normalize( vNormal );\n\tnormal.z = abs(normal.z);\n\tvec3 viewPosition = normalize( vViewPosition );\n\t\n\t#if defined(color_type_phong)\n\n\t// code taken from three.js phong light fragment shader\n\t\n\t\t#if MAX_POINT_LIGHTS > 0\n\n\t\t\tvec3 pointDiffuse = vec3( 0.0 );\n\t\t\tvec3 pointSpecular = vec3( 0.0 );\n\n\t\t\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n\t\t\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n\t\t\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n\t\t\t\tfloat lDistance = 1.0;\n\t\t\t\tif ( pointLightDistance[ i ] > 0.0 )\n\t\t\t\t\tlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n\n\t\t\t\tlVector = normalize( lVector );\n\n\t\t\t\t\t\t// diffuse\n\n\t\t\t\tfloat dotProduct = dot( normal, lVector );\n\n\t\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\t\tfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\t\t\tfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\t\t\tvec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n\n\t\t\t\t#else\n\n\t\t\t\t\tfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t\t\t#endif\n\n\t\t\t\tpointDiffuse += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\n\n\t\t\t\t\t\t// specular\n\n\t\t\t\tvec3 pointHalfVector = normalize( lVector + viewPosition );\n\t\t\t\tfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n\t\t\t\tfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n\n\t\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\n\t\t\t\tpointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n\t\t\t\tpointSpecular = vec3(0.0, 0.0, 0.0);\n\t\t\t}\n\t\t\n\t\t#endif\n\t\t\n\t\t#if MAX_DIR_LIGHTS > 0\n\n\t\t\tvec3 dirDiffuse = vec3( 0.0 );\n\t\t\tvec3 dirSpecular = vec3( 0.0 );\n\n\t\t\tfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n\t\t\t\tvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n\t\t\t\tvec3 dirVector = normalize( lDirection.xyz );\n\n\t\t\t\t\t\t// diffuse\n\n\t\t\t\tfloat dotProduct = dot( normal, dirVector );\n\n\t\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\t\tfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\t\t\tfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\t\t\tvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n\n\t\t\t\t#else\n\n\t\t\t\t\tfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t\t\t#endif\n\n\t\t\t\tdirDiffuse += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\n\n\t\t\t\t// specular\n\n\t\t\t\tvec3 dirHalfVector = normalize( dirVector + viewPosition );\n\t\t\t\tfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n\t\t\t\tfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n\n\t\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\n\t\t\t\tdirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n\t\t\t}\n\n\t\t#endif\n\t\t\n\t\tvec3 totalDiffuse = vec3( 0.0 );\n\t\tvec3 totalSpecular = vec3( 0.0 );\n\t\t\n\t\t#if MAX_POINT_LIGHTS > 0\n\n\t\t\ttotalDiffuse += pointDiffuse;\n\t\t\ttotalSpecular += pointSpecular;\n\n\t\t#endif\n\t\t\n\t\t#if MAX_DIR_LIGHTS > 0\n\n\t\t\ttotalDiffuse += dirDiffuse;\n\t\t\ttotalSpecular += dirSpecular;\n\n\t\t#endif\n\t\t\n\t\tgl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n\n\t#endif\n\t\n\t#if defined weighted_splats\n\t    //float w = pow(1.0 - (u*u + v*v), blendHardness);\n\t\t\n\t\tfloat wx = 2.0 * length(2.0 * gl_PointCoord - 1.0);\n\t\tfloat w = exp(-wx * wx * 0.5);\n\t\t\n\t\t//float distance = length(2.0 * gl_PointCoord - 1.0);\n\t\t//float w = exp( -(distance * distance) / blendHardness);\n\t\t\n\t\tgl_FragColor.rgb = gl_FragColor.rgb * w;\n\t\tgl_FragColor.a = w;\n\t#endif\n\t\n\t#if defined paraboloid_point_shape\n\t\tfloat wi = 0.0 - ( u*u + v*v);\n\t\tvec4 pos = vec4(vViewPosition, 1.0);\n\t\tpos.z += wi * vRadius;\n\t\tfloat linearDepth = -pos.z;\n\t\tpos = projectionMatrix * pos;\n\t\tpos = pos / pos.w;\n\t\tfloat expDepth = pos.z;\n\t\tdepth = (pos.z + 1.0) / 2.0;\n\t\tgl_FragDepthEXT = depth;\n\t\t\n\t\t#if defined(color_type_depth)\n\t\t\tcolor.r = linearDepth;\n\t\t\tcolor.g = expDepth;\n\t\t#endif\n\t\t\n\t\t#if defined(use_edl)\n\t\t\tgl_FragColor.a = log2(linearDepth);\n\t\t#endif\n\t\t\n\t#else\n\t\t#if defined(use_edl)\n\t\t\tgl_FragColor.a = vLogDepth;\n\t\t#endif\n\t#endif\n\t\n\t\n\t\t\n\t\n\t\n\t\n\t\n}\n\n\n`\n\nPotree.Shaders[\"normalize.vs\"] = `\nvarying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n\n    gl_Position =   projectionMatrix * modelViewMatrix * vec4(position,1.0);\n}`\n\nPotree.Shaders[\"normalize.fs\"] = `\n#extension GL_EXT_frag_depth : enable\n\nuniform sampler2D depthMap;\nuniform sampler2D texture;\n\nvarying vec2 vUv;\n\nvoid main() {\n    float depth = texture2D(depthMap, vUv).g; \n\t\n\tif(depth <= 0.0){\n\t\tdiscard;\n\t}\n\t\n    vec4 color = texture2D(texture, vUv); \n\tcolor = color / color.w;\n    \n\tgl_FragColor = vec4(color.xyz, 1.0); \n\t\n\tgl_FragDepthEXT = depth;\n}`\n\nPotree.Shaders[\"edl.vs\"] = `\n\nvarying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n\t\n\tvec4 mvPosition = modelViewMatrix * vec4(position,1.0);\n\n    gl_Position = projectionMatrix * mvPosition;\n}`\n\nPotree.Shaders[\"edl.fs\"] = `// \n// adapted from the EDL shader code from Christian Boucheny in cloud compare:\n// https://github.com/cloudcompare/trunk/tree/master/plugins/qEDL/shaders/EDL\n//\n\nuniform float screenWidth;\nuniform float screenHeight;\nuniform vec2 neighbours[NEIGHBOUR_COUNT];\nuniform float edlStrength;\nuniform float radius;\nuniform float opacity;\n\nuniform sampler2D colorMap;\n\nvarying vec2 vUv;\n\nfloat response(float depth){\n\tvec2 uvRadius = radius / vec2(screenWidth, screenHeight);\n\t\n\tfloat sum = 0.0;\n\t\n\tfor(int i = 0; i < NEIGHBOUR_COUNT; i++){\n\t\tvec2 uvNeighbor = vUv + uvRadius * neighbours[i];\n\t\t\n\t\tfloat neighbourDepth = texture2D(colorMap, uvNeighbor).a;\n\n\t\tif(neighbourDepth != 0.0){\n\t\t\tif(depth == 0.0){\n\t\t\t\tsum += 100.0;\n\t\t\t}else{\n\t\t\t\tsum += max(0.0, depth - neighbourDepth);\n\t\t\t}\n\t\t}\n\t}\n\t\n\treturn sum / float(NEIGHBOUR_COUNT);\n}\n\nvoid main(){\n\tvec4 color = texture2D(colorMap, vUv);\n\t\n\tfloat depth = color.a;\n\tfloat res = response(depth);\n\tfloat shade = exp(-res * 300.0 * edlStrength);\n\t\n\tif(color.a == 0.0 && res == 0.0){\n\t\tdiscard;\n\t}else{\n\t\tgl_FragColor = vec4(color.rgb * shade, opacity);\n\t}\n\t\n}\n`\n\nPotree.Shaders[\"blur.vs\"] = `\nvarying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n\n    gl_Position =   projectionMatrix * modelViewMatrix * vec4(position,1.0);\n}`\n\nPotree.Shaders[\"blur.fs\"] = `\nuniform mat4 projectionMatrix;\n\nuniform float screenWidth;\nuniform float screenHeight;\nuniform float near;\nuniform float far;\n\nuniform sampler2D map;\n\nvarying vec2 vUv;\n\nvoid main() {\n\n\tfloat dx = 1.0 / screenWidth;\n\tfloat dy = 1.0 / screenHeight;\n\n\tvec3 color = vec3(0.0, 0.0, 0.0);\n\tcolor += texture2D(map, vUv + vec2(-dx, -dy)).rgb;\n\tcolor += texture2D(map, vUv + vec2(  0, -dy)).rgb;\n\tcolor += texture2D(map, vUv + vec2(+dx, -dy)).rgb;\n\tcolor += texture2D(map, vUv + vec2(-dx,   0)).rgb;\n\tcolor += texture2D(map, vUv + vec2(  0,   0)).rgb;\n\tcolor += texture2D(map, vUv + vec2(+dx,   0)).rgb;\n\tcolor += texture2D(map, vUv + vec2(-dx,  dy)).rgb;\n\tcolor += texture2D(map, vUv + vec2(  0,  dy)).rgb;\n\tcolor += texture2D(map, vUv + vec2(+dx,  dy)).rgb;\n    \n\tcolor = color / 9.0;\n\t\n\tgl_FragColor = vec4(color, 1.0);\n\t\n\t\n}`\n\n\nTHREE.EventDispatcher.prototype.removeEventListeners = function(type){\n\t\n\tif ( this._listeners === undefined ) {\n\t\t\n\t\treturn;\n\t\t\n\t}\n\t\n\tif ( this._listeners[ type ] ) {\n\t\t\n\t\tdelete this._listeners[ type ];\n\t\t\n\t}\n\t\n};\n\n\nTHREE.PerspectiveCamera.prototype.zoomTo = function( node, factor ){\n\n\tif ( !node.geometry && !node.boundingSphere && !node.boundingBox) {\n\t\treturn;\n\t}\n\t\n\tif ( node.geometry && node.geometry.boundingSphere === null ) { \n\t\tnode.geometry.computeBoundingSphere();\n\t}\n\t\n\tnode.updateMatrixWorld();\n\t\n\tvar bs;\n\t\n\tif(node.boundingSphere){\n\t\tbs = node.boundingSphere;\n\t}else if(node.geometry && node.geometry.boundingSphere){\n\t\tbs = node.geometry.boundingSphere;\n\t}else{\n\t\tbs = node.boundingBox.getBoundingSphere();\n\t}\n\n\tvar _factor = factor || 1;\n\t\n\tbs = bs.clone().applyMatrix4(node.matrixWorld); \n\tvar radius = bs.radius;\n\tvar fovr = this.fov * Math.PI / 180;\n\t\n\tif( this.aspect < 1 ){\n\t\tfovr = fovr * this.aspect;\n\t}\n\t\n\tvar distanceFactor = Math.abs( radius / Math.sin( fovr / 2 ) ) * _factor ;\n\t\n\tvar offset = this.getWorldDirection().multiplyScalar( -distanceFactor );\n\tthis.position.copy(bs.center.clone().add( offset ));\n\t\n};\n\n\n\n//THREE.PerspectiveCamera.prototype.zoomTo = function(node, factor){\n//\tif(factor === undefined){\n//\t\tfactor = 1;\n//\t}\n//\n//\tnode.updateMatrixWorld();\n//\tthis.updateMatrix();\n//\tthis.updateMatrixWorld();\n//\t\n//\tvar box = Potree.utils.computeTransformedBoundingBox(node.boundingBox, node.matrixWorld);\n//\tvar dir = new THREE.Vector3(0, 0, -1).applyQuaternion(this.quaternion);\n//\tvar pos = box.center().sub(dir);\n//\t\n//\tvar ps = [\n//\t\tnew THREE.Vector3(box.min.x, box.min.y, box.min.z),\n//\t\tnew THREE.Vector3(box.min.x, box.min.y, box.min.z),\n//\t\tnew THREE.Vector3(box.max.x, box.min.y, box.min.z),\n//\t\tnew THREE.Vector3(box.min.x, box.max.y, box.min.z),\n//\t\tnew THREE.Vector3(box.min.x, box.min.y, box.max.z),\n//\t\tnew THREE.Vector3(box.min.x, box.max.y, box.max.z),\n//\t\tnew THREE.Vector3(box.max.x, box.max.y, box.min.z),\n//\t\tnew THREE.Vector3(box.max.x, box.min.y, box.max.z),\n//\t\tnew THREE.Vector3(box.max.x, box.max.y, box.max.z)\n//\t];\n//\t\n//\tvar frustum = new THREE.Frustum();\n//\tfrustum.setFromMatrix(new THREE.Matrix4().multiplyMatrices(this.projectionMatrix, this.matrixWorldInverse));\n//\t\n//\tvar max = Number.MIN_VALUE;\n//\tfor(var i = 0; i < ps.length; i++){\n//\t\tvar p  = ps[i];\n//\t\t\n//\t\tvar distance = Number.MIN_VALUE;\n//\t\t// iterate through left, right, top and bottom planes\n//\t\tfor(var j = 0; j < frustum.planes.length-2; j++){\n//\t\t\tvar plane = frustum.planes[j];\n//\t\t\tvar ray = new THREE.Ray(p, dir);\n//\t\t\tvar dI = ray.distanceToPlaneWithNegative(plane);\n//\t\t\tdistance = Math.max(distance, dI);\n//\t\t}\n//\t\tmax = Math.max(max, distance);\n//\t}\n//\tvar offset = dir.clone().multiplyScalar(-max);\n//\toffset.multiplyScalar(factor);\n//\tpos.add(offset);\n//\tthis.position.copy(pos);\n//\t\n//}\nTHREE.Ray.prototype.distanceToPlaneWithNegative = function ( plane ) {\n\tvar denominator = plane.normal.dot( this.direction );\n\tif ( denominator === 0 ) {\n\n\t\t// line is coplanar, return origin\n\t\tif( plane.distanceToPoint( this.origin ) === 0 ) {\n\t\t\treturn 0;\n\t\t}\n\n\t\t// Null is preferable to undefined since undefined means.... it is undefined\n\t\treturn null;\n\t}\n\tvar t = - ( this.origin.dot( plane.normal ) + plane.constant ) / denominator;\n\n\treturn t;\n};\n\n\n/**\n * @class Loads mno files and returns a PointcloudOctree\n * for a description of the mno binary file format, read mnoFileFormat.txt\n * \n * @author Markus Schuetz\n */\nPotree.POCLoader = function(){\n\t\n};\n \n/**\n * @return a point cloud octree with the root node data loaded. \n * loading of descendants happens asynchronously when they're needed\n * \n * @param url\n * @param loadingFinishedListener executed after loading the binary has been finished\n */\nPotree.POCLoader.load = function load(url, callback) {\n\ttry{\n\t\tlet pco = new Potree.PointCloudOctreeGeometry();\n\t\tpco.url = url;\n\t\tlet xhr = new XMLHttpRequest();\n\t\txhr.open('GET', url, true);\n\t\t\n\t\txhr.onreadystatechange = function(){\n\t\t\tif(xhr.readyState === 4 && (xhr.status === 200 || xhr.status === 0)){\n\t\t\t\tlet fMno = JSON.parse(xhr.responseText);\n\t\t\t\t\n\t\t\t\tlet version = new Potree.Version(fMno.version);\n\t\t\t\t\n\t\t\t\t// assume octreeDir is absolute if it starts with http\n\t\t\t\tif(fMno.octreeDir.indexOf(\"http\") === 0){\n\t\t\t\t\tpco.octreeDir = fMno.octreeDir;\n\t\t\t\t}else{\n\t\t\t\t\tpco.octreeDir = url + \"/../\" + fMno.octreeDir;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tpco.spacing = fMno.spacing;\n\t\t\t\tpco.hierarchyStepSize = fMno.hierarchyStepSize;\n\n\t\t\t\tpco.pointAttributes = fMno.pointAttributes;\n\t\t\t\t\n\t\t\t\tlet min = new THREE.Vector3(fMno.boundingBox.lx, fMno.boundingBox.ly, fMno.boundingBox.lz);\n\t\t\t\tlet max = new THREE.Vector3(fMno.boundingBox.ux, fMno.boundingBox.uy, fMno.boundingBox.uz);\n\t\t\t\tlet boundingBox = new THREE.Box3(min, max);\n\t\t\t\tlet tightBoundingBox = boundingBox.clone();\n\t\t\t\t\n\t\t\t\tif(fMno.tightBoundingBox){\n\t\t\t\t\ttightBoundingBox.min.copy(new THREE.Vector3(fMno.tightBoundingBox.lx, fMno.tightBoundingBox.ly, fMno.tightBoundingBox.lz));\n\t\t\t\t\ttightBoundingBox.max.copy(new THREE.Vector3(fMno.tightBoundingBox.ux, fMno.tightBoundingBox.uy, fMno.tightBoundingBox.uz));\n\t\t\t\t}\n\n\t\t\t\tlet offset = min.clone();\n\t\t\t\t\n\t\t\t\tboundingBox.min.sub(offset);\n\t\t\t\tboundingBox.max.sub(offset);\n\t\t\t\t\n\t\t\t\ttightBoundingBox.min.sub(offset);\n\t\t\t\ttightBoundingBox.max.sub(offset);\n\t\t\t\t\n\t\t\t\tpco.projection = fMno.projection;\n\t\t\t\tpco.boundingBox = boundingBox;\n\t\t\t\tpco.tightBoundingBox = tightBoundingBox;\n\t\t\t\tpco.boundingSphere = boundingBox.getBoundingSphere();\n\t\t\t\tpco.tightBoundingSphere = tightBoundingBox.getBoundingSphere();\n\t\t\t\tpco.offset = offset;\n\t\t\t\tif(fMno.pointAttributes === \"LAS\"){\n\t\t\t\t\tpco.loader = new Potree.LasLazLoader(fMno.version);\n\t\t\t\t}else if(fMno.pointAttributes === \"LAZ\"){\n\t\t\t\t\tpco.loader = new Potree.LasLazLoader(fMno.version);\n\t\t\t\t}else{\n\t\t\t\t\tpco.loader = new Potree.BinaryLoader(fMno.version, boundingBox, fMno.scale);\n\t\t\t\t\tpco.pointAttributes = new Potree.PointAttributes(pco.pointAttributes);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tlet nodes = {};\n\t\t\t\t\n\t\t\t\t{ // load root\n\t\t\t\t\tlet name = \"r\";\n\t\t\t\t\t\n\t\t\t\t\tlet root = new Potree.PointCloudOctreeGeometryNode(name, pco, boundingBox);\n\t\t\t\t\troot.level = 0;\n\t\t\t\t\troot.hasChildren = true;\n\t\t\t\t\troot.spacing = pco.spacing;\n\t\t\t\t\tif(version.upTo(\"1.5\")){\n\t\t\t\t\t\troot.numPoints = fMno.hierarchy[0][1];\n\t\t\t\t\t}else{\n\t\t\t\t\t\troot.numPoints = 0;\n\t\t\t\t\t}\n\t\t\t\t\tpco.root = root;\n\t\t\t\t\tpco.root.load();\n\t\t\t\t\tnodes[name] = root;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// load remaining hierarchy\n\t\t\t\tif(version.upTo(\"1.4\")){\n\t\t\t\t\tfor( let i = 1; i < fMno.hierarchy.length; i++){\n\t\t\t\t\t\tlet name = fMno.hierarchy[i][0];\n\t\t\t\t\t\tlet numPoints = fMno.hierarchy[i][1];\n\t\t\t\t\t\tlet index = parseInt(name.charAt(name.length-1));\n\t\t\t\t\t\tlet parentName = name.substring(0, name.length-1);\n\t\t\t\t\t\tlet parentNode = nodes[parentName];\n\t\t\t\t\t\tlet level = name.length-1;\n\t\t\t\t\t\tlet boundingBox = Potree.POCLoader.createChildAABB(parentNode.boundingBox, index);\n\t\t\t\t\t\t\n\t\t\t\t\t\tlet node = new Potree.PointCloudOctreeGeometryNode(name, pco, boundingBox);\n\t\t\t\t\t\tnode.level = level;\n\t\t\t\t\t\tnode.numPoints = numPoints;\n\t\t\t\t\t\tnode.spacing = pco.spacing / Math.pow(2, level);\n\t\t\t\t\t\tparentNode.addChild(node);\n\t\t\t\t\t\tnodes[name] = node;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tpco.nodes = nodes;\n\t\t\t\t\n\t\t\t\tcallback(pco);\n\t\t\t}\n\t\t};\n\t\t\n\t\txhr.send(null);\n\t}catch(e){\n\t\tconsole.log(\"loading failed: '\" + url + \"'\");\n\t\tconsole.log(e);\n\t\t\n\t\tcallback();\n\t}\n};\n\nPotree.POCLoader.loadPointAttributes = function(mno){\n\t\n\tlet fpa = mno.pointAttributes;\n\tlet pa = new Potree.PointAttributes();\n\t\n\tfor(let i = 0; i < fpa.length; i++){   \n\t\tlet pointAttribute = Potree.PointAttribute[fpa[i]];\n\t\tpa.add(pointAttribute);\n\t}                                                                     \n\t\n\treturn pa;\n};\n\n\nPotree.POCLoader.createChildAABB = function(aabb, index){\n\t\n\tlet min = aabb.min.clone();\n\tlet max = aabb.max.clone();\n\tlet size = new THREE.Vector3().subVectors(max, min);\n\t\n\tif((index & 0b0001) > 0){\n\t\tmin.z += size.z / 2;\n\t}else{\n\t\tmax.z -= size.z / 2;\n\t}\n\t\n\tif((index & 0b0010) > 0){\n\t\tmin.y += size.y / 2;\n\t}else{\n\t\tmax.y -= size.y / 2;\n\t}\n\t\n\tif((index & 0b0100) > 0){\n\t\tmin.x += size.x / 2;\n\t}else{\n\t\tmax.x -= size.x / 2;\n\t}\n\t\n\treturn new THREE.Box3(min, max);\n};\n\n\n\n\nPotree.PointAttributeNames = {};\n\nPotree.PointAttributeNames.POSITION_CARTESIAN \t= 0;\t// float x, y, z;\nPotree.PointAttributeNames.COLOR_PACKED\t\t= 1;\t// byte r, g, b, a; \tI = [0,1]\nPotree.PointAttributeNames.COLOR_FLOATS_1\t\t= 2;\t// float r, g, b; \t\tI = [0,1]\nPotree.PointAttributeNames.COLOR_FLOATS_255\t= 3;\t// float r, g, b; \t\tI = [0,255]\nPotree.PointAttributeNames.NORMAL_FLOATS\t\t= 4;  \t// float x, y, z;\nPotree.PointAttributeNames.FILLER\t\t\t\t= 5;\nPotree.PointAttributeNames.INTENSITY\t\t\t= 6;\nPotree.PointAttributeNames.CLASSIFICATION\t\t= 7;\nPotree.PointAttributeNames.NORMAL_SPHEREMAPPED\t= 8;\nPotree.PointAttributeNames.NORMAL_OCT16\t\t= 9;\nPotree.PointAttributeNames.NORMAL\t\t\t\t= 10;\n\n/**\n * Some types of possible point attribute data formats\n *\n * @class\n */\nPotree.PointAttributeTypes = {\n\tDATA_TYPE_DOUBLE\t: {ordinal : 0, size: 8},\n\tDATA_TYPE_FLOAT\t\t: {ordinal : 1, size: 4},\n\tDATA_TYPE_INT8\t\t: {ordinal : 2, size: 1},\n\tDATA_TYPE_UINT8\t\t: {ordinal : 3, size: 1},\n\tDATA_TYPE_INT16\t\t: {ordinal : 4, size: 2},\n\tDATA_TYPE_UINT16\t: {ordinal : 5, size: 2},\n\tDATA_TYPE_INT32\t\t: {ordinal : 6, size: 4},\n\tDATA_TYPE_UINT32\t: {ordinal : 7, size: 4},\n\tDATA_TYPE_INT64\t\t: {ordinal : 8, size: 8},\n\tDATA_TYPE_UINT64\t: {ordinal : 9, size: 8}\n};\n\nvar i = 0;\nfor(var obj in Potree.PointAttributeTypes){\n\tPotree.PointAttributeTypes[i] = Potree.PointAttributeTypes[obj];\n\ti++;\n}\n\n/**\n * A single point attribute such as color/normal/.. and its data format/number of elements/...\n *\n * @class\n * @param name\n * @param type\n * @param size\n * @returns\n */\nPotree.PointAttribute = function(name, type, numElements){\n\tthis.name = name;\n\tthis.type = type;\n\tthis.numElements = numElements;\n\tthis.byteSize = this.numElements * this.type.size;\n};\n\nPotree.PointAttribute.POSITION_CARTESIAN = new Potree.PointAttribute(\n\t\tPotree.PointAttributeNames.POSITION_CARTESIAN,\n\t\tPotree.PointAttributeTypes.DATA_TYPE_FLOAT, 3);\n\nPotree.PointAttribute.RGBA_PACKED = new Potree.PointAttribute(\n\t\tPotree.PointAttributeNames.COLOR_PACKED,\n\t\tPotree.PointAttributeTypes.DATA_TYPE_INT8, 4);\n\nPotree.PointAttribute.COLOR_PACKED = Potree.PointAttribute.RGBA_PACKED;\n\nPotree.PointAttribute.RGB_PACKED = new Potree.PointAttribute(\n\t\tPotree.PointAttributeNames.COLOR_PACKED,\n\t\tPotree.PointAttributeTypes.DATA_TYPE_INT8, 3);\n\nPotree.PointAttribute.NORMAL_FLOATS = new Potree.PointAttribute(\n\t\tPotree.PointAttributeNames.NORMAL_FLOATS,\n\t\tPotree.PointAttributeTypes.DATA_TYPE_FLOAT, 3);\n\nPotree.PointAttribute.FILLER_1B = new Potree.PointAttribute(\n\t\tPotree.PointAttributeNames.FILLER,\n\t\tPotree.PointAttributeTypes.DATA_TYPE_UINT8, 1);\n\nPotree.PointAttribute.INTENSITY = new Potree.PointAttribute(\n\t\tPotree.PointAttributeNames.INTENSITY,\n\t\tPotree.PointAttributeTypes.DATA_TYPE_UINT16, 1);\n\nPotree.PointAttribute.CLASSIFICATION = new Potree.PointAttribute(\n\t\tPotree.PointAttributeNames.CLASSIFICATION,\n\t\tPotree.PointAttributeTypes.DATA_TYPE_UINT8, 1);\n\nPotree.PointAttribute.NORMAL_SPHEREMAPPED = new Potree.PointAttribute(\n\t\tPotree.PointAttributeNames.NORMAL_SPHEREMAPPED,\n\t\tPotree.PointAttributeTypes.DATA_TYPE_UINT8, 2);\n\nPotree.PointAttribute.NORMAL_OCT16 = new Potree.PointAttribute(\n\t\tPotree.PointAttributeNames.NORMAL_OCT16,\n\t\tPotree.PointAttributeTypes.DATA_TYPE_UINT8, 2);\n\nPotree.PointAttribute.NORMAL = new Potree.PointAttribute(\n\t\tPotree.PointAttributeNames.NORMAL,\n\t\tPotree.PointAttributeTypes.DATA_TYPE_FLOAT, 3);\n\n/**\n * Ordered list of PointAttributes used to identify how points are aligned in a buffer.\n *\n * @class\n *\n */\nPotree.PointAttributes = function(pointAttributes){\n\tthis.attributes = [];\n\tthis.byteSize = 0;\n\tthis.size = 0;\n\n\tif(pointAttributes != null){\n\t\tfor(var i = 0; i < pointAttributes.length; i++){\n\t\t\tvar pointAttributeName = pointAttributes[i];\n\t\t\tvar pointAttribute = Potree.PointAttribute[pointAttributeName];\n\t\t\tthis.attributes.push(pointAttribute);\n\t\t\tthis.byteSize += pointAttribute.byteSize;\n\t\t\tthis.size++;\n\t\t}\n\t}\n};\n\nPotree.PointAttributes.prototype.add = function(pointAttribute){\n\tthis.attributes.push(pointAttribute);\n\tthis.byteSize += pointAttribute.byteSize;\n\tthis.size++;\n};\n\nPotree.PointAttributes.prototype.hasColors = function(){\n\tfor(var name in this.attributes){\n\t\tvar pointAttribute = this.attributes[name];\n\t\tif(pointAttribute.name === Potree.PointAttributeNames.COLOR_PACKED){\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n};\n\nPotree.PointAttributes.prototype.hasNormals = function(){\n\tfor(var name in this.attributes){\n\t\tvar pointAttribute = this.attributes[name];\n\t\tif(\n\t\t\tpointAttribute === Potree.PointAttribute.NORMAL_SPHEREMAPPED ||\n\t\t\tpointAttribute === Potree.PointAttribute.NORMAL_FLOATS ||\n\t\t\tpointAttribute === Potree.PointAttribute.NORMAL ||\n\t\t\tpointAttribute === Potree.PointAttribute.NORMAL_OCT16){\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n};\n\n\nPotree.BinaryLoader = function(version, boundingBox, scale){\n\tif(typeof(version) === \"string\"){\n\t\tthis.version = new Potree.Version(version);\n\t}else{\n\t\tthis.version = version;\n\t}\n\n\tthis.boundingBox = boundingBox;\n\tthis.scale = scale;\n};\n\nPotree.BinaryLoader.prototype.load = function(node){\n\tif(node.loaded){\n\t\treturn;\n\t}\n\n\tlet scope = this;\n\n\tlet url = node.getURL();\n\n\tif(this.version.equalOrHigher(\"1.4\")){\n\t\turl += \".bin\";\n\t}\n\n\tlet xhr = new XMLHttpRequest();\n\txhr.open('GET', url, true);\n\txhr.responseType = 'arraybuffer';\n\txhr.overrideMimeType('text/plain; charset=x-user-defined');\n\txhr.onreadystatechange = function() {\n\t\tif (xhr.readyState === 4) {\n\t\t\tif (xhr.status === 200 || xhr.status === 0) {\n\t\t\t\tlet buffer = xhr.response;\n\t\t\t\tscope.parse(node, buffer);\n\t\t\t} else {\n\t\t\t\tconsole.log('Failed to load file! HTTP status: ' + xhr.status + \", file: \" + url);\n\t\t\t}\n\t\t}\n\t};\n\ttry{\n\t\txhr.send(null);\n\t}catch(e){\n\t\tconsole.log(\"fehler beim laden der punktwolke: \" + e);\n\t}\n};\n\nPotree.BinaryLoader.prototype.parse = function(node, buffer){\n\n\tlet numPoints = buffer.byteLength / node.pcoGeometry.pointAttributes.byteSize;\n\tlet pointAttributes = node.pcoGeometry.pointAttributes;\n\n\tif(this.version.upTo(\"1.5\")){\n\t\tnode.numPoints = numPoints;\n\t}\n\n\tlet workerPath = Potree.scriptPath + \"/workers/BinaryDecoderWorker.js\";\n\tlet worker = Potree.workerPool.getWorker(workerPath);\n\t\n\tworker.onmessage = function(e){\n\t\tlet data = e.data;\n\t\tlet buffers = data.attributeBuffers;\n\t\tlet tightBoundingBox = new THREE.Box3(\n\t\t\tnew THREE.Vector3().fromArray(data.tightBoundingBox.min),\n\t\t\tnew THREE.Vector3().fromArray(data.tightBoundingBox.max)\n\t\t);\n\n\t\tPotree.workerPool.returnWorker(workerPath, worker);\n\n\t\tlet geometry = new THREE.BufferGeometry();\n\n\t\tfor(let property in buffers){\n\t\t\tif(buffers.hasOwnProperty(property)){\n\t\t\t\tlet buffer = buffers[property].buffer;\n\t\t\t\tlet attribute = buffers[property].attribute;\n\t\t\t\tlet numElements = attribute.numElements;\n\n\t\t\t\tif(parseInt(property) === Potree.PointAttributeNames.POSITION_CARTESIAN){\n\t\t\t\t\tgeometry.addAttribute(\"position\", new THREE.BufferAttribute(new Float32Array(buffer), 3));\n\t\t\t\t}else if(parseInt(property) === Potree.PointAttributeNames.COLOR_PACKED){\n\t\t\t\t\tgeometry.addAttribute(\"color\", new THREE.BufferAttribute(new Uint8Array(buffer), 3, true));\n\t\t\t\t}else if(parseInt(property) === Potree.PointAttributeNames.INTENSITY){\n\t\t\t\t\tgeometry.addAttribute(\"intensity\", new THREE.BufferAttribute(new Float32Array(buffer), 1));\n\t\t\t\t}else if(parseInt(property) === Potree.PointAttributeNames.CLASSIFICATION){\n\t\t\t\t\tgeometry.addAttribute(\"classification\", new THREE.BufferAttribute(new Uint8Array(buffer), 1));\n\t\t\t\t}else if(parseInt(property) === Potree.PointAttributeNames.NORMAL_SPHEREMAPPED){\n\t\t\t\t\tgeometry.addAttribute(\"normal\", new THREE.BufferAttribute(new Float32Array(buffer), 3));\n\t\t\t\t}else if(parseInt(property) === Potree.PointAttributeNames.NORMAL_OCT16){\n\t\t\t\t\tgeometry.addAttribute(\"normal\", new THREE.BufferAttribute(new Float32Array(buffer), 3));\n\t\t\t\t}else if(parseInt(property) === Potree.PointAttributeNames.NORMAL){\n\t\t\t\t\tgeometry.addAttribute(\"normal\", new THREE.BufferAttribute(new Float32Array(buffer), 3));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tlet indicesAttribute = new THREE.Uint8BufferAttribute(data.indices, 4);\n\t\tindicesAttribute.normalized = true;\n\t\tgeometry.addAttribute(\"indices\", indicesAttribute);\n\n\t\tif(!geometry.attributes.normal){\n\t\t\tlet buffer = new Float32Array(numPoints*3);\n\t\t\tgeometry.addAttribute(\"normal\", new THREE.BufferAttribute(new Float32Array(buffer), 3));\n\t\t}\n\t\t\n\t\ttightBoundingBox.max.sub(tightBoundingBox.min);\n\t\ttightBoundingBox.min.set(0, 0, 0);\n\n\t\tgeometry.boundingBox = node.boundingBox;\n\t\tnode.geometry = geometry;\n\t\tnode.mean = new THREE.Vector3(...data.mean);\n\t\tnode.tightBoundingBox = tightBoundingBox;\n\t\tnode.loaded = true;\n\t\tnode.loading = false;\n\t\tnode.pcoGeometry.numNodesLoading--;\n\t};\n\n\tlet message = {\n\t\tbuffer: buffer,\n\t\tpointAttributes: pointAttributes,\n\t\tversion: this.version.version,\n\t\tmin: [ node.boundingBox.min.x, node.boundingBox.min.y, node.boundingBox.min.z ],\n\t\toffset: [node.pcoGeometry.offset.x, node.pcoGeometry.offset.y, node.pcoGeometry.offset.z],\n\t\tscale: this.scale\n\t};\n\tworker.postMessage(message, [message.buffer]);\n\n};\n\nfunction networkToNative(val) {\n    return ((val & 0x00FF) << 24) |\n           ((val & 0xFF00) <<  8) |\n           ((val >> 8)  & 0xFF00) |\n           ((val >> 24) & 0x00FF);\n}\n\nPotree.GreyhoundBinaryLoader = function(version, boundingBox, scale){\n\tif (typeof(version) === \"string\") {\n\t\tthis.version = new Potree.Version(version);\n\t}\n    else {\n\t\tthis.version = version;\n\t}\n\n\tthis.boundingBox = boundingBox;\n\tthis.scale = scale;\n};\n\nPotree.GreyhoundBinaryLoader.prototype.load = function(node){\n\tif (node.loaded) return;\n\n    var scope = this;\n\tvar url = node.getURL();\n\n\tvar xhr = new XMLHttpRequest();\n\txhr.open('GET', url, true);\n\txhr.responseType = 'arraybuffer';\n\txhr.overrideMimeType('text/plain; charset=x-user-defined');\n\n\txhr.onreadystatechange = function() {\n\t\tif (xhr.readyState === 4) {\n\t\t\tif (xhr.status === 200 || xhr.status === 0) {\n\t\t\t\tvar buffer = xhr.response;\n\t\t\t\tscope.parse(node, buffer);\n\t\t\t}\n            else {\n\t\t\t\tconsole.log(\n                        'Failed to load file! HTTP status:', xhr.status,\n                        'file:', url);\n\t\t\t}\n\t\t}\n\t};\n\n\ttry {\n\t\txhr.send(null);\n\t}\n    catch(e) {\n\t\tconsole.log(\"error loading point cloud: \" + e);\n\t}\n};\n\nPotree.GreyhoundBinaryLoader.prototype.parse = function(node, buffer){\n\tvar NUM_POINTS_BYTES = 4;\n\n    var view = new DataView(\n            buffer, buffer.byteLength - NUM_POINTS_BYTES, NUM_POINTS_BYTES);\n    var numPoints = networkToNative(view.getUint32(0));\n\tvar pointAttributes = node.pcoGeometry.pointAttributes;\n\n    node.numPoints = numPoints;\n\n\tlet workerPath = Potree.scriptPath + \"/workers/GreyhoundBinaryDecoderWorker.js\";\n\tlet worker = Potree.workerPool.getWorker(workerPath);\n\n\tworker.onmessage = function(e){\n\t\tvar data = e.data;\n\t\tvar buffers = data.attributeBuffers;\n\t\tvar tightBoundingBox = new THREE.Box3(\n\t\t\tnew THREE.Vector3().fromArray(data.tightBoundingBox.min),\n\t\t\tnew THREE.Vector3().fromArray(data.tightBoundingBox.max)\n\t\t);\n\n\t\tPotree.workerPool.returnWorker(workerPath, worker);\n\n\t\tvar geometry = new THREE.BufferGeometry();\n\n        var addAttribute = function(name, buffer, size) {\n            geometry.addAttribute(\n                    name,\n                    new THREE.BufferAttribute(new Float32Array(buffer), size));\n        };\n\n\t\tfor (var property in buffers) {\n\t\t\tif (buffers.hasOwnProperty(property)) {\n\t\t\t\tvar buffer = buffers[property].buffer;\n\t\t\t\tvar attribute = buffers[property].attribute;\n\t\t\t\tvar numElements = attribute.numElements;\n\n                var pointAttributes = Potree.PointAttributeNames;\n\n                switch (parseInt(property)) {\n                    case pointAttributes.POSITION_CARTESIAN:\n                        addAttribute('position', buffer, 3);\n\t\t\t\t\t\t//let fb = new Float32Array(buffer);\n\t\t\t\t\t\t//console.log(fb);\n                        break;\n                    case pointAttributes.COLOR_PACKED:\n\t\t\t\t\t\tgeometry.addAttribute(\"color\", \n\t\t\t\t\t\t\tnew THREE.BufferAttribute(new Uint8Array(buffer), 3, true));\n                        break;\n                    case pointAttributes.INTENSITY:\n                        addAttribute('intensity', buffer, 1);\n                        break;\n                    case pointAttributes.CLASSIFICATION:\n                        addAttribute('classification', buffer, 1);\n                        break;\n                    case pointAttributes.NORMAL_SPHEREMAPPED:\n                    case pointAttributes.NORMAL_OCT16:\n                    case pointAttributes.NORMAL:\n                        addAttribute('normal', buffer, 3);\n                        break;\n                    default:\n                        break;\n                }\n\t\t\t}\n\t\t}\n\n        //addAttribute('indices', data.indices, 1);\n\t\t\n\t\tlet indicesAttribute = new THREE.Uint8BufferAttribute(data.indices, 4);\n\t\tindicesAttribute.normalized = true;\n\t\tgeometry.addAttribute(\"indices\", indicesAttribute);\n\n\t\tif (!geometry.attributes.normal) {\n            addAttribute('normal', new Float32Array(numPoints * 3), 3);\n        }\n\n\t\tgeometry.boundingBox = node.boundingBox;\n\t\tnode.geometry = geometry;\n\t\tnode.tightBoundingBox = tightBoundingBox;\n\t\tnode.loaded = true;\n\t\tnode.loading = false;\n\t\t--node.pcoGeometry.numNodesLoading;\n\t};\n\n    var bb = node.boundingBox;\n    var pco = node.pcoGeometry;\n\n\n\t//let nodeOffset = node.boundingBox.getCenter();\n\t//let nodeOffset = new THREE.Vector3(0, 0, 0);\n\tlet nodeOffset = node.pcoGeometry.boundingBox.getCenter().sub(node.boundingBox.min);\n\t//let nodeOffset = node.pcoGeometry.boundingBox.min;\n\n\tvar message = {\n\t\tbuffer: buffer,\n\t\tpointAttributes: pointAttributes,\n\t\tversion: this.version.version,\n        schema: node.pcoGeometry.schema,\n\t\tmin: [bb.min.x, bb.min.y, bb.min.z],\n\t\tmax: [bb.max.x, bb.max.y, bb.max.z],\n\t\toffset: nodeOffset.toArray(),\n        scale: this.scale,\n        normalize: node.pcoGeometry.normalize\n\t};\n\n\tworker.postMessage(message, [message.buffer]);\n};\n\n\n/**\n * @class Loads greyhound metadata and returns a PointcloudOctree\n *\n * @author Maarten van Meersbergen\n * @author Oscar Martinez Rubi\n * @author Connor Manning\n */\n\nclass GreyhoundUtils{\n\t\n\tstatic getQueryParam(name) {\n\t\tname = name.replace(/[\\[\\]]/g, \"\\\\$&\");\n\t\tvar regex = new RegExp(\"[?&]\" + name + \"(=([^&#]*)|&|#|$)\"),\n\t\t\tresults = regex.exec(window.location.href);\n\t\tif (!results) return null;\n\t\tif (!results[2]) return '';\n\t\treturn decodeURIComponent(results[2].replace(/\\+/g, \" \"));\n\t}\n\t\n\tstatic createSchema(attributes) {\n\t\tvar schema = [\n\t\t\t{ \"name\": \"X\", \"size\": 4, \"type\": \"signed\" },\n\t\t\t{ \"name\": \"Y\", \"size\": 4, \"type\": \"signed\" },\n\t\t\t{ \"name\": \"Z\", \"size\": 4, \"type\": \"signed\" }\n\t\t];\n\n\t\t// Once we include options in the UI to load a dynamic list of available\n\t\t// attributes for visualization (f.e. Classification, Intensity etc.)\n\t\t// we will be able to ask for that specific attribute from the server,\n\t\t// where we are now requesting all attributes for all points all the time.\n\t\t// If we do that though, we also need to tell Potree to redraw the points\n\t\t// that are already loaded (with different attributes).\n\t\t// This is not default behaviour.\n\t\tattributes.forEach(function(item) {\n\t\t\tif(item === 'COLOR_PACKED') {\n\t\t\t\tschema.push({ \"name\": \"Red\",      \"size\": 2, \"type\": \"unsigned\" });\n\t\t\t\tschema.push({ \"name\": \"Green\",    \"size\": 2, \"type\": \"unsigned\" });\n\t\t\t\tschema.push({ \"name\": \"Blue\",     \"size\": 2, \"type\": \"unsigned\" });\n\t\t\t} else if(item === 'INTENSITY'){\n\t\t\t\tschema.push({ \"name\": \"Intensity\", \"size\": 2, \"type\": \"unsigned\" });\n\t\t\t} else if(item === 'CLASSIFICATION') {\n\t\t\t\tschema.push(\n\t\t\t\t\t\t{ \"name\": \"Classification\", \"size\": 1, \"type\": \"unsigned\" });\n\t\t\t}\n\t\t});\n\n\t  return schema;\n\t}\n\t\n\tstatic fetch(url, cb) {\n\t\tvar xhr = new XMLHttpRequest();\n\t\txhr.open('GET', url, true);\n\t\txhr.onreadystatechange = function() {\n\t\t\tif (xhr.readyState === 4) {\n\t\t\t\tif (xhr.status === 200 || xhr.status === 0) {\n\t\t\t\t\tcb(null, xhr.responseText);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tcb(xhr.responseText);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\txhr.send(null);\n\t};\n\n\tstatic fetchBinary(url, cb) {\n\t\tvar xhr = new XMLHttpRequest();\n\t\txhr.open('GET', url, true);\n\t\txhr.responseType = 'arraybuffer';\n\t\txhr.onreadystatechange = function() {\n\t\t\tif (xhr.readyState === 4) {\n\t\t\t\tif (xhr.status === 200 || xhr.status === 0) {\n\t\t\t\t\tcb(null, xhr.response);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tcb(xhr.responseText);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\txhr.send(null);\n\t};\n\n\tstatic pointSizeFrom(schema) {\n\t\treturn schema.reduce((p, c) => p + c.size, 0);\n\t};\n\n\tstatic getNormalization(serverURL, baseDepth, cb) {\n\t\tvar s = [\n\t\t\t{ \"name\": \"X\",          \"size\": 4, \"type\": \"floating\" },\n\t\t\t{ \"name\": \"Y\",          \"size\": 4, \"type\": \"floating\" },\n\t\t\t{ \"name\": \"Z\",          \"size\": 4, \"type\": \"floating\" },\n\t\t\t{ \"name\": \"Red\",        \"size\": 2, \"type\": \"unsigned\" },\n\t\t\t{ \"name\": \"Green\",      \"size\": 2, \"type\": \"unsigned\" },\n\t\t\t{ \"name\": \"Blue\",       \"size\": 2, \"type\": \"unsigned\" },\n\t\t\t{ \"name\": \"Intensity\",  \"size\": 2, \"type\": \"unsigned\" }\n\t\t];\n\n\t\tvar url = serverURL + 'read?depth=' + baseDepth +\n\t\t\t'&schema=' + JSON.stringify(s);\n\n\t\tGreyhoundUtils.fetchBinary(url, function(err, buffer) {\n\t\t\tif (err) throw new Error(err);\n\n\t\t\tvar view = new DataView(buffer);\n\t\t\tvar numBytes = buffer.byteLength - 4;\n\t\t\tvar numPoints = view.getUint32(numBytes, true);\n\t\t\tvar pointSize = GreyhoundUtils.pointSizeFrom(s);\n\n\t\t\tvar colorNorm = false, intensityNorm = false;\n\t\t\tvar v;\n\n\t\t\tfor (var offset = 0; offset < numBytes; offset += pointSize) {\n\t\t\t\tif (view.getUint16(offset + 12, true) > 255 ||\n\t\t\t\t\tview.getUint16(offset + 14, true) > 255 ||\n\t\t\t\t\tview.getUint16(offset + 16, true) > 255) {\n\t\t\t\t\tcolorNorm = true;\n\t\t\t\t}\n\n\t\t\t\tif (view.getUint16(offset + 18, true) > 255) {\n\t\t\t\t\tintensityNorm = true;\n\t\t\t\t}\n\n\t\t\t\tif (colorNorm && intensityNorm) break;\n\t\t\t}\n\n\t\t\tif (colorNorm) console.log('Normalizing color');\n\t\t\tif (intensityNorm) console.log('Normalizing intensity');\n\n\t\t\tcb(null, { color: colorNorm, intensity: intensityNorm });\n\t\t});\n\t};\n\t\n};\n\nPotree.GreyhoundLoader = function() { };\nPotree.GreyhoundLoader.loadInfoJSON = function load(url, callback) { }\n\n/**\n * @return a point cloud octree with the root node data loaded.\n * loading of descendants happens asynchronously when they're needed\n *\n * @param url\n * @param loadingFinishedListener executed after loading the binary has been\n * finished\n */\nPotree.GreyhoundLoader.load = function load(url, callback) {\n\tvar HIERARCHY_STEP_SIZE = 5;\n\n\ttry {\n\t\t// We assume everything ater the string 'greyhound://' is the server url\n\t\tvar serverURL = url.split('greyhound://')[1];\n        if (serverURL.split('http://').length == 1) {\n            serverURL = 'http://' + serverURL;\n        }\n\n        GreyhoundUtils.fetch(serverURL + 'info', function(err, data) {\n            if (err) throw new Error(err);\n\n            /* We parse the result of the info query, which should be a JSON\n             * datastructure somewhat like:\n            {\n              \"bounds\": [635577, 848882, -1000, 639004, 853538, 2000],\n              \"numPoints\": 10653336,\n              \"schema\": [\n                  { \"name\": \"X\", \"size\": 8, \"type\": \"floating\" },\n                  { \"name\": \"Y\", \"size\": 8, \"type\": \"floating\" },\n                  { \"name\": \"Z\", \"size\": 8, \"type\": \"floating\" },\n                  { \"name\": \"Intensity\", \"size\": 2, \"type\": \"unsigned\" },\n                  { \"name\": \"OriginId\", \"size\": 4, \"type\": \"unsigned\" },\n                  { \"name\": \"Red\", \"size\": 2, \"type\": \"unsigned\" },\n                  { \"name\": \"Green\", \"size\": 2, \"type\": \"unsigned\" },\n                  { \"name\": \"Blue\", \"size\": 2, \"type\": \"unsigned\" }\n              ],\n              \"srs\": \"<omitted for brevity>\",\n              \"type\": \"octree\"\n            }\n            */\n            var greyhoundInfo = JSON.parse(data);\n            var version = new Potree.Version('1.4');\n\n            var bounds = greyhoundInfo.bounds;\n            var boundsConforming = greyhoundInfo.boundsConforming;\n\n            var width = bounds[3] - bounds[0];\n            var depth = bounds[4] - bounds[1];\n            var height= bounds[5] - bounds[2];\n            var radius = width / 2;\n\n            var scale = greyhoundInfo.scale;\n            var scale = greyhoundInfo.scale || .01;\n            if (Array.isArray(scale)) {\n                scale = Math.min(scale[0], scale[1], scale[2]);\n            }\n\n            if (GreyhoundUtils.getQueryParam('scale')) {\n                scale = parseFloat(GreyhoundUtils.getQueryParam('scale'));\n            }\n\n            var baseDepth = Math.max(8, greyhoundInfo.baseDepth);\n\n            // Ideally we want to change this bit completely, since\n            // greyhound's options are wider than the default options for\n            // visualizing pointclouds. If someone ever has time to build a\n            // custom ui element for greyhound, the schema options from\n            // this info request should be given to the UI, so the user can\n            // choose between them. The selected option can then be\n            // directly requested from the server in the\n            // PointCloudGreyhoundGeometryNode without asking for\n            // attributes that we are not currently visualizing.  We assume\n            // XYZ are always available.\n            var attributes = ['POSITION_CARTESIAN'];\n\n            // To be careful, we only add COLOR_PACKED as an option if all\n            // colors are actually found.\n            var red = false, green = false, blue = false;\n\n            greyhoundInfo.schema.forEach(function(entry) {\n                // Intensity and Classification are optional.\n                if (entry.name === 'Intensity') {\n                    attributes.push('INTENSITY');\n                }\n                if (entry.name === 'Classification') {\n                    attributes.push('CLASSIFICATION');\n                }\n\n                if (entry.name === 'Red') red = true;\n                else if (entry.name === 'Green') green = true;\n                else if (entry.name === 'Blue') blue = true;\n            });\n\n            if (red && green && blue) attributes.push('COLOR_PACKED');\n\n            // Fill in geometry fields.\n            var pgg = new Potree.PointCloudGreyhoundGeometry();\n            pgg.serverURL = serverURL;\n            pgg.spacing = (bounds[3] - bounds[0]) / Math.pow(2, baseDepth);\n            pgg.baseDepth = baseDepth;\n            pgg.hierarchyStepSize = HIERARCHY_STEP_SIZE;\n\n            pgg.schema = GreyhoundUtils.createSchema(attributes);\n            var pointSize = GreyhoundUtils.pointSizeFrom(pgg.schema);\n\n            pgg.pointAttributes = new Potree.PointAttributes(attributes);\n            pgg.pointAttributes.byteSize = pointSize;\n\n            var boundingBox = new THREE.Box3(\n                new THREE.Vector3().fromArray(bounds, 0),\n                new THREE.Vector3().fromArray(bounds, 3));\n\n            var offset = boundingBox.min.clone();\n\n            boundingBox.max.sub(boundingBox.min);\n            boundingBox.min.set(0, 0, 0);\n\n            pgg.projection = greyhoundInfo.srs;\n            pgg.boundingBox = boundingBox;\n            pgg.boundingSphere = boundingBox.getBoundingSphere();\n\n            pgg.scale = scale;\n            pgg.offset = offset;\n\n            console.log('Scale:', scale);\n            console.log('Offset:', offset);\n            console.log('Bounds:', boundingBox);\n\n            pgg.loader = new Potree.GreyhoundBinaryLoader(\n                    version, boundingBox, pgg.scale);\n\n            var nodes = {};\n\n            { // load root\n                var name = \"r\";\n\n                var root = new Potree.PointCloudGreyhoundGeometryNode(\n                        name, pgg, boundingBox,\n                        scale, offset);\n\n                root.level = 0;\n                root.hasChildren = true;\n                root.numPoints = greyhoundInfo.numPoints;\n                root.spacing = pgg.spacing;\n                pgg.root = root;\n                pgg.root.load();\n                nodes[name] = root;\n            }\n\n            pgg.nodes = nodes;\n\n            GreyhoundUtils.getNormalization(serverURL, greyhoundInfo.baseDepth,\n                    function(err, normalize) {\n                        if (normalize.color) pgg.normalize.color = true;\n                        if (normalize.intensity) pgg.normalize.intensity = true;\n\n                        callback(pgg);\n                    });\n        });\n\t}\n    catch(e) {\n\t\tconsole.log(\"loading failed: '\" + url + \"'\");\n\t\tconsole.log(e);\n\n\t\tcallback();\n\t}\n};\n\nPotree.GreyhoundLoader.loadPointAttributes = function(mno){\n\tvar fpa = mno.pointAttributes;\n\tvar pa = new Potree.PointAttributes();\n\n\tfor(var i = 0; i < fpa.length; i++){\n\t\tvar pointAttribute = Potree.PointAttribute[fpa[i]];\n\t\tpa.add(pointAttribute);\n\t}\n\n\treturn pa;\n};\n\n\nPotree.GreyhoundLoader.createChildAABB = function(aabb, childIndex){\n\tvar V3 = THREE.Vector3;\n\tvar min = aabb.min;\n\tvar max = aabb.max;\n\tvar dHalfLength = new THREE.Vector3().copy(max).sub(min).multiplyScalar(0.5);\n\tvar xHalfLength = new THREE.Vector3(dHalfLength.x, 0, 0);\n\tvar yHalfLength = new THREE.Vector3(0, dHalfLength.y, 0);\n\tvar zHalfLength = new THREE.Vector3(0, 0, dHalfLength.z);\n\n\tvar cmin = min;\n\tvar cmax = new THREE.Vector3().add(min).add(dHalfLength);\n\n\tvar min, max;\n\tif (childIndex === 1) {\n\t\tmin = new THREE.Vector3().copy(cmin).add(zHalfLength);\n\t\tmax = new THREE.Vector3().copy(cmax).add(zHalfLength);\n\t}else if (childIndex === 3) {\n\t\tmin = new THREE.Vector3().copy(cmin).add(zHalfLength).add(yHalfLength);\n\t\tmax = new THREE.Vector3().copy(cmax).add(zHalfLength).add(yHalfLength);\n\t}else if (childIndex === 0) {\n\t\tmin = cmin;\n\t\tmax = cmax;\n\t}else if (childIndex === 2) {\n\t\tmin = new THREE.Vector3().copy(cmin).add(yHalfLength);\n\t\tmax = new THREE.Vector3().copy(cmax).add(yHalfLength);\n\t}else if (childIndex === 5) {\n\t\tmin = new THREE.Vector3().copy(cmin).add(zHalfLength).add(xHalfLength);\n\t\tmax = new THREE.Vector3().copy(cmax).add(zHalfLength).add(xHalfLength);\n\t}else if (childIndex === 7) {\n\t\tmin = new THREE.Vector3().copy(cmin).add(dHalfLength);\n\t\tmax = new THREE.Vector3().copy(cmax).add(dHalfLength);\n\t}else if (childIndex === 4) {\n\t\tmin = new THREE.Vector3().copy(cmin).add(xHalfLength);\n\t\tmax = new THREE.Vector3().copy(cmax).add(xHalfLength);\n\t}else if (childIndex === 6) {\n\t\tmin = new THREE.Vector3().copy(cmin).add(xHalfLength).add(yHalfLength);\n\t\tmax = new THREE.Vector3().copy(cmax).add(xHalfLength).add(yHalfLength);\n\t}\n\n\treturn new THREE.Box3(min, max);\n};\n\n\n/**\n * laslaz code taken and adapted from plas.io js-laslaz\n *\thttp://plas.io/\n *  https://github.com/verma/plasio\n *\n * Thanks to Uday Verma and Howard Butler\n *\n */\n \nPotree.LasLazLoader = class LasLazLoader{\n\t\n\tconstructor(version){\n\t\tif(typeof(version) === \"string\"){\n\t\t\tthis.version = new Potree.Version(version);\n\t\t}else{\n\t\t\tthis.version = version;\n\t\t}\n\t}\n\t\n\tstatic progressCB(){\n\t\t\n\t}\n\t\n\tload(node){\n\t\t\n\t\tif(node.loaded){\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tlet pointAttributes = node.pcoGeometry.pointAttributes;\n\n\t\tlet url = node.getURL();\n\t\t\n\t\tif(this.version.equalOrHigher(\"1.4\")){\n\t\t\turl += \".\" + pointAttributes.toLowerCase();\n\t\t}\n\t\t\n\t\tlet scope = this;\n\t\t\n\t\tlet xhr = new XMLHttpRequest();\n\t\txhr.open('GET', url, true);\n\t\txhr.responseType = 'arraybuffer';\n\t\txhr.overrideMimeType('text/plain; charset=x-user-defined');\n\t\txhr.onreadystatechange = function() {\n\t\t\tif (xhr.readyState === 4) {\n\t\t\t\tif (xhr.status === 200) {\n\t\t\t\t\tlet buffer = xhr.response;\n\t\t\t\t\tscope.parse(node, buffer);\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log('Failed to load file! HTTP status: ' + xhr.status + \", file: \" + url);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\t\n\t\txhr.send(null);\n\t}\n\t\n\tparse(node, buffer){\n\t\tlet lf = new LASFile(buffer);\n\t\tlet handler = new Potree.LasLazBatcher(node);\n\t\t\n\t\treturn Promise.resolve(lf).cancellable().then(function(lf) {\n\t\t\treturn lf.open().then(function() {\n\t\t\t\tlf.isOpen = true;\n\t\t\t\treturn lf;\n\t\t\t})\n\t\t\t.catch(Promise.CancellationError, function(e) {\n\t\t\t\t// open message was sent at this point, but then handler was not called\n\t\t\t\t// because the operation was cancelled, explicitly close the file\n\t\t\t\treturn lf.close().then(function() {\n\t\t\t\t\tthrow e;\n\t\t\t\t});\n\t\t\t});\n\t\t}).then(function(lf) {\n\t\t\treturn lf.getHeader().then(function(h) {\n\t\t\t\treturn [lf, h];\n\t\t\t});\n\t\t}).then(function(v) {\n\t\t\tlet lf = v[0];\n\t\t\tlet header = v[1];\n\t\t\t\n\t\t\tlet skip = 1;\n\t\t\tlet totalRead = 0;\n\t\t\tlet totalToRead = (skip <= 1 ? header.pointsCount : header.pointsCount / skip);\n\t\t\tlet reader = function() {\n\t\t\t\tlet p = lf.readData(1000000, 0, skip);\n\t\t\t\treturn p.then(function(data) {\n\t\t\t\t\thandler.push(new LASDecoder(data.buffer,\n\t\t\t\t\t\t\t\t\t\t\t\t\t   header.pointsFormatId,\n\t\t\t\t\t\t\t\t\t\t\t\t\t   header.pointsStructSize,\n\t\t\t\t\t\t\t\t\t\t\t\t\t   data.count,\n\t\t\t\t\t\t\t\t\t\t\t\t\t   header.scale,\n\t\t\t\t\t\t\t\t\t\t\t\t\t   header.offset,\n\t\t\t\t\t\t\t\t\t\t\t\t\t   header.mins, header.maxs));\n\n\t\t\t\t\ttotalRead += data.count;\n\t\t\t\t\tPotree.LasLazLoader.progressCB(totalRead / totalToRead);\n\n\t\t\t\t\tif (data.hasMoreData)\n\t\t\t\t\t\treturn reader();\n\t\t\t\t\telse {\n\n\t\t\t\t\t\theader.totalRead = totalRead;\n\t\t\t\t\t\theader.versionAsString = lf.versionAsString;\n\t\t\t\t\t\theader.isCompressed = lf.isCompressed;\n\t\t\t\t\t\treturn [lf, header, handler];\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t};\n\t\t\t\n\t\t\treturn reader();\n\t\t}).then(function(v) {\n\t\t\tlet lf = v[0];\n\t\t\t// we're done loading this file\n\t\t\t//\n\t\t\tPotree.LasLazLoader.progressCB(1);\n\n\t\t\t// Close it\n\t\t\treturn lf.close().then(function() {\n\t\t\t\tlf.isOpen = false;\n\t\t\t\t// Delay this a bit so that the user sees 100% completion\n\t\t\t\t//\n\t\t\t\treturn Promise.delay(200).cancellable();\n\t\t\t}).then(function() {\n\t\t\t\t// trim off the first element (our LASFile which we don't really want to pass to the user)\n\t\t\t\t//\n\t\t\t\treturn v.slice(1);\n\t\t\t});\n\t\t}).catch(Promise.CancellationError, function(e) {\n\t\t\t// If there was a cancellation, make sure the file is closed, if the file is open\n\t\t\t// close and then fail\n\t\t\tif (lf.isOpen) \n\t\t\t\treturn lf.close().then(function() {\n\t\t\t\t\tlf.isOpen = false;\n\t\t\t\t\tthrow e;\n\t\t\t\t});\n\t\t\tthrow e;\n\t\t});\n\t}\n\t\n\thandle(node, url){\n\t\t\n\t}\n\t\n};\n\nPotree.LasLazBatcher = class LasLazBatcher{\n\t\n\tconstructor(node){\t\n\t\tthis.node = node;\n\t}\n\t\n\tpush(lasBuffer){\n\t\t\n\t\tlet workerPath = Potree.scriptPath + \"/workers/LASDecoderWorker.js\";\n\t\tlet worker = Potree.workerPool.getWorker(workerPath);\n\t\t\n\t\tworker.onmessage = (e) => {\n\t\t\tlet geometry = new THREE.BufferGeometry();\n\t\t\tlet numPoints = lasBuffer.pointsCount;\n\t\t\t\n\t\t\tlet endsWith = function(str, suffix) {\n\t\t\t\treturn str.indexOf(suffix, str.length - suffix.length) !== -1;\n\t\t\t};\n\t\t\t\n\t\t\tlet positions = e.data.position;\n\t\t\tlet colors = new Uint8Array(e.data.color);\n\t\t\tlet intensities = e.data.intensity;\n\t\t\tlet classifications = new Uint8Array(e.data.classification);\n\t\t\tlet returnNumbers = new Uint8Array(e.data.returnNumber);\n\t\t\tlet numberOfReturns = new Uint8Array(e.data.numberOfReturns);\n\t\t\tlet pointSourceIDs = new Uint16Array(e.data.pointSourceID);\n\t\t\t//let indices = new ArrayBuffer(numPoints*4);\n\t\t\t//let iIndices = new Uint32Array(indices);\n\t\t\t\n\t\t\t//let box = new THREE.Box3();\n\t\t\t//\n\t\t\t//let fPositions = new Float32Array(positions);\n\t\t\t//for(let i = 0; i < numPoints; i++){\t\t\t\t\n\t\t\t//\tbox.expandByPoint(new THREE.Vector3(fPositions[3*i+0], fPositions[3*i+1], fPositions[3*i+2]));\n\t\t\t//}\n\t\t\t\n\t\t\tgeometry.addAttribute('position', new THREE.BufferAttribute(new Float32Array(positions), 3));\n\t\t\tgeometry.addAttribute('color', new THREE.BufferAttribute(colors, 3, true));\n\t\t\tgeometry.addAttribute('intensity', new THREE.BufferAttribute(new Float32Array(intensities), 1));\n\t\t\tgeometry.addAttribute('classification', new THREE.BufferAttribute(classifications, 1));\n\t\t\tgeometry.addAttribute('returnNumber', new THREE.BufferAttribute(returnNumbers, 1));\n\t\t\tgeometry.addAttribute('numberOfReturns', new THREE.BufferAttribute(numberOfReturns, 1));\n\t\t\tgeometry.addAttribute('pointSourceID', new THREE.BufferAttribute(pointSourceIDs, 1));\n\t\t\tgeometry.addAttribute(\"normal\", new THREE.BufferAttribute(new Float32Array(numPoints*3), 3));\n\t\t\t\n\t\t\tlet indicesAttribute = new THREE.Uint8BufferAttribute(e.data.indices, 4);\n\t\t\tindicesAttribute.normalized = true;\n\t\t\tgeometry.addAttribute(\"indices\", indicesAttribute);\n\t\t\t\n\t\t\tlet tightBoundingBox = new THREE.Box3(\n\t\t\t\tnew THREE.Vector3().fromArray(e.data.tightBoundingBox.min),\n\t\t\t\tnew THREE.Vector3().fromArray(e.data.tightBoundingBox.max)\n\t\t\t);\n\t\t\t\n\t\t\tgeometry.boundingBox = this.node.boundingBox;\n\t\t\tthis.node.tightBoundingBox = tightBoundingBox;\n\t\t\t\n\t\t\tthis.node.geometry = geometry;\n\t\t\tthis.node.loaded = true;\n\t\t\tthis.node.loading = false;\n\t\t\tthis.node.pcoGeometry.numNodesLoading--;\n\t\t\tthis.node.mean = new THREE.Vector3(...e.data.mean);\n\t\t\t\n\t\t\tPotree.workerPool.returnWorker(workerPath, worker);\n\t\t};\n\t\t\n\t\tlet message = {\n\t\t\tbuffer: lasBuffer.arrayb,\n\t\t\tnumPoints: lasBuffer.pointsCount,\n\t\t\tpointSize: lasBuffer.pointSize,\n\t\t\tpointFormatID: 2,\n\t\t\tscale: lasBuffer.scale,\n\t\t\toffset: lasBuffer.offset,\n\t\t\tmins: lasBuffer.mins,\n\t\t\tmaxs: lasBuffer.maxs\n\t\t};\n\t\tworker.postMessage(message, [message.buffer]);\n\t};\n};\n\n\n//\n//\n//\n// how to calculate the radius of a projected sphere in screen space\n// http://stackoverflow.com/questions/21648630/radius-of-projected-sphere-in-screen-space\n// http://stackoverflow.com/questions/3717226/radius-of-projected-sphere\n//\n\n//\n// to get a ready to use gradient array from a chroma.js gradient:\n// http://gka.github.io/chroma.js/\n//\n//var stops = [];\n//for(let i = 0; i <= 10; i++){\n//\tlet range = chroma.scale(['yellow', 'navy']).mode('lch').domain([10,0])(i)._rgb\n//\t\t.slice(0, 3)\n//\t\t.map(v => (v / 255).toFixed(4))\n//\t\t.join(\", \");\n//\n//\tlet line = `[${i / 10}, new THREE.Color(${range})],`;\n//\n//\tstops.push(line);\n//}\n//stops.join(\"\\n\");\n\n\n// to get a ready to use gradient array from matplotlib:\n//import matplotlib.pyplot as plt\n//import matplotlib.colors as colors\n//\n//norm = colors.Normalize(vmin=0,vmax=1)\n//cmap = plt.cm.viridis\n//\n//for i in range(0,11):\n//    u = i / 10\n//    rgb = cmap(norm(u))[0:3]\n//    rgb = [\"{0:.3f}\".format(v) for v in rgb]\n//    rgb = \"[\" + str(u) + \", new THREE.Color(\" +  \", \".join(rgb) + \")],\"\n//    print(rgb)\n\nPotree.Gradients = {\n\tRAINBOW: [\n\t\t[0, new THREE.Color(0.278, 0, 0.714)],\n\t\t[1/6, new THREE.Color(0, 0, 1)],\n\t\t[2/6, new THREE.Color(0, 1, 1)],\n\t\t[3/6, new THREE.Color(0, 1, 0)],\n\t\t[4/6, new THREE.Color(1, 1, 0)],\n\t\t[5/6, new THREE.Color(1, 0.64, 0)],\n\t\t[1, new THREE.Color(1, 0, 0)]\n\t],\n\t// From chroma spectral http://gka.github.io/chroma.js/\n\tSPECTRAL: [\n\t\t[0, new THREE.Color(0.3686, 0.3098, 0.6353)],\n\t\t[0.1, new THREE.Color(0.1961, 0.5333, 0.7412)],\n\t\t[0.2, new THREE.Color(0.4000, 0.7608, 0.6471)],\n\t\t[0.3, new THREE.Color(0.6706, 0.8667, 0.6431)],\n\t\t[0.4, new THREE.Color(0.9020, 0.9608, 0.5961)],\n\t\t[0.5, new THREE.Color(1.0000, 1.0000, 0.7490)],\n\t\t[0.6, new THREE.Color(0.9961, 0.8784, 0.5451)],\n\t\t[0.7, new THREE.Color(0.9922, 0.6824, 0.3804)],\n\t\t[0.8, new THREE.Color(0.9569, 0.4275, 0.2627)],\n\t\t[0.9, new THREE.Color(0.8353, 0.2431, 0.3098)],\n\t\t[1, new THREE.Color(0.6196, 0.0039, 0.2588)],\n\t],\n\tPLASMA: [\n\t\t[0.0, new THREE.Color(0.241, 0.015, 0.610)],\n\t\t[0.1, new THREE.Color(0.387, 0.001, 0.654)],\n\t\t[0.2, new THREE.Color(0.524, 0.025, 0.653)],\n\t\t[0.3, new THREE.Color(0.651, 0.125, 0.596)],\n\t\t[0.4, new THREE.Color(0.752, 0.227, 0.513)],\n\t\t[0.5, new THREE.Color(0.837, 0.329, 0.431)],\n\t\t[0.6, new THREE.Color(0.907, 0.435, 0.353)],\n\t\t[0.7, new THREE.Color(0.963, 0.554, 0.272)],\n\t\t[0.8, new THREE.Color(0.992, 0.681, 0.195)],\n\t\t[0.9, new THREE.Color(0.987, 0.822, 0.144)],\n\t\t[1.0, new THREE.Color(0.940, 0.975, 0.131)],\n\t],\n\tYELLOW_GREEN: [\n\t\t[0, new THREE.Color(0.1647, 0.2824, 0.3451)],\n\t\t[0.1, new THREE.Color(0.1338, 0.3555, 0.4227)],\n\t\t[0.2, new THREE.Color(0.0610, 0.4319, 0.4864)],\n\t\t[0.3, new THREE.Color(0.0000, 0.5099, 0.5319)],\n\t\t[0.4, new THREE.Color(0.0000, 0.5881, 0.5569)],\n\t\t[0.5, new THREE.Color(0.1370, 0.6650, 0.5614)],\n\t\t[0.6, new THREE.Color(0.2906, 0.7395, 0.5477)],\n\t\t[0.7, new THREE.Color(0.4453, 0.8099, 0.5201)],\n\t\t[0.8, new THREE.Color(0.6102, 0.8748, 0.4850)],\n\t\t[0.9, new THREE.Color(0.7883, 0.9323, 0.4514)],\n\t\t[1, new THREE.Color(0.9804, 0.9804, 0.4314)],\n\t],\n\tVIRIDIS: [\n\t\t[0.0, new THREE.Color(0.267, 0.005, 0.329)],\n\t\t[0.1, new THREE.Color(0.283, 0.141, 0.458)],\n\t\t[0.2, new THREE.Color(0.254, 0.265, 0.530)],\n\t\t[0.3, new THREE.Color(0.207, 0.372, 0.553)],\n\t\t[0.4, new THREE.Color(0.164, 0.471, 0.558)],\n\t\t[0.5, new THREE.Color(0.128, 0.567, 0.551)],\n\t\t[0.6, new THREE.Color(0.135, 0.659, 0.518)],\n\t\t[0.7, new THREE.Color(0.267, 0.749, 0.441)],\n\t\t[0.8, new THREE.Color(0.478, 0.821, 0.318)],\n\t\t[0.9, new THREE.Color(0.741, 0.873, 0.150)],\n\t\t[1.0, new THREE.Color(0.993, 0.906, 0.144)],\n\t],\n\tINFERNO: [\n\t\t[0.0, new THREE.Color(0.077, 0.042, 0.206)],\n\t\t[0.1, new THREE.Color(0.225, 0.036, 0.388)],\n\t\t[0.2, new THREE.Color(0.373, 0.074, 0.432)],\n\t\t[0.3, new THREE.Color(0.522, 0.128, 0.420)],\n\t\t[0.4, new THREE.Color(0.665, 0.182, 0.370)],\n\t\t[0.5, new THREE.Color(0.797, 0.255, 0.287)],\n\t\t[0.6, new THREE.Color(0.902, 0.364, 0.184)],\n\t\t[0.7, new THREE.Color(0.969, 0.516, 0.063)],\n\t\t[0.8, new THREE.Color(0.988, 0.683, 0.072)],\n\t\t[0.9, new THREE.Color(0.961, 0.859, 0.298)],\n\t\t[1.0, new THREE.Color(0.988, 0.998, 0.645)],\n\t],\n\tGRAYSCALE: [\n\t\t[0, new THREE.Color(0,0,0)],\n\t\t[1, new THREE.Color(1,1,1)]\n\t]\n};\n\nPotree.Classification = {\n\t\"DEFAULT\": {\n\t\t0: \t\t\tnew THREE.Vector4(0.5, 0.5,0.5, 1.0),\n\t\t1: \t\t\tnew THREE.Vector4(0.5, 0.5,0.5, 1.0),\n\t\t2: \t\t\tnew THREE.Vector4(0.63, 0.32, 0.18, 1.0),\n\t\t3: \t\t\tnew THREE.Vector4(0.0, 1.0, 0.0, 1.0),\n\t\t4: \t\t\tnew THREE.Vector4(0.0, 0.8, 0.0, 1.0),\n\t\t5: \t\t\tnew THREE.Vector4(0.0, 0.6, 0.0, 1.0),\n\t\t6: \t\t\tnew THREE.Vector4(1.0, 0.66, 0.0, 1.0),\n\t\t7:\t\t\tnew THREE.Vector4(1.0, 0, 1.0, 1.0),\n\t\t8: \t\t\tnew THREE.Vector4(1.0, 0, 0.0, 1.0),\n\t\t9: \t\t\tnew THREE.Vector4(0.0, 0.0, 1.0, 1.0),\n\t\t12:\t\t\tnew THREE.Vector4(1.0, 1.0, 0.0, 1.0),\n\t\t\"DEFAULT\": \tnew THREE.Vector4(0.3, 0.6, 0.6, 0.5)\n\t}\n};\n\n\n\nPotree.PointSizeType = {\n\tFIXED: \t\t0,\n\tATTENUATED: 1,\n\tADAPTIVE: \t2\n};\n\nPotree.PointShape = {\n\tSQUARE: 0,\n\tCIRCLE: 1,\n\tPARABOLOID: 2\n};\n\nPotree.PointColorType = {\n\tRGB: \t\t\t\t0,\n\tCOLOR: \t\t\t\t1,\n\tDEPTH: \t\t\t\t2,\n\tHEIGHT: \t\t\t3,\n\tELEVATION: \t\t\t3,\n\tINTENSITY: \t\t\t4,\n\tINTENSITY_GRADIENT:\t5,\n\tLOD: \t\t\t\t6,\n\tLEVEL_OF_DETAIL: \t6,\n\tPOINT_INDEX: \t\t7,\n\tCLASSIFICATION: \t8,\n\tRETURN_NUMBER: \t\t9,\n\tSOURCE: \t\t\t10,\n\tNORMAL: \t\t\t11,\n\tPHONG: \t\t\t\t12,\n\tRGB_HEIGHT: \t\t13,\n\tCOMPOSITE: \t\t\t50\n};\n\nPotree.ClipMode = {\n\tDISABLED: \t\t\t0,\n\tCLIP_OUTSIDE: \t\t1,\n\tHIGHLIGHT_INSIDE:\t2\n};\n\nPotree.TreeType = {\n\tOCTREE:\t\t\t\t0,\n\tKDTREE:\t\t\t\t1\n};\n\n\nPotree.PointCloudMaterial = class PointCloudMaterial extends THREE.RawShaderMaterial{\n\t\n\tconstructor(parameters = {}){\n\t\tsuper();\n\t\t\n\t\tthis.visibleNodesTexture = Potree.utils.generateDataTexture( 2048, 1, new THREE.Color( 0xffffff ) );\n\t\tthis.visibleNodesTexture.minFilter = THREE.NearestFilter;\n\t\tthis.visibleNodesTexture.magFilter = THREE.NearestFilter;\n\t\t\n\t\tlet pointSize = parameters.size || 1.0;\n\t\tlet minSize = parameters.minSize || 1.0;\n\t\tlet maxSize = parameters.maxSize || 50.0;\n\t\tlet treeType = parameters.treeType || Potree.TreeType.OCTREE;\n\t\t\n\t\tthis._pointSizeType = Potree.PointSizeType.FIXED;\n\t\tthis._shape = Potree.PointShape.SQUARE;\n\t\tthis._pointColorType = Potree.PointColorType.RGB;\n\t\tthis._useClipBox = false;\n\t\tthis.numClipBoxes = 0;\n\t\tthis._clipMode = Potree.ClipMode.DISABLED;\n\t\tthis._weighted = false;\n\t\tthis._depthMap = null;\n\t\tthis._gradient = Potree.Gradients.SPECTRAL;\n\t\tthis._classification = Potree.Classification.DEFAULT;\n\t\tthis.gradientTexture = Potree.PointCloudMaterial.generateGradientTexture(this._gradient);\n\t\tthis.classificationTexture = Potree.PointCloudMaterial.generateClassificationTexture(this._classification);\n\t\tthis.lights = false;\n\t\tthis.fog = false;\n\t\tthis._treeType = treeType;\n\t\tthis._useEDL = false;\n\t\t\n\t\tthis._defaultIntensityRangeChanged = false;\n\t\tthis._defaultElevationRangeChanged = false;\n\t\t\n\t\tthis.attributes = {\n\t\t\tposition: \t\t\t{ type: \"fv\", value: [] },\n\t\t\tcolor: \t\t\t\t{ type: \"fv\", value: [] },\n\t\t\tnormal: \t\t\t{ type: \"fv\", value: [] },\n\t\t\tintensity: \t\t\t{ type: \"f\", value: [] },\n\t\t\tclassification: \t{ type: \"f\", value: [] },\n\t\t\treturnNumber: \t\t{ type: \"f\", value: [] },\n\t\t\tnumberOfReturns: \t{ type: \"f\", value: [] },\n\t\t\tpointSourceID: \t\t{ type: \"f\", value: [] },\n\t\t\tindices: \t\t\t{ type: \"fv\", value: [] }\n\t\t};\n\t\t\n\t\tthis.uniforms = {\n\t\t\tlevel:\t\t\t\t{ type: \"f\", value: 0.0 },\n\t\t\tvnStart:\t\t\t\t{ type: \"f\", value: 0.0 },\n\t\t\tspacing:\t\t\t{ type: \"f\", value: 1.0 },\n\t\t\tblendHardness:\t\t{ type: \"f\", value: 2.0 },\n\t\t\tblendDepthSupplement:\t{ type: \"f\", value: 0.0 },\n\t\t\tfov:\t\t\t\t{ type: \"f\", value: 1.0 },\n\t\t\tscreenWidth:\t\t{ type: \"f\", value: 1.0 },\n\t\t\tscreenHeight:\t\t{ type: \"f\", value: 1.0 },\n\t\t\tnear:\t\t\t\t{ type: \"f\", value: 0.1 },\n\t\t\tfar:\t\t\t\t{ type: \"f\", value: 1.0 },\n\t\t\tuColor:   \t\t\t{ type: \"c\", value: new THREE.Color( 0xffffff ) },\n\t\t\topacity:   \t\t\t{ type: \"f\", value: 1.0 },\n\t\t\tsize:   \t\t\t{ type: \"f\", value: pointSize },\n\t\t\tminSize:   \t\t\t{ type: \"f\", value: minSize },\n\t\t\tmaxSize:   \t\t\t{ type: \"f\", value: maxSize },\n\t\t\toctreeSize:\t\t\t{ type: \"f\", value: 0 },\n\t\t\tbbSize:\t\t\t\t{ type: \"fv\", value: [0,0,0] },\n\t\t\theightMin:\t\t\t{ type: \"f\", value: 0.0 },\n\t\t\theightMax:\t\t\t{ type: \"f\", value: 1.0 },\n\t\t\tclipBoxCount:\t\t{ type: \"f\", value: 0 },\n\t\t\tvisibleNodes:\t\t{ type: \"t\", value: this.visibleNodesTexture },\n\t\t\tpcIndex:   \t\t\t{ type: \"f\", value: 0 },\n\t\t\tgradient: \t\t\t{ type: \"t\", value: this.gradientTexture },\n\t\t\tclassificationLUT: \t{ type: \"t\", value: this.classificationTexture },\n\t\t\tclipBoxes:\t\t\t{ type: \"Matrix4fv\", value: [] },\n\t\t\ttoModel:\t\t\t{ type: \"Matrix4f\", value: [] },\n\t\t\tdepthMap: \t\t\t{ type: \"t\", value: null },\n\t\t\tdiffuse:\t\t\t{ type: \"fv\", value: [1,1,1]},\n\t\t\ttransition:         { type: \"f\", value: 0.5 },\n\t\t\tintensityRange:     { type: \"fv\", value: [0, 65000] },\n\t\t\tintensityGamma:     { type: \"f\", value: 1 },\n\t\t\tintensityContrast:\t{ type: \"f\", value: 0 },\n\t\t\tintensityBrightness:{ type: \"f\", value: 0 },\n\t\t\trgbGamma:     \t\t{ type: \"f\", value: 1 },\n\t\t\trgbContrast:\t\t{ type: \"f\", value: 0 },\n\t\t\trgbBrightness:\t\t{ type: \"f\", value: 0 },\n\t\t\twRGB:\t\t\t\t{ type: \"f\", value: 1 },\n\t\t\twIntensity:\t\t\t{ type: \"f\", value: 0 },\n\t\t\twElevation:\t\t\t{ type: \"f\", value: 0 },\n\t\t\twClassification:\t{ type: \"f\", value: 0 },\n\t\t\twReturnNumber:\t\t{ type: \"f\", value: 0 },\n\t\t\twSourceID:\t\t\t{ type: \"f\", value: 0 },\n\t\t};\n\t\t\n\t\tthis.defaultAttributeValues.normal = [0,0,0];\n\t\tthis.defaultAttributeValues.classification = [0,0,0];\n\t\tthis.defaultAttributeValues.indices = [0,0,0,0];\n\t\t\n\t\tthis.vertexShader = this.getDefines() + Potree.Shaders[\"pointcloud.vs\"];\n\t\tthis.fragmentShader = this.getDefines() + Potree.Shaders[\"pointcloud.fs\"];\n\t\tthis.vertexColors = THREE.VertexColors;\n\t}\n\t\n\tupdateShaderSource(){\n\t\tthis.vertexShader = this.getDefines() + Potree.Shaders[\"pointcloud.vs\"];\n\t\tthis.fragmentShader = this.getDefines() + Potree.Shaders[\"pointcloud.fs\"];\n\t\t\n\t\tif(this.depthMap){\n\t\t\tthis.uniforms.depthMap.value = this.depthMap;\n\t\t\t//this.depthMap = depthMap;\n\t\t\t//this.setValues({\n\t\t\t//\tdepthMap: this.depthMap,\n\t\t\t//});\n\t\t}\n\t\t\n\t\tif(this.opacity === 1.0){\n\t\t\tthis.blending = THREE.NoBlending;\n\t\t\tthis.transparent = false;\n\t\t\tthis.depthTest = true;\n\t\t\tthis.depthWrite = true;\n\t\t}else if(this.opacity < 1.0 && !this.useEDL){\n\t\t\tthis.blending = THREE.AdditiveBlending;\n\t\t\tthis.transparent = true;\n\t\t\tthis.depthTest = false;\n\t\t\tthis.depthWrite = true;\n\t\t\tthis.depthFunc = THREE.AlwaysDepth;\n\t\t}\n\t\t\t\n\t\tif(this.weighted){\t\n\t\t\tthis.blending = THREE.AdditiveBlending;\n\t\t\tthis.transparent = true;\n\t\t\tthis.depthTest = true;\n\t\t\tthis.depthWrite = false;\t\n\t\t}\n\t\t\t\n\t\tthis.needsUpdate = true;\n\t}\n\t\n\tgetDefines(){\n\t\tlet defines = \"\";\n\t\n\t\tif(this.pointSizeType === Potree.PointSizeType.FIXED){\n\t\t\tdefines += \"#define fixed_point_size\\n\";\n\t\t}else if(this.pointSizeType === Potree.PointSizeType.ATTENUATED){\n\t\t\tdefines += \"#define attenuated_point_size\\n\";\n\t\t}else if(this.pointSizeType === Potree.PointSizeType.ADAPTIVE){\n\t\t\tdefines += \"#define adaptive_point_size\\n\";\n\t\t}\n\t\t\n\t\tif(this.shape === Potree.PointShape.SQUARE){\n\t\t\tdefines += \"#define square_point_shape\\n\";\n\t\t}else if(this.shape === Potree.PointShape.CIRCLE){\n\t\t\tdefines += \"#define circle_point_shape\\n\";\n\t\t}else if(this.shape === Potree.PointShape.PARABOLOID){\n\t\t\tdefines += \"#define paraboloid_point_shape\\n\";\n\t\t}\n\t\t\n\t\tif(this._useEDL){\n\t\t\tdefines += \"#define use_edl\\n\";\n\t\t}\n\t\t\n\t\tif(this._pointColorType === Potree.PointColorType.RGB){\n\t\t\tdefines += \"#define color_type_rgb\\n\";\n\t\t}else if(this._pointColorType === Potree.PointColorType.COLOR){\n\t\t\tdefines += \"#define color_type_color\\n\";\n\t\t}else if(this._pointColorType === Potree.PointColorType.DEPTH){\n\t\t\tdefines += \"#define color_type_depth\\n\";\n\t\t}else if(this._pointColorType === Potree.PointColorType.HEIGHT){\n\t\t\tdefines += \"#define color_type_height\\n\";\n\t\t}else if(this._pointColorType === Potree.PointColorType.INTENSITY){\n\t\t\tdefines += \"#define color_type_intensity\\n\";\n\t\t}else if(this._pointColorType === Potree.PointColorType.INTENSITY_GRADIENT){\n\t\t\tdefines += \"#define color_type_intensity_gradient\\n\";\n\t\t}else if(this._pointColorType === Potree.PointColorType.LOD){\n\t\t\tdefines += \"#define color_type_lod\\n\";\n\t\t}else if(this._pointColorType === Potree.PointColorType.POINT_INDEX){\n\t\t\tdefines += \"#define color_type_point_index\\n\";\n\t\t}else if(this._pointColorType === Potree.PointColorType.CLASSIFICATION){\n\t\t\tdefines += \"#define color_type_classification\\n\";\n\t\t}else if(this._pointColorType === Potree.PointColorType.RETURN_NUMBER){\n\t\t\tdefines += \"#define color_type_return_number\\n\";\n\t\t}else if(this._pointColorType === Potree.PointColorType.SOURCE){\n\t\t\tdefines += \"#define color_type_source\\n\";\n\t\t}else if(this._pointColorType === Potree.PointColorType.NORMAL){\n\t\t\tdefines += \"#define color_type_normal\\n\";\n\t\t}else if(this._pointColorType === Potree.PointColorType.PHONG){\n\t\t\tdefines += \"#define color_type_phong\\n\";\n\t\t}else if(this._pointColorType === Potree.PointColorType.RGB_HEIGHT){\n\t\t\tdefines += \"#define color_type_rgb_height\\n\";\n\t\t}else if(this._pointColorType === Potree.PointColorType.COMPOSITE){\n\t\t\tdefines += \"#define color_type_composite\\n\";\n\t\t}\n\t\t\n\t\tif(this.clipMode === Potree.ClipMode.DISABLED){\n\t\t\tdefines += \"#define clip_disabled\\n\";\n\t\t}else if(this.clipMode === Potree.ClipMode.CLIP_OUTSIDE){\n\t\t\tdefines += \"#define clip_outside\\n\";\n\t\t}else if(this.clipMode === Potree.ClipMode.HIGHLIGHT_INSIDE){\n\t\t\tdefines += \"#define clip_highlight_inside\\n\";\n\t\t}\n\t\t\n\t\tif(this._treeType === Potree.TreeType.OCTREE){\n\t\t\tdefines += \"#define tree_type_octree\\n\";\n\t\t}else if(this._treeType === Potree.TreeType.KDTREE){\n\t\t\tdefines += \"#define tree_type_kdtree\\n\";\n\t\t}\n\t\t\n\t\tif(this.weighted){\n\t\t\tdefines += \"#define weighted_splats\\n\";\n\t\t}\n\t\t\n\t\tif(this.numClipBoxes > 0){\n\t\t\tdefines += \"#define use_clip_box\\n\";\n\t\t}\n\n\t\treturn defines;\n\t}\n\n\t\n\tsetClipBoxes(clipBoxes){\n\t\tif(!clipBoxes){\n\t\t\treturn;\n\t\t}\n\n\t\tthis.clipBoxes = clipBoxes;\n\t\tlet doUpdate = (this.numClipBoxes !== clipBoxes.length) && (clipBoxes.length === 0 || this.numClipBoxes === 0);\n\n\t\tthis.numClipBoxes = clipBoxes.length;\n\t\tthis.uniforms.clipBoxCount.value = this.numClipBoxes;\n\t\t\n\t\tif(doUpdate){\n\t\t\tthis.updateShaderSource();\n\t\t}\n\t\t\n\t\tthis.uniforms.clipBoxes.value = new Float32Array(this.numClipBoxes * 16);\n\t\t\n\t\tfor(let i = 0; i < this.numClipBoxes; i++){\n\t\t\tlet box = clipBoxes[i];\n\t\t\t\n\t\t\tthis.uniforms.clipBoxes.value.set(box.inverse.elements, 16*i);\n\t\t}\n\t\t\n\t\tfor(let i = 0; i < this.uniforms.clipBoxes.value.length; i++){\n\t\t\tif(Number.isNaN(this.uniforms.clipBoxes.value[i])){\n\t\t\t\tthis.uniforms.clipBoxes.value[i] = Infinity;\n\t\t\t}\n\t\t}\n\t}\n\t\n\tget gradient(){\n\t\treturn this._gradient;\n\t}\n\t\n\tset gradient(value){\n\t\tif(this._gradient !== value){\n\t\t\tthis._gradient = value;\n\t\t\tthis.gradientTexture = Potree.PointCloudMaterial.generateGradientTexture(this._gradient);\n\t\t\tthis.uniforms.gradient.value = this.gradientTexture;\n\t\t}\n\t}\n\t\n\t\n\n\tget classification(){\n\t\treturn this._classification;\n\t}\n\t\n\tset classification(value){\n\t\t\n\t\tlet isEqual = Object.keys(value).length === Object.keys(this._classification).length;\n\t\t\n\t\tfor(let key of Object.keys(value)){\n\t\t\tisEqual = isEqual && this._classification[key] !== undefined;\n\t\t\tisEqual = isEqual && value[key].equals(this._classification[key]);\n\t\t}\n\t\t\n\t\t\n\t\tif(!isEqual){\n\t\t\trecomputeClassification();\n\t\t}\n\t}\n\t\n\trecomputeClassification(){\n\t\tthis.classificationTexture = Potree.PointCloudMaterial.generateClassificationTexture(this._classification);\n\t\tthis.uniforms.classificationLUT.value = this.classificationTexture;\n\t\t\n\t\tthis.dispatchEvent({\n\t\t\ttype: \"material_property_changed\",\n\t\t\ttarget: this\n\t\t});\n\t}\n\n\tget spacing(){\n\t\treturn this.uniforms.spacing.value;\n\t}\n\t\n\tset spacing(value){\n\t\tif(this.uniforms.spacing.value !== value){\n\t\t\tthis.uniforms.spacing.value = value;\n\t\t}\n\t}\n\n\t\n\t\n\tget useClipBox(){\n\t\treturn this._useClipBox;\n\t}\n\t\n\tset useClipBox(value){\n\t\tif(this._useClipBox !== value){\n\t\t\tthis._useClipBox = value;\n\t\t\tthis.updateShaderSource();\n\t\t}\n\t}\n\n\n\tget weighted(){\n\t\treturn this._weighted;\n\t}\n\t\n\tset weighted(value){\n\t\tif(this._weighted !== value){\n\t\t\tthis._weighted = value;\n\t\t\tthis.updateShaderSource();\n\t\t}\n\t}\n\n\t\n\tget fov(){\n\t\treturn this.uniforms.fov.value;\n\t}\n\t\n\tset fov(value){\n\t\tif(this.uniforms.fov.value !== value){\n\t\t\tthis.uniforms.fov.value = value;\n\t\t\t//this.updateShaderSource();\n\t\t}\n\t}\n\n\tget screenWidth(){\n\t\treturn this.uniforms.screenWidth.value;\n\t}\n\t\n\tset screenWidth(value){\n\t\tif(this.uniforms.screenWidth.value !== value){\n\t\t\tthis.uniforms.screenWidth.value = value;\n\t\t\t//this.updateShaderSource();\n\t\t}\n\t}\n\n\n\tget screenHeight(){\n\t\treturn this.uniforms.screenHeight.value;\n\t}\n\t\n\tset screenHeight(value){\n\t\tif(this.uniforms.screenHeight.value !== value){\n\t\t\tthis.uniforms.screenHeight.value = value;\n\t\t\t//this.updateShaderSource();\n\t\t}\n\t}\n\n\n\tget near(){\n\t\treturn this.uniforms.near.value;\n\t}\n\t\n\tset near(value){\n\t\tif(this.uniforms.near.value !== value){\n\t\t\tthis.uniforms.near.value = value;\n\t\t}\n\t}\n\n\n\tget far(){\n\t\treturn this.uniforms.far.value;\n\t}\n\t\n\tset far(value){\n\t\tif(this.uniforms.far.value !== value){\n\t\t\tthis.uniforms.far.value = value;\n\t\t}\n\t}\n\n\n\tget opacity(){\n\t\treturn this.uniforms.opacity.value;\n\t}\n\t\n\tset opacity(value){\n\t\tif(this.uniforms && this.uniforms.opacity){\n\t\t\tif(this.uniforms.opacity.value !== value){\n\t\t\t\tthis.uniforms.opacity.value = value;\n\t\t\t\tthis.updateShaderSource();\n\t\t\t\tthis.dispatchEvent({\n\t\t\t\t\ttype: \"opacity_changed\",\n\t\t\t\t\ttarget: this\n\t\t\t\t});\n\t\t\t\tthis.dispatchEvent({\n\t\t\t\t\ttype: \"material_property_changed\",\n\t\t\t\t\ttarget: this\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\n\tget pointColorType(){\n\t\treturn this._pointColorType;\n\t}\n\t\n\tset pointColorType(value){\n\t\tif(this._pointColorType !== value){\n\t\t\tthis._pointColorType = value;\n\t\t\tthis.updateShaderSource();\n\t\t\tthis.dispatchEvent({\n\t\t\t\ttype: \"point_color_type_changed\",\n\t\t\t\ttarget: this\n\t\t\t});\n\t\t\tthis.dispatchEvent({\n\t\t\t\ttype: \"material_property_changed\",\n\t\t\t\ttarget: this\n\t\t\t});\n\t\t}\n\t}\n\n\n\tget depthMap(){\n\t\treturn this._depthMap;\n\t}\n\t\n\tset depthMap(value){\n\t\tif(this._depthMap !== value){\n\t\t\tthis._depthMap = value;\n\t\t\tthis.updateShaderSource();\n\t\t}\n\t}\n\n\t\n\tget pointSizeType(){\n\t\treturn this._pointSizeType;\n\t}\n\t\n\tset pointSizeType(value){\n\t\tif(this._pointSizeType !== value){\n\t\t\tthis._pointSizeType = value;\n\t\t\tthis.updateShaderSource();\n\t\t\tthis.dispatchEvent({\n\t\t\t\ttype: \"point_size_type_changed\",\n\t\t\t\ttarget: this\n\t\t\t});\n\t\t\tthis.dispatchEvent({\n\t\t\t\ttype: \"material_property_changed\",\n\t\t\t\ttarget: this\n\t\t\t});\n\t\t}\n\t}\n\n\n\tget clipMode(){\n\t\treturn this._clipMode;\n\t}\n\t\n\tset clipMode(value){\n\t\tif(this._clipMode !== value){\n\t\t\tthis._clipMode = value;\n\t\t\tthis.updateShaderSource();\n\t\t}\n\t}\n\n\n\tget useEDL(){\n\t\treturn this._useEDL;\n\t}\n\t\n\tset useEDL(value){\n\t\tif(this._useEDL !== value){\n\t\t\tthis._useEDL = value;\n\t\t\tthis.updateShaderSource();\n\t\t}\n\t}\n\n\n\tget color(){\n\t\treturn this.uniforms.uColor.value;\n\t}\n\t\n\tset color(value){\n\t\tif(!this.uniforms.uColor.value.equals(value)){\n\t\t\tthis.uniforms.uColor.value.copy(value);\n\t\t\t\n\t\t\tthis.dispatchEvent({\n\t\t\t\ttype: \"color_changed\",\n\t\t\t\ttarget: this\n\t\t\t});\n\t\t\tthis.dispatchEvent({\n\t\t\t\ttype: \"material_property_changed\",\n\t\t\t\ttarget: this\n\t\t\t});\n\t\t}\n\t}\n\n\n\tget shape(){\n\t\treturn this._shape;\n\t}\n\t\n\tset shape(value){\n\t\tif(this._shape !== value){\n\t\t\tthis._shape = value;\n\t\t\tthis.updateShaderSource();\n\t\t\tthis.dispatchEvent({type: \"point_shape_changed\", target: this});\n\t\t\tthis.dispatchEvent({\n\t\t\t\ttype: \"material_property_changed\",\n\t\t\t\ttarget: this\n\t\t\t});\n\t\t}\n\t}\n\n\n\n\tget treeType(){\n\t\treturn this._treeType;\n\t}\n\t\n\tset treeType(value){\n\t\tif(this._treeType !== value){\n\t\t\tthis._treeType = value;\n\t\t\tthis.updateShaderSource();\n\t\t}\n\t}\n\n\n\tget bbSize(){\n\t\treturn this.uniforms.bbSize.value;\n\t}\n\t\n\tset bbSize(value){\n\t\tthis.uniforms.bbSize.value = value;\n\t}\n\n\n\tget size(){\n\t\treturn this.uniforms.size.value;\n\t}\n\t\n\tset size(value){\n\t\tif(this.uniforms.size.value !== value){\n\t\t\tthis.uniforms.size.value = value;\n\t\t\t\n\t\t\tthis.dispatchEvent({\n\t\t\t\ttype: \"point_size_changed\",\n\t\t\t\ttarget: this\n\t\t\t});\n\t\t\tthis.dispatchEvent({\n\t\t\t\ttype: \"material_property_changed\",\n\t\t\t\ttarget: this\n\t\t\t});\n\t\t}\n\t}\n\t\n\tget elevationRange(){\n\t\treturn [this.heightMin, this.heightMax];\n\t}\n\t\n\tset elevationRange(value){\n\t\tthis.heightMin = value[0];\n\t\tthis.heightMax = value[1];\n\t}\n\n\tget heightMin(){\n\t\treturn this.uniforms.heightMin.value;\n\t}\n\t\n\tset heightMin(value){\n\t\tif(this.uniforms.heightMin.value !== value){\n\t\t\tthis.uniforms.heightMin.value = value;\n\t\t\t\n\t\t\tthis._defaultElevationRangeChanged = true;\n\t\t\t\n\t\t\tthis.dispatchEvent({\n\t\t\t\ttype: \"material_property_changed\",\n\t\t\t\ttarget: this\n\t\t\t});\n\t\t}\n\t}\n\n\n\tget heightMax(){\n\t\treturn this.uniforms.heightMax.value;\n\t}\n\t\n\tset heightMax(value){\n\t\tif(this.uniforms.heightMax.value !== value){\n\t\t\tthis.uniforms.heightMax.value = value;\n\t\t\t\n\t\t\tthis._defaultElevationRangeChanged = true;\n\t\t\t\n\t\t\tthis.dispatchEvent({\n\t\t\t\ttype: \"material_property_changed\",\n\t\t\t\ttarget: this\n\t\t\t});\n\t\t}\n\t}\n\n\n\tget transition(){\n\t\treturn this.uniforms.transition.value;\n\t}\n\t\n\tset transition(value){\n\t\tthis.uniforms.transition.value = value;\n\t}\n\n\n\tget intensityRange(){\n\t\treturn this.uniforms.intensityRange.value;\n\t}\n\t\n\tset intensityRange(value){\n\t\t\n\t\tif(!(value instanceof Array && value.length === 2)){\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tif(value[0] === this.uniforms.intensityRange.value[0] &&\n\t\t\tvalue[1] === this.uniforms.intensityRange.value[1]){\n\t\t\t\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tthis.uniforms.intensityRange.value = value;\n\t\t\n\t\tthis._defaultIntensityRangeChanged = true;\n\t\t\n\t\tthis.dispatchEvent({\n\t\t\ttype: \"material_property_changed\",\n\t\t\ttarget: this\n\t\t});\n\t}\n\n\n\tget intensityGamma(){\n\t\treturn this.uniforms.intensityGamma.value;\n\t}\n\t\n\tset intensityGamma(value){\n\t\tif(this.uniforms.intensityGamma.value !== value){\n\t\t\tthis.uniforms.intensityGamma.value = value;\n\t\t\tthis.dispatchEvent({\n\t\t\t\ttype: \"material_property_changed\",\n\t\t\t\ttarget: this\n\t\t\t});\n\t\t}\n\t}\n\n\n\tget intensityContrast(){\n\t\treturn this.uniforms.intensityContrast.value;\n\t}\n\t\n\tset intensityContrast(value){\n\t\tif(this.uniforms.intensityContrast.value !== value){\n\t\t\tthis.uniforms.intensityContrast.value = value;\n\t\t\tthis.dispatchEvent({\n\t\t\t\ttype: \"material_property_changed\",\n\t\t\t\ttarget: this\n\t\t\t});\n\t\t}\n\t}\n\n\n\tget intensityBrightness(){\n\t\treturn this.uniforms.intensityBrightness.value;\n\t}\n\t\n\tset intensityBrightness(value){\n\t\tif(this.uniforms.intensityBrightness.value !== value){\n\t\t\tthis.uniforms.intensityBrightness.value = value;\n\t\t\tthis.dispatchEvent({\n\t\t\t\ttype: \"material_property_changed\",\n\t\t\t\ttarget: this\n\t\t\t});\n\t\t}\n\t}\n\n\n\tget rgbGamma(){\n\t\treturn this.uniforms.rgbGamma.value;\n\t}\n\t\n\tset rgbGamma(value){\n\t\tif(this.uniforms.rgbGamma.value !== value){\n\t\t\tthis.uniforms.rgbGamma.value = value;\n\t\t\tthis.dispatchEvent({\n\t\t\t\ttype: \"material_property_changed\",\n\t\t\t\ttarget: this\n\t\t\t});\n\t\t}\n\t}\n\n\n\tget rgbContrast(){\n\t\treturn this.uniforms.rgbContrast.value;\n\t}\n\t\n\tset rgbContrast(value){\n\t\tif(this.uniforms.rgbContrast.value !== value){\n\t\t\tthis.uniforms.rgbContrast.value = value;\n\t\t\tthis.dispatchEvent({\n\t\t\t\ttype: \"material_property_changed\",\n\t\t\t\ttarget: this\n\t\t\t});\n\t\t}\n\t}\n\n\n\tget rgbBrightness(){\n\t\treturn this.uniforms.rgbBrightness.value;\n\t}\n\t\n\tset rgbBrightness(value){\n\t\tif(this.uniforms.rgbBrightness.value !== value){\n\t\t\tthis.uniforms.rgbBrightness.value = value;\n\t\t\tthis.dispatchEvent({\n\t\t\t\ttype: \"material_property_changed\",\n\t\t\t\ttarget: this\n\t\t\t});\n\t\t}\n\t}\n\n\n\tget weightRGB(){\n\t\treturn this.uniforms.wRGB.value;\n\t}\n\t\n\tset weightRGB(value){\n\t\tthis.uniforms.wRGB.value = value;\n\t}\n\n\n\tget weightIntensity(){\n\t\treturn this.uniforms.wIntensity.value;\n\t}\n\t\n\tset weightIntensity(value){\n\t\tthis.uniforms.wIntensity.value = value;\n\t}\n\n\n\tget weightElevation(){\n\t\treturn this.uniforms.wElevation.value;\n\t}\n\t\n\tset weightElevation(value){\n\t\tthis.uniforms.wElevation.value = value;\n\t}\n\n\n\tget weightClassification(){\n\t\treturn this.uniforms.wClassification.value;\n\t}\n\t\n\tset weightClassification(value){\n\t\tthis.uniforms.wClassification.value = value;\n\t}\n\n\n\tget weightReturnNumber(){\n\t\treturn this.uniforms.wReturnNumber.value;\n\t}\n\t\n\tset weightReturnNumber(value){\n\t\tthis.uniforms.wReturnNumber.value = value;\n\t}\n\n\n\tget weightSourceID(){\n\t\treturn this.uniforms.wSourceID.value;\n\t}\n\t\n\tset weightSourceID(value){\n\t\tthis.uniforms.wSourceID.value = value;\n\t}\n\n\n\n\tstatic generateGradientTexture(gradient){\n\t\tlet size = 64;\n\n\t\t// create canvas\n\t\tlet canvas = document.createElement( 'canvas' );\n\t\tcanvas.width = size;\n\t\tcanvas.height = size;\n\n\t\t// get context\n\t\tlet context = canvas.getContext( '2d' );\n\n\t\t// draw gradient\n\t\tcontext.rect( 0, 0, size, size );\n\t\tlet ctxGradient = context.createLinearGradient( 0, 0, size, size );\n\t\t\n\t\tfor(let i = 0;i < gradient.length; i++){\n\t\t\tlet step = gradient[i];\n\t\t\t\n\t\t\tctxGradient.addColorStop(step[0], \"#\" + step[1].getHexString());\n\t\t} \n\t\t\n\t\tcontext.fillStyle = ctxGradient;\n\t\tcontext.fill();\n\t\t\n\t\tlet texture = new THREE.Texture( canvas );\n\t\ttexture.needsUpdate = true;\n\t\t//textureImage = texture.image;\n\n\t\treturn texture;\n\t}\n\t\n\tstatic generateClassificationTexture(classification){\n\t\tlet width = 256;\n\t\tlet height = 256;\n\t\tlet size = width*height;\n\t\t\n\t\tlet data = new Uint8Array(4*size);\n\t\t\n\t\tfor(let x = 0; x < width; x++){\n\t\t\tfor(let y = 0; y < height; y++){\n\t\t\t\t\n\t\t\t\tlet i = x + width*y;\n\t\t\t\t\n\t\t\t\tlet color;\n\t\t\t\tif(classification[x]){\n\t\t\t\t\tcolor = classification[x];\n\t\t\t\t}else if(classification[x % 32]){\n\t\t\t\t\tcolor = classification[x % 32];\n\t\t\t\t}else{\n\t\t\t\t\tcolor = classification.DEFAULT;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tdata[4*i+0] = 255 * color.x;\n\t\t\t\tdata[4*i+1] = 255 * color.y;\n\t\t\t\tdata[4*i+2] = 255 * color.z;\n\t\t\t\tdata[4*i+3] = 255 * color.w;\n\t\t\t}\n\t\t}\n\t\t\n\t\tlet texture = new THREE.DataTexture(data, width, height, THREE.RGBAFormat);\n\t\ttexture.magFilter = THREE.NearestFilter;\n\t\ttexture.needsUpdate = true;\n\t\t\n\t\treturn texture;\n\t}\n};\n\n\n//\n// Algorithm by Christian Boucheny\n// shader code taken and adapted from CloudCompare\n//\n// see\n// https://github.com/cloudcompare/trunk/tree/master/plugins/qEDL/shaders/EDL\n// http://www.kitware.com/source/home/post/9\n// https://tel.archives-ouvertes.fr/tel-00438464/document p. 115+ (french)\n\n\n\n\nPotree.EyeDomeLightingMaterial = function(parameters){\n\tTHREE.Material.call( this );\n\n\tparameters = parameters || {};\n\t\n\tthis._neighbourCount = 4;\n\tthis.neighbours = new Float32Array(this.neighbourCount*2);\n\tfor(var c = 0; c < this.neighbourCount; c++){\n\t\tthis.neighbours[2*c+0] = Math.cos(2 * c * Math.PI / this.neighbourCount);\n\t\tthis.neighbours[2*c+1] = Math.sin(2 * c * Math.PI / this.neighbourCount);\n\t}\n\t\n\t//var lightDir = new THREE.Vector3(0.0, 0.0, 1.0).normalize();\n\t\n\tvar uniforms = {\n\t\tscreenWidth: \t{ type: \"f\", \tvalue: 0 },\n\t\tscreenHeight: \t{ type: \"f\", \tvalue: 0 },\n\t\tedlStrength: \t\t{ type: \"f\", \tvalue: 1.0 },\n\t\tradius: \t\t{ type: \"f\", \tvalue: 1.0 },\n\t\tneighbours:\t\t{ type: \"2fv\", \tvalue: this.neighbours },\n\t\tdepthMap: \t\t{ type: \"t\", \tvalue: null },\n\t\tcolorMap: \t\t{ type: \"t\", \tvalue: null },\n\t\topacity:\t\t{ type: \"f\",\tvalue: 1.0}\n\t};\n\t\n\tthis.setValues({\n\t\tuniforms: uniforms,\n\t\tvertexShader: this.getDefines() + Potree.Shaders[\"edl.vs\"],\n\t\tfragmentShader: this.getDefines() + Potree.Shaders[\"edl.fs\"],\n\t\tlights: false\n\t});\n\t\n};\n\n\nPotree.EyeDomeLightingMaterial.prototype = new THREE.ShaderMaterial();\n\n\nPotree.EyeDomeLightingMaterial.prototype.getDefines = function(){\n\tvar defines = \"\";\n\t\n\tdefines += \"#define NEIGHBOUR_COUNT \" + this.neighbourCount + \"\\n\";\n\n\treturn defines;\n};\n\nPotree.EyeDomeLightingMaterial.prototype.updateShaderSource = function(){\n\tvar attributes = {};\n\t\n\tlet PC = Potree.PointColorType;\n\t\n\tif([PC.INTENSITY, PC.INTENSITY_GRADIENT].includes(this.pointColorType)){\n\t\tattributes.intensity = { type: \"f\", value: [] };\n\t}else if(this.pointColorType === PC.CLASSIFICATION){\n\t\t//attributes.classification = { type: \"f\", value: [] };\n\t}else if(this.pointColorType === PC.RETURN_NUMBER){\n\t\tattributes.returnNumber = { type: \"f\", value: [] };\n\t\tattributes.numberOfReturns = { type: \"f\", value: [] };\n\t}else if(this.pointColorType === PC.SOURCE){\n\t\tattributes.pointSourceID = { type: \"f\", value: [] };\n\t}else if(this.pointColorType === PC.NORMAL || this.pointColorType === Potree.PointColorType.PHONG){\n\t\tattributes.normal = { type: \"f\", value: [] };\n\t}\n\tattributes.classification = { type: \"f\", value: 0 };\n\t\n\tvar vs = this.getDefines() + Potree.Shaders[\"edl.vs\"];\n\tvar fs = this.getDefines() + Potree.Shaders[\"edl.fs\"];\n\n\tthis.setValues({\n\t\tvertexShader: vs,\n\t\tfragmentShader: fs\n\t});\n\t\n\tthis.uniforms.neighbours.value = this.neighbours;\n\t\t\n\tthis.needsUpdate = true;\n};\n\nObject.defineProperty(Potree.EyeDomeLightingMaterial.prototype, \"neighbourCount\", {\n\tget: function(){\n\t\treturn this._neighbourCount;\n\t},\n\tset: function(value){\n\t\tif(this._neighbourCount !== value){\n\t\t\tthis._neighbourCount = value;\n\t\t\tthis.neighbours = new Float32Array(this._neighbourCount*2);\n\t\t\tfor(var c = 0; c < this._neighbourCount; c++){\n\t\t\t\tthis.neighbours[2*c+0] = Math.cos(2 * c * Math.PI / this._neighbourCount);\n\t\t\t\tthis.neighbours[2*c+1] = Math.sin(2 * c * Math.PI / this._neighbourCount);\n\t\t\t}\n\t\t\t\n\t\t\tthis.updateShaderSource();\n\t\t}\n\t}\n});\n\n\n\n\n\n\n\n\n\n\n// see http://john-chapman-graphics.blogspot.co.at/2013/01/ssao-tutorial.html\n\n\n\nPotree.BlurMaterial = function(parameters){\n\tTHREE.Material.call( this );\n\n\tparameters = parameters || {};\n\t\n\tvar uniforms = {\n\t\tnear: \t\t\t{ type: \"f\", value: 0 },\n\t\tfar: \t\t\t{ type: \"f\", value: 0 },\n\t\tscreenWidth: \t{ type: \"f\", value: 0 },\n\t\tscreenHeight: \t{ type: \"f\", value: 0 },\n\t\tmap: \t\t\t{ type: \"t\", value: null }\n\t};\n\t\n\tthis.setValues({\n\t\tuniforms: uniforms,\n\t\tvertexShader: Potree.Shaders[\"blur.vs\"],\n\t\tfragmentShader: Potree.Shaders[\"blur.fs\"],\n\t});\n\t\n};\n\n\nPotree.BlurMaterial.prototype = new THREE.ShaderMaterial();\n\n\n\n\n\n\n\n\n\n\n/**\n * @author mschuetz / http://mschuetz.at\n *\n *\n */ \nPotree.InputHandler = class InputHandler extends THREE.EventDispatcher{\n\t\n\tconstructor(viewer){\n\t\tsuper();\n\t\t\n\t\tthis.viewer = viewer;\n\t\tthis.renderer = viewer.renderer;\n\t\tthis.domElement = this.renderer.domElement;\n\t\t\n\t\tthis.scene = null;\n\t\tthis.interactiveScenes = [];\n\t\tthis.inputListeners = [];\n\t\t\n\t\tthis.drag = null;\n\t\tthis.mouse = new THREE.Vector2(0, 0);\n\t\t\n\t\tthis.selection = [];\n\t\t\n\t\tthis.hoveredElements = [];\n\t\tthis.pressedKeys = {};\n\t\t\n\t\tthis.wheelDelta = 0;\n\t\t\n\t\tthis.speed = 1;\n\t\t\n\t\tthis.logMessages = false;\n\t\t\n\t\tif(this.domElement.tabIndex === -1){\n\t\t\tthis.domElement.tabIndex = 2222;\n\t\t}\n\t\t\n\t\tthis.domElement.addEventListener(\"contextmenu\", (event) => { event.preventDefault(); }, false );\n\t\tthis.domElement.addEventListener(\"click\", this.onMouseClick.bind(this), false);\n\t\tthis.domElement.addEventListener(\"mousedown\", this.onMouseDown.bind(this), false);\n\t\tthis.domElement.addEventListener(\"mouseup\", this.onMouseUp.bind(this), false);\n\t\tthis.domElement.addEventListener(\"mousemove\", this.onMouseMove.bind(this), false);\n\t\tthis.domElement.addEventListener(\"mousewheel\", this.onMouseWheel.bind(this), false );\n\t\tthis.domElement.addEventListener(\"DOMMouseScroll\", this.onMouseWheel.bind(this), false ); // Firefox\n\t\tthis.domElement.addEventListener(\"dblclick\", this.onDoubleClick.bind(this));\n\t\tthis.domElement.addEventListener(\"keydown\", this.onKeyDown.bind(this));\n\t\tthis.domElement.addEventListener(\"keyup\", this.onKeyUp.bind(this));\n\t\tthis.domElement.addEventListener(\"touchstart\", this.onTouchStart.bind(this));\n\t\tthis.domElement.addEventListener(\"touchend\", this.onTouchEnd.bind(this));\n\t\tthis.domElement.addEventListener(\"touchmove\", this.onTouchMove.bind(this));\n\t}\n\t\n\taddInputListener(listener){\n\t\tthis.inputListeners.push(listener);\n\t}\n\t\n\tremoveInputListener(listener){\n\t\tthis.inputListeners = this.inputListeners.filter(e => e !== listener);\n\t}\n\t\n\tonTouchStart(e){\n\t\tif(this.logMessages) console.log(this.constructor.name + \": onTouchStart\");\n\t\t\n\t\te.preventDefault();\n\n\t\tif(e.touches.length === 1){\n\t\t\tlet rect = this.domElement.getBoundingClientRect();\n\t\t\tlet x = e.touches[0].pageX - rect.left;\n\t\t\tlet y = e.touches[0].pageY - rect.top;\n\t\t\tthis.mouse.set(x, y);\n\t\t\t\n\t\t\tthis.startDragging(null);\n\t\t}\n\t\t\n\t\tfor(let inputListener of this.inputListeners){\n\t\t\tinputListener.dispatchEvent({\n\t\t\t\ttype: e.type,\n\t\t\t\ttouches: e.touches,\n\t\t\t\tchangedTouches: e.changedTouches\n\t\t\t});\n\t\t}\n\t}\n\t\n\tonTouchEnd(e){\n\t\tif(this.logMessages) console.log(this.constructor.name + \": onTouchEnd\");\n\t\t\n\t\te.preventDefault();\n\t\t\n\t\tfor(let inputListener of this.inputListeners){\n\t\t\tinputListener.dispatchEvent({\n\t\t\t\ttype: \"drop\",\n\t\t\t\tdrag: this.drag,\n\t\t\t\tviewer: this.viewer\n\t\t\t});\n\t\t}\n\t\t\n\t\tthis.drag = null;\n\t\t\n\t\tfor(let inputListener of this.inputListeners){\n\t\t\tinputListener.dispatchEvent({\n\t\t\t\ttype: e.type,\n\t\t\t\ttouches: e.touches,\n\t\t\t\tchangedTouches: e.changedTouches\n\t\t\t});\n\t\t}\n\t}\n\t\n\tonTouchMove(e){\n\t\tif(this.logMessages) console.log(this.constructor.name + \": onTouchMove\");\n\t\t\n\t\te.preventDefault();\n\t\t\n\t\tif(e.touches.length === 1){\n\t\t\tlet rect = this.domElement.getBoundingClientRect();\n\t\t\tlet x = e.touches[0].pageX - rect.left;\n\t\t\tlet y = e.touches[0].pageY - rect.top;\n\t\t\tthis.mouse.set(x, y);\n\t\t\t\n\t\t\tif(this.drag){\n\t\t\t\tthis.drag.mouse = 1;\n\t\t\t\t\n\t\t\t\tthis.drag.lastDrag.x = x - this.drag.end.x;\n\t\t\t\tthis.drag.lastDrag.y = y - this.drag.end.y;\n\t\t\t\t\n\t\t\t\tthis.drag.end.set(x, y);\n\t\t\t\t\n\t\t\t\tif(this.logMessages) console.log(this.constructor.name + \": drag: \");\n\t\t\t\tfor(let inputListener of this.inputListeners){\n\t\t\t\t\tinputListener.dispatchEvent({\n\t\t\t\t\t\ttype: \"drag\",\n\t\t\t\t\t\tdrag: this.drag,\n\t\t\t\t\t\tviewer: this.viewer\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tfor(let inputListener of this.inputListeners){\n\t\t\tinputListener.dispatchEvent({\n\t\t\t\ttype: e.type,\n\t\t\t\ttouches: e.touches,\n\t\t\t\tchangedTouches: e.changedTouches\n\t\t\t});\n\t\t}\n\t\t\n\t\t// DEBUG CODE\n\t\t//let debugTouches = [...e.touches, {\n\t\t//\tpageX: this.domElement.clientWidth / 2, \n\t\t//\tpageY: this.domElement.clientHeight / 2}];\n\t\t//for(let inputListener of this.inputListeners){\n\t\t//\tinputListener.dispatchEvent({\n\t\t//\t\ttype: e.type,\n\t\t//\t\ttouches: debugTouches,\n\t\t//\t\tchangedTouches: e.changedTouches\n\t\t//\t});\n\t\t//}\n\t}\n\t\n\tonKeyDown(e){\n\t\tif(this.logMessages) console.log(this.constructor.name + \": onKeyDown\");\n\t\t\n\t\tif(e.keyCode === 46 && this.selection.length > 0){\n\t\t\t// DELETE\n\t\t\tthis.dispatchEvent({\n\t\t\t\ttype: \"delete\",\n\t\t\t\tselection: this.selection\n\t\t\t});\n\t\t\t\n\t\t\tthis.deselectAll();\n\t\t}\n\t\t\n\t\tthis.dispatchEvent({\n\t\t\ttype: \"keydown\",\n\t\t\tkeyCode: e.keyCode,\n\t\t\tevent: e\n\t\t});\n\t\t\n\t\t//for(let l of this.inputListeners){\n\t\t//\tl.dispatchEvent({\n\t\t//\t\ttype: \"keydown\",\n\t\t//\t\tkeyCode: e.keyCode,\n\t\t//\t\tevent: e\n\t\t//\t});\n\t\t//}\n\t\t\n\t\tthis.pressedKeys[e.keyCode] = true;\n\t\t\n\t\t//e.preventDefault();\n\t}\n\t\n\tonKeyUp(e){\n\t\tif(this.logMessages) console.log(this.constructor.name + \": onKeyUp\");\n\t\t\n\t\tdelete this.pressedKeys[e.keyCode];\n\t\t\n\t\te.preventDefault();\n\t}\n\t\n\tonDoubleClick(e){\n\t\tif(this.logMessages) console.log(this.constructor.name + \": onDoubleClick\");\n\t\t\n\t\t\n\t\tlet consumed = false;\n\t\tfor(let hovered of this.hoveredElements){\n\t\t\tif(hovered._listeners && hovered._listeners[\"dblclick\"]){\n\t\t\t\thovered.object.dispatchEvent({\n\t\t\t\t\ttype: \"dblclick\",\n\t\t\t\t\tmouse: this.mouse,\n\t\t\t\t\tobject: hovered.object\n\t\t\t\t});\n\t\t\t\tconsumed = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\t\n\t\tif(!consumed){\n\t\t\tfor(let inputListener of this.inputListeners){\n\t\t\t\tinputListener.dispatchEvent({\n\t\t\t\t\ttype: \"dblclick\",\n\t\t\t\t\tmouse: this.mouse,\n\t\t\t\t\tobject: null\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\t\n\t\te.preventDefault();\n\t}\n\t\n\tonMouseClick(e){\n\t\tif(this.logMessages) console.log(this.constructor.name + \": onMouseClick\");\n\t\t\n\t\te.preventDefault();\n\t}\n\t\n\tonMouseDown(e){\n\t\tif(this.logMessages) console.log(this.constructor.name + \": onMouseDown\");\n\t\t\n\t\te.preventDefault();\n\t\t\n\t\tif(this.hoveredElements.length === 0){\n\t\t\tfor(let inputListener of this.inputListeners){\n\t\t\t\tinputListener.dispatchEvent({\n\t\t\t\t\ttype: \"mousedown\",\n\t\t\t\t\tviewer: this.viewer,\n\t\t\t\t\tmouse: this.mouse\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\t\n\t\tif(!this.drag){\n\t\t\tlet target = this.hoveredElements\n\t\t\t\t.find(el => (\n\t\t\t\t\tel.object._listeners \n\t\t\t\t\t&& el.object._listeners[\"drag\"]\n\t\t\t\t\t&& el.object._listeners[\"drag\"].length > 0));\n\t\t\t\n\t\t\tif(target){\n\t\t\t\tthis.startDragging(target.object, {location: target.point});\n\t\t\t}else{\n\t\t\t\tthis.startDragging(null);\n\t\t\t}\n\t\t}\n\t\t\n\t\tif(this.scene){\n\t\t\tthis.viewStart = this.scene.view.clone();\n\t\t}\n\t}\n\t\n\tonMouseUp(e){\n\t\tif(this.logMessages) console.log(this.constructor.name + \": onMouseUp\");\n\t\t\n\t\te.preventDefault();\n\t\t\n\t\tlet noMovement = this.getNormalizedDrag().length() === 0; \n\t\t\n\t\tif(e.button === THREE.MOUSE.LEFT){\n\t\t\tif(noMovement){\n\t\t\t\t\n\t\t\t\tlet selectable = this.hoveredElements\n\t\t\t\t\t.find(el => el.object._listeners && el.object._listeners[\"select\"]);\n\t\t\t\t\n\t\t\t\tif(selectable){\n\t\t\t\t\tselectable = selectable.object;\n\t\t\t\t\t\n\t\t\t\t\tif(this.isSelected(selectable)){\n\t\t\t\t\t\tthis.selection\n\t\t\t\t\t\t\t.filter(e => e !== selectable)\n\t\t\t\t\t\t\t.forEach(e => this.toggleSelection(e));\n\t\t\t\t\t}else{\n\t\t\t\t\t\tthis.deselectAll();\n\t\t\t\t\t\tthis.toggleSelection(selectable);\n\t\t\t\t\t}\n\t\t\t\t}else{\n\t\t\t\t\tthis.deselectAll();\n\t\t\t\t}\n\t\t\t}\n\t\t}else if((e.button === THREE.MOUSE.RIGHT) && noMovement){\n\t\t\tthis.deselectAll();\n\t\t}\n\t\t\n\t\tif(this.hoveredElements.length === 0){\n\t\t\tfor(let inputListener of this.inputListeners){\n\t\t\t\tinputListener.dispatchEvent({\n\t\t\t\t\ttype: \"mouseup\",\n\t\t\t\t\tviewer: this.viewer,\n\t\t\t\t\tmouse: this.mouse\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\t\n\t\tif(this.drag){\n\t\t\tif(this.drag.object){\n\t\t\t\tthis.drag.object.dispatchEvent({\n\t\t\t\t\ttype: \"drop\",\n\t\t\t\t\tdrag: this.drag,\n\t\t\t\t\tviewer: this.viewer\n\t\t\t\t\t\t\n\t\t\t\t});\n\t\t\t}else{\n\t\t\t\tif(this.logMessages) console.log(this.constructor.name + \": drop: \");\n\t\t\t\tfor(let inputListener of this.inputListeners){\n\t\t\t\t\tinputListener.dispatchEvent({\n\t\t\t\t\t\ttype: \"drop\",\n\t\t\t\t\t\tdrag: this.drag,\n\t\t\t\t\t\tviewer: this.viewer\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tthis.drag = null;\n\t\t}\n\t }\n\t \n\tonMouseMove(e){\n\t\tif(this.logMessages) console.log(this.constructor.name + \": onMouseMove\");\n\t\t\n\t\te.preventDefault();\n\t\t\n\t\tlet rect = this.domElement.getBoundingClientRect();\n\t\tlet x = e.clientX - rect.left;\n\t\tlet y = e.clientY - rect.top;\n\t\tthis.mouse.set(x, y);\n\t\t\n\t\tif(this.drag){\n\t\t\tthis.drag.mouse = e.buttons;\n\t\t\t\n\t\t\tthis.drag.lastDrag.x = x - this.drag.end.x;\n\t\t\tthis.drag.lastDrag.y = y - this.drag.end.y;\n\t\t\t\n\t\t\tthis.drag.end.set(x, y);\n\t\t\t\n\t\t\tif(this.drag.object){\n\t\t\t\tif(this.logMessages) console.log(this.constructor.name + \": drag: \" + this.drag.object.name);\n\t\t\t\tthis.drag.object.dispatchEvent({\n\t\t\t\t\ttype: \"drag\",\n\t\t\t\t\tdrag: this.drag,\n\t\t\t\t\tviewer: this.viewer\n\t\t\t\t});\n\t\t\t}else{\n\t\t\t\tif(this.logMessages) console.log(this.constructor.name + \": drag: \");\n\t\t\t\tfor(let inputListener of this.inputListeners){\n\t\t\t\t\tinputListener.dispatchEvent({\n\t\t\t\t\t\ttype: \"drag\",\n\t\t\t\t\t\tdrag: this.drag,\n\t\t\t\t\t\tviewer: this.viewer\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tlet hoveredElements = this.getHoveredElements();\n\t\tlet currentlyHoveredObjects = hoveredElements.map(e => e.object);\n\t\tlet previouslyHoveredObjects = this.hoveredElements.map(e => e.object);\n\t\t\n\t\tlet now = currentlyHoveredObjects.find(e => (e._listeners && e._listeners[\"mouseover\"]));\n\t\tlet prev = previouslyHoveredObjects.find(e => (e._listeners && e._listeners[\"mouseover\"]));\n\t\t\n\t\tif(now !== prev){\n\t\t\tif(now){\n\t\t\t\tnow.dispatchEvent({\n\t\t\t\t\ttype: \"mouseover\",\n\t\t\t\t\tobject: now\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\tif(prev){\n\t\t\t\tprev.dispatchEvent({\n\t\t\t\t\ttype: \"mouseleave\",\n\t\t\t\t\tobject: prev\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\t\n\t\t//let justHovered = currentlyHoveredObjects\n\t\t//\t.filter(e => previouslyHoveredObjects.indexOf(e) === -1);\n\t\t//let justUnhovered = previouslyHoveredObjects\n\t\t//\t.filter(e => currentlyHoveredObjects.indexOf(e) === -1);\n\t\t//\t\n\t\t//justHovered = justHovered.find(e => (e._listeners && e._listeners[\"mouseover\"]));\n\t\t//justUnhovered = justUnhovered.find(e => (e._listeners && e._listeners[\"mouseover\"]));\n\t\t\n\t\t\n\t\t\n\t\t//let over = justHovered.find(e => (e._listeners && e._listeners[\"mouseover\"]));\n\t\t//if(over){\n\t\t//\tover.dispatchEvent({\n\t\t//\t\ttype: \"mouseover\",\n\t\t//\t\tobject: over\n\t\t//\t});\n\t\t//}\n\t\t//\n\t\t//let leave = justUnhovered.find(e => (e._listeners && e._listeners[\"mouseleave\"]));\n\t\t//if(leave){\n\t\t//\tleave.dispatchEvent({\n\t\t//\t\ttype: \"mouseleave\",\n\t\t//\t\tobject: leave\n\t\t//\t});\n\t\t//}\n\t\n\t\tthis.hoveredElements = hoveredElements;\n\t}\n\t\n\tonMouseWheel(e){\n\t\tif(this.logMessages) console.log(this.constructor.name + \": onMouseWheel\");\n\t\t\n\t\te.preventDefault();\n\t\t\n\t\tlet delta = 0;\n\t\tif( e.wheelDelta !== undefined ) { // WebKit / Opera / Explorer 9\n\t\t\tdelta = e.wheelDelta;\n\t\t} else if ( e.detail !== undefined ) { // Firefox\n\t\t\tdelta = -e.detail;\n\t\t}\n\t\t\n\t\tlet ndelta = Math.sign(delta);\n\t\t\n\t\t//this.wheelDelta += Math.sign(delta);\n\t\t\n\t\tif(this.hoveredElement){\n\t\t\tthis.hoveredElement.object.dispatchEvent({\n\t\t\t\ttype: \"mousewheel\",\n\t\t\t\tdelta: ndelta,\n\t\t\t\tobject: this.hoveredElement.object\n\t\t\t});\n\t\t}else{\n\t\t\tfor(let inputListener of this.inputListeners){\n\t\t\t\tinputListener.dispatchEvent({\n\t\t\t\t\ttype: \"mousewheel\",\n\t\t\t\t\tdelta: ndelta,\n\t\t\t\t\tobject: null\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\t\n\tstartDragging(object, args = null){\n\t\tthis.drag = {\n\t\t\tstart: this.mouse.clone(),\n\t\t\tend: this.mouse.clone(),\n\t\t\tlastDrag: new THREE.Vector2(0, 0),\n\t\t\tstartView: this.scene.view.clone(),\n\t\t\tobject: object\n\t\t};\n\t\t\n\t\tif(args){\n\t\t\tfor(let key of Object.keys(args)){\n\t\t\t\tthis.drag[key] = args[key];\n\t\t\t}\n\t\t}\n\t}\n\t\n\tgetMousePointCloudIntersection(mouse){\n\t\treturn Potree.utils.getMousePointCloudIntersection(\n\t\t\tthis.mouse, \n\t\t\tthis.scene.camera, \n\t\t\tthis.renderer, \n\t\t\tthis.scene.pointclouds);\n\t}\n\t\n\ttoggleSelection(object){\n\t\t\n\t\tlet oldSelection = this.selection;\n\t\t\n\t\tlet index = this.selection.indexOf(object);\n\t\t\n\t\tif(index === -1){\n\t\t\tthis.selection.push(object);\n\t\t\tobject.dispatchEvent({\n\t\t\t\ttype: \"select\"\n\t\t\t});\n\t\t}else{\n\t\t\tthis.selection.splice(index, 1);\n\t\t\tobject.dispatchEvent({\n\t\t\t\ttype: \"deselect\"\n\t\t\t});\n\t\t}\n\t\t\n\t\tthis.dispatchEvent({\n\t\t\ttype: \"selection_changed\",\n\t\t\toldSelection: oldSelection,\n\t\t\tselection: this.selection\n\t\t});\n\t}\n\t\n\tdeselectAll(){\n\t\tfor(let object of this.selection){\n\t\t\tobject.dispatchEvent({\n\t\t\t\ttype: \"deselect\"\n\t\t\t});\n\t\t}\n\t\t\n\t\tlet oldSelection = this.selection;\n\t\t\n\t\tif(this.selection.length > 0){\n\t\t\tthis.selection = [];\n\t\t\tthis.dispatchEvent({\n\t\t\t\ttype: \"selection_changed\",\n\t\t\t\toldSelection: oldSelection,\n\t\t\t\tselection: this.selection\n\t\t\t});\n\t\t}\n\t\t\n\t\t\n\t}\n\t\n\tisSelected(object){\n\t\tlet index = this.selection.indexOf(object);\n\t\t\n\t\treturn index !== -1;\n\t}\n\t\n\tregisterInteractiveScene(scene){\n\t\tlet index = this.interactiveScenes.indexOf(scene);\n\t\tif(index === -1){\n\t\t\tthis.interactiveScenes.push(scene);\n\t\t}\n\t}\n\t\n\tunregisterInteractiveScene(scene){\n\t\tlet index = this.interactiveScenes.indexOf(scene);\n\t\tif (index > -1) {\n\t\t\tthis.interactiveScenes.splice(index, 1);\n\t\t}\n\t}\n\t\n\tgetHoveredElement(){\n\t\tlet hoveredElements = this.getHoveredElements();\n\t\tif(hoveredElements.length > 0){\n\t\t\treturn hoveredElements[0];\n\t\t}else{\n\t\t\treturn null;\n\t\t}\n\t}\n\t\n\tgetHoveredElements(){\n\t\t\n\t\tlet scenes = this.interactiveScenes.concat(this.scene.scene);\n\t\n\t\tlet interactableListeners = [\"mouseover\", \"mouseleave\", \"drag\", \"drop\", \"click\", \"select\", \"deselect\"];\n\t\tlet interactables = [];\n\t\tfor(let scene of scenes){\n\t\t\tscene.traverseVisible(node => {\n\t\t\t\tif(node._listeners && node.visible){\n\t\t\t\t\tlet hasInteractableListener = interactableListeners.filter((e) => {\n\t\t\t\t\t\treturn node._listeners[e] !== undefined\n\t\t\t\t\t}).length > 0;\n\t\t\t\t\t\n\t\t\t\t\tif(hasInteractableListener){\n\t\t\t\t\t\tinteractables.push(node);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t\n\t\tlet nmouse =  {\n\t\t\tx: (this.mouse.x / this.domElement.clientWidth ) * 2 - 1,\n\t\t\ty: - (this.mouse.y / this.domElement.clientHeight ) * 2 + 1\n\t\t};\n\t\t\n\t\tlet vector = new THREE.Vector3( nmouse.x, nmouse.y, 0.5 );\n\t\tvector.unproject(this.scene.camera);\n\t\t\n\t\tlet raycaster = new THREE.Raycaster();\n\t\traycaster.ray.set( this.scene.camera.position, vector.sub( this.scene.camera.position ).normalize() );\n\t\traycaster.linePrecision = 0.2;\n\t\t\n\t\tlet intersections = raycaster.intersectObjects(interactables, false);\n\t\t\n\t\treturn intersections;\n\t\t\n\t\t//if(intersections.length > 0){\n\t\t//\treturn intersections[0];\n\t\t//}else{\n\t\t//\treturn null;\n\t\t//}\n\t}\n\t\n\tsetScene(scene){\n\t\tthis.deselectAll();\n\t\t\n\t\tthis.scene = scene;\n\t}\n\t\n\tupdate(delta){\n\t\t\n\t}\n\n\tgetNormalizedDrag(){\n\t\tif(!this.drag){\n\t\t\treturn new THREE.Vector2(0, 0);\n\t\t}\n\t\t\n\t\tlet diff = new THREE.Vector2().subVectors(this.drag.end, this.drag.start);\n\n\t\tdiff.x = diff.x / this.domElement.clientWidth;\n\t\tdiff.y = diff.y / this.domElement.clientHeight;\n\t\t\n\t\treturn diff;\n\t}\n\t\n\tgetNormalizedLastDrag(){\n\t\tif(!this.drag){\n\t\t\treturn new THREE.Vector2(0, 0);\n\t\t}\n\t\t\n\t\tlet lastDrag = this.drag.lastDrag.clone();\n\t\t\n\t\tlastDrag.x = lastDrag.x / this.domElement.clientWidth;\n\t\tlastDrag.y = lastDrag.y / this.domElement.clientHeight;\n\t\t\n\t\treturn lastDrag;\n\t}\n\t\n};\n/**\n * @author mschuetz / http://mschuetz.at\n *\n * adapted from THREE.OrbitControls by \n *\n * @author qiao / https://github.com/qiao\n * @author mrdoob / http://mrdoob.com\n * @author alteredq / http://alteredqualia.com/\n * @author WestLangley / http://github.com/WestLangley\n * @author erich666 / http://erichaines.com\n *\n *\n *\n */\n \nPotree.FirstPersonControls = class FirstPersonControls extends THREE.EventDispatcher{\n\t\n\tconstructor(viewer){\n\t\tsuper();\n\t\t\n\t\tthis.viewer = viewer;\n\t\tthis.renderer = viewer.renderer;\n\t\t\n\t\tthis.scene = null;\n\t\tthis.sceneControls = new THREE.Scene();\n\t\t\n\t\tthis.rotationSpeed = 200;\n\t\tthis.moveSpeed = 10;\n\t\t\n\t\tthis.keys = {\n\t\t\tFORWARD:   ['W'.charCodeAt(0), 38],\n\t\t\tBACKWARD:  ['S'.charCodeAt(0), 40],\n\t\t\tLEFT:      ['A'.charCodeAt(0), 37],\n\t\t\tRIGHT:     ['D'.charCodeAt(0), 39],\n\t\t\tUP:        ['R'.charCodeAt(0), 33],\n\t\t\tDOWN:      ['F'.charCodeAt(0), 34]\n\t\t};\n\t\t\n\t\tthis.fadeFactor = 50;\n\t\tthis.yawDelta = 0;\n\t\tthis.pitchDelta = 0;\n\t\tthis.translationDelta = new THREE.Vector3(0, 0, 0);\n\t\tthis.translationWorldDelta = new THREE.Vector3(0, 0, 0);\n\t\t\n\t\tthis.tweens = [];\n\t\t\n\t\tlet drag = (e) => {\n\t\t\tif(e.drag.object !== null){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tif(e.drag.startHandled === undefined){\n\t\t\t\te.drag.startHandled = true;\n\t\t\t\t\n\t\t\t\tthis.dispatchEvent({type: \"start\"});\n\t\t\t}\n\t\t\t\n\t\t\tlet moveSpeed = this.viewer.getMoveSpeed();\n\t\t\t\n\t\t\tlet ndrag = {\n\t\t\t\tx: e.drag.lastDrag.x / this.renderer.domElement.clientWidth,\n\t\t\t\ty: e.drag.lastDrag.y / this.renderer.domElement.clientHeight\n\t\t\t};\n\t\t\t\n\t\t\tif(e.drag.mouse === Potree.MOUSE.LEFT){\n\t\t\t\tthis.yawDelta += ndrag.x * this.rotationSpeed;\n\t\t\t\tthis.pitchDelta += ndrag.y * this.rotationSpeed;\n\t\t\t}else if(e.drag.mouse === Potree.MOUSE.RIGHT){\n\t\t\t\tthis.translationDelta.x -= ndrag.x * moveSpeed * 100;\n\t\t\t\tthis.translationDelta.z += ndrag.y * moveSpeed * 100;\n\t\t\t}\n\t\t};\n\t\t\n\t\tlet drop = e => {\n\t\t\tthis.dispatchEvent({type: \"end\"});\n\t\t};\n\t\t\n\t\tlet scroll = (e) => {\n\t\t\tlet speed = this.viewer.getMoveSpeed();\n\t\t\t\n\t\t\tif(e.delta < 0){\n\t\t\t\tspeed = speed * 0.9;\n\t\t\t}else if(e.delta > 0){\n\t\t\t\tspeed = speed / 0.9;\n\t\t\t}\n\t\t\t\n\t\t\tspeed = Math.max(speed, 0.1);\n\t\t\t\n\t\t\tthis.viewer.setMoveSpeed(speed);\n\t\t};\n\t\t\n\t\tlet dblclick = (e) => {\n\t\t\tthis.zoomToLocation(e.mouse);\n\t\t};\n\t\t\n\t\tthis.addEventListener(\"drag\", drag);\n\t\tthis.addEventListener(\"drop\", drop);\n\t\tthis.addEventListener(\"mousewheel\", scroll);\n\t\tthis.addEventListener(\"dblclick\", dblclick);\n\t}\n\t\n\tsetScene(scene){\n\t\tthis.scene = scene;\n\t}\n\t\n\tzoomToLocation(mouse){\n\t\tlet camera = this.scene.camera;\n\t\t\n\t\tlet I = Potree.utils.getMousePointCloudIntersection(\n\t\t\tmouse, \n\t\t\tcamera, \n\t\t\tthis.renderer, \n\t\t\tthis.scene.pointclouds);\n\t\t\t\n\t\tif(I === null){\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tlet nmouse =  {\n\t\t\tx: +( mouse.x / this.renderer.domElement.clientWidth )  * 2 - 1,\n\t\t\ty: -( mouse.y / this.renderer.domElement.clientHeight ) * 2 + 1\n\t\t};\n\t\t\n\t\tlet targetRadius = 0;\n\t\t{\n\t\t\tlet minimumJumpDistance = 0.2;\n\t\t\t\n\t\t\tlet vector = new THREE.Vector3( nmouse.x, nmouse.y, 0.5 );\n\t\t\tvector.unproject(camera);\n\t\t\t\n\t\t\tlet direction = vector.sub(camera.position).normalize();\n\t\t\tlet ray = new THREE.Ray(camera.position, direction);\n\t\t\t\n\t\t\tlet nodes = I.pointcloud.nodesOnRay(I.pointcloud.visibleNodes, ray);\n\t\t\tlet lastNode = nodes[nodes.length - 1];\n\t\t\tlet radius = lastNode.getBoundingSphere().radius;\n\t\t\ttargetRadius = Math.min(this.scene.view.radius, radius);\n\t\t\ttargetRadius = Math.max(minimumJumpDistance, targetRadius);\n\t\t}\n\t\t\n\t\tlet d = this.scene.view.direction.multiplyScalar(-1);\n\t\tlet cameraTargetPosition = new THREE.Vector3().addVectors(I.location, d.multiplyScalar(targetRadius));\n\t\tlet controlsTargetPosition = I.location;\n\t\t\n\t\tvar animationDuration = 600;\n\t\tvar easing = TWEEN.Easing.Quartic.Out;\n\t\t\n\t\t{ // animate \n\t\t\n\t\t\tlet value = {x: 0};\n\t\t\tlet tween = new TWEEN.Tween(value).to({x: 1}, animationDuration);\n\t\t\ttween.easing(easing);\n\t\t\tthis.tweens.push(tween);\n\t\t\t\n\t\t\tlet startPos = this.scene.view.position.clone();\n\t\t\tlet targetPos = cameraTargetPosition.clone();\n\t\t\tlet startRadius = this.scene.view.radius;\n\t\t\tlet targetRadius = cameraTargetPosition.distanceTo(I.location);\n\t\t\t\n\t\t\ttween.onUpdate( () => {\n\t\t\t\tlet t = value.x;\n\t\t\t\tthis.scene.view.position.x = (1 - t) * startPos.x + t * targetPos.x;\n\t\t\t\tthis.scene.view.position.y = (1 - t) * startPos.y + t * targetPos.y;\n\t\t\t\tthis.scene.view.position.z = (1 - t) * startPos.z + t * targetPos.z;\n\t\t\t\t\n\t\t\t\tthis.scene.view.radius = (1 - t) * startRadius + t * targetRadius;\n\t\t\t\tthis.viewer.setMoveSpeed(this.scene.view.radius / 2.5);\n\t\t\t});\n\t\t\t\n\t\t\ttween.onComplete( () => {\n\t\t\t\tthis.tweens = this.tweens.filter( e => e !== tween);\n\t\t\t});\n\t\t\t\n\t\t\ttween.start();\n\t\t}\n\n\t}\n\t\n\tupdate(delta){\n\t\tlet view = this.scene.view;\n\t\t\n\t\t{ // cancel move animations on user input\n\t\t\tlet changes = [ this.yawDelta, \n\t\t\t\tthis.pitchDelta, \n\t\t\t\tthis.translationDelta.length(),\n\t\t\t\tthis.translationWorldDelta.length() ];\n\t\t\tlet changeHappens = changes.some( e => Math.abs(e) > 0.001);\n\t\t\tif(changeHappens && this.tweens.length > 0){\n\t\t\t\tthis.tweens.forEach( e => e.stop() );\n\t\t\t\tthis.tweens = [];\n\t\t\t}\t\n\t\t}\n\t\t\n\t\t{ // accelerate while input is given\n\t\t\tlet ih = this.viewer.inputHandler;\n\t\t\t\n\t\t\tlet moveForward = this.keys.FORWARD.some(e => ih.pressedKeys[e]);\n\t\t\tlet moveBackward = this.keys.BACKWARD.some(e => ih.pressedKeys[e]);\n\t\t\tlet moveLeft = this.keys.LEFT.some(e => ih.pressedKeys[e]);\n\t\t\tlet moveRight = this.keys.RIGHT.some(e => ih.pressedKeys[e]);\n\t\t\tlet moveUp = this.keys.UP.some(e => ih.pressedKeys[e]);\n\t\t\tlet moveDown = this.keys.DOWN.some(e => ih.pressedKeys[e]);\n\t\t\t\n\t\t\tif(moveForward && moveBackward){\n\t\t\t\tthis.translationDelta.y = 0;\n\t\t\t}else if(moveForward){\n\t\t\t\tthis.translationDelta.y = this.viewer.getMoveSpeed();\n\t\t\t}else if(moveBackward){\n\t\t\t\tthis.translationDelta.y = -this.viewer.getMoveSpeed();\n\t\t\t}\n\t\t\t\n\t\t\tif(moveLeft && moveRight){\n\t\t\t\tthis.translationDelta.x = 0;\n\t\t\t}else if(moveLeft){\n\t\t\t\tthis.translationDelta.x = -this.viewer.getMoveSpeed();\n\t\t\t}else if(moveRight){\n\t\t\t\tthis.translationDelta.x = this.viewer.getMoveSpeed();\n\t\t\t}\n\t\t\t\n\t\t\tif(moveUp && moveDown){\n\t\t\t\tthis.translationWorldDelta.z = 0;\n\t\t\t}else if(moveUp){\n\t\t\t\tthis.translationWorldDelta.z = this.viewer.getMoveSpeed();\n\t\t\t}else if(moveDown){\n\t\t\t\tthis.translationWorldDelta.z = -this.viewer.getMoveSpeed();\n\t\t\t}\n\t\t\t\n\t\t}\n\t\t\n\t\t{ // apply rotation\n\t\t\tlet yaw = view.yaw;\n\t\t\tlet pitch = view.pitch;\n\t\t\t\n\t\t\tyaw -= this.yawDelta * delta;\n\t\t\tpitch -= this.pitchDelta * delta;\n\t\t\t\n\t\t\tview.yaw = yaw;\n\t\t\tview.pitch = pitch;\n\t\t}\n\t\t\n\t\t{ // apply translation\n\t\t\tview.translate(\n\t\t\t\tthis.translationDelta.x * delta,\n\t\t\t\tthis.translationDelta.y * delta,\n\t\t\t\tthis.translationDelta.z * delta\n\t\t\t);\n\t\t\t\n\t\t\tview.translateWorld(\n\t\t\t\tthis.translationWorldDelta.x * delta,\n\t\t\t\tthis.translationWorldDelta.y * delta,\n\t\t\t\tthis.translationWorldDelta.z * delta\n\t\t\t);\n\t\t}\n\t\t\n\t\t{ // set view target according to speed\n\t\t\tview.radius = 3 * this.viewer.getMoveSpeed();\n\t\t}\n\t\t\n\t\t{// decelerate over time\n\t\t\tlet attenuation = Math.max(0, 1 - this.fadeFactor * delta);\n\t\t\tthis.yawDelta *= attenuation;\n\t\t\tthis.pitchDelta *= attenuation;\n\t\t\tthis.translationDelta.multiplyScalar(attenuation);\n\t\t\tthis.translationWorldDelta.multiplyScalar(attenuation);\n\t\t}\n\t\t\n\t}\n\n\t\n\t\n};\n\n\n\n\n\n\n\n/**\n * @author mschuetz / http://mschuetz.at\n *\n * adapted from THREE.OrbitControls by \n *\n * @author qiao / https://github.com/qiao\n * @author mrdoob / http://mrdoob.com\n * @author alteredq / http://alteredqualia.com/\n * @author WestLangley / http://github.com/WestLangley\n * @author erich666 / http://erichaines.com\n *\n * This set of controls performs first person navigation without mouse lock.\n * Instead, rotating the camera is done by dragging with the left mouse button.\n *\n * move: a/s/d/w or up/down/left/right\n * rotate: left mouse\n * pan: right mouse\n * change speed: mouse wheel\n *\n *\n */\n\n\n\nPotree.GeoControls = function ( object, domElement ) {\n\tthis.object = object;\n\tthis.domElement = ( domElement !== undefined ) ? domElement : document;\n\t\n\t// Set to false to disable this control\n\tthis.enabled = true;\n\n\t// Set this to a THREE.SplineCurve3 instance\n\tthis.track = null;\n\t// position on track in intervall [0,1]\n\tthis.trackPos = 0;\n\t\n\tthis.rotateSpeed = 1.0;\n\tthis.moveSpeed = 10.0;\n\n\tthis.keys = { \n\t\tLEFT: 37, \n\t\tUP: 38, \n\t\tRIGHT: 39, \n\t\tBOTTOM: 40,\n\t\tA: 'A'.charCodeAt(0),\n\t\tS: 'S'.charCodeAt(0),\n\t\tD: 'D'.charCodeAt(0),\n\t\tW: 'W'.charCodeAt(0),\n\t\tQ: 'Q'.charCodeAt(0),\n\t\tE: 'E'.charCodeAt(0),\n\t\tR: 'R'.charCodeAt(0),\n\t\tF: 'F'.charCodeAt(0)\n\t};\n\n\tvar scope = this;\n\n\tvar rotateStart = new THREE.Vector2();\n\tvar rotateEnd = new THREE.Vector2();\n\tvar rotateDelta = new THREE.Vector2();\n\n\tvar panStart = new THREE.Vector2();\n\tvar panEnd = new THREE.Vector2();\n\tvar panDelta = new THREE.Vector2();\n\tvar panOffset = new THREE.Vector3();\n\n\tvar offset = new THREE.Vector3();\n\n\tvar phiDelta = 0;\n\tvar thetaDelta = 0;\n\tvar scale = 1;\n\tvar pan = new THREE.Vector3();\n\t\n\tthis.shiftDown = false;\n\n\tvar lastPosition = new THREE.Vector3();\n\n\tvar STATE = { NONE : -1, ROTATE : 0, SPEEDCHANGE : 1, PAN : 2 };\n\n\tvar state = STATE.NONE;\n\n\t// for reset\n\tthis.position0 = this.object.position.clone();\n\n\t// events\n\n\tvar changeEvent = { type: 'change' };\n\tvar startEvent = { type: 'start'};\n\tvar endEvent = { type: 'end'};\n\t\n\tthis.setTrack = function(track){\n\t\tif(this.track !== track){\n\t\t\tthis.track = track;\n\t\t\tthis.trackPos = null;\n\t\t}\n\t};\n\t\n\tthis.setTrackPos = function(trackPos, _preserveRelativeRotation){\n\t\tvar preserveRelativeRotation = _preserveRelativeRotation || false;\n\t\n\t\tvar newTrackPos = Math.max(0, Math.min(1, trackPos));\n\t\tvar oldTrackPos = this.trackPos || newTrackPos;\n\t\t\n\t\tvar newTangent = this.track.getTangentAt(newTrackPos);\n\t\tvar oldTangent = this.track.getTangentAt(oldTrackPos);\n\t\t\n\t\tif(newTangent.equals(oldTangent)){\n\t\t\t// no change in direction\n\t\t}else{\n\t\t\tvar tangentDiffNormal = new THREE.Vector3().crossVectors(oldTangent, newTangent).normalize();\n\t\t\tvar angle = oldTangent.angleTo(newTangent);\n\t\t\tvar rot = new THREE.Matrix4().makeRotationAxis(tangentDiffNormal, angle);\n\t\t\tvar dir = this.object.getWorldDirection().clone();\n\t\t\tdir = dir.applyMatrix4(rot);\n\t\t\tvar target = new THREE.Vector3().addVectors(this.object.position, dir);\n\t\t\tthis.object.lookAt(target);\n\t\t\tthis.object.updateMatrixWorld();\n\t\t\t\n\t\t\tvar event = {\n\t\t\t\ttype: 'path_relative_rotation',\n\t\t\t\tangle: angle,\n\t\t\t\taxis: tangentDiffNormal,\n\t\t\t\tcontrols: scope\n\t\t\t};\n\t\t\tthis.dispatchEvent(event);\n\t\t}\n\t\t\n\t\tif(this.trackPos === null){\n\t\t\tvar target = new THREE.Vector3().addVectors(this.object.position, newTangent);\n\t\t\tthis.object.lookAt(target);\n\t\t}\n\t\t\n\t\t\n\t\tthis.trackPos = newTrackPos;\n\t\t\n\t\t//var pStart = this.track.getPointAt(oldTrackPos);\n\t\t//var pEnd = this.track.getPointAt(newTrackPos);\n\t\t//var pDiff = pEnd.sub(pStart);\n\t\t\n\t\t\n\t\tif(newTrackPos !== oldTrackPos){\n\t\t\tvar event = {\n\t\t\t\ttype: 'move',\n\t\t\t\ttranslation: pan.clone()\n\t\t\t};\n\t\t\tthis.dispatchEvent(event);\n\t\t}\n\t}\n\t\n\tthis.getTrackPos = function(){\n\t\treturn this.trackPos;\n\t};\n\n\tthis.rotateLeft = function ( angle ) {\n\t\tthetaDelta -= angle;\n\t};\n\n\tthis.rotateUp = function ( angle ) {\n\t\tphiDelta -= angle;\n\t};\n\n\t// pass in distance in world space to move left\n\tthis.panLeft = function ( distance ) {\n\n\t\tvar te = this.object.matrix.elements;\n\n\t\t// get X column of matrix\n\t\tpanOffset.set( te[ 0 ], te[ 1 ], te[ 2 ] );\n\t\tpanOffset.multiplyScalar( - distance );\n\t\t\n\t\tpan.add( panOffset );\n\n\t};\n\n\t// pass in distance in world space to move up\n\tthis.panUp = function ( distance ) {\n\n\t\tvar te = this.object.matrix.elements;\n\n\t\t// get Y column of matrix\n\t\tpanOffset.set( te[ 4 ], te[ 5 ], te[ 6 ] );\n\t\tpanOffset.multiplyScalar( distance );\n\t\t\n\t\tpan.add( panOffset );\n\n\t};\n\t\n\t// pass in distance in world space to move forward\n\tthis.panForward = function ( distance ) {\n\n\t\tif(this.track){\n\t\t\tthis.setTrackPos( this.getTrackPos() - distance / this.track.getLength());\n\t\t}else{\n\t\t\tvar te = this.object.matrix.elements;\n\n\t\t\t// get Y column of matrix\n\t\t\tpanOffset.set( te[ 8 ], te[ 9 ], te[ 10 ] );\n\t\t\t//panOffset.set( te[ 8 ], 0, te[ 10 ] );\n\t\t\tpanOffset.multiplyScalar( distance );\n\t\t\t\n\t\t\tpan.add( panOffset );\n\t\t}\n\t};\n\t\n\tthis.pan = function ( deltaX, deltaY ) {\n\n\t\tvar element = scope.domElement === document ? scope.domElement.body : scope.domElement;\n\n\t\tif ( scope.object.fov !== undefined ) {\n\t\t\t// perspective\n\t\t\tvar position = scope.object.position;\n\t\t\tvar offset = position.clone();\n\t\t\tvar targetDistance = offset.length();\n\n\t\t\t// half of the fov is center to top of screen\n\t\t\ttargetDistance *= Math.tan( ( scope.object.fov / 2 ) * Math.PI / 180.0 );\n\n\t\t\t// we actually don't use screenWidth, since perspective camera is fixed to screen height\n\t\t\tscope.panLeft( 2 * deltaX * targetDistance / element.clientHeight );\n\t\t\tscope.panUp( 2 * deltaY * targetDistance / element.clientHeight );\n\t\t} else if ( scope.object.top !== undefined ) {\n\n\t\t\t// orthographic\n\t\t\tscope.panLeft( deltaX * (scope.object.right - scope.object.left) / element.clientWidth );\n\t\t\tscope.panUp( deltaY * (scope.object.top - scope.object.bottom) / element.clientHeight );\n\t\t} else {\n\n\t\t\t// camera neither orthographic or perspective\n\t\t\tconsole.warn( 'WARNING: GeoControls.js encountered an unknown camera type - pan disabled.' );\n\t\t}\n\t};\n\n\tthis.update = function (delta) {\n\t\tthis.object.rotation.order = 'ZYX';\n\t\t\n\t\tvar object = this.object;\n\t\t\n\t\tthis.object = new THREE.Object3D();\n\t\tthis.object.position.copy(object.position);\n\t\tthis.object.rotation.copy(object.rotation);\n\t\tthis.object.updateMatrix();\n\t\tthis.object.updateMatrixWorld();\n\t\t\n\t\tvar position = this.object.position;\n\t\t\n\t\tif(delta !== undefined){\n\t\t\n\t\t\tvar multiplier = scope.shiftDown ? 4 : 1;\n\t\t\tif(this.moveRight){\n\t\t\t\tthis.panLeft(-delta * this.moveSpeed * multiplier);\n\t\t\t}\n\t\t\tif(this.moveLeft){\n\t\t\t\tthis.panLeft(delta * this.moveSpeed * multiplier);\n\t\t\t}\n\t\t\tif(this.moveForward || this.moveForwardMouse){\n\t\t\t\tthis.panForward(-delta * this.moveSpeed * multiplier);\n\t\t\t}\n\t\t\tif(this.moveBackward){\n\t\t\t\tthis.panForward(delta * this.moveSpeed * multiplier);\n\t\t\t}\n\t\t\tif(this.rotLeft){\n\t\t\t\tscope.rotateLeft( -0.5 * Math.PI * delta / scope.rotateSpeed );\n\t\t\t}\n\t\t\tif(this.rotRight){\n\t\t\t\tscope.rotateLeft( 0.5 * Math.PI * delta / scope.rotateSpeed );\n\t\t\t}\n\t\t\tif(this.raiseCamera){\n\t\t\t\t//scope.rotateUp( -0.5 * Math.PI * delta / scope.rotateSpeed );\n\t\t\t\tscope.panUp( delta * this.moveSpeed * multiplier );\n\t\t\t}\n\t\t\tif(this.lowerCamera){\n\t\t\t\t//scope.rotateUp( 0.5 * Math.PI * delta / scope.rotateSpeed );\n\t\t\t\tscope.panUp( -delta * this.moveSpeed * multiplier );\n\t\t\t}\n\t\t\t\n\t\t}\n\t\t\n\t\tif(!pan.equals(new THREE.Vector3(0,0,0))){\n\t\t\tvar event = {\n\t\t\t\ttype: 'move',\n\t\t\t\ttranslation: pan.clone()\n\t\t\t};\n\t\t\tthis.dispatchEvent(event);\n\t\t}\n\t\t\n\t\tposition.add(pan);\n\t\t\n\t\tif(!(thetaDelta === 0.0 && phiDelta === 0.0)) {\n\t\t\tvar event = {\n\t\t\t\ttype: 'rotate',\n\t\t\t\tthetaDelta: thetaDelta,\n\t\t\t\tphiDelta: phiDelta\n\t\t\t};\n\t\t\tthis.dispatchEvent(event);\n\t\t}\n\t\t\n\t\tthis.object.updateMatrix();\n\t\tvar rot = new THREE.Matrix4().makeRotationY(thetaDelta);\n\t\tvar res = new THREE.Matrix4().multiplyMatrices(rot, this.object.matrix);\n\t\tthis.object.quaternion.setFromRotationMatrix(res);\n\t\t\n\t\tthis.object.rotation.x += phiDelta;\n\t\tthis.object.updateMatrixWorld();\n\t\t\n\t\t// send transformation proposal to listeners\n\t\tvar proposeTransformEvent = {\n\t\t\ttype: \"proposeTransform\",\n\t\t\toldPosition: object.position,\n\t\t\tnewPosition: this.object.position,\n\t\t\tobjections: 0,\n\t\t\tcounterProposals: []\n\t\t};\n\t\tthis.dispatchEvent(proposeTransformEvent);\n\t\t\n\t\t// check some counter proposals if transformation wasn't accepted\n\t\tif(proposeTransformEvent.objections > 0 ){\n\t\t\tif(proposeTransformEvent.counterProposals.length > 0){\n\t\t\t\tvar cp = proposeTransformEvent.counterProposals;\n\t\t\t\tthis.object.position.copy(cp[0]);\n\t\t\t\t\n\t\t\t\tproposeTransformEvent.objections = 0;\n\t\t\t\tproposeTransformEvent.counterProposals = [];\n\t\t\t}\n\t\t}\n\t\t\n\t\t// apply transformation, if accepted\n\t\tif(proposeTransformEvent.objections > 0){\n\t\t\t\n\t\t}else{\n\t\t\tobject.position.copy(this.object.position);\n\t\t}\n\t\t\n\t\tobject.rotation.copy(this.object.rotation);\n\t\t\n\t\tthis.object = object;\n\n\t\tthetaDelta = 0;\n\t\tphiDelta = 0;\n\t\tscale = 1;\n\t\tpan.set( 0, 0, 0 );\n\n\t\tif ( lastPosition.distanceTo( this.object.position ) > 0 ) {\n\t\t\tthis.dispatchEvent( changeEvent );\n\n\t\t\tlastPosition.copy( this.object.position );\n\t\t}\n\t\t\n\t\tif(this.track){\n\t\t\tvar pos = this.track.getPointAt(this.trackPos);\n\t\t\tobject.position.copy(pos);\n\t\t}\n\t};\n\n\n\tthis.reset = function () {\n\t\tstate = STATE.NONE;\n\n\t\tthis.object.position.copy( this.position0 );\n\t};\n\n\tfunction onMouseDown( event ) {\n\t\tif ( scope.enabled === false ) return;\n\t\tevent.preventDefault();\n\n\t\tif ( event.button === 0 ) {\n\t\t\tstate = STATE.ROTATE;\n\n\t\t\trotateStart.set( event.clientX, event.clientY );\n\t\t} else if ( event.button === 1 ) {\n\t\t\tstate = STATE.PAN;\n            \n\t\t\tpanStart.set( event.clientX, event.clientY );\n\t\t} else if ( event.button === 2 ) {\n\t\t\t//state = STATE.PAN;\n            //\n\t\t\t//panStart.set( event.clientX, event.clientY );\n\t\t\tscope.moveForwardMouse = true;\n\t\t}\n\n\t\t//scope.domElement.addEventListener( 'mousemove', onMouseMove, false );\n\t\t//scope.domElement.addEventListener( 'mouseup', onMouseUp, false );\n\t\tscope.dispatchEvent( startEvent );\n\t}\n\n\tfunction onMouseMove( event ) {\n\t\tif ( scope.enabled === false ) return;\n\n\t\tevent.preventDefault();\n\n\t\tvar element = scope.domElement === document ? scope.domElement.body : scope.domElement;\n\n\t\tif ( state === STATE.ROTATE ) {\n\t\t\trotateEnd.set( event.clientX, event.clientY );\n\t\t\trotateDelta.subVectors( rotateEnd, rotateStart );\n\n\t\t\t// rotating across whole screen goes 360 degrees around\n\t\t\tscope.rotateLeft( 2 * Math.PI * rotateDelta.x / element.clientWidth * scope.rotateSpeed );\n\n\t\t\t// rotating up and down along whole screen attempts to go 360, but limited to 180\n\t\t\tscope.rotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight * scope.rotateSpeed );\n\n\t\t\trotateStart.copy( rotateEnd );\n\n\t\t} else if ( state === STATE.PAN ) {\n\t\t\tpanEnd.set( event.clientX, event.clientY );\n\t\t\tpanDelta.subVectors( panEnd, panStart );\n\t\t\t//panDelta.multiplyScalar(this.moveSpeed).multiplyScalar(0.0001);\n\t\t\tpanDelta.multiplyScalar(0.002).multiplyScalar(scope.moveSpeed);\n\t\t\t\n\t\t\tscope.pan( panDelta.x, panDelta.y );\n\n\t\t\tpanStart.copy( panEnd );\n\t\t}\n\t}\n\n\tfunction onMouseUp(event) {\n\t\tif ( scope.enabled === false ) return;\n\t\t\n\t\t//console.log(event.which);\n\t\t\n\t\tif(event.button === 2){\n\t\t\tscope.moveForwardMouse = false;\n\t\t}else{\n\t\t\t//scope.domElement.removeEventListener( 'mousemove', onMouseMove, false );\n\t\t\t//scope.domElement.removeEventListener( 'mouseup', onMouseUp, false );\n\t\t\tscope.dispatchEvent( endEvent );\n\t\t\tstate = STATE.NONE;\n\t\t}\n\t}\n\n\tfunction onMouseWheel(event) {\n\t\tif ( scope.enabled === false || scope.noZoom === true ) return;\n\n\t\tevent.preventDefault();\n\n\t\tvar direction = (event.detail<0 || event.wheelDelta>0) ? 1 : -1;\n\t\tvar moveSpeed = scope.moveSpeed + scope.moveSpeed * 0.1 * direction;\n\t\tmoveSpeed = Math.max(0.1, moveSpeed);\n\n\t\tscope.setMoveSpeed(moveSpeed);\n\n\t\tscope.dispatchEvent( startEvent );\n\t\tscope.dispatchEvent( endEvent );\n\t}\n\t\n\tthis.setMoveSpeed = function(value){\n\t\tif(scope.moveSpeed !== value){\n\t\t\tscope.moveSpeed = value;\n\t\t\tscope.dispatchEvent( {\n\t\t\t\ttype: \"move_speed_changed\",\n\t\t\t\tcontrols: scope\n\t\t\t});\n\t\t}\n\t};\n\n\tfunction onKeyDown( event ) {\n\t\tif ( scope.enabled === false) return;\n\t\t\n\t\tscope.shiftDown = event.shiftKey;\n\t\t\n\t\tswitch ( event.keyCode ) {\n\t\t\tcase scope.keys.UP: scope.moveForward = true; break;\n\t\t\tcase scope.keys.BOTTOM: scope.moveBackward = true; break;\n\t\t\tcase scope.keys.LEFT: scope.moveLeft = true; break;\n\t\t\tcase scope.keys.RIGHT: scope.moveRight = true; break;\n\t\t\tcase scope.keys.W: scope.moveForward = true; break;\n\t\t\tcase scope.keys.S: scope.moveBackward = true; break;\n\t\t\tcase scope.keys.A: scope.moveLeft = true; break;\n\t\t\tcase scope.keys.D: scope.moveRight = true; break;\t\t\t\n\t\t\tcase scope.keys.Q: scope.rotLeft = true; break;\t\t\t\n\t\t\tcase scope.keys.E: scope.rotRight = true; break;\t\t\t\n\t\t\tcase scope.keys.R: scope.raiseCamera = true; break;\t\t\t\n\t\t\tcase scope.keys.F: scope.lowerCamera = true; break;\t\t\t\n\t\t}\n\t}\n\t\n\tfunction onKeyUp( event ) {\n\t\n\t\tscope.shiftDown = event.shiftKey;\n\t\t\n\t\tswitch ( event.keyCode ) {\n\t\t\tcase scope.keys.W: scope.moveForward = false; break;\n\t\t\tcase scope.keys.S: scope.moveBackward = false; break;\n\t\t\tcase scope.keys.A: scope.moveLeft = false; break;\n\t\t\tcase scope.keys.D: scope.moveRight = false; break;\n\t\t\tcase scope.keys.UP: scope.moveForward = false; break;\n\t\t\tcase scope.keys.BOTTOM: scope.moveBackward = false; break;\n\t\t\tcase scope.keys.LEFT: scope.moveLeft = false; break;\n\t\t\tcase scope.keys.RIGHT: scope.moveRight = false; break;\n\t\t\tcase scope.keys.Q: scope.rotLeft = false; break;\t\t\t\n\t\t\tcase scope.keys.E: scope.rotRight = false; break;\n\t\t\tcase scope.keys.R: scope.raiseCamera = false; break;\t\t\t\n\t\t\tcase scope.keys.F: scope.lowerCamera = false; break;\t\t\t\t\n\t\t}\n\t}\n\n\tthis.domElement.addEventListener( 'contextmenu', function ( event ) { event.preventDefault(); }, false );\n\tthis.domElement.addEventListener( 'mousedown', onMouseDown, false );\n\tthis.domElement.addEventListener( 'mousewheel', onMouseWheel, false );\n\tthis.domElement.addEventListener( 'DOMMouseScroll', onMouseWheel, false ); // firefox\n\t\n\tscope.domElement.addEventListener( 'mousemove', onMouseMove, false );\n\tscope.domElement.addEventListener( 'mouseup', onMouseUp, false );\n\n\tif(this.domElement.tabIndex === -1){\n\t\tthis.domElement.tabIndex = 2222;\n\t}\n\tscope.domElement.addEventListener( 'keydown', onKeyDown, false );\n\tscope.domElement.addEventListener( 'keyup', onKeyUp, false );\n\n};\n\nPotree.GeoControls.prototype = Object.create( THREE.EventDispatcher.prototype );\n/**\n * @author mschuetz / http://mschuetz.at\n *\n * adapted from THREE.OrbitControls by \n *\n * @author qiao / https://github.com/qiao\n * @author mrdoob / http://mrdoob.com\n * @author alteredq / http://alteredqualia.com/\n * @author WestLangley / http://github.com/WestLangley\n * @author erich666 / http://erichaines.com\n *\n *\n *\n */\n \nPotree.OrbitControls = class OrbitControls extends THREE.EventDispatcher{\n\t\n\tconstructor(viewer){\n\t\tsuper()\n\t\t\n\t\tthis.viewer = viewer;\n\t\tthis.renderer = viewer.renderer;\n\t\t\n\t\tthis.scene = null;\n\t\tthis.sceneControls = new THREE.Scene();\n\t\t\n\t\tthis.rotationSpeed = 5;\n\t\t\n\t\tthis.fadeFactor = 10;\n\t\tthis.yawDelta = 0;\n\t\tthis.pitchDelta = 0;\n\t\tthis.panDelta = new THREE.Vector2(0, 0);\n\t\tthis.radiusDelta = 0;\n\t\t\n\t\tthis.tweens = [];\n\t\t\n\t\t\n\t\tlet drag = (e) => {\n\t\t\tif(e.drag.object !== null){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tif(e.drag.startHandled === undefined){\n\t\t\t\te.drag.startHandled = true;\n\t\t\t\t\n\t\t\t\tthis.dispatchEvent({type: \"start\"});\n\t\t\t}\n\t\t\t\n\t\t\tlet ndrag = {\n\t\t\t\tx: e.drag.lastDrag.x / this.renderer.domElement.clientWidth,\n\t\t\t\ty: e.drag.lastDrag.y / this.renderer.domElement.clientHeight\n\t\t\t};\n\t\t\t\n\t\t\tif(e.drag.mouse === Potree.MOUSE.LEFT){\n\t\t\t\tthis.yawDelta += ndrag.x * this.rotationSpeed;\n\t\t\t\tthis.pitchDelta += ndrag.y * this.rotationSpeed;\n\t\t\t\t\n\t\t\t\tthis.stopTweens();\n\t\t\t}else if(e.drag.mouse === Potree.MOUSE.RIGHT){\n\t\t\t\tthis.panDelta.x += ndrag.x;\n\t\t\t\tthis.panDelta.y += ndrag.y;\n\t\t\t\t\n\t\t\t\tthis.stopTweens();\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t};\n\t\t\n\t\tlet drop = e => {\n\t\t\tthis.dispatchEvent({type: \"end\"});\n\t\t};\n\t\t\n\t\tlet scroll = (e) => {\n\t\t\tlet resolvedRadius = this.scene.view.radius + this.radiusDelta;\n\t\t\t\n\t\t\tthis.radiusDelta += -e.delta * resolvedRadius * 0.1;\n\t\t\t\n\t\t\tthis.stopTweens();\n\t\t};\n\t\t\n\t\tlet dblclick = (e) => {\n\t\t\tthis.zoomToLocation(e.mouse);\n\t\t};\n\t\t\n\t\t\n\t\tlet previousTouch = null;\n\t\tlet touchStart = e => {\n\t\t\tpreviousTouch = e;\n\t\t};\n\t\t\n\t\tlet touchEnd = e => {\n\t\t\tpreviousTouch = e;\n\t\t};\n\t\t\n\t\tlet touchMove = e => {\n\t\t\t\n\t\t\tif(e.touches.length === 2 && previousTouch.touches.length === 2){\n\t\t\t\tlet prev = previousTouch;\n\t\t\t\tlet curr = e;\n\t\t\t\t\n\t\t\t\tlet prevDX = prev.touches[0].pageX - prev.touches[1].pageX;\n\t\t\t\tlet prevDY = prev.touches[0].pageY - prev.touches[1].pageY;\n\t\t\t\tlet prevDist = Math.sqrt(prevDX * prevDX + prevDY * prevDY);\n\t\t\t\t\n\t\t\t\tlet currDX = curr.touches[0].pageX - curr.touches[1].pageX;\n\t\t\t\tlet currDY = curr.touches[0].pageY - curr.touches[1].pageY;\n\t\t\t\tlet currDist = Math.sqrt(currDX * currDX + currDY * currDY);\n\t\t\t\t\n\t\t\t\tlet delta = currDist / prevDist;\n\t\t\t\tlet resolvedRadius = this.scene.view.radius + this.radiusDelta;\n\t\t\t\tlet newRadius = resolvedRadius / delta;\n\t\t\t\tthis.radiusDelta = newRadius - resolvedRadius;\n\n\t\t\t\tthis.stopTweens();\n\t\t\t}\n\t\t\t\n\t\t\tpreviousTouch = e;\n\t\t};\n\t\t\n\t\tthis.addEventListener(\"touchstart\", touchStart);\n\t\tthis.addEventListener(\"touchend\", touchEnd);\n\t\tthis.addEventListener(\"touchmove\", touchMove);\n\t\tthis.addEventListener(\"drag\", drag);\n\t\tthis.addEventListener(\"drop\", drop);\n\t\tthis.addEventListener(\"mousewheel\", scroll);\n\t\tthis.addEventListener(\"dblclick\", dblclick);\n\t\t\n\t}\n\t\n\tsetScene(scene){\n\t\tthis.scene = scene;\n\t}\n\t\n\tzoomToLocation(mouse){\n\t\tlet camera = this.scene.camera;\n\t\t\n\t\tlet I = Potree.utils.getMousePointCloudIntersection(\n\t\t\tmouse, \n\t\t\tcamera, \n\t\t\tthis.renderer, \n\t\t\tthis.scene.pointclouds);\n\t\t\t\n\t\tif(I === null){\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tlet nmouse =  {\n\t\t\tx: +( mouse.x / this.renderer.domElement.clientWidth )  * 2 - 1,\n\t\t\ty: -( mouse.y / this.renderer.domElement.clientHeight ) * 2 + 1\n\t\t};\n\t\t\n\t\tlet targetRadius = 0;\n\t\t{\n\t\t\tlet minimumJumpDistance = 0.2;\n\t\t\t\n\t\t\tlet vector = new THREE.Vector3( nmouse.x, nmouse.y, 0.5 );\n\t\t\tvector.unproject(camera);\n\t\t\t\n\t\t\tlet direction = vector.sub(camera.position).normalize();\n\t\t\tlet ray = new THREE.Ray(camera.position, direction);\n\t\t\t\n\t\t\tlet nodes = I.pointcloud.nodesOnRay(I.pointcloud.visibleNodes, ray);\n\t\t\tlet lastNode = nodes[nodes.length - 1];\n\t\t\tlet radius = lastNode.getBoundingSphere().radius;\n\t\t\ttargetRadius = Math.min(this.scene.view.radius, radius);\n\t\t\ttargetRadius = Math.max(minimumJumpDistance, targetRadius);\n\t\t}\n\t\t\n\t\tlet d = this.scene.view.direction.multiplyScalar(-1);\n\t\tlet cameraTargetPosition = new THREE.Vector3().addVectors(I.location, d.multiplyScalar(targetRadius));\n\t\tlet controlsTargetPosition = I.location;\n\t\t\n\t\tvar animationDuration = 600;\n\t\tvar easing = TWEEN.Easing.Quartic.Out;\n\t\t\n\t\t{ // animate \n\t\t\n\t\t\tlet value = {x: 0};\n\t\t\tlet tween = new TWEEN.Tween(value).to({x: 1}, animationDuration);\n\t\t\ttween.easing(easing);\n\t\t\tthis.tweens.push(tween);\n\t\t\t\n\t\t\tlet startPos = this.scene.view.position.clone();\n\t\t\tlet targetPos = cameraTargetPosition.clone();\n\t\t\tlet startRadius = this.scene.view.radius;\n\t\t\tlet targetRadius = cameraTargetPosition.distanceTo(I.location);\n\t\t\t\n\t\t\ttween.onUpdate( () => {\n\t\t\t\tlet t = value.x;\n\t\t\t\tthis.scene.view.position.x = (1 - t) * startPos.x + t * targetPos.x;\n\t\t\t\tthis.scene.view.position.y = (1 - t) * startPos.y + t * targetPos.y;\n\t\t\t\tthis.scene.view.position.z = (1 - t) * startPos.z + t * targetPos.z;\n\t\t\t\t\n\t\t\t\tthis.scene.view.radius = (1 - t) * startRadius + t * targetRadius;\n\t\t\t\tthis.viewer.setMoveSpeed(this.scene.view.radius / 2.5);\n\t\t\t});\n\t\t\t\n\t\t\ttween.onComplete( () => {\n\t\t\t\tthis.tweens = this.tweens.filter( e => e !== tween);\n\t\t\t});\n\t\t\t\n\t\t\ttween.start();\n\t\t}\n\t}\n\t\n\tstopTweens(){\n\t\tthis.tweens.forEach( e => e.stop() );\n\t\tthis.tweens = [];\n\t}\n\t\n\tupdate(delta){\n\t\t\n\t\tlet view = this.scene.view;\n\t\t\n\t\t{ // apply rotation\n\t\t\tlet progression = Math.min(1, this.fadeFactor * delta);\n\t\t\t\n\t\t\tlet yaw = view.yaw;\n\t\t\tlet pitch = view.pitch;\n\t\t\tlet pivot = view.getPivot();\n\t\t\t\n\t\t\tyaw -= progression * this.yawDelta;\n\t\t\tpitch -= progression * this.pitchDelta;\n\t\t\t\n\t\t\tview.yaw = yaw;\n\t\t\tview.pitch = pitch;\n\t\t\t\n\t\t\tlet V = this.scene.view.direction.multiplyScalar(-view.radius);\n\t\t\tlet position = new THREE.Vector3().addVectors(pivot, V);\n\t\t\t\n\t\t\tview.position.copy(position);\n\t\t}\n\t\t\n\t\t{ // apply pan\n\t\t\tlet progression = Math.min(1, this.fadeFactor * delta);\n\t\t\tlet panDistance = progression * view.radius * 3;\n\t\t\t\n\t\t\tlet px = -this.panDelta.x * panDistance;\n\t\t\tlet py = this.panDelta.y * panDistance;\n\t\t\t\n\t\t\tview.pan(px, py);\n\t\t}\n\t\t\n\t\t{ // apply zoom\n\t\t\tlet progression = Math.min(1, this.fadeFactor * delta);\n\t\t\t\n\t\t\t//let radius = view.radius + progression * this.radiusDelta * view.radius * 0.1;\n\t\t\tlet radius = view.radius + progression * this.radiusDelta;\n\t\t\t\n\t\t\tlet V = view.direction.multiplyScalar(-radius);\n\t\t\tlet position = new THREE.Vector3().addVectors(view.getPivot(), V);\n\t\t\tview.radius = radius;\n\t\t\t\n\t\t\tview.position.copy(position);\n\t\t}\n\t\t\n\t\t{\n\t\t\tlet speed = view.radius / 2.5;\n\t\t\tthis.viewer.setMoveSpeed(speed);\n\t\t}\n\t\t\n\t\t{// decelerate over time\n\t\t\tlet progression = Math.min(1, this.fadeFactor * delta);\n\t\t\tlet attenuation = Math.max(0, 1 - this.fadeFactor * delta);\n\t\t\t\n\t\t\tthis.yawDelta *= attenuation;\n\t\t\tthis.pitchDelta *= attenuation;\n\t\t\tthis.panDelta.multiplyScalar(attenuation);\n\t\t\t//this.radiusDelta *= attenuation;\n\t\t\tthis.radiusDelta -= progression * this.radiusDelta\n\t\t}\n\t}\n\t\n};\n\n\n\nPotree.EarthControls = class EarthControls extends THREE.EventDispatcher{\n\t\n\tconstructor(viewer){\n\t\tsuper(viewer);\n\t\t\n\t\tthis.viewer = viewer;\n\t\tthis.renderer = viewer.renderer;\n\t\t\n\t\tthis.scene = null;\n\t\tthis.sceneControls = new THREE.Scene();\n\t\t\n\t\tthis.rotationSpeed = 10;\n\t\t\n\t\tthis.fadeFactor = 20;\n\t\tthis.wheelDelta = 0;\n\t\tthis.zoomDelta = new THREE.Vector3();\n\t\tthis.camStart = null;\n\t\t\n\t\tthis.tweens = [];\n\n\t\t\n\t\tthis.pivotIndicator;\n\t\t{\n\t\t\tlet sg = new THREE.SphereGeometry(1, 16, 16);\n\t\t\tlet sm = new THREE.MeshNormalMaterial();\n\t\t\tthis.pivotIndicator = new THREE.Mesh(sg, sm);\n\t\t\tthis.pivotIndicator.visible = false;\n\t\t\tthis.sceneControls.add(this.pivotIndicator);\n\t\t}\n\t\t\n\t\tlet drag = (e) => {\n\t\t\tif(e.drag.object !== null){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tif(!this.pivot){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tif(e.drag.startHandled === undefined){\n\t\t\t\te.drag.startHandled = true;\n\t\t\t\t\n\t\t\t\tthis.dispatchEvent({type: \"start\"});\n\t\t\t}\n\t\t\t\n\t\t\tlet camStart = this.camStart;\n\t\t\tlet view = this.viewer.scene.view;\n\t\t\t\n\t\t\t//let camera = this.viewer.scene.camera;\n\t\t\tlet mouse = e.drag.end;\n\t\t\tlet domElement = this.viewer.renderer.domElement;\n\t\t\t\n\t\t\tif(e.drag.mouse === Potree.MOUSE.LEFT){\n\t\t\t\tlet nmouse =  {\n\t\t\t\t\tx: (mouse.x / domElement.clientWidth ) * 2 - 1,\n\t\t\t\t\ty: - (mouse.y / domElement.clientHeight ) * 2 + 1\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\tlet vector = new THREE.Vector3( nmouse.x, nmouse.y, 0.5 );\n\t\t\t\tvector.unproject(camStart);\n\t\t\t\t\n\t\t\t\tlet dir = vector.sub( camStart.position).normalize();\n\t\t\t\tlet ray = new THREE.Ray(camStart.position, dir);\n\t\t\t\tlet plane = new THREE.Plane().setFromNormalAndCoplanarPoint(\n\t\t\t\t\tnew THREE.Vector3(0, 0, 1), \n\t\t\t\t\tthis.pivot);\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tlet distanceToPlane = ray.distanceToPlane(plane);\n\n\t\t\t\tif(distanceToPlane > 0){\n\t\t\t\t\tlet I = new THREE.Vector3().addVectors(\n\t\t\t\t\t\tcamStart.position, \n\t\t\t\t\t\tdir.clone().multiplyScalar(distanceToPlane));\n\t\t\t\t\t\t\n\t\t\t\t\tlet movedBy = new THREE.Vector3().subVectors(\n\t\t\t\t\t\tI, this.pivot);\n\t\t\t\t\t\n\t\t\t\t\tlet newCamPos = camStart.position.clone().sub(movedBy);\n\t\t\t\t\t\n\t\t\t\t\tview.position.copy(newCamPos);\n\t\t\t\t\t\n\t\t\t\t\t{\n\t\t\t\t\t\tlet distance = newCamPos.distanceTo(this.pivot);\n\t\t\t\t\t\tview.radius = distance;\n\t\t\t\t\t\tlet speed = view.radius / 2.5;\n\t\t\t\t\t\tthis.viewer.setMoveSpeed(speed);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}else if(e.drag.mouse === Potree.MOUSE.RIGHT){\n\t\t\t\tlet ndrag = {\n\t\t\t\t\tx: e.drag.lastDrag.x / this.renderer.domElement.clientWidth,\n\t\t\t\t\ty: e.drag.lastDrag.y / this.renderer.domElement.clientHeight\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\tlet yawDelta = -ndrag.x * this.rotationSpeed * 0.5;\n\t\t\t\tlet pitchDelta = -ndrag.y * this.rotationSpeed * 0.2;\n\t\t\t\t\n\t\t\t\tlet originalPitch = view.pitch;\n\t\t\t\tlet tmpView = view.clone();\n\t\t\t\ttmpView.pitch = tmpView.pitch + pitchDelta;\n\t\t\t\tpitchDelta = tmpView.pitch - originalPitch;\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tlet pivotToCam = new THREE.Vector3().subVectors(view.position, this.pivot);\n\t\t\t\tlet pivotToCamTarget = new THREE.Vector3().subVectors(view.getPivot(), this.pivot);\n\t\t\t\tlet side = view.getSide();\n\t\t\t\t\n\t\t\t\tpivotToCam.applyAxisAngle(side, pitchDelta);\n\t\t\t\tpivotToCamTarget.applyAxisAngle(side, pitchDelta);\n\t\t\t\t\n\t\t\t\tpivotToCam.applyAxisAngle(new THREE.Vector3(0, 0, 1), yawDelta);\n\t\t\t\tpivotToCamTarget.applyAxisAngle(new THREE.Vector3(0, 0, 1), yawDelta);\n\t\t\t\t\n\t\t\t\tlet newCam = new THREE.Vector3().addVectors(this.pivot, pivotToCam);\n\t\t\t\tlet newCamTarget = new THREE.Vector3().addVectors(this.pivot, pivotToCamTarget);\n\t\t\t\t\n\t\t\t\tview.position.copy(newCam);\n\t\t\t\tview.yaw += yawDelta;\n\t\t\t\tview.pitch += pitchDelta;\n\n\t\t\t}\n\t\t\t\n\t\t};\n\t\t\n\t\tlet onMouseDown = e => {\n\t\t\tlet I = Potree.utils.getMousePointCloudIntersection(\n\t\t\t\te.mouse, \n\t\t\t\tthis.scene.camera, \n\t\t\t\tthis.renderer, \n\t\t\t\tthis.scene.pointclouds);\n\t\t\t\t\n\t\t\tif(I){\n\t\t\t\tthis.pivot = I.location;\n\t\t\t\tthis.camStart = this.scene.camera.clone();\n\t\t\t\tthis.pivotIndicator.visible = true;\n\t\t\t\tthis.pivotIndicator.position.copy(I.location);\n\t\t\t}\n\t\t};\n\t\t\n\t\tlet drop = e => {\n\t\t\tthis.dispatchEvent({type: \"end\"});\n\t\t};\n\t\t\n\t\tlet onMouseUp = e => {\n\t\t\tthis.camStart = null;\n\t\t\tthis.pivot = null;\n\t\t\tthis.pivotIndicator.visible = false;\n\t\t};\n\t\t\n\t\tlet scroll = (e) => {\n\t\t\tthis.wheelDelta += e.delta\n\t\t};\n\t\t\n\t\tlet dblclick = (e) => {\n\t\t\tthis.zoomToLocation(e.mouse);\n\t\t};\n\t\t\n\t\tthis.addEventListener(\"drag\", drag);\n\t\tthis.addEventListener(\"drop\", drop);\n\t\tthis.addEventListener(\"mousewheel\", scroll);\n\t\tthis.addEventListener(\"mousedown\", onMouseDown);\n\t\tthis.addEventListener(\"mouseup\", onMouseUp);\n\t\tthis.addEventListener(\"dblclick\", dblclick);\n\t}\n\t\n\tsetScene(scene){\n\t\tthis.scene = scene;\n\t}\n\t\n\tzoomToLocation(mouse){\n\t\tlet camera = this.scene.camera;\n\t\t\n\t\tlet I = Potree.utils.getMousePointCloudIntersection(\n\t\t\tmouse, \n\t\t\tcamera, \n\t\t\tthis.renderer, \n\t\t\tthis.scene.pointclouds);\n\t\t\t\n\t\tif(I === null){\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tlet nmouse =  {\n\t\t\tx: +( mouse.x / this.renderer.domElement.clientWidth )  * 2 - 1,\n\t\t\ty: -( mouse.y / this.renderer.domElement.clientHeight ) * 2 + 1\n\t\t};\n\t\t\n\t\tlet targetRadius = 0;\n\t\t{\n\t\t\tlet minimumJumpDistance = 0.2;\n\t\t\t\n\t\t\tlet vector = new THREE.Vector3( nmouse.x, nmouse.y, 0.5 );\n\t\t\tvector.unproject(camera);\n\t\t\t\n\t\t\tlet direction = vector.sub(camera.position).normalize();\n\t\t\tlet ray = new THREE.Ray(camera.position, direction);\n\t\t\t\n\t\t\tlet nodes = I.pointcloud.nodesOnRay(I.pointcloud.visibleNodes, ray);\n\t\t\tlet lastNode = nodes[nodes.length - 1];\n\t\t\tlet radius = lastNode.getBoundingSphere().radius;\n\t\t\ttargetRadius = Math.min(this.scene.view.radius, radius);\n\t\t\ttargetRadius = Math.max(minimumJumpDistance, targetRadius);\n\t\t}\n\t\t\n\t\tlet d = this.scene.view.direction.multiplyScalar(-1);\n\t\tlet cameraTargetPosition = new THREE.Vector3().addVectors(I.location, d.multiplyScalar(targetRadius));\n\t\tlet controlsTargetPosition = I.location;\n\t\t\n\t\tvar animationDuration = 600;\n\t\tvar easing = TWEEN.Easing.Quartic.Out;\n\t\t\n\t\t{ // animate \n\t\t\n\t\t\tlet value = {x: 0};\n\t\t\tlet tween = new TWEEN.Tween(value).to({x: 1}, animationDuration);\n\t\t\ttween.easing(easing);\n\t\t\tthis.tweens.push(tween);\n\t\t\t\n\t\t\tlet startPos = this.scene.view.position.clone();\n\t\t\tlet targetPos = cameraTargetPosition.clone();\n\t\t\tlet startRadius = this.scene.view.radius;\n\t\t\tlet targetRadius = cameraTargetPosition.distanceTo(I.location);\n\t\t\t\n\t\t\ttween.onUpdate( () => {\n\t\t\t\tlet t = value.x;\n\t\t\t\tthis.scene.view.position.x = (1 - t) * startPos.x + t * targetPos.x;\n\t\t\t\tthis.scene.view.position.y = (1 - t) * startPos.y + t * targetPos.y;\n\t\t\t\tthis.scene.view.position.z = (1 - t) * startPos.z + t * targetPos.z;\n\t\t\t\t\n\t\t\t\tthis.scene.view.radius = (1 - t) * startRadius + t * targetRadius;\n\t\t\t\tthis.viewer.setMoveSpeed(this.scene.view.radius / 2.5);\n\t\t\t});\n\t\t\t\n\t\t\ttween.onComplete( () => {\n\t\t\t\tthis.tweens = this.tweens.filter( e => e !== tween);\n\t\t\t});\n\t\t\t\n\t\t\ttween.start();\n\t\t}\n\t}\n\t\n\tupdate(delta){\n\t\tlet view = this.scene.view;\n\t\tlet fade = Math.pow(0.5, this.fadeFactor * delta);\n\t\tlet progression = 1 - fade;\n\t\tlet camera = this.scene.camera;\n\t\t\n\t\t// compute zoom\n\t\tif(this.wheelDelta !== 0){\n\t\t\tlet I = Potree.utils.getMousePointCloudIntersection(\n\t\t\t\tthis.viewer.inputHandler.mouse, \n\t\t\t\tthis.scene.camera, \n\t\t\t\tthis.renderer, \n\t\t\t\tthis.scene.pointclouds);\n\t\t\t\t\n\t\t\tif(I){\n\t\t\t\tlet resolvedPos = new THREE.Vector3().addVectors(view.position, this.zoomDelta);\n\t\t\t\tlet distance = I.location.distanceTo(resolvedPos);\n\t\t\t\tlet jumpDistance = distance * 0.2 * this.wheelDelta;\n\t\t\t\tlet targetDir = new THREE.Vector3().subVectors(I.location, view.position);\n\t\t\t\ttargetDir.normalize();\n\t\t\t\t\n\t\t\t\tresolvedPos.add(targetDir.multiplyScalar(jumpDistance));\n\t\t\t\tthis.zoomDelta.subVectors(resolvedPos, view.position);\n\t\t\t\t\n\t\t\t\t{\n\t\t\t\t\tlet distance = resolvedPos.distanceTo(I.location);\n\t\t\t\t\tview.radius = distance;\n\t\t\t\t\tlet speed = view.radius / 2.5;\n\t\t\t\t\tthis.viewer.setMoveSpeed(speed);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\t// apply zoom\n\t\tif(this.zoomDelta.length() !== 0){\n\t\t\tlet p = this.zoomDelta.clone().multiplyScalar(progression);\n\t\t\t\n\t\t\tlet newPos = new THREE.Vector3().addVectors(view.position, p);\n\t\t\tview.position.copy(newPos);\n\t\t}\n\t\t\n\t\tif(this.pivotIndicator.visible){\n\t\t\tlet distance = this.pivotIndicator.position.distanceTo(view.position);\n\t\t\tlet pixelHeight = this.renderer.domElement.clientHeight;\n\t\t\tlet pr = Potree.utils.projectedRadius(1, camera.fov * Math.PI / 180, distance, pixelHeight);\n\t\t\tlet scale = (10 / pr);\n\t\t\tthis.pivotIndicator.scale.set(scale, scale, scale);\n\t\t}\n\t\t\n\t\t// decelerate over time\n\t\t{\n\t\t\tthis.zoomDelta.multiplyScalar(fade);\n\t\t\tthis.wheelDelta = 0;\n\t\t}\n\t\t\n\t}\n\t \n}\n\n\n\n\n\n\n\n\n\n\n\n/**\n * \n * @param node\n * @class an item in the lru list. \n */\nfunction LRUItem(node){\n\tthis.previous = null;\n\tthis.next = null;\n\tthis.node = node;\n}\n\n/**\n * \n * @class A doubly-linked-list of the least recently used elements.\n */\nfunction LRU(){\n\t// the least recently used item\n\tthis.first = null;\n\t// the most recently used item\n\tthis.last = null;\n\t// a list of all items in the lru list\n\tthis.items = {};\n\tthis.elements = 0;\n\tthis.numPoints = 0;\n}\n\n/**\n * number of elements in the list\n * \n * @returns {Number}\n */\nLRU.prototype.size = function(){\n\treturn this.elements;\n};\n\nLRU.prototype.contains = function(node){\n\treturn this.items[node.id] == null;\n};\n\n/**\n * makes node the most recently used item. if the list does not contain node, it will be added.\n * \n * @param node\n */\nLRU.prototype.touch = function(node){\n\tif(!node.loaded){\n\t\treturn;\n\t}\n\n\tvar item;\n\tif(this.items[node.id] == null){\n\t\t// add to list\n\t\titem = new LRUItem(node);\n\t\titem.previous = this.last;\n\t\tthis.last = item;\n\t\tif(item.previous !== null){\n\t\t\titem.previous.next = item;\n\t\t}\n\t\t\n\t\tthis.items[node.id] = item;\n\t\tthis.elements++;\n\t\t\n\t\tif(this.first === null){\n\t\t\tthis.first = item;\n\t\t}\n\t\tthis.numPoints += node.numPoints;\n\t}else{\n\t\t// update in list\n\t\titem = this.items[node.id];\n\t\tif(item.previous === null){\n\t\t\t// handle touch on first element\n\t\t\tif(item.next !== null){\n\t\t\t\tthis.first = item.next;\n\t\t\t\tthis.first.previous = null;\n\t\t\t\titem.previous = this.last;\n\t\t\t\titem.next = null;\n\t\t\t\tthis.last = item;\n\t\t\t\titem.previous.next = item;\n\t\t\t}\n\t\t}else if(item.next === null){\n\t\t\t// handle touch on last element\n\t\t}else{\n\t\t\t// handle touch on any other element\n\t\t\titem.previous.next = item.next;\n\t\t\titem.next.previous = item.previous;\n\t\t\titem.previous = this.last;\n\t\t\titem.next = null;\n\t\t\tthis.last = item;\n\t\t\titem.previous.next = item;\n\t\t}\n\t\t\n\t\t\n\t}\n};\n\n///**\n// * removes the least recently used item from the list and returns it. \n// * if the list was empty, null will be returned.\n// */\n//LRU.prototype.remove = function remove(){\n//\tif(this.first === null){\n//\t\treturn null;\n//\t}\n//\tvar lru = this.first;\n//\n//\t// if the lru list contains at least 2 items, the item after the least recently used elemnt will be the new lru item. \n//\tif(lru.next !== null){\n//\t\tthis.first = lru.next;\n//\t\tthis.first.previous = null;\n//\t}else{\n//\t\tthis.first = null;\n//\t\tthis.last = null;\n//\t}\n//\t\n//\tdelete this.items[lru.node.id];\n//\tthis.elements--;\n//\tthis.numPoints -= lru.node.numPoints;\n//\t\n////\tLogger.info(\"removed node: \" + lru.node.id);\n//\treturn lru.node;\n//};\n\nLRU.prototype.remove = function remove(node){\n\n\tvar lruItem = this.items[node.id];\n\tif(lruItem){\n\t\n\t\tif(this.elements === 1){\n\t\t\tthis.first = null;\n\t\t\tthis.last = null;\n\t\t}else{\n\t\t\tif(!lruItem.previous){\n\t\t\t\tthis.first = lruItem.next;\n\t\t\t\tthis.first.previous = null;\n\t\t\t}\n\t\t\tif(!lruItem.next){\n\t\t\t\tthis.last = lruItem.previous;\n\t\t\t\tthis.last.next = null;\n\t\t\t}\n\t\t\tif(lruItem.previous &&lruItem.next){\n\t\t\t\tlruItem.previous.next = lruItem.next;\n\t\t\t\tlruItem.next.previous = lruItem.previous;\n\t\t\t}\n\t\t}\n\t\n\t\tdelete this.items[node.id];\n\t\tthis.elements--;\n\t\tthis.numPoints -= node.numPoints;\n\t}\n\t\n};\n\nLRU.prototype.getLRUItem = function(){\n\tif(this.first === null){\n\t\treturn null;\n\t}\n\tvar lru = this.first;\n\t\n\treturn lru.node;\n};\n\nLRU.prototype.toString = function(){\n\tvar string = \"{ \";\n\tvar curr = this.first;\n\twhile(curr !== null){\n\t\tstring += curr.node.id;\n\t\tif(curr.next !== null){\n\t\t\tstring += \", \";\n\t\t}\n\t\tcurr = curr.next;\n\t}\n\tstring += \"}\";\n\tstring += \"(\" + this.size() + \")\";\n\treturn string;\n};\n\nLRU.prototype.freeMemory = function(){\n\tif(this.elements <= 1){\n\t\treturn;\n\t}\n\n\twhile(this.numPoints > Potree.pointLoadLimit){\n\t\tvar element = this.first;\n\t\tvar node = element.node;\n\t\tthis.disposeDescendants(node);\n\t\n\t}\n};\n\nLRU.prototype.disposeDescendants = function(node){\n\tvar stack = [];\n\tstack.push(node);\n\twhile(stack.length > 0){\n\t\tvar current = stack.pop();\n\t\t\n\t\t//console.log(current);\n\t\t\n\t\tcurrent.dispose();\n\t\tthis.remove(current);\n\t\t\n\t\tfor(var key in current.children){\n\t\t\tif(current.children.hasOwnProperty(key)){\n\t\t\t\tvar child = current.children[key];\n\t\t\t\tif(child.loaded){\n\t\t\t\t\tstack.push(current.children[key]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n};\nPotree.Annotation = class extends THREE.EventDispatcher{\n\t\n\tconstructor(args = {}){\n\t\tsuper();\n\t\t\n\t\tthis.scene = null;\n\t\tthis.title = args.title || \"No Title\";\n\t\tthis.description = args.description || \"\";\n\t\t\n\t\tif(!args.position){\n\t\t\t//this.position = new THREE.Vector3(0, 0, 0);\n\t\t\tthis.position = null;\n\t\t}else if(args.position instanceof THREE.Vector3){\n\t\t\tthis.position = args.position;\n\t\t}else{\n\t\t\tthis.position = new THREE.Vector3(...args.position);\n\t\t}\n\t\t\n\t\tthis.cameraPosition = (args.cameraPosition instanceof Array) ? \n\t\t\tnew THREE.Vector3().fromArray(args.cameraPosition) : args.cameraPosition;\n\t\tthis.cameraTarget = (args.cameraTarget instanceof Array) ? \n\t\t\tnew THREE.Vector3().fromArray(args.cameraTarget) : args.cameraTarget;\n\t\tthis.radius = args.radius;\n\t\tthis.view = args.view || null;\n\t\tthis.keepOpen = false;\n\t\tthis.descriptionVisible = false;\n\t\tthis.showDescription = true;\n\t\tthis.actions = args.actions || [];\n\t\tthis.isHighlighted = false;\n\t\tthis._visible = true;\n\t\tthis.__visible = true;\n\t\tthis._display = true;\n\t\tthis._expand = false;\n\t\tthis.collapseThreshold = [args.collapseThreshold, 100].find(e => e !== undefined);\n\t\t\n\t\tthis.children = [];\n\t\tthis.parent = null;\n\t\tthis.boundingBox = new THREE.Box3();\n\t\t\n\t\tlet iconClose = Potree.resourcePath + \"/icons/close.svg\";\n\t\t\n\t\tthis.domElement = $(`\n\t\t\t<div class=\"annotation\" oncontextmenu=\"return false;\">\n\t\t\t\t<div class=\"annotation-titlebar\">\n\t\t\t\t\t<span class=\"annotation-label\">${this.title}</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"annotation-description\">\n\t\t\t\t\t<span class=\"annotation-description-close\">\n\t\t\t\t\t\t<img src=\"${iconClose}\" width=\"16px\">\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class=\"annotation-description-content\">${this.description}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`);\n\t\t\n\t\tthis.elTitlebar = this.domElement.find(\".annotation-titlebar\");\n\t\tthis.elTitle = this.elTitlebar.find(\".annotation-label\");\n\t\tthis.elDescription = this.domElement.find(\".annotation-description\");\n\t\tthis.elDescriptionClose = this.elDescription.find(\".annotation-description-close\");\n\t\t//this.elDescriptionContent = this.elDescription.find(\".annotation-description-content\");\n\t\t\n\t\tthis.clickTitle = () => {\n\t\t\tif(this.hasView()){\n\t\t\t\tthis.moveHere(this.scene.camera);\n\t\t\t}\n\t\t\tthis.dispatchEvent({type: \"click\", target: this});\n\t\t};\n\t\t\n\t\tthis.elTitle.click(this.clickTitle);\n\t\t\n\t\tthis.actions = this.actions.map(a => {\n\t\t\tif(a instanceof Potree.Action){\n\t\t\t\treturn a;\n\t\t\t}else{\n\t\t\t\treturn new Potree.Action(a);\n\t\t\t}\n\t\t});\n\t\t\n\t\tfor(let action of this.actions){\n\t\t\taction.pairWith(this);\n\t\t}\n        \n\t\tlet actions = this.actions.filter(\n\t\t\ta => a.showIn === undefined || a.showIn.includes(\"scene\"));\n\t\t\n\t\tfor(let action of actions){\n\t\t\tthis.elTitle.css(\"padding\", \"1px 3px 0px 8px\");\n\t\t\t\n\t\t\tlet elButton = $(`<img src=\"${action.icon}\" class=\"annotation-action-icon\">`);\n\t\t\tthis.elTitlebar.append(elButton);\n\t\t\telButton.click(() => action.onclick({annotation: this}));\n\t\t}\n\t\t\n\t\tthis.elDescriptionClose.hover(\n\t\t\te => this.elDescriptionClose.css(\"opacity\", \"1\"),\n\t\t\te => this.elDescriptionClose.css(\"opacity\", \"0.5\")\n\t\t);\n\t\tthis.elDescriptionClose.click(e => this.setHighlighted(false));\n\t\t//this.elDescriptionContent.html(this.description);\n\t\t\n\t\tthis.domElement.mouseenter(e => this.setHighlighted(true));\n\t\tthis.domElement.mouseleave(e => this.setHighlighted(false));\n\t\t\n\t\tthis.domElement.on(\"touchstart\", e => {\n\t\t\tthis.setHighlighted(!this.isHighlighted);\n\t\t});\n\t\t\n\t\tthis.display = false;\n\t}\n\t\n\tget visible(){\n\t\treturn this._visible;\n\t}\n\t\n\tset visible(value){\n\t\tif(this._visible === value){\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tthis._visible = value;\n\t\t\n\t\tthis.traverse(node => {\n\t\t\tnode.display = value;\n\t\t});\n\t\t\n\t\tthis.dispatchEvent({\n\t\t\ttype: \"visibility_changed\",\n\t\t\tannotation: this\n\t\t});\n\t}\n\t\n\tget display(){\n\t\treturn this._display;\n\t}\n\t\n\tset display(display){\n\t\t\n\t\tif(this._display === display){\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tthis._display = display;\n\t\t\n\t\tif(display){\n\t\t\t//this.domElement.fadeIn(200);\n\t\t\tthis.domElement.show();\n\t\t}else{\n\t\t\t//this.domElement.fadeOut(200);\n\t\t\tthis.domElement.hide();\n\t\t}\n\t}\n\t\n\tget expand(){\n\t\treturn this._expand;\n\t}\n\t\n\tset expand(expand){\n\t\t\n\t\tif(this._expand === expand){\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tif(expand){\n\t\t\tthis.display = false;\n\t\t}else{\n\t\t\tthis.display = true;\n\t\t\tthis.traverseDescendants(node => {\n\t\t\t\tnode.display = false;\n\t\t\t});\n\t\t}\n\t\t\n\t\tthis._expand = expand;\n\t}\n\t\n\tadd(annotation){\n\t\tif(!this.children.includes(annotation)){\n\t\t\tthis.children.push(annotation);\n\t\t\tannotation.parent = this;\n\t\t\t\n\t\t\tlet descendants = [];\n\t\t\tannotation.traverse(a => {descendants.push(a)});\n\t\t\t\n\t\t\tfor(let descendant of descendants){\n\t\t\t\tlet c = this;\n\t\t\t\twhile(c !== null){\n\t\t\t\t\tc.dispatchEvent({\n\t\t\t\t\t\t\"type\": \"annotation_added\",\n\t\t\t\t\t\t\"annotation\": descendant\n\t\t\t\t\t});\n\t\t\t\t\tc = c.parent;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t}\n\t}\n\t\n\tlevel(){\n\t\tif(this.parent === null){\n\t\t\treturn 0;\n\t\t}else{\n\t\t\treturn this.parent.level() + 1;\n\t\t}\n\t}\n\t\n\tremove(annotation){\n\t\tthis.children = this.children.filter(e => e !== annotation);\n\t\tannotation.parent = null;\n\t}\n\t\n\tupdateBounds(){\n\t\tlet box = new THREE.Box3();\n\t\t\n\t\tif(this.position){\n\t\t\tbox.expandByPoint(this.position);\n\t\t}\n\t\t\n\t\tfor(let child of this.children){\n\t\t\tchild.updateBounds();\n\t\t\t\n\t\t\tbox.union(child.boundingBox);\n\t\t}\n\t\t\n\t\tthis.boundingBox.copy(box);\n\t}\n\t\n\ttraverse(callback){\n\t\tlet expand = callback(this);\n\t\t\n\t\tif(expand === undefined || expand === true){\n\t\t\tfor(let child of this.children){\n\t\t\t\tchild.traverse(callback);\n\t\t\t}\n\t\t}\n\t}\n\t\n\ttraverseDescendants(callback){\n\t\tfor(let child of this.children){\n\t\t\tchild.traverse(callback);\n\t\t}\n\t}\n\t\n\tflatten(){\n\t\tlet annotations = [];\n\t\t\n\t\tthis.traverse(annotation => {\n\t\t\tannotations.push(annotation);\n\t\t});\n\t\t\n\t\treturn annotations;\n\t}\n\t\n\tdescendants(){\n\t\tlet annotations = [];\n\t\t\n\t\tthis.traverse(annotation => {\n\t\t\tif(annotation !== this){\n\t\t\t\tannotations.push(annotation);\n\t\t\t}\n\t\t});\n\t\t\n\t\treturn annotations;\n\t}\n\t\n\tsetHighlighted(highlighted){\n\t\tif(highlighted){\n\t\t\tthis.domElement.css(\"opacity\", \"0.8\");\n\t\t\tthis.elTitlebar.css(\"box-shadow\", \"0 0 5px #fff\");\n\t\t\tthis.domElement.css(\"z-index\", \"1000\");\n\t\t\t\n\t\t\tif(this.description){\n\t\t\t\tthis.descriptionVisible = true;\t\n\t\t\t\t//this.elDescription.css(\"display\", \"block\");\n\t\t\t\tthis.elDescription.fadeIn(200);\n\t\t\t\tthis.elDescription.css(\"position\", \"relative\");\n\t\t\t}\n\t\t}else{\n\t\t\tthis.domElement.css(\"opacity\", \"0.5\");\n\t\t\tthis.elTitlebar.css(\"box-shadow\", \"\");\n\t\t\tthis.domElement.css(\"z-index\", \"100\");\n\t\t\tthis.descriptionVisible = false;\t\n\t\t\tthis.elDescription.css(\"display\", \"none\");\n\t\t\t//this.elDescription.fadeOut(200);\n\t\t}\n\t\t\n\t\tthis.isHighlighted = highlighted;\n\t}\n\t\n\thasView(){\n\t\tlet hasPosTargetView = this.cameraTarget instanceof THREE.Vector3;\n\t\thasPosTargetView = hasPosTargetView && this.cameraPosition instanceof THREE.Vector3;\n\t\t\n\t\tlet hasRadiusView = this.radius !== undefined;\n\t\t\n\t\tlet hasView = hasPosTargetView || hasRadiusView;\n\t\t\t\t\n\t\treturn hasView;\n\t};\n\t\n\tmoveHere(camera){\t\t\n\t\tif(!this.hasView()){\n\t\t\treturn;\n\t\t}\n\n\t\tlet view = this.scene.view;\n\t\t\n\t\tvar animationDuration = 300;\n\t\tvar easing = TWEEN.Easing.Quartic.Out;\n\t\t\n\t\t\n\t\tlet endTarget;\n\t\tif(this.cameraTarget){\n\t\t\tendTarget = this.cameraTarget;\n\t\t}else if(this.position){\n\t\t\tendTarget = this.position;\n\t\t}else{\n\t\t\tendTarget = this.boundingBox.getCenter();\n\t\t}\n\t\t\n\t\tif(this.cameraPosition){\n\t\t\t\n\t\t\tlet endPosition = this.cameraPosition;\n\n\t\t\t{ // animate camera position\n\t\t\t\tlet tween = new TWEEN.Tween(view.position).to(endPosition, animationDuration);\n\t\t\t\ttween.easing(easing);\n\t\t\t\ttween.start();\n\t\t\t}\n\t\t\t\n\t\t\t{ // animate camera target\n\t\t\t\tvar camTargetDistance = camera.position.distanceTo(endTarget);\n\t\t\t\tvar target = new THREE.Vector3().addVectors(\n\t\t\t\t\tcamera.position, \n\t\t\t\t\tcamera.getWorldDirection().clone().multiplyScalar(camTargetDistance)\n\t\t\t\t);\n\t\t\t\tvar tween = new TWEEN.Tween(target).to(endTarget, animationDuration);\n\t\t\t\ttween.easing(easing);\n\t\t\t\ttween.onUpdate(() => {\n\t\t\t\t\tview.lookAt(target);\n\t\t\t\t});\n\t\t\t\ttween.onComplete(() => {\n\t\t\t\t\tview.lookAt(target);\n\t\t\t\t\tthis.dispatchEvent({type: \"focusing_finished\", target: this});\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tthis.dispatchEvent({type: \"focusing_started\", target: this});\n\t\t\t\ttween.start();\n\t\t\t}\n\t\t}else if(this.radius){\n\t\t\tlet direction = view.direction;\n\t\t\tlet endPosition = endTarget.clone().add(direction.multiplyScalar(-this.radius));\n\t\t\tlet startRadius = view.radius;\n\t\t\tlet endRadius = this.radius;\n\t\t\t\n\t\t\t{ // animate camera position\n\t\t\t\tlet tween = new TWEEN.Tween(view.position).to(endPosition, animationDuration);\n\t\t\t\ttween.easing(easing);\n\t\t\t\ttween.start();\n\t\t\t}\n\t\t\t\n\t\t\t{ // animate radius\n\t\t\t\tlet t = {x: 0};\n\t\t\t\n\t\t\t\tlet tween = new TWEEN.Tween(t)\n\t\t\t\t\t.to({x: 1}, animationDuration)\n\t\t\t\t\t.onUpdate(function(){\n\t\t\t\t\t\tview.radius = this.x * endRadius + (1 - this.x) * startRadius;\n\t\t\t\t\t});\n\t\t\t\ttween.easing(easing);\n\t\t\t\ttween.start();\n\t\t\t}\n\t\t\t\n\t\t}\n\t};\n\t\n\tdispose(){\n\t\tif(this.domElement.parentElement){\n\t\t\tthis.domElement.parentElement.removeChild(this.domElement);\n\t\t}\n    \n\t};\n\t\n\t\n\t\n\ttoString(){\n\t\treturn \"Annotation: \" + this.title;\n\t}\n};\n\n\nPotree.Action = class Action extends THREE.EventDispatcher{\n\n\tconstructor(args = {}){\n\t\tsuper();\n\t\t\n\t\tthis.icon = args.icon || \"\";\n\t\tthis.tooltip = args.tooltip;\n\t\t\n\t\tif(args.onclick !== undefined){\n\t\t\tthis.onclick = args.onclick;\n\t\t}\n\t\t\n\t}\n\t\n\tonclick(event){\n\t\t\n\t}\n\t\n\tpairWith(object){\n\t\t\n\t}\n\t\n\tsetIcon(newIcon){\n\t\tlet oldIcon = this.icon;\n\t\t\n\t\tif(newIcon === oldIcon){\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tthis.icon = newIcon;\n\t\t\n\t\tthis.dispatchEvent({\n\t\t\ttype: \"icon_changed\",\n\t\t\taction: this,\n\t\t\ticon: newIcon,\n\t\t\toldIcon: oldIcon\n\t\t});\n\t}\n\n};\n\nPotree.Actions = {};\n\nPotree.Actions.ToggleAnnotationVisibility = class ToggleAnnotationVisibility extends Potree.Action{\n\n\tconstructor(args = {}){\n\t\tsuper(args);\n\t\t\n\t\tthis.icon = Potree.resourcePath + \"/icons/eye.svg\";\n\t\tthis.showIn = \"sidebar\";\n\t\tthis.tooltip = \"toggle visibility\";\n\t}\n\t\n\tpairWith(annotation){\n\t\t\n\t\tif(annotation.visible){\n\t\t\tthis.setIcon(Potree.resourcePath + \"/icons/eye.svg\");\n\t\t}else{\n\t\t\tthis.setIcon(Potree.resourcePath + \"/icons/eye_crossed.svg\");\n\t\t}\n\t\t\n\t\tannotation.addEventListener(\"visibility_changed\", e => {\n\t\t\tlet annotation = e.annotation;\n\t\t\t\n\t\t\tif(annotation.visible){\n\t\t\t\tthis.setIcon(Potree.resourcePath + \"/icons/eye.svg\");\n\t\t\t}else{\n\t\t\t\tthis.setIcon(Potree.resourcePath + \"/icons/eye_crossed.svg\");\n\t\t\t}\n\t\t});\n\t}\n\t\n\tonclick(event){\n\t\tlet annotation = event.annotation;\n\t\t\n\t\tannotation.visible = !annotation.visible;\n\t\t\n\t\tif(annotation.visible){\n\t\t\tthis.setIcon(Potree.resourcePath + \"/icons/eye.svg\");\n\t\t}else{\n\t\t\tthis.setIcon(Potree.resourcePath + \"/icons/eye_crossed.svg\");\n\t\t}\n\t}\n}\n\n\n\n\n\nPotree.ProfileData = class ProfileData{\n\t\n\tconstructor(profile){\n\t\tthis.profile = profile;\n\t\t\n\t\tthis.segments = [];\n\t\tthis.boundingBox = new THREE.Box3();\n\t\t\n\t\tfor(let i = 0; i < profile.points.length - 1; i++){\n\t\t\tlet start = profile.points[i];\n\t\t\tlet end = profile.points[i+1];\n\t\t\t\n\t\t\tlet startGround = new THREE.Vector3(start.x, start.y, 0);\n\t\t\tlet endGround = new THREE.Vector3(end.x, end.y, 0);\n\t\t\t\n\t\t\tlet center = new THREE.Vector3().addVectors(endGround, startGround).multiplyScalar(0.5);\n\t\t\tlet length = startGround.distanceTo(endGround);\n\t\t\tlet side = new THREE.Vector3().subVectors(endGround, startGround).normalize();\n\t\t\tlet up = new THREE.Vector3(0, 0, 1);\n\t\t\tlet forward = new THREE.Vector3().crossVectors(side, up).normalize();\n\t\t\tlet N = forward;\n\t\t\tlet cutPlane = new THREE.Plane().setFromNormalAndCoplanarPoint(N, startGround);\n\t\t\tlet halfPlane = new THREE.Plane().setFromNormalAndCoplanarPoint(side, center);\n\t\t\t\n\t\t\tlet segment = {\n\t\t\t\tstart: start,\n\t\t\t\tend: end,\n\t\t\t\tcutPlane: cutPlane,\n\t\t\t\thalfPlane: halfPlane,\n\t\t\t\tlength: length,\n\t\t\t\tpoints: new Potree.Points()\n\t\t\t};\n\t\t\t\n\t\t\tthis.segments.push(segment);\n\t\t}\n\t}\n\t\n\tsize(){\n\t\t\n\t\tlet size = 0;\n\t\tfor(let segment of this.segments){\n\t\t\tsize += segment.points.numPoints;\n\t\t}\n\t\t\n\t\treturn size;\n\t}\n\t\n};\n\nPotree.ProfileRequest = class ProfileRequest{\n\t\n\tconstructor(pointcloud, profile, maxDepth, callback){\n\t\tthis.pointcloud = pointcloud;\n\t\tthis.profile = profile;\n\t\tthis.maxDepth = maxDepth || Number.MAX_VALUE;\n\t\tthis.callback = callback;\n\t\tthis.temporaryResult = new Potree.ProfileData(this.profile);\n\t\tthis.pointsServed = 0;\n\t\tthis.highestLevelServed = 0;\n\n\t\tthis.priorityQueue = new BinaryHeap(function(x){return 1 / x.weight;});\n\t\t\n\t\tthis.initialize();\n\t}\n\n\tinitialize(){\n\t\tthis.priorityQueue.push({node: this.pointcloud.pcoGeometry.root, weight: 1});\n\t\tthis.traverse(this.pointcloud.pcoGeometry.root);\n\t};\n\t\n\t// traverse the node and add intersecting descendants to queue\n\ttraverse(node){\n\t\t\n\t\tlet stack = [];\n\t\tfor(let i = 0; i < 8; i++){\n\t\t\tlet child = node.children[i];\n\t\t\tif(child && this.pointcloud.nodeIntersectsProfile(child, this.profile)){\n\t\t\t\tstack.push(child);\n\t\t\t}\n\t\t}\n\t\t\n\t\twhile(stack.length > 0){\n\t\t\tlet node = stack.pop();\n\t\t\tlet weight = node.boundingSphere.radius;\n\t\t\t\n\t\t\tthis.priorityQueue.push({node: node, weight: weight});\n\t\t\n\t\t\t// add children that intersect the cutting plane\n\t\t\tif(node.level < this.maxDepth){\n\t\t\t\tfor(let i = 0; i < 8; i++){\n\t\t\t\t\tlet child = node.children[i];\n\t\t\t\t\tif(child && this.pointcloud.nodeIntersectsProfile(child, this.profile)){\n\t\t\t\t\t\tstack.push(child);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t\n\tupdate(){\n\t\t\n\t\t// load nodes in queue\n\t\t// if hierarchy expands, also load nodes from expanded hierarchy\n\t\t// once loaded, add data to this.points and remove node from queue\n\t\t// only evaluate 1-50 nodes per frame to maintain responsiveness\n\t\t\n\t\tlet maxNodesPerUpdate = 1;\n\t\tlet intersectedNodes = [];\n\t\t\n\t\tfor(let i = 0; i < Math.min(maxNodesPerUpdate, this.priorityQueue.size()); i++){\n\t\t\tlet element = this.priorityQueue.pop();\n\t\t\tlet node = element.node;\n\t\t\t\n\t\t\t\n\t\t\tif(node.loaded){\n\t\t\t\t// add points to result\n\t\t\t\tintersectedNodes.push(node);\n\t\t\t\tPotree.getLRU().touch(node);\n\t\t\t\tthis.highestLevelServed = node.getLevel();\n\t\t\t\t\n\t\t\t\tif((node.level % node.pcoGeometry.hierarchyStepSize) === 0 && node.hasChildren){\n\t\t\t\t\tthis.traverse(node);\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\tnode.load();\n\t\t\t\tthis.priorityQueue.push(element);\n\t\t\t}\n\t\t}\n\t\t\n\t\tif(intersectedNodes.length > 0){\n\t\t\tthis.getPointsInsideProfile(intersectedNodes, this.temporaryResult);\n\t\t\tif(this.temporaryResult.size() > 100){\n\t\t\t\tthis.pointsServed += this.temporaryResult.size();\n\t\t\t\tthis.callback.onProgress({request: this, points: this.temporaryResult});\n\t\t\t\tthis.temporaryResult = new Potree.ProfileData(this.profile);\n\t\t\t}\n\t\t}\n\t\t\n\t\tif(this.priorityQueue.size() === 0){\n\t\t\t// we're done! inform callback and remove from pending requests\n\n\t\t\tif(this.temporaryResult.size() > 0){\n\t\t\t\tthis.pointsServed += this.temporaryResult.size();\n\t\t\t\tthis.callback.onProgress({request: this, points: this.temporaryResult});\n\t\t\t\tthis.temporaryResult = new Potree.ProfileData(this.profile);\n\t\t\t}\n\t\t\t\n\t\t\tthis.callback.onFinish({request: this});\n\t\t\t\n\t\t\tlet index = this.pointcloud.profileRequests.indexOf(this);\n\t\t\tif(index >= 0){\n\t\t\t\tthis.pointcloud.profileRequests.splice(index, 1);\n\t\t\t}\n\t\t}\n\t};\n\t\n\tgetPointsInsideProfile(nodes, target){\n\t\n\t\tlet totalMileage = 0;\n\t\t\n\t\t\n\t\tfor(let segment of target.segments){\n\t\t\t\n\t\t\tfor(let node of nodes){\n\t\t\t\tlet geometry = node.geometry;\n\t\t\t\tlet positions = geometry.attributes.position;\n\t\t\t\tlet p = positions.array;\n\t\t\t\tlet numPoints = node.numPoints;\n\t\t\t\t\n\t\t\t\tlet sv = new THREE.Vector3().subVectors(segment.end, segment.start).setZ(0);\n\t\t\t\tlet segmentDir = sv.clone().normalize();\n\t\t\t\t\n\t\t\t\tlet accepted = [];\n\t\t\t\tlet mileage = [];\n\t\t\t\tlet acceptedPositions = [];\n\t\t\t\tlet points = new Potree.Points();\n\t\t\t\t\n\t\t\t\tlet nodeMatrix = new THREE.Matrix4().makeTranslation(...node.boundingBox.min.toArray());\n\t\t\t\t\n\t\t\t\tlet matrix = new THREE.Matrix4().multiplyMatrices(\n\t\t\t\t\tthis.pointcloud.matrixWorld, nodeMatrix);\n\t\t\t\t\n\t\t\t\tfor(let i = 0; i < numPoints; i++){\n\t\t\t\t\tlet pos = new THREE.Vector3(p[3*i], p[3*i+1], p[3*i+2]);\n\t\t\t\t\tpos.applyMatrix4(matrix);\n\t\t\t\t\tlet distance = Math.abs(segment.cutPlane.distanceToPoint(pos));\n\t\t\t\t\tlet centerDistance = Math.abs(segment.halfPlane.distanceToPoint(pos));\n\t\t\t\t\t\n\t\t\t\t\tif(distance < this.profile.width / 2 && centerDistance < segment.length / 2){\n\t\t\t\t\t\t\n\t\t\t\t\t\tlet svp = new THREE.Vector3().subVectors(pos, segment.start);\n\t\t\t\t\t\tlet localMileage = segmentDir.dot(svp);\n\t\t\t\t\t\t\n\t\t\t\t\t\taccepted.push(i);\n\t\t\t\t\t\tmileage.push(localMileage + totalMileage);\n\t\t\t\t\t\tpoints.boundingBox.expandByPoint(pos);\n\t\t\t\t\t\t\n\t\t\t\t\t\tacceptedPositions.push(pos.x);\n\t\t\t\t\t\tacceptedPositions.push(pos.y);\n\t\t\t\t\t\tacceptedPositions.push(pos.z);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tfor(let attribute of Object.keys(geometry.attributes).filter(a => a !== \"indices\")) {\n\n\t\t\t\t\tlet bufferedAttribute = geometry.attributes[attribute];\n\t\t\t\t\tlet type = bufferedAttribute.array.constructor;\n\t\t\t\t\t\n\t\t\t\t\tlet filteredBuffer = null;\n\t\t\t\t\t\n\t\t\t\t\tif(attribute === \"position\"){\n\t\t\t\t\t\tfilteredBuffer = new type(acceptedPositions);\n\t\t\t\t\t}else{\n\t\t\t\t\t\tfilteredBuffer = new type(accepted.length * bufferedAttribute.itemSize);\n\t\t\t\t\t\n\t\t\t\t\t\tfor(let i = 0; i < accepted.length; i++){\n\t\t\t\t\t\t\tlet index = accepted[i];\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tfilteredBuffer.set(\n\t\t\t\t\t\t\t\tbufferedAttribute.array.subarray(\n\t\t\t\t\t\t\t\t\tbufferedAttribute.itemSize * index, \n\t\t\t\t\t\t\t\t\tbufferedAttribute.itemSize * index + bufferedAttribute.itemSize),\n\t\t\t\t\t\t\t\tbufferedAttribute.itemSize * i)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tpoints.data[attribute] = filteredBuffer;\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tpoints.data[\"mileage\"] = new Float64Array(mileage);\n\t\t\t\tpoints.numPoints = accepted.length;\n\t\t\t\t\n\t\t\t\tsegment.points.add(points);\n\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\ttotalMileage += segment.length;\n\t\t}\n\t\n\t\tfor(let segment of target.segments){\n\t\t\ttarget.boundingBox.union(segment.points.boundingBox);\n\t\t}\n\t\t\n\t\t\n\t\t\n\t};\n\t\n\tfinishLevelThenCancel(){\n\t\tif(this.cancelRequested){\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tthis.maxDepth = this.highestLevelServed + 1;\n\t\tthis.cancelRequested = true;\n\t\t\n\t\tconsole.log(`maxDepth: ${this.maxDepth}`);\n\t};\n\t\n\tcancel(){\n\t\tthis.callback.onCancel();\n\t\t\n\t\tthis.priorityQueue = new BinaryHeap(function(x){return 1 / x.weight;});\n\t\t\n\t\tlet index = this.pointcloud.profileRequests.indexOf(this);\n\t\tif(index >= 0){\n\t\t\tthis.pointcloud.profileRequests.splice(index, 1);\n\t\t}\n\t};\n\t\n};\n\n\nPotree.PointCloudOctreeNode = class PointCloudOctreeNode extends Potree.PointCloudTreeNode{\n\t\n\tconstructor(){\n\t\tsuper();\n\t\t\n\t\tthis.children = {};\n\t\tthis.sceneNode = null;\n\t\tthis.octree = null;\n\t}\n\t\n\tgetNumPoints(){\n\t\treturn this.geometryNode.numPoints;\n\t};\n\t\n\tisLoaded(){\n\t\treturn true;\n\t};\n\t\n\tisTreeNode(){\n\t\treturn true;\n\t};\n\t\n\tisGeometryNode(){\n\t\treturn false;\n\t};\n\t\n\tgetLevel(){\n\t\treturn this.geometryNode.level;\n\t};\n\t\n\tgetBoundingSphere(){\n\t\treturn this.geometryNode.boundingSphere;\n\t};\n\t\n\tgetBoundingBox(){\n\t\treturn this.geometryNode.boundingBox;\n\t};\n\t\n\tgetChildren(){\n\t\tlet children = [];\n\t\t\n\t\tfor(let i = 0; i < 8; i++){\n\t\t\tif(this.children[i]){\n\t\t\t\tchildren.push(this.children[i]);\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn children;\n\t};\n\t\n\tget name(){\n\t\treturn this.geometryNode.name;\n\t}\n};\n\n\nPotree.PointCloudOctree = class extends Potree.PointCloudTree{\n\t\n\tconstructor(geometry, material){\n\t\tsuper();\n\t\t\n\t\tthis.pcoGeometry = geometry;\n\t\tthis.boundingBox = this.pcoGeometry.boundingBox;\n\t\tthis.boundingSphere = this.boundingBox.getBoundingSphere();\n\t\tthis.material = material || new Potree.PointCloudMaterial();\n\t\tthis.visiblePointsTarget = 2*1000*1000;\n\t\tthis.minimumNodePixelSize = 150;\n\t\tthis.level = 0;\n\t\tthis.position.copy(geometry.offset);\n\t\tthis.updateMatrix();\n\t\t\n\t\tthis.showBoundingBox = false;\n\t\tthis.boundingBoxNodes = [];\n\t\tthis.loadQueue = [];\n\t\tthis.visibleBounds = new THREE.Box3();\t\n\t\tthis.visibleNodes = [];\n\t\tthis.visibleGeometry = [];\n\t\tthis.generateDEM = false;\n\t\tthis.profileRequests = [];\n\t\tthis.name = \"\";\n\t\t\n\t\t{\n\t\t\tlet box = [this.pcoGeometry.tightBoundingBox, this.getBoundingBoxWorld()]\n\t\t\t\t.find(v => v !== undefined);\n\t\t\t\t\n\t\t\tthis.updateMatrixWorld(true);\n\t\t\tbox = Potree.utils.computeTransformedBoundingBox(box, this.matrixWorld);\n\t\t\t\n\t\t\tlet bWidth = box.max.z - box.min.z;\n\t\t\tlet bMin = box.min.z - 0.2 * bWidth;\n\t\t\tlet bMax = box.max.z + 0.2 * bWidth;\n\t\t\tthis.material.heightMin = bMin;\n\t\t\tthis.material.heightMax = bMax;\n\t\t}\n\t\t\n\t\t// TODO read projection from file instead\n\t\tthis.projection = geometry.projection;\n\t\t\n\t\tthis.root = this.pcoGeometry.root;\n\t}\n\t\n\t\n\tsetName(name){\n\t\tif(this.name !== name){\n\t\t\tthis.name = name;\n\t\t\tthis.dispatchEvent({type: \"name_changed\", name: name, pointcloud: this});\n\t\t}\n\t}\n\t\n\tgetName(){\n\t\treturn name;\n\t}\n\t\n\ttoTreeNode(geometryNode, parent){\n\t\tlet node = new Potree.PointCloudOctreeNode();\n\t\t\n\t\t//if(geometryNode.name === \"r40206\"){\n\t\t//\tconsole.log(\"creating node for r40206\");\n\t\t//}\n\t\tlet sceneNode = new THREE.Points(geometryNode.geometry, this.material);\n\t\tsceneNode.name = geometryNode.name;\n\t\tsceneNode.position.copy(geometryNode.boundingBox.min);\n\t\tsceneNode.frustumCulled = false;\n\t\tsceneNode.onBeforeRender = (_this, scene, camera, geometry, material, group) => {\n\t\t\t\n\t\t\tif(material.program){\n\t\t\t\t_this.getContext().useProgram(material.program.program);\n\t\t\t\t\n\t\t\t\tif(material.program.getUniforms().map.level){\n\t\t\t\t\tlet level = geometryNode.getLevel();\n\t\t\t\t\tmaterial.uniforms.level.value = level;\n\t\t\t\t\tmaterial.program.getUniforms().map.level.setValue(_this.getContext(), level);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif(this.visibleNodeTextureOffsets && material.program.getUniforms().map.vnStart){\n\t\t\t\t\tlet vnStart = this.visibleNodeTextureOffsets.get(node);\n\t\t\t\t\tmaterial.uniforms.vnStart.value = vnStart;\n\t\t\t\t\tmaterial.program.getUniforms().map.vnStart.setValue(_this.getContext(), vnStart);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif(material.program.getUniforms().map.pcIndex){\n\t\t\t\t\tlet i = node.pcIndex ? node.pcIndex : this.visibleNodes.indexOf(node);\n\t\t\t\t\tmaterial.uniforms.pcIndex.value = i;\n\t\t\t\t\tmaterial.program.getUniforms().map.pcIndex.setValue(_this.getContext(), i);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\t\n\t\t//{ // DEBUG\n\t\t//\tlet sg = new THREE.SphereGeometry(1, 16, 16);\n\t\t//\tlet sm = new THREE.MeshNormalMaterial();\n\t\t//\tlet s = new THREE.Mesh(sg, sm);\n\t\t//\ts.scale.set(5, 5, 5);\n\t\t//\ts.position.copy(geometryNode.mean)\n\t\t//\t\t.add(this.position)\n\t\t//\t\t.add(geometryNode.boundingBox.min);\n\t\t//\t\n\t\t//\tviewer.scene.scene.add(s);\n\t\t//}\n\t\t\n\t\tnode.geometryNode = geometryNode;\n\t\tnode.sceneNode = sceneNode;\n\t\tnode.pointcloud = this;\n\t\tnode.children = {};\n\t\tfor(let key in geometryNode.children){\n\t\t\tnode.children[key] = geometryNode.children[key];\n\t\t}\n\t\t\n\t\tif(!parent){\n\t\t\tthis.root = node;\n\t\t\tthis.add(sceneNode);\n\t\t}else{\n\t\t\tlet childIndex = parseInt(geometryNode.name[geometryNode.name.length - 1]);\n\t\t\tparent.sceneNode.add(sceneNode);\n\t\t\tparent.children[childIndex] = node;\n\t\t}\n\t\t\n\t\tlet disposeListener = function(){\n\t\t\tlet childIndex = parseInt(geometryNode.name[geometryNode.name.length - 1]);\n\t\t\tparent.sceneNode.remove(node.sceneNode);\n\t\t\tparent.children[childIndex] = geometryNode;\n\t\t}\n\t\tgeometryNode.oneTimeDisposeHandlers.push(disposeListener);\n\t\t\n\t\treturn node;\n\t}\n\t\n\tupdateVisibleBounds(){\n\t\tlet leafNodes = [];\n\t\tfor(let i = 0; i < this.visibleNodes.length; i++){\n\t\t\tlet node = this.visibleNodes[i];\n\t\t\tlet isLeaf = true;\n\t\t\t\n\t\t\tfor(let j = 0; j < node.children.length; j++){\n\t\t\t\tlet child = node.children[j];\n\t\t\t\tif(child instanceof Potree.PointCloudOctreeNode){\n\t\t\t\t\tisLeaf = isLeaf && !child.sceneNode.visible;\n\t\t\t\t}else if(child instanceof Potree.PointCloudOctreeGeometryNode){\n\t\t\t\t\tisLeaf = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif(isLeaf){\n\t\t\t\tleafNodes.push(node);\n\t\t\t}\n\t\t}\n\t\t\n\t\tthis.visibleBounds.min = new THREE.Vector3( Infinity, Infinity, Infinity );\n\t\tthis.visibleBounds.max = new THREE.Vector3( - Infinity, - Infinity, - Infinity );\n\t\tfor(let i = 0; i < leafNodes.length; i++){\n\t\t\tlet node = leafNodes[i];\n\t\t\t\n\t\t\tthis.visibleBounds.expandByPoint(node.getBoundingBox().min);\n\t\t\tthis.visibleBounds.expandByPoint(node.getBoundingBox().max);\n\t\t}\n\t}\n\t\n\tupdateMaterial(material, visibleNodes, camera, renderer){\n\t\tmaterial.fov = camera.fov * (Math.PI / 180);\n\t\tmaterial.screenWidth = renderer.domElement.clientWidth;\n\t\tmaterial.screenHeight = renderer.domElement.clientHeight;\n\t\tmaterial.spacing = this.pcoGeometry.spacing * Math.max(this.scale.x, this.scale.y, this.scale.z);\n\t\tmaterial.near = camera.near;\n\t\tmaterial.far = camera.far;\n\t\tmaterial.uniforms.octreeSize.value = this.pcoGeometry.boundingBox.getSize().x;\n\t\t\n\t\t// update visibility texture\n\t\tif(material.pointSizeType >= 0){\n\t\t\tif(material.pointSizeType === Potree.PointSizeType.ADAPTIVE \n\t\t\t\t|| material.pointColorType === Potree.PointColorType.LOD){\n\t\t\t\t\n\t\t\t\tthis.updateVisibilityTexture(material, visibleNodes);\n\t\t\t}\n\t\t}\n\t}\n\t\n\tupdateVisibilityTexture(material, visibleNodes){\n\t\tif(!material){\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tlet texture = material.visibleNodesTexture;\n\t\tlet data = texture.image.data;\n\t\tdata.fill(0);\n\t\t\n\t\tthis.visibleNodeTextureOffsets = new Map();\n\t\t\n\t\t// copy array\n\t\tvisibleNodes = visibleNodes.slice();\n\t\t\n\t\t// sort by level and index, e.g. r, r0, r3, r4, r01, r07, r30, ...\n\t\tlet sort = function(a, b){\n\t\t\tlet na = a.geometryNode.name;\n\t\t\tlet nb = b.geometryNode.name;\n\t\t\tif(na.length != nb.length) return na.length - nb.length;\n\t\t\tif(na < nb) return -1;\n\t\t\tif(na > nb) return 1;\n\t\t\treturn 0;\n\t\t};\n\t\tvisibleNodes.sort(sort);\n\n\t\t\n\t\tfor(let i = 0; i < visibleNodes.length; i++){\n\t\t\tlet node = visibleNodes[i];\n\t\t\t\n\t\t\tthis.visibleNodeTextureOffsets.set(node, i);\n\t\t\t\n\t\t\tlet children = [];\n\t\t\tfor(let j = 0; j < 8; j++){\n\t\t\t\tlet child = node.children[j];\n\t\t\t\tif(child instanceof Potree.PointCloudOctreeNode && child.sceneNode.visible && visibleNodes.indexOf(child) >= 0){\n\t\t\t\t\tchildren.push(child);\n\t\t\t\t}\n\t\t\t}\n\t\t\tchildren.sort(function(a, b){\n\t\t\t\tif(a.geometryNode.name < b.geometryNode.name) return -1;\n\t\t\t\tif(a.geometryNode.name > b.geometryNode.name) return 1;\n\t\t\t\treturn 0;\n\t\t\t});\n\t\t\t\n\t\t\tdata[i*3 + 0] = 0;\n\t\t\tdata[i*3 + 1] = 0;\n\t\t\tdata[i*3 + 2] = 0;\n\t\t\tfor(let j = 0; j < children.length; j++){\n\t\t\t\tlet child = children[j];\n\t\t\t\tlet index = parseInt(child.geometryNode.name.substr(-1));\n\t\t\t\tdata[i*3 + 0] += Math.pow(2, index);\n\t\t\t\t\n\t\t\t\tif(j === 0){\n\t\t\t\t\tlet vArrayIndex = visibleNodes.indexOf(child);\n\t\t\t\t\tdata[i*3 + 1] = (vArrayIndex - i) >> 8;\n\t\t\t\t\tdata[i*3 + 2] = (vArrayIndex - i) % 256;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}\n\t\t}\n\t\t\n\t\t\n\t\ttexture.needsUpdate = true;\n\t}\n\t\n\tnodeIntersectsProfile(node, profile){\n\t\tlet bbWorld = node.boundingBox.clone().applyMatrix4(this.matrixWorld);\n\t\tlet bsWorld = bbWorld.getBoundingSphere();\n\t\t\n\t\tfor(let i = 0; i < profile.points.length - 1; i++){\n\t\t\tlet start = new THREE.Vector3(profile.points[i].x, bsWorld.center.y, profile.points[i].z);\n\t\t\tlet end = new THREE.Vector3(profile.points[i+1].x, bsWorld.center.y, profile.points[i+1].z);\n\t\t\t\n\t\t\tlet ray1 = new THREE.Ray(start, new THREE.Vector3().subVectors(end, start).normalize());\n\t\t\tlet ray2 = new THREE.Ray(end, new THREE.Vector3().subVectors(start, end).normalize());\n\t\t\t\n\t\t\tif(ray1.intersectsSphere(bsWorld) && ray2.intersectsSphere(bsWorld)){\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn false;\n\t}\n\t\n\tnodesOnRay(nodes, ray){\n\t\tlet nodesOnRay = [];\n\n\t\tlet _ray = ray.clone();\n\t\tfor(let i = 0; i < nodes.length; i++){\n\t\t\tlet node = nodes[i];\n\t\t\t//var inverseWorld = new THREE.Matrix4().getInverse(node.matrixWorld);\n\t\t\t//let sphere = node.getBoundingSphere().clone().applyMatrix4(node.sceneNode.matrixWorld);\n\t\t\tlet sphere = node.getBoundingSphere().clone().applyMatrix4(this.matrixWorld);\n\t\t\t\n\t\t\tif(_ray.intersectsSphere(sphere)){\n\t\t\t\tnodesOnRay.push(node);\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn nodesOnRay;\n\t}\n\t\n\tupdateMatrixWorld( force ){\n\t\tif ( this.matrixAutoUpdate === true ) this.updateMatrix();\n\n\t\tif ( this.matrixWorldNeedsUpdate === true || force === true ) {\n\n\t\t\tif ( !this.parent ) {\n\n\t\t\t\tthis.matrixWorld.copy( this.matrix );\n\n\t\t\t} else {\n\n\t\t\t\tthis.matrixWorld.multiplyMatrices( this.parent.matrixWorld, this.matrix );\n\n\t\t\t}\n\n\t\t\tthis.matrixWorldNeedsUpdate = false;\n\n\t\t\tforce = true;\n\n\t\t}\n\t}\n\t\n\thideDescendants(object){\n\t\tlet stack = [];\n\t\tfor(let i = 0; i < object.children.length; i++){\n\t\t\tlet child = object.children[i];\n\t\t\tif(child.visible){\n\t\t\t\tstack.push(child);\n\t\t\t}\n\t\t}\n\t\t\n\t\twhile(stack.length > 0){\n\t\t\tlet object = stack.shift();\n\t\t\t\n\t\t\tobject.visible = false;\n\t\t\t\n\t\t\tfor(let i = 0; i < object.children.length; i++){\n\t\t\t\tlet child = object.children[i];\n\t\t\t\tif(child.visible){\n\t\t\t\t\tstack.push(child);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t\n\tmoveToOrigin(){\n\t\tthis.position.set(0,0,0);\n\t\tthis.updateMatrixWorld(true);\n\t\tlet box = this.boundingBox;\n\t\tlet transform = this.matrixWorld;\n\t\tlet tBox = Potree.utils.computeTransformedBoundingBox(box, transform);\n\t\tthis.position.set(0,0,0).sub(tBox.getCenter());\n\t};\n\n\tmoveToGroundPlane(){\n\t\tthis.updateMatrixWorld(true);\n\t\tlet box = this.boundingBox;\n\t\tlet transform = this.matrixWorld;\n\t\tlet tBox = Potree.utils.computeTransformedBoundingBox(box, transform);\n\t\tthis.position.y += -tBox.min.y;\n\t};\n\n\tgetBoundingBoxWorld(){\n\t\tthis.updateMatrixWorld(true);\n\t\tlet box = this.boundingBox;\n\t\tlet transform = this.matrixWorld;\n\t\tlet tBox = Potree.utils.computeTransformedBoundingBox(box, transform);\n\t\t\n\t\treturn tBox;\n\t};\n\t\n\t/**\n\t * returns points inside the profile points\n\t *\n\t * maxDepth:\t\tsearch points up to the given octree depth\n\t *\n\t *\n\t * The return value is an array with all segments of the profile path\n\t *  var segment = {\n\t * \t\tstart: \tTHREE.Vector3,\n\t * \t\tend: \tTHREE.Vector3,\n\t * \t\tpoints: {}\n\t * \t\tproject: function()\n\t *  };\n\t *\n\t * The project() function inside each segment can be used to transform\n\t * that segments point coordinates to line up along the x-axis.\n\t *\n\t *\n\t */\n\tgetPointsInProfile(profile, maxDepth, callback){\n\n\t\tif(callback){\n\t\t\tlet request = new Potree.ProfileRequest(this, profile, maxDepth, callback);\n\t\t\tthis.profileRequests.push(request);\n\t\t\t\n\t\t\treturn request;\n\t\t}\n\n\t\tlet points = {\n\t\t\tsegments: [],\n\t\t\tboundingBox: new THREE.Box3(),\n\t\t\tprojectedBoundingBox: new THREE.Box2()\n\t\t};\n\t\t\n\t\t// evaluate segments\n\t\tfor(let i = 0; i < profile.points.length - 1; i++){\n\t\t\tlet start = profile.points[i];\n\t\t\tlet end = profile.points[i+1];\n\t\t\tlet ps = this.getProfile(start, end, profile.width, maxDepth);\n\t\t\t\n\t\t\tlet segment = {\n\t\t\t\tstart: start,\n\t\t\t\tend: end,\n\t\t\t\tpoints: ps,\n\t\t\t\tproject: null\n\t\t\t};\n\t\t\t\n\t\t\tpoints.segments.push(segment);\n\t\t\t\n\t\t\tpoints.boundingBox.expandByPoint(ps.boundingBox.min);\n\t\t\tpoints.boundingBox.expandByPoint(ps.boundingBox.max);\n\t\t}\n\t\t\n\t\t// add projection functions to the segments\n\t\tlet mileage = new THREE.Vector3();\n\t\tfor(let i = 0; i < points.segments.length; i++){\n\t\t\tlet segment = points.segments[i];\n\t\t\tlet start = segment.start;\n\t\t\tlet end = segment.end;\n\t\t\t\n\t\t\tlet project = function(_start, _end, _mileage, _boundingBox){\n\t\t\t\tlet start = _start;\n\t\t\t\tlet end = _end;\n\t\t\t\tlet mileage = _mileage;\n\t\t\t\tlet boundingBox = _boundingBox;\n\t\t\t\t\n\t\t\t\tlet xAxis = new THREE.Vector3(1,0,0);\n\t\t\t\tlet dir = new THREE.Vector3().subVectors(end, start);\n\t\t\t\tdir.y = 0;\n\t\t\t\tdir.normalize();\n\t\t\t\tlet alpha = Math.acos(xAxis.dot(dir));\n\t\t\t\tif(dir.z > 0){\n\t\t\t\t\talpha = -alpha;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\n\t\t\t\treturn function(position){\n\t\t\t\t\t\t\t\n\t\t\t\t\tlet toOrigin = new THREE.Matrix4().makeTranslation(-start.x, -boundingBox.min.y, -start.z);\n\t\t\t\t\tlet alignWithX = new THREE.Matrix4().makeRotationY(-alpha);\n\t\t\t\t\tlet applyMileage = new THREE.Matrix4().makeTranslation(mileage.x, 0, 0);\n\n\t\t\t\t\tlet pos = position.clone();\n\t\t\t\t\tpos.applyMatrix4(toOrigin);\n\t\t\t\t\tpos.applyMatrix4(alignWithX);\n\t\t\t\t\tpos.applyMatrix4(applyMileage);\n\t\t\t\t\t\n\t\t\t\t\treturn pos;\n\t\t\t\t};\n\t\t\t\t\n\t\t\t}(start, end, mileage.clone(), points.boundingBox.clone());\n\t\t\t\n\t\t\tsegment.project = project;\n\t\t\t\n\t\t\tmileage.x += new THREE.Vector3(start.x, 0, start.z).distanceTo(new THREE.Vector3(end.x, 0, end.z));\n\t\t\tmileage.y += end.y - start.y;\n\t\t}\n\t\t\n\t\tpoints.projectedBoundingBox.min.x = 0;\n\t\tpoints.projectedBoundingBox.min.y = points.boundingBox.min.y;\n\t\tpoints.projectedBoundingBox.max.x = mileage.x;\n\t\tpoints.projectedBoundingBox.max.y = points.boundingBox.max.y;\n\t\t\n\t\treturn points;\n\t}\n\t\n\t/**\n\t * returns points inside the given profile bounds.\n\t *\n\t * start: \t\n\t * end: \t\n\t * width:\t\n\t * depth:\t\tsearch points up to the given octree depth\n\t * callback:\tif specified, points are loaded before searching\n\t *\t\t\t\t\n\t *\n\t */\n\tgetProfile(start, end, width, depth, callback){\n\t\tif(callback !== undefined){\n\t\t\tlet request = new Potree.ProfileRequest(start, end, width, depth, callback);\n\t\t\tthis.profileRequests.push(request);\n\t\t}else{\n\t\t\tlet stack = [];\n\t\t\tstack.push(this);\n\t\t\t\n\t\t\tlet center = new THREE.Vector3().addVectors(end, start).multiplyScalar(0.5);\n\t\t\tlet length = new THREE.Vector3().subVectors(end, start).length();\n\t\t\tlet side = new THREE.Vector3().subVectors(end, start).normalize();\n\t\t\tlet up = new THREE.Vector3(0, 1, 0);\n\t\t\tlet forward = new THREE.Vector3().crossVectors(side, up).normalize();\n\t\t\tlet N = forward;\n\t\t\tlet cutPlane = new THREE.Plane().setFromNormalAndCoplanarPoint(N, start);\n\t\t\tlet halfPlane = new THREE.Plane().setFromNormalAndCoplanarPoint(side, center);\n\t\t\t\n\t\t\tlet inside = null;\n\t\t\t\n\t\t\tlet boundingBox = new THREE.Box3();\n\t\t\t\n\t\t\t\n\t\t\twhile(stack.length > 0){\n\t\t\t\tlet object = stack.shift();\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tlet pointsFound = 0;\n\t\t\t\t\n\t\t\t\tif(object instanceof THREE.Points){\n\t\t\t\t\tlet geometry = object.geometry;\n\t\t\t\t\tlet positions = geometry.attributes.position;\n\t\t\t\t\tlet p = positions.array;\n\t\t\t\t\tlet numPoints = object.numPoints;\n\t\t\t\t\t\n\t\t\t\t\tif(!inside){\n\t\t\t\t\t\tinside = {};\n\t\t\t\t\t\t\n\t\t\t\t\t\tfor (let property in geometry.attributes) {\n\t\t\t\t\t\t\tif (geometry.attributes.hasOwnProperty(property)) {\n\t\t\t\t\t\t\t\tif(property === \"indices\"){\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\t\tinside[property] = [];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tfor(let i = 0; i < numPoints; i++){\n\t\t\t\t\t\tlet pos = new THREE.Vector3(p[3*i], p[3*i+1], p[3*i+2]);\n\t\t\t\t\t\tpos.applyMatrix4(this.matrixWorld);\n\t\t\t\t\t\tlet distance = Math.abs(cutPlane.distanceToPoint(pos));\n\t\t\t\t\t\tlet centerDistance = Math.abs(halfPlane.distanceToPoint(pos));\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(distance < width / 2 && centerDistance < length / 2){\n\t\t\t\t\t\t\tboundingBox.expandByPoint(pos);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tfor (let property in geometry.attributes) {\n\t\t\t\t\t\t\t\tif (geometry.attributes.hasOwnProperty(property)) {\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tif(property === \"position\"){\n\t\t\t\t\t\t\t\t\t\tinside[property].push(pos);\n\t\t\t\t\t\t\t\t\t}else if(property === \"indices\"){\n\t\t\t\t\t\t\t\t\t\t// skip indices\n\t\t\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\t\t\tlet values = geometry.attributes[property];\n\t\t\t\t\t\t\t\t\t\tif(values.itemSize === 1){\n\t\t\t\t\t\t\t\t\t\t\tinside[property].push(values.array[i + j]);\n\t\t\t\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\t\t\t\tlet value = [];\n\t\t\t\t\t\t\t\t\t\t\tfor(let j = 0; j < values.itemSize; j++){\n\t\t\t\t\t\t\t\t\t\t\t\tvalue.push(values.array[i*values.itemSize + j]);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tinside[property].push(value);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tpointsFound++;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t//console.log(\"traversing: \" + object.name + \", #points found: \" + pointsFound);\n\t\t\t\t\n\t\t\t\tif(object == this || object.level < depth){\n\t\t\t\t\tfor(let i = 0; i < object.children.length; i++){\n\t\t\t\t\t\tlet child = object.children[i];\n\t\t\t\t\t\tif(child instanceof THREE.Points){\n\t\t\t\t\t\t\tlet sphere = child.boundingSphere.clone().applyMatrix4(child.matrixWorld);\n\t\t\t\t\t\t\tif(cutPlane.distanceToSphere(sphere) < sphere.radius){\n\t\t\t\t\t\t\t\tstack.push(child);\t\n\t\t\t\t\t\t\t}\t\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tinside.numPoints = inside.position.length;\n\t\t\t\n\t\t\tlet project = function(_start, _end){\n\t\t\t\tlet start = _start;\n\t\t\t\tlet end = _end;\n\t\t\t\t\n\t\t\t\tlet xAxis = new THREE.Vector3(1,0,0);\n\t\t\t\tlet dir = new THREE.Vector3().subVectors(end, start);\n\t\t\t\tdir.y = 0;\n\t\t\t\tdir.normalize();\n\t\t\t\tlet alpha = Math.acos(xAxis.dot(dir));\n\t\t\t\tif(dir.z > 0){\n\t\t\t\t\talpha = -alpha;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\n\t\t\t\treturn function(position){\n\t\t\t\t\t\t\t\n\t\t\t\t\tlet toOrigin = new THREE.Matrix4().makeTranslation(-start.x, -start.y, -start.z);\n\t\t\t\t\tlet alignWithX = new THREE.Matrix4().makeRotationY(-alpha);\n\n\t\t\t\t\tlet pos = position.clone();\n\t\t\t\t\tpos.applyMatrix4(toOrigin);\n\t\t\t\t\tpos.applyMatrix4(alignWithX);\n\t\t\t\t\t\n\t\t\t\t\treturn pos;\n\t\t\t\t};\n\t\t\t\t\n\t\t\t}(start, end);\n\t\t\t\n\t\t\tinside.project = project;\n\t\t\tinside.boundingBox = boundingBox;\n\t\t\t\n\t\t\treturn inside;\n\t\t}\n\t};\n\n\tgetVisibleExtent(){\n\t\treturn this.visibleBounds.applyMatrix4(this.matrixWorld);\n\t};\n\n\n\t/**\n\t *\n\t *\n\t *\n\t * params.pickWindowSize:\tLook for points inside a pixel window of this size.\n\t * \t\t\t\t\t\t\tUse odd values: 1, 3, 5, ...\n\t * \n\t * \n\t * TODO: only draw pixels that are actually read with readPixels(). \n\t * \n\t */\n\tpick(renderer, camera, ray, params = {}){\n\t\t\n\t\t//let start = new Date().getTime();\n\t\t\n\t\tlet pickWindowSize = params.pickWindowSize || 17;\n\t\tlet pickOutsideClipRegion = params.pickOutsideClipRegion || false;\n\t\tlet width = Math.ceil(renderer.domElement.clientWidth);\n\t\tlet height = Math.ceil(renderer.domElement.clientHeight);\n\t\t\n\t\tlet nodes = this.nodesOnRay(this.visibleNodes, ray);\n\t\t\n\t\tif(nodes.length === 0){\n\t\t\treturn null;\n\t\t}\n\t\t\n\t\tif(!this.pickState){\n\t\t\t\n\t\t\tlet scene = new THREE.Scene();\n\t\t\t\n\t\t\tlet material = new Potree.PointCloudMaterial();\n\t\t\tmaterial.pointColorType = Potree.PointColorType.POINT_INDEX;\t\n\t\t\t\n\t\t\tlet renderTarget = new THREE.WebGLRenderTarget( \n\t\t\t\t1, 1, \n\t\t\t\t{ minFilter: THREE.LinearFilter, \n\t\t\t\tmagFilter: THREE.NearestFilter, \n\t\t\t\tformat: THREE.RGBAFormat } \n\t\t\t);\n\t\t\t\n\t\t\tthis.pickState = {\n\t\t\t\trenderTarget: renderTarget,\n\t\t\t\tmaterial: material,\n\t\t\t\tscene: scene\n\t\t\t};\n\t\t};\n\t\t\n\t\tlet pickState = this.pickState;\n\t\tlet pickMaterial = pickState.material;\n\t\t\n\t\t{ // update pick material\n\t\t\tpickMaterial.pointSizeType = this.material.pointSizeType;\n\t\t\tpickMaterial.shape = this.material.shape;\n\t\t\t\n\t\t\tpickMaterial.size = this.material.size;\n\t\t\tpickMaterial.minSize = this.material.minSize;\n\t\t\tpickMaterial.maxSize = this.material.maxSize;\n\t\t\tpickMaterial.classification = this.material.classification;\n\t\t\t\n\t\t\tif(pickOutsideClipRegion){\n\t\t\t\tpickMaterial.clipMode = Potree.ClipMode.DISABLED;\n\t\t\t}else{\n\t\t\t\tpickMaterial.clipMode = this.material.clipMode;\n\t\t\t\tif(this.material.clipMode === Potree.ClipMode.CLIP_OUTSIDE){\n\t\t\t\t\tpickMaterial.setClipBoxes(this.material.clipBoxes);\n\t\t\t\t}else{\n\t\t\t\t\tpickMaterial.setClipBoxes([]);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tthis.updateMaterial(pickMaterial, nodes, camera, renderer);\n\t\t}\n\t\t\n\t\tif(pickState.renderTarget.width != width || pickState.renderTarget.height != height){\n\t\t\tpickState.renderTarget.dispose();\n\t\t\tpickState.renderTarget = new THREE.WebGLRenderTarget( \n\t\t\t\t1, 1, \n\t\t\t\t{ minFilter: THREE.LinearFilter, \n\t\t\t\tmagFilter: THREE.NearestFilter, \n\t\t\t\tformat: THREE.RGBAFormat } \n\t\t\t);\n\t\t}\n\t\tpickState.renderTarget.setSize(width, height);\n\t\trenderer.setRenderTarget( pickState.renderTarget );\n\t\t\n\t\tlet pixelPos = new THREE.Vector3()\n\t\t\t.addVectors(camera.position, ray.direction)\n\t\t\t.project(camera)\n\t\t\t.addScalar(1)\n\t\t\t.multiplyScalar(0.5);\n\t\tpixelPos.x *= width;\n\t\tpixelPos.y *= height;\n\t\t\n\t\trenderer.setScissor(\n\t\t\tparseInt(pixelPos.x - (pickWindowSize - 1) / 2), \n\t\t\tparseInt(pixelPos.y - (pickWindowSize - 1) / 2),\n\t\t\tparseInt(pickWindowSize), parseInt(pickWindowSize));\n\t\trenderer.setScissorTest(true);\n\t\t\n\t\trenderer.state.buffers.depth.setTest(pickMaterial.depthTest);\n\t\trenderer.state.buffers.depth.setMask(pickMaterial.depthWrite);\n\t\trenderer.state.setBlending(THREE.NoBlending);\n\t\t\n\t\trenderer.clearTarget( pickState.renderTarget, true, true, true );\n\t\t\n\t\t//pickState.scene.children = nodes.map(n => n.sceneNode);\n\t\t\n\t\t//let childStates = [];\n\t\tlet tempNodes = [];\n\t\tfor(let i = 0; i < nodes.length; i++){\n\t\t\tlet node = nodes[i];\n\t\t\tnode.pcIndex = i+1;\n\t\t\tlet sceneNode = node.sceneNode;\n\t\t\t\n\t\t\tlet tempNode = new THREE.Points(sceneNode.geometry, pickMaterial);\n\t\t\ttempNode.matrix = sceneNode.matrix;\n\t\t\ttempNode.matrixWorld = sceneNode.matrixWorld;\n\t\t\ttempNode.matrixAutoUpdate = false;\n\t\t\ttempNode.frustumCulled = false;\n\t\t\ttempNode.pcIndex = i+1;\n\t\t\t\n\t\t\tlet geometryNode = node.geometryNode;\n\t\t\tlet material = pickMaterial;\n\t\t\ttempNode.onBeforeRender = (_this, scene, camera, geometry, material, group) => {\n\t\t\t\t\n\t\t\t\tif(material.program){\n\t\t\t\t\t_this.getContext().useProgram(material.program.program);\n\t\t\t\t\t\n\t\t\t\t\tif(material.program.getUniforms().map.level){\n\t\t\t\t\t\tlet level = geometryNode.getLevel();\n\t\t\t\t\t\tmaterial.uniforms.level.value = level;\n\t\t\t\t\t\tmaterial.program.getUniforms().map.level.setValue(_this.getContext(), level);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif(this.visibleNodeTextureOffsets && material.program.getUniforms().map.vnStart){\n\t\t\t\t\t\tlet vnStart = this.visibleNodeTextureOffsets.get(node);\n\t\t\t\t\t\tmaterial.uniforms.vnStart.value = vnStart;\n\t\t\t\t\t\tmaterial.program.getUniforms().map.vnStart.setValue(_this.getContext(), vnStart);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif(material.program.getUniforms().map.pcIndex){\n\t\t\t\t\t\tmaterial.uniforms.pcIndex.value = node.pcIndex;\n\t\t\t\t\t\tmaterial.program.getUniforms().map.pcIndex.setValue(_this.getContext(), node.pcIndex);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t};\n\t\t\ttempNodes.push(tempNode);\n\t\t\t\n\t\t\t//for(let child of nodes[i].sceneNode.children){\n\t\t\t//\tchildStates.push({child: child, visible: child.visible});\n\t\t\t//\tchild.visible = false;\n\t\t\t//}\n\t\t}\n\t\tpickState.scene.autoUpdate = false;\n\t\tpickState.scene.children = tempNodes;\n\t\t//pickState.scene.overrideMaterial = pickMaterial;\n\t\t\n\t\trenderer.state.setBlending(THREE.NoBlending);\n\t\t\n\t\t// RENDER\n\t\trenderer.render(pickState.scene, camera, pickState.renderTarget);\n\t\t\n\t\t//for(let childState of childStates){\n\t\t//\tchildState.child = childState.visible;\n\t\t//}\n\t\t\n\t\t//pickState.scene.overrideMaterial = null;\n\t\t\n\t\t//renderer.context.readPixels(\n\t\t//\tpixelPos.x - (pickWindowSize-1) / 2, pixelPos.y - (pickWindowSize-1) / 2, \n\t\t//\tpickWindowSize, pickWindowSize, \n\t\t//\trenderer.context.RGBA, renderer.context.UNSIGNED_BYTE, pixels);\n\t\t\n\t\tlet clamp = (number, min, max) => Math.min(Math.max(min, number), max);\n\t\t\n\t\tlet x = parseInt(clamp(pixelPos.x - (pickWindowSize-1) / 2, 0, width));\n\t\tlet y = parseInt(clamp(pixelPos.y - (pickWindowSize-1) / 2, 0, height));\n\t\tlet w = parseInt(Math.min(x + pickWindowSize, width) - x);\n\t\tlet h = parseInt(Math.min(y + pickWindowSize, height) - y);\n\t\t\n\t\tlet pixelCount = w * h;\n\t\tlet buffer = new Uint8Array(4 * pixelCount);\n\t\trenderer.readRenderTargetPixels(pickState.renderTarget, \n\t\t\tx, y, w, h, \n\t\t\tbuffer);\n\t\t\n\t\trenderer.setScissorTest(false);\n\t\t\n\t\trenderer.setRenderTarget(null);\n\t\t\n\t\tlet pixels = buffer;\n\t\tlet ibuffer = new Uint32Array(buffer.buffer);\n\t\t\n\t\t// find closest hit inside pixelWindow boundaries\n\t\tlet min = Number.MAX_VALUE;\n\t\tlet hit = null;\n\t\tfor(let u = 0; u < pickWindowSize; u++){\n\t\t\tfor(let v = 0; v < pickWindowSize; v++){\n\t\t\t\tlet offset = (u + v*pickWindowSize);\n\t\t\t\tlet distance = Math.pow(u - (pickWindowSize-1) / 2, 2) + Math.pow(v - (pickWindowSize-1) / 2, 2);\n\t\t\t\t\n\t\t\t\tlet pcIndex = pixels[4*offset + 3];\n\t\t\t\tpixels[4*offset + 3] = 0;\n\t\t\t\tlet pIndex = ibuffer[offset];\n\t\t\t\t\n\t\t\t\t//if((pIndex !== 0 || pcIndex !== 0) && distance < min){\n\t\t\t\tif(pcIndex > 0 && distance < min){\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\thit = {\n\t\t\t\t\t\tpIndex: pIndex,\n\t\t\t\t\t\tpcIndex: pcIndex - 1\n\t\t\t\t\t};\n\t\t\t\t\tmin = distance;\n\t\t\t\t\t\n\t\t\t\t\t//console.log(hit);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t//console.log(pixels);\n\t\t\n\t\t//{ // open window with image\n\t\t//\tlet img = Potree.utils.pixelsArrayToImage(buffer, w, h);\n\t\t//\tlet screenshot = img.src;\n\t\t//\t\n\t\t//\tif(!this.debugDIV){\n\t\t//\t\tthis.debugDIV = $(`\n\t\t//\t\t\t<div id=\"pickDebug\" \n\t\t//\t\t\tstyle=\"position: absolute; \n\t\t//\t\t\tright: 400px; width: 300px;\n\t\t//\t\t\tbottom: 44px; width: 300px;\n\t\t//\t\t\tz-index: 1000;\n\t\t//\t\t\t\"></div>`);\n\t\t//\t\t$(document.body).append(this.debugDIV);\n\t\t//\t}\n\t\t//\t\n\t\t//\tthis.debugDIV.empty();\n\t\t//\tthis.debugDIV.append($(`<img src=\"${screenshot}\"\n\t\t//\t\tstyle=\"transform: scaleY(-1);\"/>`));\n\t\t//\t//$(this.debugWindow.document).append($(`<img src=\"${screenshot}\"/>`));\n\t\t//\t//this.debugWindow.document.write('<img src=\"'+screenshot+'\"/>');\n\t\t//}\n\t\t\n\t\t//return;\n\t\t\n\t\tlet point = null;\n\t\t\n\t\tif(hit){\n\t\t\tpoint = {};\n\t\t\t\n\t\t\tif(!nodes[hit.pcIndex]){\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\t\n\t\t\tlet pc = nodes[hit.pcIndex].sceneNode;\n\t\t\tlet attributes = pc.geometry.attributes;\n\t\t\t\n\t\t\tfor(let property in attributes) {\n\t\t\t\tif (attributes.hasOwnProperty(property)) {\n\t\t\t\t\tlet values = pc.geometry.attributes[property];\n\t\t\t\t\n\t\t\t\t\tif(property === \"position\"){\n\t\t\t\t\t\tlet positionArray = values.array;\n\t\t\t\t\t\tlet x = positionArray[3*hit.pIndex+0];\n\t\t\t\t\t\tlet y = positionArray[3*hit.pIndex+1];\n\t\t\t\t\t\tlet z = positionArray[3*hit.pIndex+2];\n\t\t\t\t\t\tlet position = new THREE.Vector3(x, y, z);\n\t\t\t\t\t\tposition.applyMatrix4(pc.matrixWorld);\n\t\t\t\t\t\n\t\t\t\t\t\tpoint[property] = position;\n\t\t\t\t\t}else if(property === \"indices\"){\n\t\t\t\t\t\n\t\t\t\t\t}else{\n\t\t\t\t\t\tif(values.itemSize === 1){\n\t\t\t\t\t\t\tpoint[property] = values.array[hit.pIndex];\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\tlet value = [];\n\t\t\t\t\t\t\tfor(let j = 0; j < values.itemSize; j++){\n\t\t\t\t\t\t\t\tvalue.push(values.array[values.itemSize*hit.pIndex + j]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tpoint[property] = value;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\t//let end = new Date().getTime();\n\t\t//let duration = end - start;\n\t\t//console.log(`pick duration: ${duration}ms`);\n\t\t\n\t\treturn point;\n\t\t\n\t\t\n\t};\n\t\n\tget progress(){\n\t\treturn this.visibleNodes.length / this.visibleGeometry.length;\n\t}\n};\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar nodesLoadTimes = {};\n\nPotree.PointCloudOctreeGeometry = function(){\n\tthis.url = null;\n\tthis.octreeDir = null;\n\tthis.spacing = 0;\n\tthis.boundingBox = null;\n\tthis.root = null;\n\tthis.numNodesLoading = 0;\n\tthis.nodes = null;\n\tthis.pointAttributes = null;\n\tthis.hierarchyStepSize = -1;\n\tthis.loader = null;\n};\n\nPotree.PointCloudOctreeGeometryNode = function(name, pcoGeometry, boundingBox){\n\tthis.id = Potree.PointCloudOctreeGeometryNode.IDCount++;\n\tthis.name = name;\n\tthis.index = parseInt(name.charAt(name.length-1));\n\tthis.pcoGeometry = pcoGeometry;\n\tthis.geometry = null;\n\tthis.boundingBox = boundingBox;\n\tthis.boundingSphere = boundingBox.getBoundingSphere();\n\tthis.children = {};\n\tthis.numPoints = 0;\n\tthis.level = null;\n\tthis.loaded = false;\n\tthis.oneTimeDisposeHandlers = [];\n};\n\nPotree.PointCloudOctreeGeometryNode.IDCount = 0;\n\nPotree.PointCloudOctreeGeometryNode.prototype = Object.create(Potree.PointCloudTreeNode.prototype);\n\nPotree.PointCloudOctreeGeometryNode.prototype.isGeometryNode = function(){\n\treturn true;\n};\n\nPotree.PointCloudOctreeGeometryNode.prototype.getLevel = function(){\n\treturn this.level;\n};\n\nPotree.PointCloudOctreeGeometryNode.prototype.isTreeNode = function(){\n\treturn false;\n};\n\nPotree.PointCloudOctreeGeometryNode.prototype.isLoaded = function(){\n\treturn this.loaded;\n};\n\nPotree.PointCloudOctreeGeometryNode.prototype.getBoundingSphere = function(){\n\treturn this.boundingSphere;\n};\n\nPotree.PointCloudOctreeGeometryNode.prototype.getBoundingBox = function(){\n\treturn this.boundingBox;\n};\n\nPotree.PointCloudOctreeGeometryNode.prototype.getChildren = function(){\n\tvar children = [];\n\t\n\tfor(var i = 0; i < 8; i++){\n\t\tif(this.children[i]){\n\t\t\tchildren.push(this.children[i]);\n\t\t}\n\t}\n\t\n\treturn children;\n};\n\nPotree.PointCloudOctreeGeometryNode.prototype.getBoundingBox = function(){\n\treturn this.boundingBox;\n};\n\nPotree.PointCloudOctreeGeometryNode.prototype.getURL = function(){\n\tvar url = \"\";\n\t\n\tvar version = this.pcoGeometry.loader.version;\n\t\n\tif(version.equalOrHigher(\"1.5\")){\n\t\turl = this.pcoGeometry.octreeDir + \"/\" + this.getHierarchyPath() + \"/\" + this.name;\n\t}else if(version.equalOrHigher(\"1.4\")){\n\t\turl = this.pcoGeometry.octreeDir + \"/\" + this.name;\n\t}else if(version.upTo(\"1.3\")){\n\t\turl = this.pcoGeometry.octreeDir + \"/\" + this.name;\n\t}\n\t\n\treturn url;\n};\n\nPotree.PointCloudOctreeGeometryNode.prototype.getHierarchyPath = function(){\n\tvar path = \"r/\";\n\n\tvar hierarchyStepSize = this.pcoGeometry.hierarchyStepSize;\n\tvar indices = this.name.substr(1);\n\t\n\tvar numParts = Math.floor(indices.length / hierarchyStepSize);\n\tfor(var i = 0; i < numParts; i++){\n\t\tpath += indices.substr(i * hierarchyStepSize, hierarchyStepSize) + \"/\";\n\t}\n\t\n\tpath = path.slice(0,-1);\n\n\treturn path;\n};\n\nPotree.PointCloudOctreeGeometryNode.prototype.addChild = function(child){\n\tthis.children[child.index] = child;\n\tchild.parent = this;\n};\n\nPotree.PointCloudOctreeGeometryNode.prototype.load = function(){\n\tif(this.loading === true || this.loaded === true ||this.pcoGeometry.numNodesLoading > 3){\n\t\treturn;\n\t}\n\t\n\tthis.loading = true;\n\t\n\tthis.pcoGeometry.numNodesLoading++;\n\t\n\t\n\tif(this.pcoGeometry.loader.version.equalOrHigher(\"1.5\")){\n\t\tif((this.level % this.pcoGeometry.hierarchyStepSize) === 0 && this.hasChildren){\n\t\t\tthis.loadHierachyThenPoints();\n\t\t}else{\n\t\t\tthis.loadPoints();\n\t\t}\n\t}else{\n\t\tthis.loadPoints();\n\t}\n\t\n\t\n};\n\nPotree.PointCloudOctreeGeometryNode.prototype.loadPoints = function(){\n\tthis.pcoGeometry.loader.load(this);\n};\n\n\nPotree.PointCloudOctreeGeometryNode.prototype.loadHierachyThenPoints = function(){\n\n\tvar node = this;\n\n\t// load hierarchy\n\tvar callback = function(node, hbuffer){\n\t\tvar count = hbuffer.byteLength / 5;\n\t\tvar view = new DataView(hbuffer);\n\t\t\n\t\tvar stack = [];\n\t\tvar children = view.getUint8(0);\n\t\tvar numPoints = view.getUint32(1, true);\n\t\tnode.numPoints = numPoints;\n\t\tstack.push({children: children, numPoints: numPoints, name: node.name});\n\t\t\n\t\tvar decoded = [];\n\t\t\n\t\tvar offset = 5;\n\t\twhile(stack.length > 0){\n\t\t\n\t\t\tvar snode = stack.shift();\n\t\t\tvar mask = 1;\n\t\t\tfor(var i = 0; i < 8; i++){\n\t\t\t\tif((snode.children & mask) !== 0){\n\t\t\t\t\tvar childIndex = i;\n\t\t\t\t\tvar childName = snode.name + i;\n\t\t\t\t\t\n\t\t\t\t\tvar childChildren = view.getUint8(offset);\n\t\t\t\t\tvar childNumPoints = view.getUint32(offset + 1, true);\n\t\t\t\t\t\n\t\t\t\t\tstack.push({children: childChildren, numPoints: childNumPoints, name: childName});\n\t\t\t\t\t\n\t\t\t\t\tdecoded.push({children: childChildren, numPoints: childNumPoints, name: childName});\n\t\t\t\t\t\n\t\t\t\t\toffset += 5;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tmask = mask * 2;\n\t\t\t}\n\t\t\t\n\t\t\tif(offset === hbuffer.byteLength){\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\t\n\t\t}\n\t\t\n\t\t//console.log(decoded);\n\t\t\n\t\tvar nodes = {};\n\t\tnodes[node.name] = node;\n\t\tvar pco = node.pcoGeometry;\n\t\t\n\t\t\n\t\tfor( var i = 0; i < decoded.length; i++){\n\t\t\tvar name = decoded[i].name;\n\t\t\tvar numPoints = decoded[i].numPoints;\n\t\t\tvar index = parseInt(name.charAt(name.length-1));\n\t\t\tvar parentName = name.substring(0, name.length-1);\n\t\t\tvar parentNode = nodes[parentName];\n\t\t\tvar level = name.length-1;\n\t\t\tvar boundingBox = Potree.POCLoader.createChildAABB(parentNode.boundingBox, index);\n\t\t\t\n\t\t\tvar currentNode = new Potree.PointCloudOctreeGeometryNode(name, pco, boundingBox);\n\t\t\tcurrentNode.level = level;\n\t\t\tcurrentNode.numPoints = numPoints;\n\t\t\tcurrentNode.hasChildren = decoded[i].children > 0;\n\t\t\tcurrentNode.spacing = pco.spacing / Math.pow(2, level);\n\t\t\tparentNode.addChild(currentNode);\n\t\t\tnodes[name] = currentNode;\n\t\t}\n\t\t\n\t\tnode.loadPoints();\n\t\t\n\t};\n\tif((node.level % node.pcoGeometry.hierarchyStepSize) === 0){\n\t\t//var hurl = node.pcoGeometry.octreeDir + \"/../hierarchy/\" + node.name + \".hrc\";\n\t\tvar hurl = node.pcoGeometry.octreeDir + \"/\" + node.getHierarchyPath() + \"/\" + node.name + \".hrc\";\n\t\t\n\t\tvar xhr = new XMLHttpRequest();\n\t\txhr.open('GET', hurl, true);\n\t\txhr.responseType = 'arraybuffer';\n\t\txhr.overrideMimeType('text/plain; charset=x-user-defined');\n\t\txhr.onreadystatechange = function() {\n\t\t\tif (xhr.readyState === 4) {\n\t\t\t\tif (xhr.status === 200 || xhr.status === 0) {\n\t\t\t\t\tvar hbuffer = xhr.response;\n\t\t\t\t\tcallback(node, hbuffer);\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log('Failed to load file! HTTP status: ' + xhr.status + \", file: \" + url);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\ttry{\n\t\t\txhr.send(null);\n\t\t}catch(e){\n\t\t\tconsole.log(\"fehler beim laden der punktwolke: \" + e);\n\t\t}\n\t}\n\n};\n\n\nPotree.PointCloudOctreeGeometryNode.prototype.getNumPoints = function(){\n\treturn this.numPoints;\n};\n\n\nPotree.PointCloudOctreeGeometryNode.prototype.dispose = function(){\n\tif(this.geometry && this.parent != null){\n\t\tthis.geometry.dispose();\n\t\tthis.geometry = null;\n\t\tthis.loaded = false;\n\t\t\n\t\t//this.dispatchEvent( { type: 'dispose' } );\n\t\tfor(var i = 0; i < this.oneTimeDisposeHandlers.length; i++){\n\t\t\tvar handler = this.oneTimeDisposeHandlers[i];\n\t\t\thandler();\n\t\t}\n\t\tthis.oneTimeDisposeHandlers = [];\n\t}\n};\n\n//THREE.EventDispatcher.prototype.apply( Potree.PointCloudOctreeGeometryNode.prototype );\nObject.assign( Potree.PointCloudOctreeGeometryNode.prototype, THREE.EventDispatcher.prototype );\nPotree.PointCloudGreyhoundGeometry = function(){\n\tthis.spacing = 0;\n\tthis.boundingBox = null;\n\tthis.root = null;\n\tthis.numNodesLoading = 0;\n\tthis.nodes = null;\n\tthis.pointAttributes = {};\n\tthis.hierarchyStepSize = -1;\n\tthis.loader = null;\n    this.schema = null;\n\n\tthis.baseDepth = null;\n\tthis.offset = null;\n\tthis.projection = null;\n\n\tthis.boundingSphere = null;\n\n\t//the serverURL will contain the base URL of the greyhound server. f.e. http://dev.greyhound.io/resource/autzen/\n\tthis.serverURL = null;\n\n    this.normalize = { color: false, intensity: false };\n};\n\nvar nodesLoadTimes = {};\nvar baseLoaded = false;\n\nPotree.PointCloudGreyhoundGeometryNode = function(\n        name, pcoGeometry, boundingBox, scale, offset) {\n\tthis.id = Potree.PointCloudGreyhoundGeometryNode.IDCount++;\n\tthis.name = name;\n\tthis.index = parseInt(name.charAt(name.length-1));\n\tthis.pcoGeometry = pcoGeometry;\n\tthis.geometry = null;\n\tthis.boundingBox = boundingBox;\n\tthis.boundingSphere = boundingBox.getBoundingSphere();\n    this.scale = scale;\n    this.offset = offset;\n\tthis.children = {};\n\tthis.numPoints = 0;\n\tthis.level = null;\n\tthis.loaded = false;\n\tthis.oneTimeDisposeHandlers = [];\n\n\tlet bounds = this.boundingBox.clone()\n\tbounds.min.sub(this.pcoGeometry.boundingBox.getCenter());\n\tbounds.max.sub(this.pcoGeometry.boundingBox.getCenter());\n\n\tif (this.scale) {\n\t\tbounds.min.multiplyScalar(1 / this.scale);\n\t\tbounds.max.multiplyScalar(1 / this.scale);\n\t}\n\n    // This represents the bounds for this node in the reference frame of the\n    // global bounds from `info`, centered around the origin, and then scaled\n    // by our selected scale.\n    this.greyhoundBounds = bounds;\n\n    // This represents the offset between the coordinate system described above\n    // and our pcoGeometry bounds.\n    this.greyhoundOffset = this.pcoGeometry.offset.clone().add(\n            this.pcoGeometry.boundingBox.getSize().multiplyScalar(0.5));\n};\n\nPotree.PointCloudGreyhoundGeometryNode.IDCount = 0;\n\nPotree.PointCloudGreyhoundGeometryNode.prototype =\n    Object.create(Potree.PointCloudTreeNode.prototype);\n\nPotree.PointCloudGreyhoundGeometryNode.prototype.isGeometryNode = function() {\n\treturn true;\n};\n\nPotree.PointCloudGreyhoundGeometryNode.prototype.isTreeNode = function() {\n\treturn false;\n};\n\nPotree.PointCloudGreyhoundGeometryNode.prototype.isLoaded = function() {\n\treturn this.loaded;\n};\n\nPotree.PointCloudGreyhoundGeometryNode.prototype.getBoundingSphere = function() {\n\treturn this.boundingSphere;\n};\n\nPotree.PointCloudGreyhoundGeometryNode.prototype.getBoundingBox = function() {\n\treturn this.boundingBox;\n};\n\nPotree.PointCloudGreyhoundGeometryNode.prototype.getLevel = function(){\n\treturn this.level;\n};\n\nPotree.PointCloudGreyhoundGeometryNode.prototype.getChildren = function() {\n\tvar children = [];\n\n\tfor (var i = 0; i < 8; ++i) {\n\t\tif (this.children[i]) {\n\t\t\tchildren.push(this.children[i]);\n\t\t}\n\t}\n\n\treturn children;\n};\n\nPotree.PointCloudGreyhoundGeometryNode.prototype.getURL = function() {\n    var schema = this.pcoGeometry.schema;\n    let bounds = this.greyhoundBounds;\n\n    var boundsString =\n        bounds.min.x + ',' + bounds.min.y + ',' + bounds.min.z + ',' +\n        bounds.max.x + ',' + bounds.max.y + ',' + bounds.max.z;\n\n    var url = ''+this.pcoGeometry.serverURL +\n        'read?depthBegin=' +\n        (baseLoaded ? (this.level + this.pcoGeometry.baseDepth) : 0) +\n        '&depthEnd=' + (this.level + this.pcoGeometry.baseDepth + 1) +\n        '&bounds=[' + boundsString + ']' +\n        '&schema=' + JSON.stringify(schema) +\n        '&compress=true';\n\n    if (this.scale) {\n        url += '&scale=' + this.scale;\n    }\n\n    if (this.greyhoundOffset) {\n\t\tlet offset = this.greyhoundOffset;\n\t\turl += '&offset=[' + offset.x + ',' + offset.y + ',' + offset.z + ']';\n\t}\n\n\tif(this.level === 1){\n\t\tlet a = 1;\n\t}\n\n    if (!baseLoaded) baseLoaded = true;\n\n    return url;\n};\n\nPotree.PointCloudGreyhoundGeometryNode.prototype.addChild = function(child) {\n\tthis.children[child.index] = child;\n\tchild.parent = this;\n};\n\nPotree.PointCloudGreyhoundGeometryNode.prototype.load = function(){\n\tif (\n            this.loading === true ||\n            this.loaded === true ||\n            this.pcoGeometry.numNodesLoading > 3) {\n\t\treturn;\n\t}\n\n\tthis.loading = true;\n\tthis.pcoGeometry.numNodesLoading++;\n\n\tif (\n            this.level % this.pcoGeometry.hierarchyStepSize === 0 &&\n            this.hasChildren) {\n\t\tthis.loadHierarchyThenPoints();\n\t}\n    else {\n\t\tthis.loadPoints();\n\t}\n};\n\nPotree.PointCloudGreyhoundGeometryNode.prototype.loadPoints = function(){\n\tthis.pcoGeometry.loader.load(this);\n};\n\n\nPotree.PointCloudGreyhoundGeometryNode.prototype.loadHierarchyThenPoints =\n        function() {\n    // From Greyhound (Cartesian) ordering for the octree to Potree-default\n\tvar transform = [0, 2, 1, 3, 4, 6, 5, 7];\n\n    var makeBitMask = function(node) {\n        var mask = 0;\n        Object.keys(node).forEach(function(key) {\n            if      (key === 'swd') mask += 1 << transform[0];\n            else if (key === 'nwd') mask += 1 << transform[1];\n            else if (key === 'swu') mask += 1 << transform[2];\n            else if (key === 'nwu') mask += 1 << transform[3];\n            else if (key === 'sed') mask += 1 << transform[4];\n            else if (key === 'ned') mask += 1 << transform[5];\n            else if (key === 'seu') mask += 1 << transform[6];\n            else if (key === 'neu') mask += 1 << transform[7];\n        });\n        return mask;\n    };\n\n    var parseChildrenCounts = function(base, parentName, stack) {\n        var keys = Object.keys(base);\n        var child;\n        var childName;\n\n        keys.forEach(function(key) {\n            if (key === 'n') return;\n            switch (key) {\n                case 'swd':\n                    child = base.swd; childName = parentName + transform[0];\n                    break;\n                case 'nwd':\n                    child = base.nwd; childName = parentName + transform[1];\n                    break;\n                case 'swu':\n                    child = base.swu; childName = parentName + transform[2];\n                    break;\n                case 'nwu':\n                    child = base.nwu; childName = parentName + transform[3];\n                    break;\n                case 'sed':\n                    child = base.sed; childName = parentName + transform[4];\n                    break;\n                case 'ned':\n                    child = base.ned; childName = parentName + transform[5];\n                    break;\n                case 'seu':\n                    child = base.seu; childName = parentName + transform[6];\n                    break;\n                case 'neu':\n                    child = base.neu; childName = parentName + transform[7];\n                    break;\n                default:\n                    break;\n            }\n\n            stack.push({\n                children: makeBitMask(child),\n                numPoints: child.n,\n                name: childName\n            });\n\n            parseChildrenCounts(child, childName, stack);\n        });\n    };\n\n\t// Load hierarchy.\n\tvar callback = function(node, greyhoundHierarchy) {\n\t\tvar decoded = [];\n\t\tnode.numPoints = greyhoundHierarchy.n;\n        parseChildrenCounts(greyhoundHierarchy, node.name, decoded);\n\n\t\tvar nodes = {};\n\t\tnodes[node.name] = node;\n\t\tvar pgg = node.pcoGeometry;\n\n\t\tfor( var i = 0; i < decoded.length; i++){\n\t\t\tvar name = decoded[i].name;\n\t\t\tvar numPoints = decoded[i].numPoints;\n\t\t\tvar index = parseInt(name.charAt(name.length-1));\n\t\t\tvar parentName = name.substring(0, name.length-1);\n\t\t\tvar parentNode = nodes[parentName];\n\t\t\tvar level = name.length-1;\n\t\t\tvar boundingBox = Potree.GreyhoundLoader.createChildAABB(\n                    parentNode.boundingBox, index);\n\n\t\t\tvar currentNode = new Potree.PointCloudGreyhoundGeometryNode(\n                    name, pgg, boundingBox, node.scale, node.offset);\n\n\t\t\tcurrentNode.level = level;\n\t\t\tcurrentNode.numPoints = numPoints;\n\t\t\tcurrentNode.hasChildren = decoded[i].children > 0;\n\t\t\tcurrentNode.spacing = pgg.spacing / Math.pow(2, level);\n\t\t\tparentNode.addChild(currentNode);\n\t\t\tnodes[name] = currentNode;\n\t\t}\n\n\t\tnode.loadPoints();\n\t};\n\n\tif (this.level % this.pcoGeometry.hierarchyStepSize === 0) {\n        var depthBegin = this.level + this.pcoGeometry.baseDepth;\n        var depthEnd = depthBegin + this.pcoGeometry.hierarchyStepSize + 2;\n\n        let bounds = this.greyhoundBounds;\n\n        var boundsString =\n            bounds.min.x + ',' + bounds.min.y + ',' + bounds.min.z + ',' +\n            bounds.max.x + ',' + bounds.max.y + ',' + bounds.max.z;\n\n\t\tvar hurl = '' + this.pcoGeometry.serverURL +\n            'hierarchy?bounds=[' + boundsString + ']' +\n            '&depthBegin=' + depthBegin +\n            '&depthEnd=' + depthEnd;\n\n\t\tif (this.scale) {\n\t\t\thurl += '&scale=' + this.scale;\n\t\t}\n\n        if (this.greyhoundOffset) {\n            let offset = this.greyhoundOffset;\n\t\t\thurl += '&offset=[' + offset.x + ',' + offset.y + ',' + offset.z + ']';\n\t\t}\n\n\t\tvar xhr = new XMLHttpRequest();\n\t\txhr.open('GET', hurl, true);\n\n        var that = this;\n\t\txhr.onreadystatechange = function() {\n\t\t\tif (xhr.readyState === 4) {\n\t\t\t\tif (xhr.status === 200 || xhr.status === 0) {\n                    var greyhoundHierarchy = JSON.parse(xhr.responseText) || { };\n                    callback(that, greyhoundHierarchy);\n\t\t\t\t} else {\n                    console.log(\n                            'Failed to load file! HTTP status:', xhr.status,\n                            'file:', hurl);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\ttry {\n\t\t\txhr.send(null);\n\t\t}\n        catch(e) {\n\t\t\tconsole.log(\"fehler beim laden der punktwolke: \" + e);\n\t\t}\n\t}\n};\n\n\nPotree.PointCloudGreyhoundGeometryNode.prototype.getNumPoints = function(){\n\treturn this.numPoints;\n};\n\n\nPotree.PointCloudGreyhoundGeometryNode.prototype.dispose = function(){\n\tif (this.geometry && this.parent != null) {\n\t\tthis.geometry.dispose();\n\t\tthis.geometry = null;\n\t\tthis.loaded = false;\n\n\t\t//this.dispatchEvent( { type: 'dispose' } );\n\t\tfor (var i = 0; i < this.oneTimeDisposeHandlers.length; i++) {\n\t\t\tvar handler = this.oneTimeDisposeHandlers[i];\n\t\t\thandler();\n\t\t}\n\t\tthis.oneTimeDisposeHandlers = [];\n\t}\n};\n\n//THREE.EventDispatcher.prototype.apply(\n//        Potree.PointCloudGreyhoundGeometryNode.prototype);\nObject.assign( Potree.PointCloudGreyhoundGeometryNode.prototype, THREE.EventDispatcher.prototype );\n\n\n\n\nPotree.utils = class{\n\t\n\tstatic loadShapefileFeatures(file, callback){\n\t\t\n\t\tlet features = [];\n\t\t\t\n\t\tlet handleFinish = () => {\n\t\t\tcallback(features);\n\t\t};\n\t\t\n\t\tshapefile.open(file)\n\t\t.then(source => {source.read()\n\t\t\t.then(function log(result){\n\t\t\t\tif(result.done){\n\t\t\t\t\thandleFinish();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t//console.log(result.value);\n\t\t\t\t\n\t\t\t\tif(result.value && result.value.type === \"Feature\" && result.value.geometry !== undefined){\n\t\t\t\t\tfeatures.push(result.value);\n\t\t\t\t}\n\t\t\t\n\t\t\t\treturn source.read().then(log);\n\t\t\t})\n\t\t});\n\t}\n\t\n\tstatic toString(value){\n\t\tif(value instanceof THREE.Vector3){\n\t\t\treturn value.x.toFixed(2) + \", \" + value.y.toFixed(2) + \", \" + value.z.toFixed(2);\n\t\t}else{\n\t\t\treturn \"\" + value + \"\";\n\t\t}\n\t}\n\t\n\tstatic normalizeURL(url){\n\t\tlet u = new URL(url);\n\t\t\n\t\treturn u.protocol + \"//\" + u.hostname + u.pathname.replace(/\\/+/g, \"/\");\n\t};\n\n\tstatic pathExists(url){\n\t\tlet req = new XMLHttpRequest();\n\t\treq.open('GET', url, false);\n\t\treq.send(null);\n\t\tif (req.status !== 200) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t};\n\n\t/**\n\t * adapted from mhluska at https://github.com/mrdoob/three.js/issues/1561\n\t */\n\tstatic computeTransformedBoundingBox(box, transform){\n\n\t\tlet vertices = [\n\t\t\tnew THREE.Vector3(box.min.x, box.min.y, box.min.z).applyMatrix4(transform),\n\t\t\tnew THREE.Vector3(box.min.x, box.min.y, box.min.z).applyMatrix4(transform),\n\t\t\tnew THREE.Vector3(box.max.x, box.min.y, box.min.z).applyMatrix4(transform),\n\t\t\tnew THREE.Vector3(box.min.x, box.max.y, box.min.z).applyMatrix4(transform),\n\t\t\tnew THREE.Vector3(box.min.x, box.min.y, box.max.z).applyMatrix4(transform),\n\t\t\tnew THREE.Vector3(box.min.x, box.max.y, box.max.z).applyMatrix4(transform),\n\t\t\tnew THREE.Vector3(box.max.x, box.max.y, box.min.z).applyMatrix4(transform),\n\t\t\tnew THREE.Vector3(box.max.x, box.min.y, box.max.z).applyMatrix4(transform),\n\t\t\tnew THREE.Vector3(box.max.x, box.max.y, box.max.z).applyMatrix4(transform)\n\t\t];\n\t\t\n\t\tlet boundingBox = new THREE.Box3();\n\t\tboundingBox.setFromPoints( vertices );\n\t\t\n\t\treturn boundingBox;\n\t};\n\n\t/**\n\t * add separators to large numbers\n\t * \n\t * @param nStr\n\t * @returns\n\t */\n\tstatic addCommas(nStr){\n\t\tnStr += '';\n\t\tlet x = nStr.split('.');\n\t\tlet x1 = x[0];\n\t\tlet x2 = x.length > 1 ? '.' + x[1] : '';\n\t\tlet rgx = /(\\d+)(\\d{3})/;\n\t\twhile (rgx.test(x1)) {\n\t\t\tx1 = x1.replace(rgx, '$1' + ',' + '$2');\n\t\t}\n\t\treturn x1 + x2;\n\t};\n\t\n\tstatic removeCommas(str){\n\t\treturn str.replace(/,/g, \"\");\n\t}\n\n\t/**\n\t * create worker from a string\n\t *\n\t * code from http://stackoverflow.com/questions/10343913/how-to-create-a-web-worker-from-a-string\n\t */\n\tstatic createWorker(code){\n\t\t let blob = new Blob([code], {type: 'application/javascript'});\n\t\t let worker = new Worker(URL.createObjectURL(blob));\n\t\t \n\t\t return worker;\n\t};\n\n\tstatic loadSkybox(path){\n\t\tlet camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 1, 100000 );\n\t\tcamera.up.set(0, 0, 1);\n\t\tlet scene = new THREE.Scene();\n\n\t\tlet format = \".jpg\";\n\t\tlet urls = [\n\t\t\tpath + 'px' + format, path + 'nx' + format,\n\t\t\tpath + 'py' + format, path + 'ny' + format,\n\t\t\tpath + 'pz' + format, path + 'nz' + format\n\t\t];\n\t\t\n\t\t//var materialArray = [];\n\t\t//for (var i = 0; i < 6; i++){\n\t\t//\tmaterialArray.push( new THREE.MeshBasicMaterial({\n\t\t//\t\tmap: THREE.ImageUtils.loadTexture( urls[i] ),\n\t\t//\t\tside: THREE.BackSide,\n\t\t//\t\tdepthTest: false,\n\t\t//\t\tdepthWrite: false\n\t\t//\t\t})\n\t\t//\t);\n\t\t//}\n\t\t\n\t\tlet materialArray = [];\n\t\t{\n\t\t\tfor (let i = 0; i < 6; i++){\n\t\t\t\t\n\t\t\t\tlet material = new THREE.MeshBasicMaterial({\n\t\t\t\t\tmap: null,\n\t\t\t\t\tside: THREE.BackSide,\n\t\t\t\t\tdepthTest: false,\n\t\t\t\t\tdepthWrite: false\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tmaterialArray.push(material);\n\t\t\t\t\n\t\t\t\tlet loader = new THREE.TextureLoader();\n\t\t\t\tloader.load( urls[i],\n\t\t\t\t\tfunction loaded(texture){\n\t\t\t\t\t\tmaterial.map = texture;\n\t\t\t\t\t\tmaterial.needsUpdate = true;\n\t\t\t\t\t},function progress(xhr){\n\t\t\t\t\t\t//console.log( (xhr.loaded / xhr.total * 100) + '% loaded' );\n\t\t\t\t\t},function error(xhr){\n\t\t\t\t\t\tconsole.log( 'An error happened', xhr );\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t}\n\t\t\n\t\tvar skyGeometry = new THREE.CubeGeometry( 5000, 5000, 5000 );\n\t\tvar skybox = new THREE.Mesh( skyGeometry, materialArray );\n\n\t\tscene.add(skybox);\n\t\t\n\t\t// z up\n\t\tscene.rotation.x = Math.PI / 2;\n\t\t\n\t\treturn {\"camera\": camera, \"scene\": scene};\n\t};\n\n\tstatic createGrid(width, length, spacing, color){\n\t\tlet material = new THREE.LineBasicMaterial({\n\t\t\tcolor: color || 0x888888\n\t\t});\n\t\t\n\t\tlet geometry = new THREE.Geometry();\n\t\tfor(let i = 0; i <= length; i++){\n\t\t\t geometry.vertices.push(new THREE.Vector3(-(spacing*width)/2, i*spacing-(spacing*length)/2, 0));\n\t\t\t geometry.vertices.push(new THREE.Vector3(+(spacing*width)/2, i*spacing-(spacing*length)/2, 0));\n\t\t}\n\t\t\n\t\tfor(let i = 0; i <= width; i++){\n\t\t\t geometry.vertices.push(new THREE.Vector3(i*spacing-(spacing*width)/2, -(spacing*length)/2, 0));\n\t\t\t geometry.vertices.push(new THREE.Vector3(i*spacing-(spacing*width)/2, +(spacing*length)/2, 0));\n\t\t}\n\t\t\n\t\tlet line = new THREE.LineSegments(geometry, material, THREE.LinePieces);\n\t\tline.receiveShadow = true;\n\t\treturn line;\n\t};\n\n\n\tstatic createBackgroundTexture(width, height){\n\n\t\tfunction gauss(x, y){\n\t\t\treturn (1 / (2 * Math.PI)) * Math.exp( - (x*x + y*y) / 2);\n\t\t};\n\n\t\t//map.magFilter = THREE.NearestFilter;\n\t\tlet size = width * height;\n\t\tlet data = new Uint8Array( 3 * size );\n\n\t\tlet chroma = [1, 1.5, 1.7];\n\t\tlet max = gauss(0, 0);\n\n\t\tfor(let x = 0; x < width; x++){\n\t\t\tfor(let y = 0; y < height; y++){\n\t\t\t\tlet u = 2 * (x / width) - 1;\n\t\t\t\tlet v = 2 * (y / height) - 1;\n\t\t\t\t\n\t\t\t\tlet i = x + width*y;\n\t\t\t\tlet d = gauss(2*u, 2*v) / max;\n\t\t\t\tlet r = (Math.random() + Math.random() + Math.random()) / 3;\n\t\t\t\tr = (d * 0.5 + 0.5) * r * 0.03;\n\t\t\t\tr = r * 0.4;\n\t\t\t\t\n\t\t\t\t//d = Math.pow(d, 0.6);\n\t\t\t\t\n\t\t\t\tdata[3*i+0] = 255 * (d / 15 + 0.05 + r) * chroma[0];\n\t\t\t\tdata[3*i+1] = 255 * (d / 15 + 0.05 + r) * chroma[1];\n\t\t\t\tdata[3*i+2] = 255 * (d / 15 + 0.05 + r) * chroma[2];\n\t\t\t}\n\t\t}\n\t\t\n\t\tlet texture = new THREE.DataTexture( data, width, height, THREE.RGBFormat );\n\t\ttexture.needsUpdate = true;\n\t\t\n\t\treturn texture;\n\t};\n\n\tstatic getMousePointCloudIntersection(mouse, camera, renderer, pointclouds){\n\t\tlet nmouse =  {\n\t\t\tx: (mouse.x / renderer.domElement.clientWidth ) * 2 - 1,\n\t\t\ty: - (mouse.y / renderer.domElement.clientHeight ) * 2 + 1\n\t\t};\n\t\t\n\t\t//let vector = new THREE.Vector3( nmouse.x, nmouse.y, 0.5 );\n\t\t//vector.unproject(camera);\n\n\t\t//let direction = vector.sub(camera.position).normalize();\n\t\t//let ray = new THREE.Ray(camera.position, direction);\n\t\t\n\t\tlet raycaster = new THREE.Raycaster();\n\t\traycaster.setFromCamera(nmouse, camera);\n\t\tlet ray = raycaster.ray;\n\t\t\n\t\tlet selectedPointcloud = null;\n\t\tlet closestDistance = Infinity;\n\t\tlet closestIntersection = null;\n\t\tlet closestPoint = null;\n\t\t\n\t\tfor(let pointcloud of pointclouds){\n\t\t\tlet point = pointcloud.pick(renderer, camera, ray);\n\t\t\t\n\t\t\tif(!point){\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t\n\t\t\tlet distance = camera.position.distanceTo(point.position);\n\t\t\t\n\t\t\tif(distance < closestDistance){\n\t\t\t\tclosestDistance = distance;\n\t\t\t\tselectedPointcloud = pointcloud;\n\t\t\t\tclosestIntersection = point.position;\n\t\t\t\tclosestPoint = point;\n\t\t\t}\n\t\t}\n\t\t\n\t\tif(selectedPointcloud){\n\t\t\treturn {\n\t\t\t\tlocation: closestIntersection,\n\t\t\t\tdistance: closestDistance,\n\t\t\t\tpointcloud: selectedPointcloud,\n\t\t\t\tpoint: closestPoint\n\t\t\t};\n\t\t}else{\n\t\t\treturn null;\n\t\t}\n\t};\t\n\t\t\n\tstatic pixelsArrayToImage(pixels, width, height){\n\t\tlet canvas = document.createElement('canvas');\n\t\tcanvas.width = width;\n\t\tcanvas.height = height;\n\n\t\tlet context = canvas.getContext('2d');\n\t\t\n\t\tpixels = new pixels.constructor(pixels);\n\t\t\n\t\tfor(let i = 0; i < pixels.length; i++){\n\t\t\tpixels[i*4 + 3] = 255;\n\t\t}\n\n\t\tlet imageData = context.createImageData(width, height);\n\t\timageData.data.set(pixels);\n\t\tcontext.putImageData(imageData, 0, 0);\n\n\t\tlet img = new Image();\n\t\timg.src = canvas.toDataURL();\n\t\t//img.style.transform = \"scaleY(-1)\";\n\t\t\n\t\treturn img;\n\t};\n\n\tstatic projectedRadius(radius, fov, distance, screenHeight){\n\t\tlet projFactor =  (1 / Math.tan(fov / 2)) / distance;\n\t\tprojFactor = projFactor * screenHeight / 2;\n\t\t\n\t\treturn radius * projFactor;\n\t};\n\t\t\n\t\t\n\tstatic topView(camera, node){\n\t\tcamera.position.set(0, 1, 0);\n\t\tcamera.rotation.set(-Math.PI / 2, 0, 0);\n\t\tcamera.zoomTo(node, 1);\n\t};\n\n\tstatic frontView(camera, node){\n\t\tcamera.position.set(0, 0, 1);\n\t\tcamera.rotation.set(0, 0, 0);\n\t\tcamera.zoomTo(node, 1);\n\t};\n\n\n\tstatic leftView(camera, node){\n\t\tcamera.position.set(-1, 0, 0);\n\t\tcamera.rotation.set(0, -Math.PI / 2, 0);\n\t\tcamera.zoomTo(node, 1);\n\t};\n\n\tstatic rightView(camera, node){\n\t\tcamera.position.set(1, 0, 0);\n\t\tcamera.rotation.set(0, Math.PI / 2, 0);\n\t\tcamera.zoomTo(node, 1);\n\t};\n\t\t\n\t/**\n\t *  \n\t * 0: no intersection\n\t * 1: intersection\n\t * 2: fully inside\n\t */\n\tstatic frustumSphereIntersection(frustum, sphere){\n\t\tlet planes = frustum.planes;\n\t\tlet center = sphere.center;\n\t\tlet negRadius = - sphere.radius;\n\n\t\tlet minDistance = Number.MAX_VALUE;\n\t\t\n\t\tfor ( let i = 0; i < 6; i ++ ) {\n\n\t\t\tlet distance = planes[ i ].distanceToPoint( center );\n\n\t\t\tif ( distance < negRadius ) {\n\n\t\t\t\treturn 0;\n\n\t\t\t}\n\t\t\t\n\t\t\tminDistance = Math.min(minDistance, distance);\n\n\t\t}\n\n\t\treturn (minDistance >= sphere.radius) ? 2 : 1;\n\t};\n\t\t\n\t// code taken from three.js\n\t// ImageUtils - generateDataTexture()\n\tstatic generateDataTexture(width, height, color){\n\t\tlet size = width * height;\n\t\tlet data = new Uint8Array(3 * width * height);\n\t\t\n\t\tlet r = Math.floor( color.r * 255 );\n\t\tlet g = Math.floor( color.g * 255 );\n\t\tlet b = Math.floor( color.b * 255 );\n\t\t\n\t\tfor ( let i = 0; i < size; i ++ ) {\n\t\t\tdata[ i * 3 ] \t   = r;\n\t\t\tdata[ i * 3 + 1 ] = g;\n\t\t\tdata[ i * 3 + 2 ] = b;\n\t\t}\n\t\t\n\t\tlet texture = new THREE.DataTexture( data, width, height, THREE.RGBFormat );\n\t\ttexture.needsUpdate = true;\n\t\ttexture.magFilter = THREE.NearestFilter;\n\t\t\n\t\treturn texture;\n\t};\n\t\t\n\t// from http://stackoverflow.com/questions/901115/how-can-i-get-query-string-values-in-javascript\n\tstatic getParameterByName(name) {\n\t\tname = name.replace(/[\\[]/, \"\\\\[\").replace(/[\\]]/, \"\\\\]\");\n\t\tlet regex = new RegExp(\"[\\\\?&]\" + name + \"=([^&#]*)\"), results = regex.exec(location.search);\n\t\treturn results === null ? null : decodeURIComponent(results[1].replace(/\\+/g, \" \"));\n\t}\n\t\n\tstatic setParameter(name, value){\n\t\t//value = encodeURIComponent(value);\n\t\t\n\t\tname = name.replace(/[\\[]/, \"\\\\[\").replace(/[\\]]/, \"\\\\]\");\n\t\tlet regex = new RegExp(\"([\\\\?&])(\" + name + \"=([^&#]*))\");\n\t\tlet results = regex.exec(location.search);\n\n\t\tlet url = window.location.href;\n\t\tif(results === null){\n\t\t\tif(window.location.search.length === 0){\n\t\t\t\turl = url + \"?\";\n\t\t\t}else{\n\t\t\t\turl = url + \"&\";\n\t\t\t}\n\n\t\t\turl = url + name + \"=\" + value;\n\t\t}else{\n\t\t\tlet newValue = name + \"=\" + value;\n\t\t\turl = url.replace(results[2], newValue);\n\t\t}\n\t\twindow.history.replaceState({}, \"\", url);\n\t}\n\t\n};\n\nPotree.utils.screenPass = new function(){\n\n\tthis.screenScene = new THREE.Scene();\n\tthis.screenQuad = new THREE.Mesh(new THREE.PlaneBufferGeometry(2, 2, 0));\n\tthis.screenQuad.material.depthTest = true;\n\tthis.screenQuad.material.depthWrite = true;\n\tthis.screenQuad.material.transparent = true;\n\tthis.screenScene.add(this.screenQuad);\n\tthis.camera = new THREE.Camera();\n\t\n\tthis.render = function(renderer, material, target){\n\t\tthis.screenQuad.material = material;\n\t\t\n\t\tif(typeof target === \"undefined\"){\n\t\t\trenderer.render(this.screenScene, this.camera);\n\t\t}else{\n\t\t\trenderer.render(this.screenScene, this.camera, target);\n\t\t}\n\t};\n}();\n\n\n\n\nPotree.Features = function(){\n\n\tvar ftCanvas = document.createElement(\"canvas\");\n\tvar gl = ftCanvas.getContext(\"webgl\") || ftCanvas.getContext(\"experimental-webgl\");\n\tif (gl === null)\n\t\treturn null;\n\n\t// -- code taken from THREE.WebGLRenderer --\n\tvar _vertexShaderPrecisionHighpFloat = gl.getShaderPrecisionFormat( gl.VERTEX_SHADER, gl.HIGH_FLOAT );\n\tvar _vertexShaderPrecisionMediumpFloat = gl.getShaderPrecisionFormat( gl.VERTEX_SHADER, gl.MEDIUM_FLOAT );\n\tvar _vertexShaderPrecisionLowpFloat = gl.getShaderPrecisionFormat( gl.VERTEX_SHADER, gl.LOW_FLOAT );\n\n\tvar _fragmentShaderPrecisionHighpFloat = gl.getShaderPrecisionFormat( gl.FRAGMENT_SHADER, gl.HIGH_FLOAT );\n\tvar _fragmentShaderPrecisionMediumpFloat = gl.getShaderPrecisionFormat( gl.FRAGMENT_SHADER, gl.MEDIUM_FLOAT );\n\tvar _fragmentShaderPrecisionLowpFloat = gl.getShaderPrecisionFormat( gl.FRAGMENT_SHADER, gl.LOW_FLOAT );\n\n\tvar highpAvailable = _vertexShaderPrecisionHighpFloat.precision > 0 && _fragmentShaderPrecisionHighpFloat.precision > 0;\n\tvar mediumpAvailable = _vertexShaderPrecisionMediumpFloat.precision > 0 && _fragmentShaderPrecisionMediumpFloat.precision > 0;\n\t// -----------------------------------------\n\n\tvar precision;\n\tif(highpAvailable){\n\t\tprecision = \"highp\";\n\t}else if(mediumpAvailable){\n\t\tprecision = \"mediump\";\n\t}else{\n\t\tprecision = \"lowp\";\n\t}\n\n\treturn {\n\t\tSHADER_INTERPOLATION: {\n\t\t\tisSupported: function(){\n\n\t\t\t\tvar supported = true;\n\n\t\t\t\tsupported = supported && gl.getExtension(\"EXT_frag_depth\");\n\t\t\t\tsupported = supported && gl.getParameter(gl.MAX_VARYING_VECTORS) >= 8;\n\n\t\t\t\treturn supported;\n\t\t\t}\n\t\t},\n\t\tSHADER_SPLATS: {\n\t\t\tisSupported: function(){\n\n\t\t\t\tvar supported = true;\n\n\t\t\t\tsupported = supported && gl.getExtension(\"EXT_frag_depth\");\n\t\t\t\tsupported = supported && gl.getExtension(\"OES_texture_float\");\n\t\t\t\tsupported = supported && gl.getParameter(gl.MAX_VARYING_VECTORS) >= 8;\n\n\t\t\t\treturn supported;\n\n\t\t\t}\n\n\t\t},\n\t\tSHADER_EDL: {\n\t\t\tisSupported: function(){\n\t\t\t\t\n\t\t\t\tvar supported = true;\n\t\t\t\t\n\t\t\t\tsupported = supported && gl.getExtension(\"EXT_frag_depth\");\n\t\t\t\tsupported = supported && gl.getExtension(\"OES_texture_float\");\n\t\t\t\tsupported = supported && gl.getParameter(gl.MAX_VARYING_VECTORS) >= 8;\n\t\t\t\t\n\t\t\t\treturn supported;\n\t\t\t\t\n\t\t\t}\n\t\t\n\t\t},\n\t\tprecision: precision\n\t};\n\n}();\n\n/**\n * adapted from http://stemkoski.github.io/Three.js/Sprite-Text-Labels.html\n */\n\nPotree.TextSprite = function(text){\n\n\tTHREE.Object3D.call(this);\n\t\n\tvar scope = this;\n\n\tvar texture = new THREE.Texture();\n\ttexture.minFilter = THREE.LinearFilter;\n\ttexture.magFilter = THREE.LinearFilter;\n\tvar spriteMaterial = new THREE.SpriteMaterial( { \n\t\tmap: texture, \n\t\t//useScreenCoordinates: false,\n\t\tdepthTest: false,\n\t\tdepthWrite: false} );\n\t\n\tthis.material = spriteMaterial;\n\tthis.sprite = new THREE.Sprite(spriteMaterial);\n\tthis.add(this.sprite);\n\t\n\t//THREE.Sprite.call(this, spriteMaterial);\n\t\n\tthis.borderThickness = 4;\n\tthis.fontface = \"Arial\";\n\tthis.fontsize = 28;\n\tthis.borderColor = { r:0, g:0, b:0, a:1.0 };\n\tthis.backgroundColor = { r:255, g:255, b:255, a:1.0 };\n\tthis.textColor = {r: 255, g: 255, b: 255, a: 1.0};\n\tthis.text = \"\";\n\t\n\tthis.setText(text);\n};\n\nPotree.TextSprite.prototype = new THREE.Object3D();\n\nPotree.TextSprite.prototype.setText = function(text){\n\tif(this.text !== text){\n\t\tthis.text = text;\n\t\t\n\t\tthis.update();\n\t}\n};\n\nPotree.TextSprite.prototype.setTextColor = function(color){\n\tthis.textColor = color;\n\t\n\tthis.update();\n};\n\nPotree.TextSprite.prototype.setBorderColor = function(color){\n\tthis.borderColor = color;\n\t\n\tthis.update();\n};\n\nPotree.TextSprite.prototype.setBackgroundColor = function(color){\n\tthis.backgroundColor = color;\n\t\n\tthis.update();\n};\n\nPotree.TextSprite.prototype.update = function(){\n\n\tvar canvas = document.createElement('canvas');\n\tvar context = canvas.getContext('2d');\n\tcontext.font = \"Bold \" + this.fontsize + \"px \" + this.fontface;\n\t\n\t// get size data (height depends only on font size)\n\tvar metrics = context.measureText( this.text );\n\tvar textWidth = metrics.width;\n\tvar margin = 5;\n\tvar spriteWidth = 2*margin + textWidth + 2 * this.borderThickness;\n\tvar spriteHeight = this.fontsize * 1.4 + 2 * this.borderThickness;\n\t\n\tvar canvas = document.createElement('canvas');\n\tvar context = canvas.getContext('2d');\n\tcontext.canvas.width = spriteWidth;\n\tcontext.canvas.height = spriteHeight;\n\tcontext.font = \"Bold \" + this.fontsize + \"px \" + this.fontface;\n\t\n\t// background color\n\tcontext.fillStyle   = \"rgba(\" + this.backgroundColor.r + \",\" + this.backgroundColor.g + \",\"\n\t\t\t\t\t\t\t\t  + this.backgroundColor.b + \",\" + this.backgroundColor.a + \")\";\n\t// border color\n\tcontext.strokeStyle = \"rgba(\" + this.borderColor.r + \",\" + this.borderColor.g + \",\"\n\t\t\t\t\t\t\t\t  + this.borderColor.b + \",\" + this.borderColor.a + \")\";\n\t\t\t\t\t\t\t\t  \n\tcontext.lineWidth = this.borderThickness;\n\tthis.roundRect(context, this.borderThickness/2, this.borderThickness/2, \n\t\ttextWidth + this.borderThickness + 2*margin, this.fontsize * 1.4 + this.borderThickness, 6);\t\t\t\t\t\t  \n\t\t\n\t// text color\n\tcontext.strokeStyle = \"rgba(0, 0, 0, 1.0)\";\n\tcontext.strokeText( this.text, this.borderThickness + margin, this.fontsize + this.borderThickness);\n\t\n\tcontext.fillStyle = \"rgba(\" + this.textColor.r + \",\" + this.textColor.g + \",\"\n\t\t\t\t\t\t\t\t  + this.textColor.b + \",\" + this.textColor.a + \")\";\n\tcontext.fillText( this.text, this.borderThickness + margin, this.fontsize + this.borderThickness);\n\t\n\t\t\t\t\t\t\t\t  \n\tvar texture = new THREE.Texture(canvas); \n\ttexture.minFilter = THREE.LinearFilter;\n\ttexture.magFilter = THREE.LinearFilter;\n\ttexture.needsUpdate = true;\t\n\t\n\t//var spriteMaterial = new THREE.SpriteMaterial( \n\t//\t{ map: texture, useScreenCoordinates: false } );\n\tthis.sprite.material.map = texture;\n\t\t\n\tthis.sprite.scale.set(spriteWidth*0.01,spriteHeight*0.01,1.0);\n\t\t\n\t//this.material = spriteMaterial;\t\t\t\t\t\t  \n};\n\nPotree.TextSprite.prototype.roundRect = function(ctx, x, y, w, h, r) {\n\tctx.beginPath();\n\tctx.moveTo(x+r, y);\n\tctx.lineTo(x+w-r, y);\n\tctx.quadraticCurveTo(x+w, y, x+w, y+r);\n\tctx.lineTo(x+w, y+h-r);\n\tctx.quadraticCurveTo(x+w, y+h, x+w-r, y+h);\n\tctx.lineTo(x+r, y+h);\n\tctx.quadraticCurveTo(x, y+h, x, y+h-r);\n\tctx.lineTo(x, y+r);\n\tctx.quadraticCurveTo(x, y, x+r, y);\n\tctx.closePath();\n\tctx.fill();\n\tctx.stroke();   \n};\n\n// \n// TODO \n// \n// - option to look along path during animation\n// - \n// \n\n\nPotree.AnimationPath = class{\n\t\n\tconstructor(points = []){\n\t\tthis.points = points;\n\t\tthis.spline = new THREE.Spline(points);\n\t\tthis.spline.reparametrizeByArcLength(1 / this.spline.getLength().total);\n\t\tthis.tween = null;\n\t}\n\t\n\tget(t){\n\t\treturn this.spline.getPoint(t);\n\t}\n\t\n\tanimate(metersPerSecond = 1){\n\t\t\n\t\tstop();\n\t\t\n\t\tlet length = this.spline.getLength().total;\n\t\tlet animationDuration = (1000 * length) / metersPerSecond;\n\n\t\tlet progress = {t: 0};\n\t\tthis.tween = new TWEEN.Tween(progress).to({t: 1}, animationDuration);\n\t\tthis.tween.easing(TWEEN.Easing.Linear.None);\n\t\tthis.tween.onUpdate((e) => {\n\t\t\tviewer.scene.view.position.copy(this.spline.getPoint(progress.t));\n\t\t});\n\t\t\n\t\tthis.tween.start();\n\t}\n\t\n\tstop(){\n\t\tif(this.tween){\n\t\t\tthis.tween.stop();\n\t\t}\n\t}\n\t\n\tresume(){\n\t\tif(this.tween){\n\t\t\tthis.tween.start();\n\t\t}\n\t}\n\t\n\tgetGeometry(){\n\t\tlet geometry = new THREE.Geometry();\n\t\t\n\t\tlet samples = 100;\n\t\tlet i = 0;\n\t\tfor(let u = 0; u <= 1; u += 1 / samples){\n\t\t\tlet position = this.spline.getPoint(u);\n\t\t\tgeometry.vertices[i] = new THREE.Vector3( position.x, position.y, position.z );\n\t\t\t\n\t\t\ti++;\n\t\t}\n\t\t\n\t\treturn geometry;\n\t\t\n\t\t//let material = new THREE.LineBasicMaterial( { color: 0xffffff, opacity: 1, linewidth: 2 } );\n\t\t//let line = new THREE.Line(geometry, material);\n\t\t//viewer.scene.scene.add(line);\n\t}\n};\n\n\n\n//let target = new THREE.Vector3(589854.34, 231411.19, 692.77)\n//let points = [\n//\tnew THREE.Vector3(589815.52, 231738.31, 959.48 ),\n//\tnew THREE.Vector3(589604.73, 231615.00, 968.10 ),\n//\tnew THREE.Vector3(589579.11, 231354.41, 1010.06),\n//\tnew THREE.Vector3(589723.00, 231169.95, 1015.57),\n//\tnew THREE.Vector3(589960.76, 231116.87, 978.60 ),\n//\tnew THREE.Vector3(590139.29, 231268.71, 972.33 )\n//]\n//\n//let path = new Potree.AnimationPath(points);\n\nPotree.Version = function(version){\n\tthis.version = version;\n\tvar vmLength = (version.indexOf(\".\") === -1) ? version.length : version.indexOf(\".\");\n\tthis.versionMajor = parseInt(version.substr(0, vmLength));\n\tthis.versionMinor = parseInt(version.substr(vmLength + 1));\n\tif(this.versionMinor.length === 0){\n\t\tthis.versionMinor = 0;\n\t}\n\t\n};\n\nPotree.Version.prototype.newerThan = function(version){\n\tvar v = new Potree.Version(version);\n\t\n\tif( this.versionMajor > v.versionMajor){\n\t\treturn true;\n\t}else if( this.versionMajor === v.versionMajor && this.versionMinor > v.versionMinor){\n\t\treturn true;\n\t}else{\n\t\treturn false;\n\t}\n};\n\nPotree.Version.prototype.equalOrHigher = function(version){\n\tvar v = new Potree.Version(version);\n\t\n\tif( this.versionMajor > v.versionMajor){\n\t\treturn true;\n\t}else if( this.versionMajor === v.versionMajor && this.versionMinor >= v.versionMinor){\n\t\treturn true;\n\t}else{\n\t\treturn false;\n\t}\n};\n\nPotree.Version.prototype.upTo = function(version){\n\treturn !this.newerThan(version);\n};\n\nPotree.Measure = class Measure extends THREE.Object3D{\n\tconstructor(){\n\t\tsuper();\n\t\t\n\t\tthis.constructor.counter = (this.constructor.counter === undefined) ? 0 : this.constructor.counter + 1;\n\t\t\n\t\tthis.name = \"Measure_\" + this.constructor.counter;\n\t\tthis.points = [];\n\t\tthis._showDistances = true;\n\t\tthis._showCoordinates = false;\n\t\tthis._showArea = false;\n\t\tthis._closed = true;\n\t\tthis._showAngles = false;\n\t\tthis._showHeight = false;\n\t\tthis.maxMarkers = Number.MAX_SAFE_INTEGER;\n\t\t\n\t\tthis.sphereGeometry = new THREE.SphereGeometry(0.4, 10, 10);\n\t\tthis.color = new THREE.Color( 0xff0000 );\n\n\t\tthis.lengthUnit = {code: \"m\"};\n\t\t\n\t\tthis.spheres = [];\n\t\tthis.edges = [];\n\t\tthis.sphereLabels = [];\n\t\tthis.edgeLabels = [];\n\t\tthis.angleLabels = [];\n\t\tthis.coordinateLabels = [];\n\t\t\n\t\tthis.heightEdge;\n\t\tthis.heightLabel;\n\t\t{ // height stuff\n\t\t\t\n\t\t\t{ // height line\n\t\t\t\tlet lineGeometry = new THREE.Geometry();\n\t\t\t\tlineGeometry.vertices.push(\n\t\t\t\t\tnew THREE.Vector3(), \n\t\t\t\t\tnew THREE.Vector3(), \n\t\t\t\t\tnew THREE.Vector3(), \n\t\t\t\t\tnew THREE.Vector3());\n\t\t\t\tlineGeometry.colors.push(this.color, this.color, this.color);\n\t\t\t\tlet lineMaterial = new THREE.LineDashedMaterial( \n\t\t\t\t\t{ color: 0xff0000, dashSize: 5, gapSize: 2 } );\n\t\t\t\t\n\t\t\t\tlineMaterial.depthTest = false;\n\t\t\t\tthis.heightEdge = new THREE.Line(lineGeometry, lineMaterial);\n\t\t\t\tthis.heightEdge.visible = false;\n\t\t\t\t\n\t\t\t\tthis.add(this.heightEdge);\n\t\t\t}\n\t\t\t\n\t\t\t{ // height label\n\t\t\t\tthis.heightLabel = new Potree.TextSprite(\"\");\n\t\t\t\tthis.heightLabel.setBorderColor({r:0, g:0, b:0, a:0.8});\n\t\t\t\tthis.heightLabel.setBackgroundColor({r:0, g:0, b:0, a:0.3});\n\t\t\t\tthis.heightLabel.setTextColor({r:180, g:220, b:180, a:1.0});\n\t\t\t\tthis.heightLabel.material.depthTest = false;\n\t\t\t\tthis.heightLabel.material.opacity = 1;\n\t\t\t\tthis.heightLabel.visible = false;;\n\t\t\t\tthis.add(this.heightLabel);\n\t\t\t}\n\t\t}\n\t\t\n\t\tthis.areaLabel = new Potree.TextSprite(\"\");\n\t\tthis.areaLabel.setBorderColor({r:0, g:0, b:0, a:0.8});\n\t\tthis.areaLabel.setBackgroundColor({r:0, g:0, b:0, a:0.3});\n\t\tthis.areaLabel.setTextColor({r:180, g:220, b:180, a:1.0});\n\t\tthis.areaLabel.material.depthTest = false;\n\t\tthis.areaLabel.material.opacity = 1;\n\t\tthis.areaLabel.visible = false;;\n\t\tthis.add(this.areaLabel);\n\t\t\n\t\t\n\t}\n\t\n\tcreateSphereMaterial(){\n\t\tlet sphereMaterial = new THREE.MeshLambertMaterial({\n\t\t\tshading: THREE.SmoothShading, \n\t\t\tcolor: this.color, \n\t\t\tdepthTest: false, \n\t\t\tdepthWrite: false}\n\t\t);\n\t\t\n\t\treturn sphereMaterial;\n\t};\n\t\n\taddMarker(point){\n\t\tif(point instanceof THREE.Vector3){\n\t\t\tpoint = {position: point};\n\t\t}\n\t\tthis.points.push(point);\n\t\t\n\t\t// sphere\n\t\tlet sphere = new THREE.Mesh(this.sphereGeometry, this.createSphereMaterial());\n\t\t\n\t\tthis.add(sphere);\n\t\tthis.spheres.push(sphere);\n\t\t\n\t\t{ // edges\n\t\t\tlet lineGeometry = new THREE.Geometry();\n\t\t\tlineGeometry.vertices.push(new THREE.Vector3(), new THREE.Vector3());\n\t\t\tlineGeometry.colors.push(this.color, this.color, this.color);\n\t\t\tlet lineMaterial = new THREE.LineBasicMaterial( { \n\t\t\t\tlinewidth: 1\n\t\t\t});\n\t\t\tlineMaterial.depthTest = false;\n\t\t\tlet edge = new THREE.Line(lineGeometry, lineMaterial);\n\t\t\tedge.visible = true;\n\t\t\t\n\t\t\tthis.add(edge);\n\t\t\tthis.edges.push(edge);\n\t\t}\n\t\t\n\t\t\n\t\t{ // edge labels\n\t\t\tlet edgeLabel = new Potree.TextSprite();\n\t\t\tedgeLabel.setBorderColor({r:0, g:0, b:0, a:0.8});\n\t\t\tedgeLabel.setBackgroundColor({r:0, g:0, b:0, a:0.3});\n\t\t\tedgeLabel.material.depthTest = false;\n\t\t\tedgeLabel.visible = false;\n\t\t\tthis.edgeLabels.push(edgeLabel);\n\t\t\tthis.add(edgeLabel);\n\t\t}\n\t\t\n\t\t{ // angle labels\n\t\t\tlet angleLabel = new Potree.TextSprite();\n            angleLabel.setBorderColor({r:0, g:0, b:0, a:0.8});\n\t\t\tangleLabel.setBackgroundColor({r:0, g:0, b:0, a:0.3});\n            angleLabel.material.depthTest = false;\n            angleLabel.material.opacity = 1;\n\t\t\tangleLabel.visible = false;\n\t\t\tthis.angleLabels.push(angleLabel);\n\t\t\tthis.add(angleLabel);\n\t\t}\n\t\t\n\t\t{ // coordinate labels\n\t\t\tlet coordinateLabel = new Potree.TextSprite();\n\t\t\tcoordinateLabel.setBorderColor({r:0, g:0, b:0, a:0.8});\n\t\t\tcoordinateLabel.setBackgroundColor({r:0, g:0, b:0, a:0.3});\n\t\t\tcoordinateLabel.material.depthTest = false;\n\t\t\tcoordinateLabel.material.opacity = 1;\n\t\t\tcoordinateLabel.visible = false;\n\t\t\tthis.coordinateLabels.push(coordinateLabel);\n\t\t\tthis.add(coordinateLabel);\n\t\t}\n\t\t\n\t\t{ // Event Listeners\n\t\t\tlet drag = (e) => {\n\t\t\t\tlet I = Potree.utils.getMousePointCloudIntersection(\n\t\t\t\t\te.drag.end, \n\t\t\t\t\te.viewer.scene.camera, \n\t\t\t\t\te.viewer.renderer, \n\t\t\t\t\te.viewer.scene.pointclouds);\n\t\t\t\t\n\t\t\t\tif(I){\n\t\t\t\t\tlet i = this.spheres.indexOf(e.drag.object);\n\t\t\t\t\tif(i !== -1){\n\t\t\t\t\t\t\n\t\t\t\t\t\tlet point = this.points[i];\n\t\t\t\t\t\tfor(let key of Object.keys(I.point).filter(e => e !== \"position\")){\n\t\t\t\t\t\t\tpoint[key] = I.point[key];\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tthis.setPosition(i, I.location);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\t\n\t\t\tlet drop = e => {\n\t\t\t\tlet i = this.spheres.indexOf(e.drag.object);\n\t\t\t\tif(i !== -1){\n\t\t\t\t\tthis.dispatchEvent({\n\t\t\t\t\t\t\"type\": \"marker_dropped\",\n\t\t\t\t\t\t\"measurement\": this,\n\t\t\t\t\t\t\"index\": i\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\t\t\t\n\t\t\tlet mouseover = (e) => e.object.material.emissive.setHex(0x888888);\n\t\t\tlet mouseleave = (e) => e.object.material.emissive.setHex(0x000000);\n\t\t\t\n\t\t\tsphere.addEventListener(\"drag\", drag);\n\t\t\tsphere.addEventListener(\"drop\", drop);\n\t\t\tsphere.addEventListener(\"mouseover\", mouseover);\n\t\t\tsphere.addEventListener(\"mouseleave\", mouseleave);\n\t\t}\n\n\t\tlet event = {\n\t\t\ttype: \"marker_added\",\n\t\t\tmeasurement: this,\n\t\t\tsphere: sphere\n\t\t};\n\t\tthis.dispatchEvent(event);\n\t\t\n\t\tthis.setMarker(this.points.length-1, point);\n\t};\n\t\n\tremoveMarker(index){\n\t\tthis.points.splice(index, 1);\n\t\t\n\t\tthis.remove(this.spheres[index]);\n\t\t\n\t\tlet edgeIndex = (index === 0) ? 0 : (index - 1);\n\t\tthis.remove(this.edges[edgeIndex]);\n\t\tthis.edges.splice(edgeIndex, 1);\n\t\t\n\t\tthis.remove(this.edgeLabels[edgeIndex]);\n\t\tthis.edgeLabels.splice(edgeIndex, 1);\n\t\tthis.coordinateLabels.splice(index, 1);\n\t\t\n\t\tthis.spheres.splice(index, 1);\n\t\t\n\t\tthis.update();\n\t\t\n\t\tthis.dispatchEvent({type: \"marker_removed\", measurement: this});\n\t};\n\t\n\tsetMarker(index, point){\n\t\tthis.points[index] = point;\n\t\t\n\t\tlet event = {\n\t\t\ttype: \t\t'marker_moved',\n\t\t\tmeasure:\tthis,\n\t\t\tindex:\t\tindex,\n\t\t\tposition: \tpoint.position.clone()\n\t\t};\n\t\tthis.dispatchEvent(event);\n\t\t\n\t\tthis.update();\n\t}\n\t\n\tsetPosition(index, position){\n\t\tlet point = this.points[index];\t\t\t\n\t\tpoint.position.copy(position);\n\t\t\n\t\tlet event = {\n\t\t\ttype: \t\t'marker_moved',\n\t\t\tmeasure:\tthis,\n\t\t\tindex:\t\tindex,\n\t\t\tposition: \tposition.clone()\n\t\t};\n\t\tthis.dispatchEvent(event);\n\t\t\n\t\tthis.update();\n\t};\n\t\n\tgetArea(){\n\t\tlet area = 0;\n\t\tlet j = this.points.length - 1;\n\t\t\n\t\tfor(let i = 0; i < this.points.length; i++){\n\t\t\tlet p1 = this.points[i].position;\n\t\t\tlet p2 = this.points[j].position;\n\t\t\tarea += (p2.x + p1.x) * (p1.y - p2.y);\n\t\t\tj = i;\n\t\t}\n\t\t\n\t\treturn Math.abs(area / 2);\n\t};\n\t\n\tgetTotalDistance(){\n\t\t\n\t\tif(this.points.length === 0){\n\t\t\treturn 0;\n\t\t}\n\t\t\n\t\tlet distance = 0;\n\t\t\n\t\tfor(let i = 1; i < this.points.length; i++){\n\t\t\tlet prev = this.points[i-1].position;\n\t\t\tlet curr = this.points[i].position;\n\t\t\tlet d = prev.distanceTo(curr);\n\t\t\t\n\t\t\tdistance += d;\n\t\t}\n\t\t\n\t\tif(this.closed && this.points.length > 1){\n\t\t\tlet first = this.points[0].position;\n\t\t\tlet last = this.points[this.points.length - 1].position;\n\t\t\tlet d = last.distanceTo(first);\n\t\t\t\n\t\t\tdistance += d;\n\t\t}\n\t\t\n\t\treturn distance;\n\t}\n\t\n\tgetAngleBetweenLines(cornerPoint, point1, point2) {\n        let v1 = new THREE.Vector3().subVectors(point1.position, cornerPoint.position);\n        let v2 = new THREE.Vector3().subVectors(point2.position, cornerPoint.position);\n        return v1.angleTo(v2);\n    };\n\t\n\tgetAngle(index){\n\t\n\t\tif(this.points.length < 3 || index >= this.points.length){\n\t\t\treturn 0;\n\t\t}\n\t\t\n\t\tlet previous = (index === 0) ? this.points[this.points.length-1] : this.points[index-1];\n\t\tlet point = this.points[index];\n\t\tlet next = this.points[(index + 1) % (this.points.length)];\n\t\t\n\t\treturn this.getAngleBetweenLines(point, previous, next);\n\t};\n\t\n\tupdate(){\n\t\n\t\tif(this.points.length === 0){\n\t\t\treturn;\n\t\t}else if(this.points.length === 1){\n\t\t\tlet point = this.points[0];\n\t\t\tlet position = point.position;\n\t\t\tthis.spheres[0].position.copy(position);\n\t\t\t\n\t\t\t{// coordinate labels\n\t\t\t\tlet coordinateLabel = this.coordinateLabels[0];\n\t\t\t\t\n\t\t\t\tlet labelPos = position.clone().add(new THREE.Vector3(0,1,0));\n\t\t\t\tcoordinateLabel.position.copy(labelPos);\n\t\t\t\t\n\t\t\t\t/*let msg = Potree.utils.addCommas(position.x.toFixed(2)) \n\t\t\t\t\t+ \" / \" + Potree.utils.addCommas(position.y.toFixed(2)) \n\t\t\t\t\t+ \" / \" + Potree.utils.addCommas(position.z.toFixed(2));*/\n\t\t\t\tlet msg = Potree.utils.addCommas(position.z.toFixed(2) + \" \" + this.lengthUnit.code);\n\t\t\t\tcoordinateLabel.setText(msg);\n\t\t\t\t\n\t\t\t\tcoordinateLabel.visible = this.showCoordinates;\n\t\t\t}\n\t\t\t\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tlet lastIndex = this.points.length - 1;\n\t\t\n\t\tlet centroid = new THREE.Vector3();\n\t\tfor(let i = 0; i <= lastIndex; i++){\n\t\t\tlet point = this.points[i];\n\t\t\tcentroid.add(point.position);\n\t\t}\n\t\tcentroid.divideScalar(this.points.length);\n\t\t\n\t\tfor(let i = 0; i <= lastIndex; i++){\n\t\t\tlet index = i;\n\t\t\tlet nextIndex = ( i + 1 > lastIndex ) ? 0 : i + 1;\n\t\t\tlet previousIndex = (i === 0) ? lastIndex : i - 1;\n\t\t\n\t\t\tlet point = this.points[index];\n\t\t\tlet nextPoint = this.points[nextIndex];\n\t\t\tlet previousPoint = this.points[previousIndex];\n\t\t\t\n\t\t\tlet sphere = this.spheres[index];\n\t\t\t\n\t\t\t// spheres\n\t\t\tsphere.position.copy(point.position);\n\t\t\tsphere.material.color = this.color;\n\n\t\t\t{// edges\n\t\t\t\tlet edge = this.edges[index];\n\t\t\t\t\n\t\t\t\tedge.material.color = this.color;\n\t\t\t\t\n\t\t\t\tedge.position.copy(point.position);\n\t\t\t\t\n\t\t\t\tedge.geometry.vertices[0].set(0, 0, 0);\n\t\t\t\tedge.geometry.vertices[1].copy(nextPoint.position).sub(point.position);\n\t\t\t\t\n\t\t\t\tedge.geometry.verticesNeedUpdate = true;\n\t\t\t\tedge.geometry.computeBoundingSphere();\n\t\t\t\tedge.visible = index < lastIndex || this.closed;\n\t\t\t}\n\t\t\t\n\t\t\t{// edge labels\n\t\t\t\tlet edgeLabel = this.edgeLabels[i];\n\t\t\t\n\t\t\t\tlet center = new THREE.Vector3().add(point.position);\n\t\t\t\tcenter.add(nextPoint.position);\n\t\t\t\tcenter = center.multiplyScalar(0.5);\n\t\t\t\tlet distance = point.position.distanceTo(nextPoint.position);\n\t\t\t\t\n\t\t\t\tedgeLabel.position.copy(center);\n\t\t\t\tedgeLabel.setText(Potree.utils.addCommas(distance.toFixed(2)) + \" \" + this.lengthUnit.code);\n\t\t\t\tedgeLabel.visible = this.showDistances && (index < lastIndex || this.closed) && this.points.length >= 2 && distance > 0;\n\t\t\t}\n\t\t\t\n\t\t\t{// angle labels\n\t\t\t\tlet angleLabel = this.angleLabels[i];\n\t\t\t\tlet angle = this.getAngleBetweenLines(point, previousPoint, nextPoint);\n\t\t\t\t\n\t\t\t\tlet dir = nextPoint.position.clone().sub(previousPoint.position);\n\t\t\t\tdir.multiplyScalar(0.5);\n\t\t\t\tdir = previousPoint.position.clone().add(dir).sub(point.position).normalize();\n\t\t\t\t\n\t\t\t\tlet dist = Math.min(point.position.distanceTo(previousPoint.position), point.position.distanceTo(nextPoint.position));\n\t\t\t\tdist = dist / 9;\n\t\t\t\t\n\t\t\t\tlet labelPos = point.position.clone().add(dir.multiplyScalar(dist));\n\t\t\t\tangleLabel.position.copy(labelPos);\n\t\t\t\t\n\t\t\t\tlet msg = Potree.utils.addCommas((angle*(180.0/Math.PI)).toFixed(1)) + '\\u00B0';\n\t\t\t\tangleLabel.setText(msg);\n\t\t\t\t\n\t\t\t\tangleLabel.visible = this.showAngles && (index < lastIndex || this.closed) && this.points.length >= 3 && angle > 0;\n\t\t\t}\n\t\t\t\n\t\t\t{// coordinate labels\n\t\t\t\tlet coordinateLabel = this.coordinateLabels[0];\n\t\t\t\t\n\t\t\t\tlet labelPos = point.position.clone().add(new THREE.Vector3(0,1,0));\n\t\t\t\tcoordinateLabel.position.copy(labelPos);\n\t\t\t\t\n\t\t\t\t/*let msg = Potree.utils.addCommas(point.position.x.toFixed(2)) \n\t\t\t\t\t+ \" / \" + Potree.utils.addCommas(point.position.y.toFixed(2)) \n\t\t\t\t\t+ \" / \" + Potree.utils.addCommas(point.position.z.toFixed(2));*/\n\n\t\t\t\tlet msg = Potree.utils.addCommas(point.position.z.toFixed(2) + \" \" + this.lengthUnit.code);\n\t\t\t\tcoordinateLabel.setText(msg);\n\t\t\t\t\n\t\t\t\t//coordinateLabel.visible = this.showCoordinates && (index < lastIndex || this.closed);\n\t\t\t\tcoordinateLabel.visible = this.showCoordinates;\n\t\t\t}\n\t\t}\n\n\t\t{ // update height stuff\n\t\t\tlet heightEdge = this.heightEdge;\n\t\t\theightEdge.visible = this.showHeight;\n\t\t\tthis.heightLabel.visible = this.showHeight;\n\t\t\t\n\t\t\tif(this.showHeight){\n\t\t\t\tlet sorted = this.points.slice().sort( (a, b) => a.position.z - b.position.z );\n\t\t\t\tlet lowPoint = sorted[0].position.clone();\n\t\t\t\tlet highPoint = sorted[sorted.length - 1].position.clone();\n\t\t\t\tlet min = lowPoint.z;\n\t\t\t\tlet max = highPoint.z;\n\t\t\t\tlet height = max - min;\n\t\t\t\t\n\t\t\t\tlet start = new THREE.Vector3(highPoint.x, highPoint.y, min);\n\t\t\t\tlet end = new THREE.Vector3(highPoint.x, highPoint.y, max);\n\t\t\t\t\n\t\t\t\theightEdge.position.copy(lowPoint);\n\t\t\t\t\n\t\t\t\theightEdge.geometry.vertices[0].set(0, 0, 0);\n\t\t\t\theightEdge.geometry.vertices[1].copy(start).sub(lowPoint);\n\t\t\t\theightEdge.geometry.vertices[2].copy(start).sub(lowPoint);\n\t\t\t\theightEdge.geometry.vertices[3].copy(end).sub(lowPoint);\n\t\t\t\t\n\t\t\t\theightEdge.geometry.verticesNeedUpdate = true;\n\t\t\t\t//heightEdge.geometry.computeLineDistances();\n\t\t\t\t//heightEdge.geometry.lineDistancesNeedUpdate = true;\n\t\t\t\theightEdge.geometry.computeBoundingSphere();\n\t\t\t\t\n\t\t\t\t//heightEdge.material.dashSize = height / 40;\n\t\t\t\t//heightEdge.material.gapSize = height / 40;\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tlet heightLabelPosition = start.clone().add(end).multiplyScalar(0.5);\n\t\t\t\tthis.heightLabel.position.copy(heightLabelPosition);\n\t\t\t\tlet msg = Potree.utils.addCommas(height.toFixed(2)) + \" \" + this.lengthUnit.code;\n\t\t\t\tthis.heightLabel.setText(msg);\n\t\t\t}\n\t\t\t\n\t\t}\n\t\t\n\t\t{ // update area label\n\t\t\tthis.areaLabel.position.copy(centroid);\n\t\t\tthis.areaLabel.visible = this.showArea && this.points.length >= 3;\n\t\t\tlet msg = Potree.utils.addCommas(this.getArea().toFixed(1)) + \" \" + this.lengthUnit.code + \"\\u00B2\";\n\t\t\tthis.areaLabel.setText(msg);\n\t\t}\n\t};\n\t\n\traycast(raycaster, intersects){\n\t\t\n\t\tfor(let i = 0; i < this.points.length; i++){\n\t\t\tlet sphere = this.spheres[i];\n\t\t\t\n\t\t\tsphere.raycast(raycaster, intersects);\n\t\t}\n\t\t\n\t\t// recalculate distances because they are not necessarely correct\n\t\t// for scaled objects.\n\t\t// see https://github.com/mrdoob/three.js/issues/5827\n\t\t// TODO: remove this once the bug has been fixed\n\t\tfor(let i = 0; i < intersects.length; i++){\n\t\t\tlet I = intersects[i];\n\t\t\tI.distance = raycaster.ray.origin.distanceTo(I.point);\n\t\t}\n\t\tintersects.sort( function ( a, b ) { return a.distance - b.distance;} );\n\t};\n\t\n\tget showCoordinates(){\n\t\treturn this._showCoordinates;\n\t}\n\t\n\tset showCoordinates(value){\n\t\tthis._showCoordinates = value;\n\t\tthis.update();\n\t}\n\t\n\tget showAngles(){\n\t\treturn this._showAngles;\n\t}\n\t\n\tset showAngles(value){\n\t\tthis._showAngles = value;\n\t\tthis.update();\n\t}\n\t\n\tget showHeight(){\n\t\treturn this._showHeight;\n\t}\n\t\n\tset showHeight(value){\n\t\tthis._showHeight = value;\n\t\tthis.update();\n\t}\n\t\n\tget showArea(){\n\t\treturn this._showArea;\n\t}\n\t\n\tset showArea(value){\n\t\tthis._showArea = value;\n\t\tthis.update();\n\t}\n\t\n\tget closed(){\n\t\treturn this._closed;\n\t}\n\t\n\tset closed(value){\n\t\tthis._closed = value;\n\t\tthis.update();\n\t}\n\t\n\tget showDistances(){\n\t\treturn this._showDistances;\n\t}\n\t\n\tset showDistances(value){\n\t\tthis._showDistances = value;\n\t\tthis.update();\n\t}\n};\n\n\nPotree.MeasuringTool = class MeasuringTool extends THREE.EventDispatcher{\n\t\n\tconstructor(viewer){\n\t\tsuper();\n\t\t\n\t\tthis.viewer = viewer;\n\t\tthis.renderer = viewer.renderer;\n\t\t\n\t\tthis.addEventListener(\"start_inserting_measurement\", e => {\n\t\t\tthis.viewer.dispatchEvent({\n\t\t\t\ttype: \"cancel_insertions\"\n\t\t\t});\n\t\t});\n\t\t\n\t\tthis.sceneMeasurement = new THREE.Scene();\n\t\tthis.sceneMeasurement.name = \"scene_measurement\";\n\t\tthis.light = new THREE.PointLight( 0xffffff, 1.0 );\n\t\tthis.sceneMeasurement.add(this.light);\n\t\t\n\t\tthis.viewer.inputHandler.registerInteractiveScene(this.sceneMeasurement);\n\t\t\n\t\tthis.onRemove = (e) => {this.sceneMeasurement.remove(e.measurement)};\n\t\tthis.onAdd = e => {this.sceneMeasurement.add(e.measurement)};\n\t}\n\t\n\tsetScene(scene){\n\t\tif(this.scene === scene){\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tif(this.scene){\n\t\t\tthis.scene.removeEventListener(\"measurement_added\", this.onAdd);\n\t\t\tthis.scene.removeEventListener(\"measurement_removed\", this.onRemove);\n\t\t}\n\t\t\n\t\tthis.scene = scene;\n\t\t\n\t\tthis.scene.addEventListener(\"measurement_added\", this.onAdd);\n\t\tthis.scene.addEventListener(\"measurement_removed\", this.onRemove);\n\t\t\n\t}\n\t\n\tstartInsertion(args = {}){\n\t\t\n\t\tlet domElement = this.viewer.renderer.domElement;\n\t\t\n\t\tlet measure = new Potree.Measure();\n\t\t\n\t\tthis.dispatchEvent({\n\t\t\ttype: \"start_inserting_measurement\",\n\t\t\tmeasure: measure\n\t\t});\n\n\t\tmeasure.showDistances =  (args.showDistances == null) ? true : args.showDistances;\n\t\tmeasure.showArea = args.showArea || false;\n\t\tmeasure.showAngles = args.showAngles || false;\n\t\tmeasure.showCoordinates = args.showCoordinates || false;\n\t\tmeasure.showHeight = args.showHeight || false;\n\t\tmeasure.closed = args.closed || false;\n\t\tmeasure.maxMarkers = args.maxMarkers || Infinity;\n\t\tmeasure.name = args.name || \"Measurement\";\n\t\t\n\t\tthis.sceneMeasurement.add(measure);\n\t\t\n\t\tlet cancel = {\n\t\t\tremoveLastMarker: measure.maxMarkers > 3,\n\t\t\tcallback: null\n\t\t};\n\t\t\n\t\tlet insertionCallback = (e) => {\n\t\t\tif(e.button === THREE.MOUSE.LEFT){\n\t\t\t\t\n\t\t\t\tmeasure.addMarker(measure.points[measure.points.length - 1].position.clone());\n\t\t\t\t\n\t\t\t\tif(measure.points.length >= measure.maxMarkers){\n\t\t\t\t\tcancel.callback();\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tthis.viewer.inputHandler.startDragging(\n\t\t\t\t\tmeasure.spheres[measure.spheres.length - 1]);\n\t\t\t}else if(e.button === THREE.MOUSE.RIGHT){\n\t\t\t\tcancel.callback();\n\t\t\t}\n\t\t};\n\t\t\n\t\tcancel.callback = e => {\n\t\t\tif(cancel.removeLastMarker){\n\t\t\t\tmeasure.removeMarker(measure.points.length - 1);\n\t\t\t}\n\t\t\tdomElement.removeEventListener(\"mouseup\", insertionCallback, true);\n\t\t\tthis.viewer.removeEventListener(\"cancel_insertions\", cancel.callback);\n\t\t};\n\t\t\n\t\tif(measure.maxMarkers > 1){\n\t\t\tthis.viewer.addEventListener(\"cancel_insertions\", cancel.callback);\n\t\t\tdomElement.addEventListener(\"mouseup\", insertionCallback , true);\n\t\t}\n\t\t\n\t\tmeasure.addMarker(new THREE.Vector3(0, 0, 0));\n\t\tthis.viewer.inputHandler.startDragging(\n\t\t\tmeasure.spheres[measure.spheres.length - 1]);\n\t\t\t\n\t\tthis.viewer.scene.addMeasurement(measure);\n\t}\n\t\n\tupdate(){\n\t\tlet camera = this.viewer.scene.camera;\n\t\tlet domElement = this.renderer.domElement;\n\t\tlet measurements = this.viewer.scene.measurements;\n\t\t\n\t\tthis.light.position.copy(camera.position);\n\t\t\n\t\t// make size independant of distance\n\t\tfor(let measure of measurements){\n\t\t\t\n\t\t\tmeasure.lengthUnit = this.viewer.lengthUnit;\n\t\t\tmeasure.update();\n\n\t\t\t// spheres\n\t\t\tfor(let sphere of measure.spheres){\n\t\t\t\tlet distance = camera.position.distanceTo(sphere.getWorldPosition());\n\t\t\t\tlet pr = Potree.utils.projectedRadius(1, camera.fov * Math.PI / 180, distance, domElement.clientHeight);\n\t\t\t\tlet scale = (15 / pr);\n\t\t\t\tsphere.scale.set(scale, scale, scale);\n\t\t\t}\n\t\t\t\n\t\t\t// labels\n\t\t\tlet labels = measure.edgeLabels.concat(measure.angleLabels);\n\t\t\tfor(let label of labels){\n\t\t\t\tlet distance = camera.position.distanceTo(label.getWorldPosition());\n\t\t\t\tlet pr = Potree.utils.projectedRadius(1, camera.fov * Math.PI / 180, distance, domElement.clientHeight);\n\t\t\t\tlet scale = (70 / pr);\n\t\t\t\tlabel.scale.set(scale, scale, scale);\n\t\t\t}\n\t\t\t\n\t\t\t// coordinate labels\n\t\t\tfor(let j = 0; j < measure.coordinateLabels.length; j++){\n\t\t\t\tlet label = measure.coordinateLabels[j]\n\t\t\t\tlet sphere = measure.spheres[j];\n\t\t\t\tlet point = measure.points[j];\n\t\t\t\t\n\t\t\t\tlet distance = camera.position.distanceTo(sphere.getWorldPosition());\n\t\t\t\t\t\n\t\t\t\tlet screenPos = sphere.getWorldPosition().clone().project( camera );\n\t\t\t\tscreenPos.x = Math.round( ( screenPos.x + 1 ) * domElement.clientWidth  / 2 ),\n\t\t\t\tscreenPos.y = Math.round( ( - screenPos.y + 1 ) * domElement.clientHeight / 2 );\n\t\t\t\tscreenPos.z = 0;\n\t\t\t\tscreenPos.y -= 30;\n\t\t\t\t\n\t\t\t\tlet labelPos = new THREE.Vector3( \n\t\t\t\t\t(screenPos.x / domElement.clientWidth) * 2 - 1, \n\t\t\t\t\t-(screenPos.y / domElement.clientHeight) * 2 + 1, \n\t\t\t\t\t0.5 );\n\t\t\t\tlabelPos.unproject(camera);\n                \n\t\t\t\tlet direction = labelPos.sub(camera.position).normalize();\n\t\t\t\tlabelPos = new THREE.Vector3().addVectors(\n\t\t\t\t\tcamera.position, direction.multiplyScalar(distance));\n\t\t\t\t\t\n\t\t\t\tlabel.position.copy(labelPos);\n\t\t\t\t\n\t\t\t\tlet pr = Potree.utils.projectedRadius(1, camera.fov * Math.PI / 180, distance, domElement.clientHeight);\n\t\t\t\tlet scale = (70 / pr);\n\t\t\t\tlabel.scale.set(scale, scale, scale);\n\t\t\t}\n\t\t\t\n\t\t\t// height label\n\t\t\tif(measure.showHeight){ \n\t\t\t\tlet label = measure.heightLabel;\n\t\t\t\n\t\t\t\t{\n\t\t\t\t\tlet distance = label.position.distanceTo(camera.position);\n\t\t\t\t\tlet pr = Potree.utils.projectedRadius(1, camera.fov * Math.PI / 180, distance, domElement.clientHeight);\n\t\t\t\t\tlet scale = (70 / pr);\n\t\t\t\t\tlabel.scale.set(scale, scale, scale);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t{ // height edge\n\t\t\t\t\tlet edge = measure.heightEdge;\n\t\t\t\t\tlet lowpoint = edge.geometry.vertices[0].clone().add(edge.position);\n\t\t\t\t\tlet start = edge.geometry.vertices[2].clone().add(edge.position);\n\t\t\t\t\tlet end = edge.geometry.vertices[3].clone().add(edge.position);\n\t\t\t\t\t\n\t\t\t\t\tlet lowScreen = lowpoint.clone().project(camera);\n\t\t\t\t\tlet startScreen = start.clone().project(camera);\n\t\t\t\t\tlet endScreen = end.clone().project(camera);\n\t\t\t\t\t\n\t\t\t\t\tlet toPixelCoordinates = v => {\n\t\t\t\t\t\tlet r = v.clone().addScalar(1).divideScalar(2);\n\t\t\t\t\t\tr.x = r.x * domElement.clientWidth;\n\t\t\t\t\t\tr.y = r.y * domElement.clientHeight;\n\t\t\t\t\t\tr.z = 0;\n\t\t\t\t\t\t\n\t\t\t\t\t\treturn r;\n\t\t\t\t\t};\n\t\t\t\t\n\t\t\t\t\tlet lowEL = toPixelCoordinates(lowScreen);\n\t\t\t\t\tlet startEL = toPixelCoordinates(startScreen);\n\t\t\t\t\tlet endEL = toPixelCoordinates(endScreen);\n\t\t\t\t\t\n\t\t\t\t\tlet distances = [0, \n\t\t\t\t\t\tlowEL.distanceTo(startEL),\n\t\t\t\t\t\tstartEL.distanceTo(endEL), 0];\n\t\t\t\t\t\t\n\t\t\t\t\tlet lToS = lowEL.distanceTo(startEL);\n\t\t\t\t\tlet sToE = startEL.distanceTo(endEL);\n\t\t\t\t\t\n\t\t\t\t\tedge.geometry.lineDistances = [0, lToS, lToS, lToS + sToE];\n\t\t\t\t\tedge.geometry.lineDistancesNeedUpdate = true;\n\t\t\t\t\t\t\n\t\t\t\t\tedge.material.dashSize = 10;\n\t\t\t\t\tedge.material.gapSize = 10;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t{ // area label\n\t\t\t\tlet label = measure.areaLabel;\n\t\t\t\n\t\t\t\tlet distance = label.position.distanceTo(camera.position);\n\t\t\t\tlet pr = Potree.utils.projectedRadius(1, camera.fov * Math.PI / 180, distance, domElement.clientHeight);\n\t\t\t\tlet scale = (70 / pr);\n\t\t\t\tlabel.scale.set(scale, scale, scale);\n\t\t\t}\n\t\t\t\n\t\t}\n\t\t\n\t\t\n\t}\n\t\n};\n\n\n\n\n\n\n\nPotree.Profile = class extends THREE.Object3D{\n\t\n\tconstructor(){\n\t\tsuper();\n\t\t\n\t\tthis.constructor.counter = (this.constructor.counter === undefined) ? 0 : this.constructor.counter + 1;\n\t\t\n\t\tthis.name = \"Profile_\" + this.constructor.counter;\n\t\tthis.points = [];\n\t\tthis.spheres = [];\n\t\tthis.edges = [];\n\t\tthis.boxes = [];\n\t\tthis.width = 1;\n\t\tthis.height = 20;\n\t\tthis._modifiable = true;\n\t\n\t\tthis.sphereGeometry = new THREE.SphereGeometry(0.4, 10, 10);\n\t\tthis.color = new THREE.Color( 0xff0000 );\n\t\tthis.lineColor = new THREE.Color( 0xff0000 );\n\t}\n\t\n\tcreateSphereMaterial(){\n\t\tlet sphereMaterial = new THREE.MeshLambertMaterial({\n\t\t\tshading: THREE.SmoothShading, \n\t\t\tcolor: 0xff0000, \n\t\t\tdepthTest: false, \n\t\t\tdepthWrite: false}\n\t\t);\n\t\t\n\t\treturn sphereMaterial;\n\t};\n\t\n\tgetSegments(){\n\t\tlet segments = [];\n\t\t\n\t\tfor(let i = 0; i < this.points.length - 1; i++){\n\t\t\tlet start = this.points[i].clone();\n\t\t\tlet end = this.points[i+1].clone();\n\t\t\tsegments.push({start: start, end: end});\n\t\t}\n\t\t\n\t\treturn segments;\n\t}\n\t\n\tgetSegmentMatrices(){\n\t\tlet segments = this.getSegments();\n\t\tlet matrices = [];\n\t\n\t\tfor(let segment of segments){\n\t\t\tlet {start, end} = segment;\n\t\t\t\n\t\t\tlet box = new THREE.Object3D();\n\t\t\t\n\t\t\tlet length = start.clone().setZ(0).distanceTo(end.clone().setZ(0));\n\t\t\tbox.scale.set(length, 10000, this.width);\n\t\t\tbox.up.set(0, 0, 1);\n\n\t\t\tlet center = new THREE.Vector3().addVectors(start, end).multiplyScalar(0.5);\n\t\t\tlet diff = new THREE.Vector3().subVectors(end, start);\n\t\t\tlet target = new THREE.Vector3(diff.y, -diff.x, 0);\n\n\t\t\tbox.position.set(0,0,0);\n\t\t\tbox.lookAt(target);\n\t\t\tbox.position.copy(center);\n\t\t\t\n\t\t\tbox.updateMatrixWorld();\n\t\t\tmatrices.push(box.matrixWorld);\n\t\t}\n\t\t\n\t\treturn matrices;\n\t}\n\t\n\taddMarker(point){\n\t\tthis.points.push(point);\n\t\t\n\t\tlet sphere = new THREE.Mesh(this.sphereGeometry, this.createSphereMaterial());\n\t\t\n\t\tthis.add(sphere);\n\t\tthis.spheres.push(sphere);\n\t\t\n\t\t// edges & boxes\n\t\tif(this.points.length > 1){\n\t\t\n\t\t\tvar lineGeometry = new THREE.Geometry();\n\t\t\tlineGeometry.vertices.push(new THREE.Vector3(), new THREE.Vector3());\n\t\t\tlineGeometry.colors.push(this.lineColor, this.lineColor, this.lineColor);\n\t\t\tvar lineMaterial = new THREE.LineBasicMaterial( { \n\t\t\t\tvertexColors: THREE.VertexColors, \n\t\t\t\tlinewidth: 2, \n\t\t\t\ttransparent: true, \n\t\t\t\topacity: 0.4 \n\t\t\t});\n\t\t\tlineMaterial.depthTest = false;\n\t\t\tvar edge = new THREE.Line(lineGeometry, lineMaterial);\n\t\t\tedge.visible = false;\n\t\t\t\n\t\t\tthis.add(edge);\n\t\t\tthis.edges.push(edge);\n\t\t\t\n\t\t\t\n\t\t\tvar boxGeometry = new THREE.BoxGeometry(1, 1, 1);\n\t\t\tvar boxMaterial = new THREE.MeshBasicMaterial({color: 0xff0000, transparent: true, opacity: 0.2});\n\t\t\tvar box = new THREE.Mesh(boxGeometry, boxMaterial);\n\t\t\tbox.visible = false;\n\t\t\t\n\t\t\tthis.add(box);\n\t\t\tthis.boxes.push(box);\n\t\t}\n\t\t\n\t\t{ // event listeners\n\t\t\tlet drag = (e) => {\n\t\t\t\tlet I = Potree.utils.getMousePointCloudIntersection(\n\t\t\t\t\te.drag.end, \n\t\t\t\t\te.viewer.scene.camera, \n\t\t\t\t\te.viewer.renderer, \n\t\t\t\t\te.viewer.scene.pointclouds);\n\t\t\t\t\n\t\t\t\tif(I){\n\t\t\t\t\tlet i = this.spheres.indexOf(e.drag.object);\n\t\t\t\t\tif(i !== -1){\n\t\t\t\t\t\tthis.setPosition(i, I.location);\n\t\t\t\t\t\tthis.dispatchEvent({\n\t\t\t\t\t\t\t\"type\": \"marker_moved\",\n\t\t\t\t\t\t\t\"profile\": this,\n\t\t\t\t\t\t\t\"index\": i\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\t\n\t\t\tlet drop = e => {\n\t\t\t\tlet i = this.spheres.indexOf(e.drag.object);\n\t\t\t\tif(i !== -1){\n\t\t\t\t\tthis.dispatchEvent({\n\t\t\t\t\t\t\"type\": \"marker_dropped\",\n\t\t\t\t\t\t\"profile\": this,\n\t\t\t\t\t\t\"index\": i\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\t\t\t\n\t\t\tlet mouseover = (e) => e.object.material.emissive.setHex(0x888888);\n\t\t\tlet mouseleave = (e) => e.object.material.emissive.setHex(0x000000);\n\t\t\n\t\t\tsphere.addEventListener(\"drag\", drag);\n\t\t\tsphere.addEventListener(\"drop\", drop);\n\t\t\tsphere.addEventListener(\"mouseover\", mouseover);\n\t\t\tsphere.addEventListener(\"mouseleave\", mouseleave);\n\t\t}\n\t\t\n\t\tlet event = {\n\t\t\ttype: \"marker_added\",\n\t\t\tprofile: this,\n\t\t\tsphere: sphere\n\t\t};\n\t\tthis.dispatchEvent(event);\n\t\t\n\t\tthis.setPosition(this.points.length-1, point);\n\t}\n\t\n\tremoveMarker(index){\n\t\tthis.points.splice(index, 1);\n\t\t\n\t\tthis.remove(this.spheres[index]);\n\t\t\n\t\tvar edgeIndex = (index === 0) ? 0 : (index - 1);\n\t\tthis.remove(this.edges[edgeIndex]);\n\t\tthis.edges.splice(edgeIndex, 1);\n\t\tthis.remove(this.boxes[edgeIndex]);\n\t\tthis.boxes.splice(edgeIndex, 1);\n\t\t\n\t\tthis.spheres.splice(index, 1);\n\t\t\n\t\tthis.update();\n\t\t\n\t\tthis.dispatchEvent({\n\t\t\t\"type\": \"marker_removed\",\n\t\t\t\"profile\": this\n\t\t});\n\t}\n\t\n\tsetPosition(index, position){\n\t\tlet point = this.points[index];\t\t\t\n\t\tpoint.copy(position);\n\t\t\n\t\tlet event = {\n\t\t\ttype: \t\t'marker_moved',\n\t\t\tprofile:\tthis,\n\t\t\tindex:\t\tindex,\n\t\t\tposition: \tpoint.clone()\n\t\t};\n\t\tthis.dispatchEvent(event);\n\t\t\n\t\tthis.update();\n\t}\n\t\n\tsetWidth(width){\n\t\tthis.width = width;\n\t\t\n\t\tlet event = {\n\t\t\ttype: \t\t'width_changed',\n\t\t\tprofile:\tthis,\n\t\t\twidth:\t\twidth\n\t\t};\n\t\tthis.dispatchEvent(event);\n\t\t\n\t\tthis.update();\n\t}\n\t\n\tgetWidth(){\n\t\treturn this.width;\n\t}\n\t\n\tupdate(){\n\t\t\n\t\tif(this.points.length === 0){\n\t\t\treturn;\n\t\t}else if(this.points.length === 1){\n\t\t\tlet point = this.points[0];\n\t\t\tthis.spheres[0].position.copy(point);\n\t\t\t\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tlet min = this.points[0].clone();\n\t\tlet max = this.points[0].clone();\n\t\tlet centroid = new THREE.Vector3();\n\t\tlet lastIndex = this.points.length - 1;\n\t\tfor(var i = 0; i <= lastIndex; i++){\n\t\t\tlet point = this.points[i];\n\t\t\tlet sphere = this.spheres[i];\n\t\t\tlet leftIndex = (i === 0) ? lastIndex : i - 1;\n\t\t\tlet rightIndex = (i === lastIndex) ? 0 : i + 1;\n\t\t\tlet leftVertex = this.points[leftIndex];\n\t\t\tlet rightVertex = this.points[rightIndex];\n\t\t\tlet leftEdge = this.edges[leftIndex];\n\t\t\tlet rightEdge = this.edges[i];\n\t\t\tlet leftBox = this.boxes[leftIndex];\n\t\t\tlet rightBox = this.boxes[i];\n\t\t\t\n\t\t\tlet leftEdgeLength = point.distanceTo(leftVertex);\n\t\t\tlet rightEdgeLength = point.distanceTo(rightVertex);\n\t\t\tlet leftEdgeCenter = new THREE.Vector3().addVectors(leftVertex, point).multiplyScalar(0.5);\n\t\t\tlet rightEdgeCenter = new THREE.Vector3().addVectors(point, rightVertex).multiplyScalar(0.5);\n\t\t\t\n\t\t\tsphere.position.copy(point);\n\t\t\t\n\t\t\tif(this._modifiable){\n\t\t\t\tsphere.visible = true;\n\t\t\t}else{\n\t\t\t\tsphere.visible = false;\n\t\t\t}\n\t\t\t\n\t\t\tif(leftEdge){\n\t\t\t\tleftEdge.geometry.vertices[1].copy(point);\n\t\t\t\tleftEdge.geometry.verticesNeedUpdate = true;\n\t\t\t\tleftEdge.geometry.computeBoundingSphere();\n\t\t\t}\n\t\t\t\n\t\t\tif(rightEdge){\n\t\t\t\trightEdge.geometry.vertices[0].copy(point);\n\t\t\t\trightEdge.geometry.verticesNeedUpdate = true;\n\t\t\t\trightEdge.geometry.computeBoundingSphere();\n\t\t\t}\n\t\t\t\n\t\t\tif(leftBox){\n\t\t\t\tvar start = leftVertex;\n\t\t\t\tvar end = point;\n\t\t\t\tvar length = start.clone().setZ(0).distanceTo(end.clone().setZ(0));\n\t\t\t\tleftBox.scale.set(length, 1000000, this.width);\n\t\t\t\tleftBox.up.set(0, 0, 1);\n\t\t\t\t\n\t\t\t\tvar center = new THREE.Vector3().addVectors(start, end).multiplyScalar(0.5);\n\t\t\t\tvar diff = new THREE.Vector3().subVectors(end, start);\n\t\t\t\tvar target = new THREE.Vector3(diff.y, -diff.x, 0);\n\t\t\t\t\n\t\t\t\tleftBox.position.set(0,0,0);\n\t\t\t\tleftBox.lookAt(target);\n\t\t\t\tleftBox.position.copy(center);\n\t\t\t}\n\n\t\t\tcentroid.add(point);\n\t\t\tmin.min(point);\n\t\t\tmax.max(point);\n\t\t}\n\t\tcentroid.multiplyScalar(1 / this.points.length);\n\t\t\n\t\tfor(var i = 0; i < this.boxes.length; i++){\n\t\t\tvar box = this.boxes[i];\n\t\t\t\n\t\t\tbox.position.z = min.z + (max.z - min.z) / 2;\n\t\t}\n\t}\n\t\n\traycast(raycaster, intersects){\n\t\t\n\t\tfor(let i = 0; i < this.points.length; i++){\n\t\t\tlet sphere = this.spheres[i];\n\t\t\t\n\t\t\tsphere.raycast(raycaster, intersects);\n\t\t}\n\t\t\n\t\t// recalculate distances because they are not necessarely correct\n\t\t// for scaled objects.\n\t\t// see https://github.com/mrdoob/three.js/issues/5827\n\t\t// TODO: remove this once the bug has been fixed\n\t\tfor(let i = 0; i < intersects.length; i++){\n\t\t\tlet I = intersects[i];\n\t\t\tI.distance = raycaster.ray.origin.distanceTo(I.point);\n\t\t}\n\t\tintersects.sort( function ( a, b ) { return a.distance - b.distance;} );\n\t};\n\t\n\tget modifiable(){\n\t\treturn this._modifiable;\n\t}\n\t\n\tset modifiable(value){\n\t\tthis._modifiable = value;\n\t\tthis.update();\n\t}\n};\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nPotree.ProfileTool = class ProfileTool extends THREE.EventDispatcher{\n\t\n\tconstructor(viewer){\n\t\tsuper();\n\t\t\n\t\tthis.viewer = viewer;\n\t\tthis.renderer = viewer.renderer;\n\t\t\n\t\tthis.addEventListener(\"start_inserting_profile\", e => {\n\t\t\tthis.viewer.dispatchEvent({\n\t\t\t\ttype: \"cancel_insertions\"\n\t\t\t});\n\t\t});\n\t\t\n\t\tthis.sceneProfile = new THREE.Scene();\n\t\tthis.sceneProfile.name = \"scene_profile\";\n\t\tthis.light = new THREE.PointLight( 0xffffff, 1.0 );\n\t\tthis.sceneProfile.add(this.light);\n\t\t\n\t\tthis.viewer.inputHandler.registerInteractiveScene(this.sceneProfile);\n\n\t\tthis.onRemove = e => this.sceneProfile.remove(e.profile);\n\t\tthis.onAdd = e => this.sceneProfile.add(e.profile);\n\t}\n\t\n\tsetScene(scene){\n\t\tif(this.scene === scene){\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tif(this.scene){\n\t\t\tthis.scene.removeEventListeners(\"profile_added\", this.onAdd);\n\t\t\tthis.scene.removeEventListeners(\"profile_removed\", this.onRemove);\n\t\t}\n\t\t\n\t\tthis.scene = scene;\n\t\t\n\t\tthis.scene.addEventListener(\"profile_added\", this.onAdd);\n\t\tthis.scene.addEventListener(\"profile_removed\", this.onRemove);\n\t}\n\t\n\tstartInsertion(args = {}){\n\t\tlet domElement = this.viewer.renderer.domElement;\n\t\t\n\t\tlet profile = new Potree.Profile();\n\t\tprofile.name = args.name || \"Profile\";\n\t\t\n\t\tthis.dispatchEvent({\n\t\t\ttype: \"start_inserting_profile\",\n\t\t\tprofile: profile\n\t\t});\n\t\t\n\t\tthis.sceneProfile.add(profile);\n\t\t\n\t\tlet cancel = {\n\t\t\tcallback: null\n\t\t};\n\t\t\n\t\tlet insertionCallback = (e) => {\n\t\t\tif(e.button === THREE.MOUSE.LEFT){\n\t\t\t\tif(profile.points.length <= 1){\n\t\t\t\t\tlet camera = this.viewer.scene.camera;\n\t\t\t\t\tlet distance = camera.position.distanceTo(profile.points[0]);\n\t\t\t\t\tlet pr = Potree.utils.projectedRadius(1, camera.fov * Math.PI / 180, distance, domElement.clientHeight);\n\t\t\t\t\tlet width = (10 / pr);\n\t\t\t\t\t\n\t\t\t\t\tprofile.setWidth(width);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tprofile.addMarker(profile.points[profile.points.length - 1].clone());\n\t\t\t\t\n\t\t\t\tthis.viewer.inputHandler.startDragging(\n\t\t\t\t\tprofile.spheres[profile.spheres.length - 1]);\n\t\t\t}else if(e.button === THREE.MOUSE.RIGHT){\n\t\t\t\tcancel.callback();\n\t\t\t}\n\t\t};\n\t\t\n\t\t\n\t\t\n\t\tcancel.callback = e => {\n\t\t\tprofile.removeMarker(profile.points.length - 1);\n\t\t\tdomElement.removeEventListener(\"mouseup\", insertionCallback, true);\n\t\t\tthis.viewer.removeEventListener(\"cancel_insertions\", cancel.callback);\n\t\t};\n\t\t\n\t\tthis.viewer.addEventListener(\"cancel_insertions\", cancel.callback);\n\t\tdomElement.addEventListener(\"mouseup\", insertionCallback , true);\n\t\t\n\t\tprofile.addMarker(new THREE.Vector3(0, 0, 0));\n\t\tthis.viewer.inputHandler.startDragging(\n\t\t\tprofile.spheres[profile.spheres.length - 1]);\n\t\t\t\n\t\tthis.viewer.scene.addProfile(profile);\n\t}\n\t\n\tupdate(){\n\t\tlet camera = this.viewer.scene.camera;\n\t\tlet domElement = this.renderer.domElement;\n\t\tlet profiles = this.viewer.scene.profiles;\n\t\t\n\t\tthis.light.position.copy(camera.position);\n\t\t\n\t\t// make size independant of distance\n\t\tfor(let profile of profiles){\n\t\t\tfor(let sphere of profile.spheres){\n\t\t\t\tlet distance = camera.position.distanceTo(sphere.getWorldPosition());\n\t\t\t\tlet pr = Potree.utils.projectedRadius(1, camera.fov * Math.PI / 180, distance, domElement.clientHeight);\n\t\t\t\tlet scale = (15 / pr);\n\t\t\t\tsphere.scale.set(scale, scale, scale);\n\t\t\t}\n\t\t}\n\t}\n\t\n};\n\n\n\n\n\n\nPotree.TransformationTool = class TransformationTool{\n\t\n\tconstructor(viewer){\n\t\t\n\t\tthis.viewer = viewer;\n\t\t\n\t\tthis.sceneTransform = new THREE.Scene();\n\t\tthis.translationNode = new THREE.Object3D();\n\t\tthis.rotationNode = new THREE.Object3D();\n\t\tthis.scaleNode = new THREE.Object3D();\n\t\t\n\t\tthis.TRANSFORMATION_MODES = {\n\t\t\tDEFAULT: 0,\n\t\t\tTRANSLATE: 1,\n\t\t\tROTATE: 2,\n\t\t\tSCALE: 3\n\t\t};\n\t\t\n\t\tthis.keys = {\n\t\t\tTRANSLATE:  ['E'.charCodeAt(0)],\n\t\t\tSCALE:      ['R'.charCodeAt(0)],\n\t\t\tROTATE:     ['T'.charCodeAt(0)]\n\t\t}\n\t\t\n\t\tthis.mode = this.TRANSFORMATION_MODES.DEFAULT;\n\t\t\n\t\tthis.menu = new HoverMenu(Potree.resourcePath + \"/icons/menu_icon.svg\");\n\t\t\n\t\tthis.selection = [];\n\t\t\n\t\tthis.viewer.inputHandler.registerInteractiveScene(this.sceneTransform);\n\t\tthis.viewer.inputHandler.addEventListener(\"selection_changed\", (e) => {\n\t\t\tthis.selection = e.selection;\n\t\t});\n\t\tthis.viewer.inputHandler.addEventListener(\"keydown\", (e) => {\n\t\t\tif(this.selection.length > 0){\n\t\t\t\tif(this.keys.TRANSLATE.some(key => key === e.keyCode)){\n\t\t\t\t\tthis.setMode(this.TRANSFORMATION_MODES.TRANSLATE);\n\t\t\t\t}else if(this.keys.SCALE.some(key => key === e.keyCode)){\n\t\t\t\t\tthis.setMode(this.TRANSFORMATION_MODES.SCALE);\n\t\t\t\t}else if(this.keys.ROTATE.some(key => key === e.keyCode)){\n\t\t\t\t\tthis.setMode(this.TRANSFORMATION_MODES.ROTATE);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t});\n\t\t\n\t\t{ // Menu\n\t\t\tthis.menu.addItem(new HoverMenuItem(Potree.resourcePath + \"/icons/translate.svg\", e => {\n\t\t\t\t//console.log(\"translate!\");\n\t\t\t\tthis.setMode(this.TRANSFORMATION_MODES.TRANSLATE);\n\t\t\t}));\n\t\t\tthis.menu.addItem(new HoverMenuItem(Potree.resourcePath + \"/icons/rotate.svg\", e => {\n\t\t\t\t//console.log(\"rotate!\");\n\t\t\t\tthis.setMode(this.TRANSFORMATION_MODES.ROTATE);\n\t\t\t}));\n\t\t\tthis.menu.addItem(new HoverMenuItem(Potree.resourcePath + \"/icons/scale.svg\", e => {\n\t\t\t\t//console.log(\"scale!\");\n\t\t\t\tthis.setMode(this.TRANSFORMATION_MODES.SCALE);\n\t\t\t}));\n\t\t\tthis.menu.setPosition(100, 100);\n\t\t\t$(this.viewer.renderArea).append(this.menu.element);\n\t\t\tthis.menu.element.hide();\n\t\t}\n\t\t\n\t\t{ // translation node\n\t\t\t\n\t\t\tlet createArrow = (name, direction, color) => {\n\t\t\t\tlet material = new THREE.MeshBasicMaterial({\n\t\t\t\t\tcolor: color, \n\t\t\t\t\tdepthTest: false, \n\t\t\t\t\tdepthWrite: false});\n\t\t\t\t\t\n\t\t\t\tlet shaftGeometry = new THREE.Geometry();\n\t\t\t\tshaftGeometry.vertices.push(new THREE.Vector3(0, 0, 0));\n\t\t\t\tshaftGeometry.vertices.push(new THREE.Vector3(0, 1, 0));\n\t\t\t\t\n\t\t\t\tlet shaftMaterial = new THREE.LineBasicMaterial({\n\t\t\t\t\tcolor: color, \n\t\t\t\t\tdepthTest: true, \n\t\t\t\t\tdepthWrite: true,\n\t\t\t\t\ttransparent: true\n\t\t\t\t\t});\n\t\t\t\tlet shaft = new THREE.Line(shaftGeometry, shaftMaterial);\n\t\t\t\tshaft.name = name + \"_shaft\";\n\t\t\t\t\n\t\t\t\tlet headGeometry = new THREE.CylinderGeometry(0, 0.04, 0.1, 10, 1, false);\n\t\t\t\tlet headMaterial  = material;\n\t\t\t\tlet head = new THREE.Mesh(headGeometry, headMaterial);\n\t\t\t\thead.name = name + \"_head\";\n\t\t\t\thead.position.y = 1;\n\t\t\t\t\n\t\t\t\tlet arrow = new THREE.Object3D();\n\t\t\t\tarrow.name = name;\n\t\t\t\tarrow.add(shaft);\n\t\t\t\tarrow.add(head);\n\t\t\t\t\n\t\t\t\tlet mouseover = e => {\n\t\t\t\t\tlet c = new THREE.Color(0xFFFF00);\n\t\t\t\t\tshaftMaterial.color = c;\n\t\t\t\t\theadMaterial.color = c;\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\tlet mouseleave = e => {\n\t\t\t\t\tlet c = new THREE.Color(color);\n\t\t\t\t\tshaftMaterial.color = c;\n\t\t\t\t\theadMaterial.color = c;\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\tlet drag = e => {\n\t\t\t\t\t\n\t\t\t\t\tlet camera = this.viewer.scene.camera;\n\t\t\t\t\t\n\t\t\t\t\tif(!e.drag.intersectionStart){\n\t\t\t\t\t\te.drag.intersectionStart = e.drag.location;\n\t\t\t\t\t\te.drag.objectStart = e.drag.object.getWorldPosition();\n\t\t\t\t\t\t\n\t\t\t\t\t\tlet start = this.sceneTransform.position.clone();\n\t\t\t\t\t\tlet end = direction.clone().applyMatrix4(this.sceneTransform.matrixWorld);\n\t\t\t\t\t\t//let end = start.clone().add(direction);\n\t\t\t\t\t\tlet line = new THREE.Line3(start, end);\n\t\t\t\t\t\te.drag.line = line;\n\t\t\t\t\t\t\n\t\t\t\t\t\tlet camOnLine = line.closestPointToPoint(camera.position, false);\n\t\t\t\t\t\tlet normal = new THREE.Vector3().subVectors(\n\t\t\t\t\t\t\tcamera.position, camOnLine);\n\t\t\t\t\t\tlet plane = new THREE.Plane()\n\t\t\t\t\t\t\t.setFromNormalAndCoplanarPoint(normal, e.drag.intersectionStart);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\te.drag.dragPlane = plane;\n\t\t\t\t\t\te.drag.pivot = e.drag.intersectionStart;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t{\n\t\t\t\t\t\tlet mouse = e.drag.end;\n\t\t\t\t\t\tlet domElement = viewer.renderer.domElement;\n\t\t\t\t\t\tlet nmouse =  {\n\t\t\t\t\t\t\tx: (mouse.x / domElement.clientWidth ) * 2 - 1,\n\t\t\t\t\t\t\ty: - (mouse.y / domElement.clientHeight ) * 2 + 1\n\t\t\t\t\t\t};\n\t\t\t\t\t\t\n\t\t\t\t\t\tlet vector = new THREE.Vector3( nmouse.x, nmouse.y, 0.5 );\n\t\t\t\t\t\tvector.unproject(camera);\n\t\t\t\t\t\t\n\t\t\t\t\t\tlet ray = new THREE.Ray(camera.position, vector.sub( camera.position));\n\t\t\t\t\t\tlet I = ray.intersectPlane(e.drag.dragPlane);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(I){\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tlet iOnLine = e.drag.line.closestPointToPoint(I, false);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tlet diff = new THREE.Vector3().subVectors(\n\t\t\t\t\t\t\t\tiOnLine, e.drag.pivot);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tfor(let selection of this.selection){\n\t\t\t\t\t\t\t\tselection.position.add(diff);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\te.drag.pivot = e.drag.pivot.add(diff);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\tshaft.addEventListener(\"mouseover\", mouseover);\n\t\t\t\tshaft.addEventListener(\"mouseleave\", mouseleave);\n\t\t\t\tshaft.addEventListener(\"drag\", drag);\n\n\t\t\t\treturn arrow;\n\t\t\t};\n\t\t\t\n\t\t\tlet arrowX = createArrow(\"arrow_x\", new THREE.Vector3(1, 0, 0), 0xFF0000);\n\t\t\tlet arrowY = createArrow(\"arrow_y\", new THREE.Vector3(0, 1, 0), 0x00FF00);\n\t\t\tlet arrowZ = createArrow(\"arrow_z\", new THREE.Vector3(0, 0, 1), 0x0000FF);\n\t\t\t\n\t\t\tarrowX.rotation.z = -Math.PI/2;\n\t\t\tarrowZ.rotation.x = Math.PI/2;\n\t\t\t\n\t\t\tthis.translationNode.add(arrowX);\n\t\t\tthis.translationNode.add(arrowY);\n\t\t\tthis.translationNode.add(arrowZ);\n\t\t}\n\t\t\n\t\t{ // Rotation Node\n\t\t\tlet createCircle = (name, normal, color) => {\n\t\t\t\tlet material = new THREE.LineBasicMaterial({\n\t\t\t\t\tcolor: color, \n\t\t\t\t\tdepthTest: true, \n\t\t\t\t\tdepthWrite: true,\n\t\t\t\t\ttransparent: true\n\t\t\t\t\t});\n\t\t\t\t\n\t\t\t\tlet segments = 32;\n\t\t\t\tlet radius = 1;\n\t\t\t\tlet geometry = new THREE.BufferGeometry();\n\t\t\t\tlet positions = new Float32Array( (segments + 1) * 3 );\n\t\t\t\tfor(let i = 0; i <= segments; i++){\n\t\t\t\t\tlet u = (i / segments) * Math.PI * 2;\n\t\t\t\t\tlet x = Math.cos(u) * radius;\n\t\t\t\t\tlet y = Math.sin(u) * radius;\n\t\t\t\t\t\n\t\t\t\t\tpositions[3 * i + 0] = x;\n\t\t\t\t\tpositions[3 * i + 1] = y;\n\t\t\t\t\tpositions[3 * i + 2] = 0;\n\t\t\t\t}\n\t\t\t\tgeometry.addAttribute(\"position\", new THREE.BufferAttribute(positions, 3));\n\t\t\t\tgeometry.computeBoundingSphere();\n\t\t\t\t\n\t\t\t\tlet circle = new THREE.Line(geometry, material);\n\t\t\t\tcircle.name = name + \"_circle\";\n\t\t\t\tcircle.lookAt(normal);\n\t\t\t\t\n\t\t\t\tlet mouseover = e => {\n\t\t\t\t\tlet c = new THREE.Color(0xFFFF00);\n\t\t\t\t\tmaterial.color = c;\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\tlet mouseleave = e => {\n\t\t\t\t\tlet c = new THREE.Color(color);\n\t\t\t\t\tmaterial.color = c;\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\tlet drag = e => {\n\t\t\t\t\t\n\t\t\t\t\tlet camera = this.viewer.scene.camera;\n\t\t\t\t\tlet n = normal.clone().applyEuler(this.sceneTransform.rotation);\n\t\t\t\t\t\n\t\t\t\t\tif(!e.drag.intersectionStart){\n\t\t\t\t\t\te.drag.objectStart = e.drag.object.getWorldPosition();\n\t\t\t\t\t\t\n\t\t\t\t\t\tlet plane = new THREE.Plane()\n\t\t\t\t\t\t\t.setFromNormalAndCoplanarPoint(n, this.sceneTransform.getWorldPosition());\n\t\t\t\t\t\t\n\t\t\t\t\t\t{ // e.drag.location seems imprecisse, calculate real start location\n\t\t\t\t\t\t\tlet mouse = e.drag.end;\n\t\t\t\t\t\t\tlet domElement = viewer.renderer.domElement;\n\t\t\t\t\t\t\tlet nmouse =  {\n\t\t\t\t\t\t\t\tx: (mouse.x / domElement.clientWidth ) * 2 - 1,\n\t\t\t\t\t\t\t\ty: - (mouse.y / domElement.clientHeight ) * 2 + 1\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tlet vector = new THREE.Vector3( nmouse.x, nmouse.y, 0.5 );\n\t\t\t\t\t\t\tvector.unproject(camera);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tlet ray = new THREE.Ray(camera.position, vector.sub( camera.position));\n\t\t\t\t\t\t\tlet I = ray.intersectPlane(plane);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\te.drag.intersectionStart = I;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\te.drag.dragPlane = plane;\n\t\t\t\t\t\te.drag.pivot = e.drag.intersectionStart;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tlet mouse = e.drag.end;\n\t\t\t\t\tlet domElement = viewer.renderer.domElement;\n\t\t\t\t\tlet nmouse =  {\n\t\t\t\t\t\tx: (mouse.x / domElement.clientWidth ) * 2 - 1,\n\t\t\t\t\t\ty: - (mouse.y / domElement.clientHeight ) * 2 + 1\n\t\t\t\t\t};\n\t\t\t\t\t\n\t\t\t\t\tlet vector = new THREE.Vector3( nmouse.x, nmouse.y, 0.5 );\n\t\t\t\t\tvector.unproject(camera);\n\t\t\t\t\t\n\t\t\t\t\tlet ray = new THREE.Ray(camera.position, vector.sub( camera.position));\n\t\t\t\t\tlet I = ray.intersectPlane(e.drag.dragPlane);\n\t\t\t\t\t\t\n\t\t\t\t\tif(I){\n\t\t\t\t\t\tlet center = this.sceneTransform.position;\n\t\t\t\t\t\tlet from = e.drag.pivot;\n\t\t\t\t\t\tlet to = I;\n\t\t\t\t\t\t\n\t\t\t\t\t\tlet v1 = from.clone().sub(center).normalize();\n\t\t\t\t\t\tlet v2 = to.clone().sub(center).normalize();\n\t\t\t\t\t\t\n\t\t\t\t\t\tlet angle = Math.acos(v1.dot(v2));\n\t\t\t\t\t\tlet sign = Math.sign(v1.cross(v2).dot(n));\n\t\t\t\t\t\tangle = angle * sign;\n\t\t\t\t\t\tif(Number.isNaN(angle)){\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tfor(let selection of this.selection){\n\t\t\t\t\t\t\tselection.rotateOnAxis(normal, angle);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\te.drag.pivot = I;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\tcircle.addEventListener(\"mouseover\", mouseover);\n\t\t\t\tcircle.addEventListener(\"mouseleave\", mouseleave);\n\t\t\t\tcircle.addEventListener(\"drag\", drag);\n\t\t\t\t\n\t\t\t\t\n\t\t\t\treturn circle;\n\t\t\t};\n\t\t\t\n\t\t\t{ // transparent ball\n\t\t\t\tlet sg = new THREE.SphereGeometry(1, 32, 32);\n\t\t\t\tlet sm = new THREE.MeshBasicMaterial({\n\t\t\t\t//let sm = new THREE.MeshNormalMaterial({\n\t\t\t\t\tcolor: 0xaaaaaa,\n\t\t\t\t\ttransparent: true,\n\t\t\t\t\tdepthTest: true,\n\t\t\t\t\tdepthWrite: true,\n\t\t\t\t\topacity: 0.4\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tlet sphere = new THREE.Mesh(sg, sm);\n\t\t\t\tsphere.name = name + \"_sphere\";\n\t\t\t\tsphere.scale.set(0.9, 0.9, 0.9);\n\t\t\t\tthis.rotationNode.add(sphere);\n\t\t\t}\n\t\t\n\t\t\tlet yaw = createCircle(\"yaw\", new THREE.Vector3(0, 0, 1), 0xff0000);\n\t\t\tlet pitch = createCircle(\"pitch\", new THREE.Vector3(1, 0, 0), 0x00ff00);\n\t\t\tlet roll = createCircle(\"roll\", new THREE.Vector3(0, 1, 0), 0x0000ff);\n\t\t\n\t\t\tthis.rotationNode.add(yaw);\n\t\t\tthis.rotationNode.add(pitch);\n\t\t\tthis.rotationNode.add(roll);\n\t\t}\n\t\t\n\t\t{ // scale node\n\t\t\t\n\t\t\tlet createHandle = (name, direction, color) => {\n\t\t\t\tlet material = new THREE.MeshBasicMaterial({\n\t\t\t\t\tcolor: color, \n\t\t\t\t\tdepthTest: false, \n\t\t\t\t\tdepthWrite: false});\n\t\t\t\t\t\n\t\t\t\tlet shaftGeometry = new THREE.Geometry();\n\t\t\t\tshaftGeometry.vertices.push(new THREE.Vector3(0, 0, 0));\n\t\t\t\tshaftGeometry.vertices.push(new THREE.Vector3(0, 1, 0));\n\t\t\t\t\n\t\t\t\tlet shaftMaterial = new THREE.LineBasicMaterial({\n\t\t\t\t\tcolor: color, \n\t\t\t\t\tdepthTest: true, \n\t\t\t\t\tdepthWrite: true,\n\t\t\t\t\ttransparent: true\n\t\t\t\t\t});\n\t\t\t\tlet shaft = new THREE.Line(shaftGeometry, shaftMaterial);\n\t\t\t\tshaft.name = name + \"_shaft\";\n\t\t\t\t\n\t\t\t\tlet headGeometry = new THREE.BoxGeometry(1, 1, 1);\n\t\t\t\tlet headMaterial  = material;\n\t\t\t\tlet head = new THREE.Mesh(headGeometry, headMaterial);\n\t\t\t\thead.name = name + \"_head\";\n\t\t\t\thead.position.y = 1;\n\t\t\t\thead.scale.set(0.07, 0.07, 0.07);\n\t\t\t\t\n\t\t\t\tlet arrow = new THREE.Object3D();\n\t\t\t\tarrow.add(shaft);\n\t\t\t\tarrow.add(head);\n\t\t\t\t\n\t\t\t\tlet mouseover = e => {\n\t\t\t\t\tlet c = new THREE.Color(0xFFFF00);\n\t\t\t\t\tshaftMaterial.color = c;\n\t\t\t\t\theadMaterial.color = c;\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\tlet mouseleave = e => {\n\t\t\t\t\tlet c = new THREE.Color(color);\n\t\t\t\t\tshaftMaterial.color = c;\n\t\t\t\t\theadMaterial.color = c;\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\tlet drag = e => {\n\t\t\t\t\t\n\t\t\t\t\tlet camera = this.viewer.scene.camera;\n\t\t\t\t\t\n\t\t\t\t\tif(!e.drag.intersectionStart){\n\t\t\t\t\t\te.drag.intersectionStart = e.drag.location;\n\t\t\t\t\t\te.drag.scaleStart = this.selection[0].scale.clone();\n\t\t\t\t\t\t\n\t\t\t\t\t\tlet start = this.sceneTransform.position.clone();\n\t\t\t\t\t\tlet end = direction.clone().applyMatrix4(this.sceneTransform.matrixWorld);\n\t\t\t\t\t\t//let end = start.clone().add(direction);\n\t\t\t\t\t\tlet line = new THREE.Line3(start, end);\n\t\t\t\t\t\te.drag.line = line;\n\t\t\t\t\t\t\n\t\t\t\t\t\tlet camOnLine = line.closestPointToPoint(camera.position, false);\n\t\t\t\t\t\tlet normal = new THREE.Vector3().subVectors(\n\t\t\t\t\t\t\tcamera.position, camOnLine);\n\t\t\t\t\t\tlet plane = new THREE.Plane()\n\t\t\t\t\t\t\t.setFromNormalAndCoplanarPoint(normal, e.drag.intersectionStart);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\te.drag.dragPlane = plane;\n\t\t\t\t\t\te.drag.pivot = e.drag.intersectionStart;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t{\n\t\t\t\t\t\tlet mouse = e.drag.end;\n\t\t\t\t\t\tlet domElement = viewer.renderer.domElement;\n\t\t\t\t\t\tlet nmouse =  {\n\t\t\t\t\t\t\tx: (mouse.x / domElement.clientWidth ) * 2 - 1,\n\t\t\t\t\t\t\ty: - (mouse.y / domElement.clientHeight ) * 2 + 1\n\t\t\t\t\t\t};\n\t\t\t\t\t\t\n\t\t\t\t\t\tlet vector = new THREE.Vector3( nmouse.x, nmouse.y, 0.5 );\n\t\t\t\t\t\tvector.unproject(camera);\n\t\t\t\t\t\t\n\t\t\t\t\t\tlet ray = new THREE.Ray(camera.position, vector.sub( camera.position));\n\t\t\t\t\t\tlet I = ray.intersectPlane(e.drag.dragPlane);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(I){\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tlet iOnLine = e.drag.line.closestPointToPoint(I, false);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t//let diff = new THREE.Vector3().subVectors(\n\t\t\t\t\t\t\t//\tiOnLine, e.drag.pivot);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tlet oldDistance = this.sceneTransform.position.distanceTo(e.drag.pivot);\n\t\t\t\t\t\t\tlet newDistance = this.sceneTransform.position.distanceTo(I);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tlet s = newDistance / oldDistance;\n\t\t\t\t\t\t\tlet scale = new THREE.Vector3(\n\t\t\t\t\t\t\t\tdirection.x === 0 ? 1 : s * direction.x,\n\t\t\t\t\t\t\t\tdirection.y === 0 ? 1 : s * direction.y,\n\t\t\t\t\t\t\t\tdirection.z === 0 ? 1 : s * direction.z\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tfor(let selection of this.selection){\n\t\t\t\t\t\t\t\t//selection.position.add(diff);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tselection.scale.copy(e.drag.scaleStart.clone().multiply(scale));\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t//selection.scale.copy(\n\t\t\t\t\t\t\t\t//\te.drag.scaleStart.clone()\n\t\t\t\t\t\t\t\t//\t.multiplyScalar(scale)\n\t\t\t\t\t\t\t\t//\t.multiply(direction));\n\t\t\t\t\t\t\t\t//console.log(Potree.utils.toString(selection.scale));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t//e.drag.pivot = e.drag.pivot.add(diff);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\tshaft.addEventListener(\"mouseover\", mouseover);\n\t\t\t\tshaft.addEventListener(\"mouseleave\", mouseleave);\n\t\t\t\tshaft.addEventListener(\"drag\", drag);\n\n\t\t\t\treturn arrow;\n\t\t\t};\n\t\t\t\n\t\t\tlet arrowX = createHandle(\"arrow_x\", new THREE.Vector3(1, 0, 0), 0xFF0000);\n\t\t\tlet arrowY = createHandle(\"arrow_y\", new THREE.Vector3(0, 1, 0), 0x00FF00);\n\t\t\tlet arrowZ = createHandle(\"arrow_z\", new THREE.Vector3(0, 0, 1), 0x0000FF);\n\t\t\t\n\t\t\tarrowX.rotation.z = -Math.PI/2;\n\t\t\tarrowZ.rotation.x = Math.PI/2;\n\t\t\t\n\t\t\tthis.scaleNode.add(arrowX);\n\t\t\tthis.scaleNode.add(arrowY);\n\t\t\tthis.scaleNode.add(arrowZ);\n\t\t}\n\t\t\n\t\t\n\t\tthis.setMode(this.TRANSFORMATION_MODES.TRANSLATE);\n\t}\n\t\n\tgetSelectionBoundingBox(){\n\t\t\n\t\tlet min = new THREE.Vector3(+Infinity, +Infinity, +Infinity);\n\t\tlet max = new THREE.Vector3(-Infinity, -Infinity, -Infinity);\n\t\t\n\t\tfor(let node of this.selection){\n\t\t\t\n\t\t\tlet box = null;\n\t\t\tif(node.boundingBox){\n\t\t\t\tbox = node.boundingBox;\n\t\t\t}else if(node.geometry && node.geometry.boundingBox){\n\t\t\t\tbox = node.geometry.boundingBox;\n\t\t\t}\n\t\t\t\n\t\t\tif(box){\n\t\t\t\t//let tbox = Potree.utils.computeTransformedBoundingBox(box, node.matrixWorld);\t\t\t\t\n\t\t\t\tlet tbox = box.clone().applyMatrix4(node.matrixWorld);\n\t\t\t\t\n\t\t\t\tmin = min.min(tbox.min);\n\t\t\t\tmax = max.max(tbox.max);\n\t\t\t}else{\n\t\t\t\tlet wp = node.getWorldPosition();\n\t\t\t\tmin = min.min(wp);\n\t\t\t\tmax = max.max(wp);\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn new THREE.Box3(min, max);\n\t\t\n\t}\n\t\n\tsetMode(mode){\n\t\tif(this.mode === mode){\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tthis.sceneTransform.remove(this.translationNode);\n\t\tthis.sceneTransform.remove(this.rotationNode);\n\t\tthis.sceneTransform.remove(this.scaleNode);\n\t\t\n\t\tif(mode === this.TRANSFORMATION_MODES.TRANSLATE){\n\t\t\tthis.sceneTransform.add(this.translationNode);\n\t\t}else if(mode === this.TRANSFORMATION_MODES.ROTATE){\n\t\t\tthis.sceneTransform.add(this.rotationNode);\n\t\t}else if(mode === this.TRANSFORMATION_MODES.SCALE){\n\t\t\tthis.sceneTransform.add(this.scaleNode);\n\t\t}\n\t\t\n\t\tthis.mode = mode;\n\t}\n\t\n\t\n\t//setSelection(selection){\n\t//\tthis.selection = selection;\n\t//}\n\t\n\tupdate(){\n\t\t\n\t\tif(this.selection.length === 0){\n\t\t\tthis.sceneTransform.visible = false;\n\t\t\tthis.menu.element.hide();\n\t\t\treturn;\n\t\t}else{\n\t\t\tthis.sceneTransform.visible = true;\n\t\t\tthis.menu.element.show();\n\t\t}\n\t\t\n\t\tif(this.selection.length === 1){\n\t\t\tthis.sceneTransform.rotation.copy(this.selection[0].rotation);\n\t\t}\n\t\t\n\t\tlet scene = this.viewer.scene;\n\t\tlet renderer = this.viewer.renderer;\n\t\tlet domElement = renderer.domElement;\n\t\t\n\t\tlet box = this.getSelectionBoundingBox();\n\t\tlet pivot = box.getCenter();\n\t\tthis.sceneTransform.position.copy(pivot);\n\t\t\n\t\t{ // size\n\t\t\tlet distance = scene.camera.position.distanceTo(pivot);\n\t\t\tlet pr = Potree.utils.projectedRadius(1, scene.camera.fov * Math.PI / 180, distance, renderer.domElement.clientHeight);\n\t\t\tlet scale = (120 / pr);\n\t\t\tthis.sceneTransform.scale.set(scale, scale, scale);\n\t\t}\n\t\t\n\t\t{ // menu\n\t\t\tlet screenPos = pivot.clone().project(scene.camera);\n\t\t\tscreenPos.x = domElement.clientWidth * (screenPos.x + 1) / 2;\n\t\t\tscreenPos.y = domElement.clientHeight * (1-(screenPos.y + 1) / 2);\n\t\t\t\n\t\t\tthis.menu.setPosition(screenPos.x, screenPos.y);\n\t\t}\n\t\t\n\t}\n\t\n\t//render(camera, target){\n\t//\tthis.update();\n\t//\tthis.renderer.render(this.sceneTransform, camera, target);\n\t//}\n\t\n};\n\nPotree.Volume = class extends THREE.Object3D{\n\t\n\tconstructor(args = {}){\n\t\tsuper();\n\t\t\n\t\tthis.constructor.counter = (this.constructor.counter === undefined) ? 0 : this.constructor.counter + 1;\n\t\t\n\t\tthis.name = \"volume_\" + this.constructor.counter;\n\t\t\n\t\tthis._clip = args.clip || false;\n\t\tthis._modifiable = args.modifiable || true;\n\t\t\n\t\tlet boxGeometry = new THREE.BoxGeometry(1, 1, 1);\n\t\tboxGeometry.computeBoundingBox();\n\t\t\n\t\tlet boxFrameGeometry = new THREE.Geometry();\n\t\t{\n\t\t\tlet l = 0.1;\n\t\t\t\n\t\t\t// corner vertices\n\t\t\tlet v = [\n\t\t\t\t[-0.5, -0.5, -0.5],\n\t\t\t\t[-0.5, -0.5, +0.5],\n\t\t\t\t[-0.5, +0.5, -0.5],\n\t\t\t\t[-0.5, +0.5, +0.5],\n\t\t\t\t[+0.5, -0.5, -0.5],\n\t\t\t\t[+0.5, -0.5, +0.5],\n\t\t\t\t[+0.5, +0.5, -0.5],\n\t\t\t\t[+0.5, +0.5, +0.5]\n\t\t\t];\n\t\t\t//\n\t\t\t//// create a cross at each corner with cross length l\n\t\t\t//for(let b of v){\n\t\t\t//\t\n\t\t\t//\tlet b1 = [ b[0] - l * Math.sign(b[0]), b[1], b[2] ];\n\t\t\t//\tlet b2 = [ b[0], b[1] - l * Math.sign(b[1]), b[2] ];\n\t\t\t//\tlet b3 = [ b[0], b[1], b[2] - l * Math.sign(b[2]) ];\n\t\t\t//\t\n\t\t\t//\t// create the 3 lines that a cross consists of\n\t\t\t//\tfor(let d of [b, b1, b, b2, b, b3]){\n\t\t\t//\t\tboxFrameGeometry.vertices.push(new THREE.Vector3().fromArray(d));\n\t\t\t//\t}\n\t\t\t//\t\n\t\t\t//}\n\t\t\t\n\t\t\t// bottom\n\t\t\tboxFrameGeometry.vertices.push(new THREE.Vector3(-0.5, -0.5, 0.5));\n\t\t\tboxFrameGeometry.vertices.push(new THREE.Vector3(0.5, -0.5, 0.5));\n\t\t\tboxFrameGeometry.vertices.push(new THREE.Vector3(0.5, -0.5, 0.5));\n\t\t\tboxFrameGeometry.vertices.push(new THREE.Vector3(0.5, -0.5, -0.5));\n\t\t\tboxFrameGeometry.vertices.push(new THREE.Vector3(0.5, -0.5, -0.5));\n\t\t\tboxFrameGeometry.vertices.push(new THREE.Vector3(-0.5, -0.5, -0.5));\n\t\t\tboxFrameGeometry.vertices.push(new THREE.Vector3(-0.5, -0.5, -0.5));\n\t\t\tboxFrameGeometry.vertices.push(new THREE.Vector3(-0.5, -0.5, 0.5));\n\t\t\t// top\n\t\t\tboxFrameGeometry.vertices.push(new THREE.Vector3(-0.5, 0.5, 0.5));\n\t\t\tboxFrameGeometry.vertices.push(new THREE.Vector3(0.5, 0.5, 0.5));\n\t\t\tboxFrameGeometry.vertices.push(new THREE.Vector3(0.5, 0.5, 0.5));\n\t\t\tboxFrameGeometry.vertices.push(new THREE.Vector3(0.5, 0.5, -0.5));\n\t\t\tboxFrameGeometry.vertices.push(new THREE.Vector3(0.5, 0.5, -0.5));\n\t\t\tboxFrameGeometry.vertices.push(new THREE.Vector3(-0.5, 0.5, -0.5));\n\t\t\tboxFrameGeometry.vertices.push(new THREE.Vector3(-0.5, 0.5, -0.5));\n\t\t\tboxFrameGeometry.vertices.push(new THREE.Vector3(-0.5, 0.5, 0.5));\n\t\t\t// sides\n\t\t\tboxFrameGeometry.vertices.push(new THREE.Vector3(-0.5, -0.5, 0.5));\n\t\t\tboxFrameGeometry.vertices.push(new THREE.Vector3(-0.5, 0.5, 0.5));\n\t\t\tboxFrameGeometry.vertices.push(new THREE.Vector3(0.5, -0.5, 0.5));\n\t\t\tboxFrameGeometry.vertices.push(new THREE.Vector3(0.5, 0.5, 0.5));\n\t\t\tboxFrameGeometry.vertices.push(new THREE.Vector3(0.5, -0.5, -0.5));\n\t\t\tboxFrameGeometry.vertices.push(new THREE.Vector3(0.5, 0.5, -0.5));\n\t\t\tboxFrameGeometry.vertices.push(new THREE.Vector3(-0.5, -0.5, -0.5));\n\t\t\tboxFrameGeometry.vertices.push(new THREE.Vector3(-0.5, 0.5, -0.5));\n\t\t}\n\n\t\tthis.dimension = new THREE.Vector3(1,1,1);\n\t\tthis.material = new THREE.MeshBasicMaterial( {\n\t\t\tcolor: 0x00ff00, \n\t\t\ttransparent: true, \n\t\t\topacity: 0.3,\n\t\t\tdepthTest: true, \n\t\t\tdepthWrite: false} );\n\t\tthis.box = new THREE.Mesh(boxGeometry, this.material);\n\t\tthis.box.geometry.computeBoundingBox();\n\t\tthis.boundingBox = this.box.geometry.boundingBox;\n\t\tthis.add(this.box);\n\t\t\n\t\tthis.frame = new THREE.LineSegments( boxFrameGeometry, new THREE.LineBasicMaterial({color: 0x000000}));\n\t\t//this.frame.mode = THREE.Lines;\n\t\tthis.add(this.frame);\n\t\t\n\t\tthis.label = new Potree.TextSprite(\"0\");\n\t\tthis.label.setBorderColor({r:0, g:255, b:0, a:0.0});\n\t\tthis.label.setBackgroundColor({r:0, g:255, b:0, a:0.0});\n\t\tthis.label.material.depthTest = false;\n\t\tthis.label.material.depthWrite = false;\n\t\tthis.label.material.transparent = true;\n\t\tthis.label.position.y -= 0.5;\n\t\tthis.add(this.label);\n\t\t\n\t\tthis.label.updateMatrixWorld = () => {\n\t\t\tvar volumeWorldPos = new THREE.Vector3();\n\t\t\tvolumeWorldPos.setFromMatrixPosition( this.matrixWorld );\n\t\t\tthis.label.position.copy(volumeWorldPos);\n\t\t\tthis.label.updateMatrix();\n\t\t\tthis.label.matrixWorld.copy(this.label.matrix);\n\t\t\tthis.label.matrixWorldNeedsUpdate = false;\n\t\t\t\n\t\t\tfor ( var i = 0, l = this.label.children.length; i < l; i ++ ) {\n\t\t\t\tthis.label.children[ i ].updateMatrixWorld( true );\n\t\t\t}\n\t\t};\n\t\t\n\t\t{ // event listeners\n\t\t\tthis.addEventListener(\"select\", e => {});\n\t\t\tthis.addEventListener(\"deselect\", e => {});\n\t\t}\n\t\t\n\t\tthis.update();\n\t}\n\n\tgetVolume(){\n\t\treturn Math.abs(this.scale.x * this.scale.y * this.scale.z);\n\t}\n\t\n\tupdate(){\n\t\tthis.boundingBox = this.box.geometry.boundingBox;\n\t\tthis.boundingSphere = this.boundingBox.getBoundingSphere();\n\t\t\n\t\tif(this._clip){\n\t\t\tthis.box.visible = false;\n\t\t\tthis.label.visible = false;\n\t\t}else{\n\t\t\tthis.box.visible = true;\n\t\t\tthis.label.visible = true;\n\t\t}\n\t};\n\t\n\traycast(raycaster, intersects){\n\t\t\n\t\tlet is = [];\n\t\tthis.box.raycast(raycaster, is);\n\t\n\t\tif(is.length > 0){\n\t\t\tvar I = is[0];\n\t\t\tintersects.push({\n\t\t\t\tdistance: I.distance,\n\t\t\t\tobject: this,\n\t\t\t\tpoint: I.point.clone()\n\t\t\t});\n\t\t}\n\t};\n\t\n\tget clip(){\n\t\treturn this._clip;\n\t}\n\t\n\tset clip(value){\n\t\tthis._clip = value;\n\t\t\n\t\tthis.update();\n\t}\n\t\n\tget modifieable(){\n\t\treturn this._modifiable;\n\t}\n\t\n\tset modifieable(value){\n\t\tthis._modifiable = value;\n\t\t\n\t\tthis.update();\n\t}\n};\n\n\nPotree.VolumeTool = class VolumeTool extends THREE.EventDispatcher{\n\t\n\tconstructor(viewer){\n\t\tsuper()\n\t\t\n\t\tthis.viewer = viewer;\n\t\tthis.renderer = viewer.renderer;\n\t\t\n\t\tthis.addEventListener(\"start_inserting_volume\", e => {\n\t\t\tthis.viewer.dispatchEvent({\n\t\t\t\ttype: \"cancel_insertions\"\n\t\t\t});\n\t\t});\n\n\t\tthis.sceneVolume = new THREE.Scene();\n\t\tthis.sceneVolume.name = \"scene_volume\";\n\t\t\n\t\tthis.viewer.inputHandler.registerInteractiveScene(this.sceneVolume);\n\n\t\tthis.onRemove = e => {\n\t\t\tthis.sceneVolume.remove(e.volume);\n\t\t};\n\t\t\n\t\tthis.onAdd = e => {\n\t\t\tthis.sceneVolume.add(e.volume);\n\t\t};\n\t\t\n\t\tthis.viewer.inputHandler.addEventListener(\"delete\", e => {\n\t\t\tlet volumes = e.selection.filter(e => (e instanceof Potree.Volume));\n\t\t\tvolumes.forEach(e => this.viewer.scene.removeVolume(e));\n\t\t});\n\t}\n\t\n\tsetScene(scene){\n\t\tif(this.scene === scene){\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tif(this.scene){\n\t\t\tthis.scene.removeEventListeners(\"volume_added\", this.onAdd);\n\t\t\tthis.scene.removeEventListeners(\"volume_removed\", this.onRemove);\n\t\t}\n\t\t\n\t\tthis.scene = scene;\n\t\t\n\t\tthis.scene.addEventListener(\"volume_added\", this.onAdd);\n\t\tthis.scene.addEventListener(\"volume_removed\", this.onRemove);\n\t}\n\t\n\tstartInsertion(args = {}){\n\t\tlet domElement = this.viewer.renderer.domElement;\n\t\t\n\t\tlet volume = new Potree.Volume();\n\t\tvolume.clip = args.clip || false;\n\t\tvolume.name = args.name || \"Volume\";\n\t\t\n\t\tthis.dispatchEvent({\n\t\t\ttype: \"start_inserting_volume\",\n\t\t\tvolume: volume\n\t\t});\n\t\t\n\t\t//this.sceneVolume.add(volume);\n\t\tthis.viewer.scene.addVolume(volume);\n\t\t\n\t\tlet cancel = {\n\t\t\tcallback: null\n\t\t};\n\n\t\tlet drag = e => {\n\t\t\tlet camera = this.viewer.scene.camera;\n\t\t\t\n\t\t\tlet I = Potree.utils.getMousePointCloudIntersection(\n\t\t\t\te.drag.end, \n\t\t\t\tthis.viewer.scene.camera, \n\t\t\t\tthis.viewer.renderer, \n\t\t\t\tthis.viewer.scene.pointclouds);\n\t\t\t\t\n\t\t\tif(I){\n\t\t\t\tvolume.position.copy(I.location);\n\t\t\t\t\n\t\t\t\tvar wp = volume.getWorldPosition().applyMatrix4(camera.matrixWorldInverse);\n\t\t\t\tvar pp = new THREE.Vector4(wp.x, wp.y, wp.z).applyMatrix4(camera.projectionMatrix);\n\t\t\t\tvar w = Math.abs((wp.z  / 10)); \n\t\t\t\tvolume.scale.set(w,w,w);\n\t\t\t}\n\t\t};\n\t\t\n\t\tlet drop = e => {\n\t\t\tvolume.removeEventListener(\"drag\", drag);\n\t\t\tvolume.removeEventListener(\"drop\", drop);\n\t\t\t\n\t\t\tcancel.callback();\n\t\t};\n\t\t\n\t\tcancel.callback = e => {\n\t\t\tvolume.removeEventListener(\"drag\", drag);\n\t\t\tvolume.removeEventListener(\"drop\", drop);\n\t\t\tthis.viewer.removeEventListener(\"cancel_insertions\", cancel.callback);\n\t\t};\n\t\t\n\t\tvolume.addEventListener(\"drag\", drag);\n\t\tvolume.addEventListener(\"drop\", drop);\n\t\tthis.viewer.addEventListener(\"cancel_insertions\", cancel.callback);\n\t\t\n\t\tthis.viewer.inputHandler.startDragging(volume);\n\t}\n\t\n\tupdate(delta){\n\t\t\n\t\tif(!this.scene){\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tlet camera = this.viewer.scene.camera;\n\t\tlet domElement = this.viewer.renderer.domElement;\n\t\t//let labels = this.viewer.scene.volumes.map(e => e.label);\n\t\t\n\t\tlet volumes = this.viewer.scene.volumes;\n\t\tfor(let volume of volumes){\n\t\t\tlet label = volume.label;\n\t\t\t\n\t\t\t{\n\t\t\t\tlet distance = label.position.distanceTo(camera.position);\n\t\t\t\tlet pr = Potree.utils.projectedRadius(1, camera.fov * Math.PI / 180, distance, domElement.clientHeight);\n\t\t\t\tlet scale = (70 / pr);\n\t\t\t\tlabel.scale.set(scale, scale, scale);\n\t\t\t}\n\t\t\t\n\t\t\tlet text = Potree.utils.addCommas(volume.getVolume().toFixed(3)) + \"\\u00B3\";\n\t\t\tlabel.setText(text);\n\t\t}\n\t\t\n\t}\n\n};\n/**\n *\n * code adapted from three.js BoxHelper.js\n * https://github.com/mrdoob/three.js/blob/dev/src/helpers/BoxHelper.js\n *\n * @author mrdoob / http://mrdoob.com/\n * @author Mugen87 / http://github.com/Mugen87\n * @author mschuetz / http://potree.org\n */\n\nPotree.Box3Helper = class Box3Helper extends THREE.LineSegments{\n\n\tconstructor(box, color){\n\n\t\tif ( color === undefined ) color = 0xffff00;\n\n\t\tlet indices = new Uint16Array([ 0, 1, 1, 2, 2, 3, 3, 0, 4, 5, 5, 6, 6, 7, 7, 4, 0, 4, 1, 5, 2, 6, 3, 7 ]);\n\t\tlet positions = new Float32Array( [\n\t\t\tbox.min.x, box.min.y, box.min.z,\n\t\t\tbox.max.x, box.min.y, box.min.z,\n\t\t\tbox.max.x, box.min.y, box.max.z,\n\t\t\tbox.min.x, box.min.y, box.max.z,\n\t\t\tbox.min.x, box.max.y, box.min.z,\n\t\t\tbox.max.x, box.max.y, box.min.z,\n\t\t\tbox.max.x, box.max.y, box.max.z,\n\t\t\tbox.min.x, box.max.y, box.max.z\n\t\t]);\n\n\t\tlet geometry = new THREE.BufferGeometry();\n\t\tgeometry.setIndex( new THREE.BufferAttribute( indices, 1 ) );\n\t\tgeometry.addAttribute( 'position', new THREE.BufferAttribute( positions, 3 ) );\n\n\t\tlet material = new THREE.LineBasicMaterial( { color: color } ) ;\n\t\t\n\t\tsuper(geometry, material);\n\t}\n\n}\n\n/**\n *\n * @author sigeom sa / http://sigeom.ch\n * @author Ioda-Net Srl / https://www.ioda-net.ch/\n * @author Markus Schtz / http://potree.org\n *\n */\n\nPotree.GeoJSONExporter = class GeoJSONExporter{\n\t\n\tstatic measurementToFeatures(measurement){\n\t\t\n\t\tlet coords = measurement.points.map(e => e.position.toArray());\n\t\t\n\t\tlet features = [];\n\t\t\n\t\tif(coords.length === 1){\n\t\t\tlet feature = {\n\t\t\t\ttype: 'Feature',\n\t\t\t\tgeometry: {\n\t\t\t\t\ttype: 'Point',\n\t\t\t\t\tcoordinates: coords[0],\n\t\t\t\t},\n\t\t\t\tproperties: {\n\t\t\t\t\tname: measurement.name\n\t\t\t\t}\n\t\t\t};\n\t\t\tfeatures.push(feature);\n\t\t}else if(coords.length > 1 && !measurement.closed){\n\t\t\tlet object = {\n\t\t\t\t\"type\": \"Feature\",\n\t\t\t\t\"geometry\": {\n\t\t\t\t\t\"type\": \"LineString\",\n\t\t\t\t\t\"coordinates\": coords\n\t\t\t\t},\n\t\t\t\t\"properties\": {\n\t\t\t\t\tname: measurement.name\n\t\t\t\t}\n\t\t\t};\n\t\t\t\n\t\t\tfeatures.push(object);\n\t\t}else if(coords.length > 1 && measurement.closed){\n\n\t\t\tlet object = {\n\t\t\t\t\"type\": \"Feature\",\n\t\t\t\t\"geometry\": {\n\t\t\t\t\t\"type\": \"Polygon\",\n\t\t\t\t\t\"coordinates\": [[...coords, coords[0]]]\n\t\t\t\t},\n\t\t\t\t\"properties\": {\n\t\t\t\t\tname: measurement.name\n\t\t\t\t}\n\t\t\t};\n\t\t\tfeatures.push(object);\n\t\t}\n\n\t\tif(measurement.showDistances){\n\t\t\tmeasurement.edgeLabels.forEach((label) => {\n\t\t\t\tlet labelPoint = {\n\t\t\t\t\ttype: 'Feature',\n\t\t\t\t\tgeometry: {\n\t\t\t\t\t\ttype: 'Point',\n\t\t\t\t\t\tcoordinates: label.position.toArray(),\n\t\t\t\t\t},\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\tdistance: label.text\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tfeatures.push(labelPoint);\n\t\t\t});\n\t\t}\n\t\t\n\t\tif(measurement.showArea){\n\t\t\tvar point = measurement.areaLabel.position;\n\t\t\tvar labelArea = {\n\t\t\t\ttype: 'Feature',\n\t\t\t\tgeometry: {\n\t\t\t\t\ttype: 'Point',\n\t\t\t\t\tcoordinates: point.toArray(),\n\t\t\t\t},\n\t\t\t\tproperties: {\n\t\t\t\t\tarea: measurement.areaLabel.text\n\t\t\t\t}\n\t\t\t};\n\t\t\tfeatures.push(labelArea);\n\t\t}\n\t\t\n\t\treturn features;\n\t}\n\t\n\tstatic toString(measurements){\n\t\t\n\t\tif(!(measurements instanceof Array)){\n\t\t\tmeasurements = [measurements];\n\t\t}\n\t\t\n\t\tmeasurements = measurements.filter(m => m instanceof Potree.Measure);\n\t\t\n\t\tlet features = [];\n\t\tfor(let measure of measurements){\n\t\t\tlet f = Potree.GeoJSONExporter.measurementToFeatures(measure);\n\t\t\t\n\t\t\tfeatures = features.concat(f);\n\t\t}\n\t\t\n\t\tlet geojson = {\n\t\t\t\"type\": \"FeatureCollection\",\n\t\t\t\"features\": features\n\t\t};\n\t\t\n\t\treturn JSON.stringify(geojson, null, \"\\t\");\n\t}\n\n}\n\n\n\n/**\n *\n * @author sigeom sa / http://sigeom.ch\n * @author Ioda-Net Srl / https://www.ioda-net.ch/\n * @author Markus Schtz / http://potree.org\n *\n */\n\nPotree.DXFExporter = class DXFExporter{\n\t\n\tstatic measurementPointSection(measurement){\n\t\t\n\t\tlet position = measurement.points[0].position;\n\t\t\n\t\tif(!position){\n\t\t\treturn \"\";\n\t\t}\n\t\t\n\t\tlet dxfSection = `0\nCIRCLE\n8\nlayer_point\n10\n${position.x}\n20\n${position.y}\n30\n${position.z}\n40\n1.0\n`;\n\n\t\treturn dxfSection;\n\t}\n\t\n\tstatic measurementPolylineSection(measurement){\n\t\t// bit code for polygons/polylines: \n\t\t// https://www.autodesk.com/techpubs/autocad/acad2000/dxf/polyline_dxf_06.htm\n\t\tlet geomCode = 8; \n\t\tif(measurement.closed){\n\t\t\tgeomCode += 1;\n\t\t}\n\t\t\n\t\tlet dxfSection = `0\nPOLYLINE\n8\nlayer_polyline\n62\n1\n66\n1\n10\n0.0\n20\n0.0\n30\n0.0\n70\n${geomCode}\n`;\n\n\t\tlet xMax = 0.0;\n\t\tlet yMax = 0.0;\n\t\tlet zMax = 0.0;\n\t\tfor(let point of measurement.points){\n\t\t\tpoint = point.position;\n\t\t\txMax = Math.max(xMax, point.x);\n\t\t\tyMax = Math.max(yMax, point.y);\n\t\t\tzMax = Math.max(zMax, point.z);\n\t\t\t\n\t\t\tdxfSection += `0\nVERTEX\n8\n0\n10\n${point.x}\n20\n${point.y}\n30\n${point.z}\n70\n32\n`;\n\n\t\t}\n            dxfSection += `0\nSEQEND\n`;\n\n\t\treturn dxfSection;\n\t}\n\t\n\tstatic measurementSection(measurement){\n\t\t\n\t\t//if(measurement.points.length <= 1){\n\t\t//\treturn \"\";\n\t\t//}\n\t\t\n\t\tif(measurement.points.length === 0){\n\t\t\treturn \"\";\n\t\t}else if(measurement.points.length === 1){\n\t\t\treturn Potree.DXFExporter.measurementPointSection(measurement);\n\t\t}else if(measurement.points.length >= 2){\n\t\t\treturn Potree.DXFExporter.measurementPolylineSection(measurement);\n\t\t}\n\t}\n\t\n\t\n\tstatic toString(measurements){\n\t\t\n\t\tif(!(measurements instanceof Array)){\n\t\t\tmeasurements = [measurements];\n\t\t}\n\t\tmeasurements = measurements.filter(m => m instanceof Potree.Measure);\n\t\t\n\t\tlet points = measurements.filter(m => (m instanceof Potree.Measure))\n\t\t\t.map(m => m.points)\n\t\t\t.reduce((a, v) => a.concat(v))\n\t\t\t.map(p => p.position);\n\t\t\t\n\t\tlet min = new THREE.Vector3(Infinity, Infinity, Infinity);\n\t\tlet max = new THREE.Vector3(-Infinity, -Infinity, -Infinity);\n\t\tfor(let point of points){\n\t\t\tmin.min(point);\n\t\t\tmax.max(point);\n\t\t}\n\t\t\n\t\t\n\t\t\n\t\tlet dxfHeader = `999\nDXF created from potree\n0\nSECTION\n2\nHEADER\n9\n$ACADVER\n1\nAC1006\n9\n$INSBASE\n10\n0.0\n20\n0.0\n30\n0.0\n9\n$EXTMIN\n10\n${min.x}\n20\n${min.y}\n30\n${min.z}\n9\n$EXTMAX\n10\n${max.x}\n20\n${max.y}\n30\n${max.z}\n0\nENDSEC\n`;\n\n\t\tlet dxfBody = `0\nSECTION\n2\nENTITIES\n`;\n\t\t\n\t\tfor(let measurement of measurements){\n\t\t\tdxfBody += Potree.DXFExporter.measurementSection(measurement);\n\t\t}\n\t\t\n\t\tdxfBody += `0\nENDSEC\n`;\n\n\t\tlet dxf = dxfHeader + dxfBody + '0\\nEOF';\n\t\t\n\t\treturn dxf;\n\t}\n\n\t\n}\n\nPotree.CSVExporter = class CSVExporter{\n\t\n\tstatic toString(points){\n\t\tlet string = \"\";\n\t\t\n\t\tlet attributes = Object.keys(points.data)\n\t\t\t.filter(a => a !== \"normal\")\n\t\t\t.sort((a, b) => {\n\t\t\t\tif(a === \"position\") return -1;\n\t\t\t\tif(b === \"position\") return 1;\n\t\t\t\tif(a === \"color\") return -1;\n\t\t\t\tif(b === \"color\") return 1;\n\t\t\t});\n\t\t\n\t\tlet headerValues = [];\n\t\tfor(let attribute of attributes){\n\t\t\tlet itemSize = points.data[attribute].length / points.numPoints;\n\t\t\t\n\t\t\tif(attribute === \"position\"){\n\t\t\t\theaderValues = headerValues.concat([\"x\", \"y\", \"z\"]);\n\t\t\t}else if(attribute === \"color\"){\n\t\t\t\theaderValues = headerValues.concat([\"r\", \"g\", \"b\"]);\n\t\t\t}else if(itemSize > 1){\n\t\t\t\tfor(let i = 0; i < itemSize; i++){\n\t\t\t\t\theaderValues.push(`${attribute}_${i}`);\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\theaderValues.push(attribute);\n\t\t\t}\n\t\t}\n\t\tstring = headerValues.join(\", \") + \"\\n\";\n\n\t\tfor(let i = 0; i < points.numPoints; i++){\n\t\t\t\n\t\t\tlet values = [];\n\t\t\t\n\t\t\tfor(let attribute of attributes){\n\t\t\t\tlet itemSize = points.data[attribute].length / points.numPoints;\n\t\t\t\tlet value = points.data[attribute]\n\t\t\t\t\t.subarray(itemSize * i, itemSize * i + itemSize)\n\t\t\t\t\t.join(\", \");\n\t\t\t\tvalues.push(value);\n\t\t\t}\n\t\t\t\n\t\t\tstring += values.join(\", \") + \"\\n\";\n\t\t}\n\t\t\n\t\treturn string;\n\t}\n\t\n};\n\nPotree.LASExporter = class LASExporter{\n\t\n\tstatic toLAS(points){\n\t\tlet string = \"\";\n\t\t\n\t\tlet boundingBox = points.boundingBox;\n\t\tlet offset = boundingBox.min.clone();\n\t\tlet diagonal = boundingBox.min.distanceTo(boundingBox.max);\n\t\tlet scale = new THREE.Vector3(0.001, 0.001, 0.001);\n\t\tif(diagonal > 1000*1000){\n\t\t\tscale = new THREE.Vector3(0.01, 0.01, 0.01);\n\t\t}else{\n\t\t\tscale = new THREE.Vector3(0.001, 0.001, 0.001);\n\t\t}\n\t\t\n\t\tlet setString = function(string, offset, buffer){\n\t\t\tlet view = new Uint8Array(buffer);\n\t\t\t\n\t\t\tfor(let i = 0; i < string.length; i++){\n\t\t\t\tlet charCode = string.charCodeAt(i);\n\t\t\t\tview[offset + i] = charCode;\n\t\t\t}\n\t\t}\n\t\t\n\t\tlet buffer = new ArrayBuffer(227 + 28 * points.numPoints);\n\t\tlet view = new DataView(buffer);\n\t\tlet u8View = new Uint8Array(buffer);\n\t\t//let u16View = new Uint16Array(buffer);\n\t\t\n\t\tsetString(\"LASF\", 0, buffer);\n\t\tu8View[24] = 1;\n\t\tu8View[25] = 2;\n\t\t\n\t\t// system identifier o:26 l:32\n\t\t\n\t\t// generating software o:58 l:32\n\t\tsetString(\"Potree 1.5\", 58, buffer); \n\t\t\n\t\t// file creation day of year o:90 l:2\n\t\t// file creation year o:92 l:2\n\t\t\n\t\t// header size o:94 l:2\n\t\tview.setUint16(94, 227, true);\n\t\t\n\t\t// offset to point data o:96 l:4\n\t\tview.setUint32(96, 227, true);\n\t\t\n\t\t// number of letiable length records o:100 l:4\n\t\t\n\t\t// point data record format 104 1\n\t\tu8View[104] = 2;\n\t\t\n\t\t// point data record length 105 2\n\t\tview.setUint16(105, 28, true);\n\t\t\n\t\t// number of point records 107 4 \n\t\tview.setUint32(107, points.numPoints, true);\n\t\t\n\t\t// number of points by return 111 20\n\t\t\n\t\t// x scale factor 131 8\n\t\tview.setFloat64(131, scale.x, true);\n\t\t\n\t\t// y scale factor 139 8\n\t\tview.setFloat64(139, scale.y, true);\n\t\t\n\t\t// z scale factor 147 8\n\t\tview.setFloat64(147, scale.z, true);\n\t\t\n\t\t// x offset 155 8\n\t\tview.setFloat64(155, offset.x, true);\n\t\t\n\t\t// y offset 163 8\n\t\tview.setFloat64(163, offset.y, true);\n\t\t\n\t\t// z offset 171 8\n\t\tview.setFloat64(171, offset.z, true);\n\t\t\n\t\t// max x 179 8\n\t\tview.setFloat64(179, boundingBox.max.x, true);\n\t\t\n\t\t// min x 187 8\n\t\tview.setFloat64(187, boundingBox.min.x, true);\n\t\t\n\t\t// max y 195 8\n\t\tview.setFloat64(195, boundingBox.max.y, true);\n\t\t\n\t\t// min y 203 8\n\t\tview.setFloat64(203, boundingBox.min.y, true);\n\t\t\n\t\t// max z 211 8\n\t\tview.setFloat64(211, boundingBox.max.z, true);\n\t\t\n\t\t// min z 219 8\n\t\tview.setFloat64(219, boundingBox.min.z, true);\n\t\t\n\t\tlet boffset = 227;\n\t\tfor(let i = 0; i < points.numPoints; i++){\n\t\t\t//let point = points[i];\n\t\t\t//let position = new THREE.Vector3(point.x, point.y, point.z);\n\t\t\t\n\t\t\tlet px = points.data.position[3*i + 0];\n\t\t\tlet py = points.data.position[3*i + 1];\n\t\t\tlet pz = points.data.position[3*i + 2];\n\t\t\t\n\t\t\tlet ux = parseInt((px - offset.x) / scale.x);\n\t\t\tlet uy = parseInt((py - offset.y) / scale.y);\n\t\t\tlet uz = parseInt((pz - offset.z) / scale.z);\n\t\t\t\n\t\t\tview.setUint32(boffset + 0, ux, true);\n\t\t\tview.setUint32(boffset + 4, uy, true);\n\t\t\tview.setUint32(boffset + 8, uz, true);\n\t\t\t\n\t\t\tif(points.data.intensity){\n\t\t\t\tview.setUint16(boffset + 12, (points.data.intensity[i]), true);\n\t\t\t}\n\t\t\t\n\t\t\tlet rt = 0;\n\t\t\tif(points.data.returnNumber){\n\t\t\t\trt += points.data.returnNumber[i];\n\t\t\t}\n\t\t\tif(points.data.numberOfReturns){\n\t\t\t\trt += (points.data.numberOfReturns[i] << 3);\n\t\t\t}\n\t\t\tview.setUint8(boffset + 14, rt);\n\t\t\t\n\t\t\tif(points.data.classification){\n\t\t\t\tview.setUint8(boffset + 15, points.data.classification[i]);\n\t\t\t}\n\t\t\t// scan angle rank\n\t\t\t// user data\n\t\t\t// point source id\n\t\t\tif(points.data.pointSourceID){\n\t\t\t\tview.setUint16(boffset + 18, points.data.pointSourceID[i]);\n\t\t\t}\n\t\t\t\n\t\t\tif(points.data.color){\n\t\t\t\tview.setUint16(boffset + 20, (points.data.color[3*i + 0] * 255), true);\n\t\t\t\tview.setUint16(boffset + 22, (points.data.color[3*i + 1] * 255), true);\n\t\t\t\tview.setUint16(boffset + 24, (points.data.color[3*i + 2] * 255), true);\n\t\t\t}\n\t\t\t\n\t\t\tboffset += 28;\n\t\t}\n\n\t\treturn buffer;\n\t}\n\t\n};\n\nPotree.PointCloudArena4DNode = class PointCloudArena4DNode extends Potree.PointCloudTreeNode{\n\t\n\tconstructor(){\n\t\tsuper(); \n\t\t\n\t\tthis.left = null;\n\t\tthis.right = null;\n\t\tthis.sceneNode = null;\n\t\tthis.kdtree = null;\n\t}\n\t\n\tgetNumPoints(){\n\t\treturn this.geometryNode.numPoints;\n\t}\n\t\n\tisLoaded(){\n\t\treturn true;\n\t}\n\t\n\tisTreeNode(){\n\t\treturn true;\n\t}\n\t\n\tisGeometryNode(){\n\t\treturn false;\n\t}\n\t\n\tgetLevel(){\n\t\treturn this.geometryNode.level;\n\t}\n\t\n\tgetBoundingSphere(){\n\t\treturn this.geometryNode.boundingSphere;\n\t}\n\t\n\tgetBoundingBox(){\n\t\treturn this.geometryNode.boundingBox;\n\t}\n\t\n\ttoTreeNode(child){\n\t\tvar geometryNode = null;\n\t\t\n\t\tif(this.left === child){\n\t\t\tgeometryNode = this.left;\n\t\t}else if(this.right === child){\n\t\t\tgeometryNode = this.right;\n\t\t}\n\t\t\n\t\tif(!geometryNode.loaded){\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tvar node = new Potree.PointCloudArena4DNode();\n\t\tvar sceneNode = THREE.PointCloud(geometryNode.geometry, this.kdtree.material);\n\t\tsceneNode.visible = false;\n\t\t\n\t\tnode.kdtree = this.kdtree;\n\t\tnode.geometryNode = geometryNode;\n\t\tnode.sceneNode = sceneNode;\n\t\tnode.parent = this;\n\t\tnode.left = this.geometryNode.left;\n\t\tnode.right = this.geometryNode.right;\n\t}\n\t\n\tgetChildren(){\n\t\tvar children = [];\n\t\t\n\t\tif(this.left){\n\t\t\tchildren.push(this.left);\n\t\t} \n\t\t\n\t\tif(this.right){\n\t\t\tchildren.push(this.right);\n\t\t}\n\t\t\n\t\treturn children;\n\t}\n};\n\nPotree.PointCloudOctreeNode.prototype = Object.create(Potree.PointCloudTreeNode.prototype);\n\n\n\nPotree.PointCloudArena4D = class PointCloudArena4D extends Potree.PointCloudTree{\n\t\n\tconstructor(geometry){\n\t\tsuper()\n\t\t\n\t\tthis.root = null;\n\t\tif(geometry.root){\n\t\t\tthis.root = geometry.root;\n\t\t}else{\n\t\t\tgeometry.addEventListener(\"hierarchy_loaded\", () => {\n\t\t\t\tthis.root = geometry.root;\n\t\t\t});\n\t\t}\n\t\t\n\t\tthis.visiblePointsTarget = 2*1000*1000;\n\t\tthis.minimumNodePixelSize = 150;\n\t\t\n\t\tthis.position.sub(geometry.offset);\n\t\tthis.updateMatrix();\n\t\t\n\t\tthis.numVisibleNodes = 0;\n\t\tthis.numVisiblePoints = 0;\n\t\t\n\t\tthis.boundingBoxNodes = [];\n\t\tthis.loadQueue = [];\n\t\tthis.visibleNodes = [];\n\t\t\n\t\tthis.pcoGeometry = geometry;\n\t\tthis.boundingBox = this.pcoGeometry.boundingBox;\n\t\tthis.boundingSphere = this.pcoGeometry.boundingSphere;\n\t\tthis.material = new Potree.PointCloudMaterial({vertexColors: THREE.VertexColors, size: 0.05, treeType: Potree.TreeType.KDTREE});\n\t\tthis.material.sizeType = Potree.PointSizeType.ATTENUATED;\n\t\tthis.material.size = 0.05;\n\t\tthis.profileRequests = [];\n\t\tthis.name = \"\";\n\t}\n\t\n\tsetName(name){\n\t\tif(this.name !== name){\n\t\t\tthis.name = name;\n\t\t\tthis.dispatchEvent({type: \"name_changed\", name: name, pointcloud: this});\n\t\t}\n\t}\n\t\n\tgetName(){\n\t\treturn this.name;\n\t}\n\t\n\tgetLevel(){\n\t\treturn this.level;\n\t}\n\t\n\ttoTreeNode(geometryNode, parent){\n\t\tvar node = new Potree.PointCloudArena4DNode();\n\t\tvar sceneNode = new THREE.Points(geometryNode.geometry, this.material);\n\t\t\n\t\tsceneNode.frustumCulled = false;\n\t\tsceneNode.onBeforeRender = (_this, scene, camera, geometry, material, group) => {\n\t\t\t\n\t\t\tif(material.program){\n\t\t\t\t_this.getContext().useProgram(material.program.program);\n\t\t\t\t\n\t\t\t\tif(material.program.getUniforms().map.level){\n\t\t\t\t\tlet level = geometryNode.getLevel();\n\t\t\t\t\tmaterial.uniforms.level.value = level;\n\t\t\t\t\tmaterial.program.getUniforms().map.level.setValue(_this.getContext(), level);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif(this.visibleNodeTextureOffsets && material.program.getUniforms().map.vnStart){\n\t\t\t\t\tlet vnStart = this.visibleNodeTextureOffsets.get(node);\n\t\t\t\t\tmaterial.uniforms.vnStart.value = vnStart;\n\t\t\t\t\tmaterial.program.getUniforms().map.vnStart.setValue(_this.getContext(), vnStart);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif(material.program.getUniforms().map.pcIndex){\n\t\t\t\t\tlet i = node.pcIndex ? node.pcIndex : this.visibleNodes.indexOf(node);\n\t\t\t\t\tmaterial.uniforms.pcIndex.value = i;\n\t\t\t\t\tmaterial.program.getUniforms().map.pcIndex.setValue(_this.getContext(), i);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\t\n\t\tnode.geometryNode = geometryNode;\n\t\tnode.sceneNode = sceneNode;\n\t\tnode.pointcloud = this;\n\t\tnode.left = geometryNode.left;\n\t\tnode.right = geometryNode.right;\n\t\t\n\t\tif(!parent){\n\t\t\tthis.root = node;\n\t\t\tthis.add(sceneNode);\n\t\t}else{\n\t\t\tparent.sceneNode.add(sceneNode);\n\t\t\t\n\t\t\tif(parent.left === geometryNode){\n\t\t\t\tparent.left = node;\n\t\t\t}else if(parent.right === geometryNode){\n\t\t\t\tparent.right = node;\n\t\t\t}\n\t\t}\n\t\t\n\t\tvar disposeListener = function(){\n\t\t\tparent.sceneNode.remove(node.sceneNode);\n\t\t\t\n\t\t\tif(parent.left === node){\n\t\t\t\tparent.left = geometryNode;\n\t\t\t}else if(parent.right === node){\n\t\t\t\tparent.right = geometryNode;\n\t\t\t}\n\t\t}\n\t\tgeometryNode.oneTimeDisposeHandlers.push(disposeListener);\n\t\t\n\t\treturn node;\n\t}\n\t\n\tupdateMaterial(material, visibleNodes, camera, renderer){\n\t\tmaterial.fov = camera.fov * (Math.PI / 180);\n\t\tmaterial.screenWidth = renderer.domElement.clientWidth;\n\t\tmaterial.screenHeight = renderer.domElement.clientHeight;\n\t\tmaterial.spacing = this.pcoGeometry.spacing;\n\t\tmaterial.near = camera.near;\n\t\tmaterial.far = camera.far;\n\t\t\n\t\t// reduce shader source updates by setting maxLevel slightly higher than actually necessary\n\t\tif(this.maxLevel > material.levels){\n\t\t\tmaterial.levels = this.maxLevel + 2;\n\t\t}\n\t\t\n\t\t//material.minSize = 3;\n\t\t\n\t\t//material.uniforms.octreeSize.value = this.boundingBox.size().x;\n\t\tvar bbSize = this.boundingBox.getSize();\n\t\tmaterial.bbSize = [bbSize.x, bbSize.y, bbSize.z];\n\t\t\n\t\t// update visibility texture\n\t\tif(material.pointSizeType){\n\t\t\tif(material.pointSizeType === Potree.PointSizeType.ADAPTIVE \n\t\t\t\t|| material.pointColorType === Potree.PointColorType.LOD){\n\t\t\t\t\n\t\t\t\tthis.updateVisibilityTexture(material, visibleNodes);\n\t\t\t}\n\t\t}\n\t}\n\t\n\tupdateVisibleBounds(){\n\t\t\n\t}\n\t\n\thideDescendants(object){\n\t\tvar stack = [];\n\t\tfor(var i = 0; i < object.children.length; i++){\n\t\t\tvar child = object.children[i];\n\t\t\tif(child.visible){\n\t\t\t\tstack.push(child);\n\t\t\t}\n\t\t}\n\t\t\n\t\twhile(stack.length > 0){\n\t\t\tvar object = stack.shift();\n\t\t\t\n\t\t\tobject.visible = false;\n\t\t\tif(object.boundingBoxNode){\n\t\t\t\tobject.boundingBoxNode.visible = false;\n\t\t\t}\n\t\t\t\n\t\t\tfor(var i = 0; i < object.children.length; i++){\n\t\t\t\tvar child = object.children[i];\n\t\t\t\tif(child.visible){\n\t\t\t\t\tstack.push(child);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t\n\tupdateMatrixWorld( force ){\n\t\t//node.matrixWorld.multiplyMatrices( node.parent.matrixWorld, node.matrix );\n\t\t\n\t\tif ( this.matrixAutoUpdate === true ) this.updateMatrix();\n\n\t\tif ( this.matrixWorldNeedsUpdate === true || force === true ) {\n\n\t\t\tif ( this.parent === undefined ) {\n\n\t\t\t\tthis.matrixWorld.copy( this.matrix );\n\n\t\t\t} else {\n\n\t\t\t\tthis.matrixWorld.multiplyMatrices( this.parent.matrixWorld, this.matrix );\n\n\t\t\t}\n\n\t\t\tthis.matrixWorldNeedsUpdate = false;\n\n\t\t\tforce = true;\n\n\t\t}\n\t}\n\t\n\tnodesOnRay(nodes, ray){\n\t\tvar nodesOnRay = [];\n\n\t\tvar _ray = ray.clone();\n\t\tfor(var i = 0; i < nodes.length; i++){\n\t\t\tvar node = nodes[i];\n\t\t\tvar sphere = node.getBoundingSphere().clone().applyMatrix4(node.sceneNode.matrixWorld);\n\t\t\tvar box = node.getBoundingBox().clone().applyMatrix4(node.sceneNode.matrixWorld);\n\t\t\t\n\t\t\tif(_ray.intersectsSphere(sphere)){\n\t\t\t\tnodesOnRay.push(node);\n\t\t\t}\n\t\t\t//if(_ray.isIntersectionBox(box)){\n\t\t\t//\tnodesOnRay.push(node);\n\t\t\t//}\n\t\t}\n\t\t\n\t\treturn nodesOnRay;\n\t}\n\t\n\tpick(renderer, camera, ray, params = {}){\n\t\t\n\t\t//let start = new Date().getTime();\n\t\t\n\t\tlet pickWindowSize = params.pickWindowSize || 17;\n\t\tlet pickOutsideClipRegion = params.pickOutsideClipRegion || false;\n\t\tlet width = Math.ceil(renderer.domElement.clientWidth);\n\t\tlet height = Math.ceil(renderer.domElement.clientHeight);\n\t\t\n\t\tlet nodes = this.nodesOnRay(this.visibleNodes, ray);\n\t\t\n\t\tif(nodes.length === 0){\n\t\t\treturn null;\n\t\t}\n\t\t\n\t\tif(!this.pickState){\n\t\t\t\n\t\t\tlet scene = new THREE.Scene();\n\t\t\t\n\t\t\tlet material = new Potree.PointCloudMaterial();\n\t\t\tmaterial.pointColorType = Potree.PointColorType.POINT_INDEX;\t\n\t\t\t\n\t\t\tlet renderTarget = new THREE.WebGLRenderTarget( \n\t\t\t\t1, 1, \n\t\t\t\t{ minFilter: THREE.LinearFilter, \n\t\t\t\tmagFilter: THREE.NearestFilter, \n\t\t\t\tformat: THREE.RGBAFormat } \n\t\t\t);\n\t\t\t\n\t\t\tthis.pickState = {\n\t\t\t\trenderTarget: renderTarget,\n\t\t\t\tmaterial: material,\n\t\t\t\tscene: scene\n\t\t\t};\n\t\t};\n\t\t\n\t\tlet pickState = this.pickState;\n\t\tlet pickMaterial = pickState.material;\n\t\t\n\t\t{ // update pick material\n\t\t\tpickMaterial.pointSizeType = this.material.pointSizeType;\n\t\t\tpickMaterial.shape = this.material.shape;\n\t\t\t\n\t\t\tpickMaterial.size = this.material.size;\n\t\t\tpickMaterial.minSize = this.material.minSize;\n\t\t\tpickMaterial.maxSize = this.material.maxSize;\n\t\t\tpickMaterial.classification = this.material.classification;\n\t\t\t\n\t\t\tif(pickOutsideClipRegion){\n\t\t\t\tpickMaterial.clipMode = Potree.ClipMode.DISABLED;\n\t\t\t}else{\n\t\t\t\tpickMaterial.clipMode = this.material.clipMode;\n\t\t\t\tif(this.material.clipMode === Potree.ClipMode.CLIP_OUTSIDE){\n\t\t\t\t\tpickMaterial.setClipBoxes(this.material.clipBoxes);\n\t\t\t\t}else{\n\t\t\t\t\tpickMaterial.setClipBoxes([]);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tthis.updateMaterial(pickMaterial, nodes, camera, renderer);\n\t\t}\n\t\t\n\t\tif(pickState.renderTarget.width != width || pickState.renderTarget.height != height){\n\t\t\tpickState.renderTarget.dispose();\n\t\t\tpickState.renderTarget = new THREE.WebGLRenderTarget( \n\t\t\t\t1, 1, \n\t\t\t\t{ minFilter: THREE.LinearFilter, \n\t\t\t\tmagFilter: THREE.NearestFilter, \n\t\t\t\tformat: THREE.RGBAFormat } \n\t\t\t);\n\t\t}\n\t\tpickState.renderTarget.setSize(width, height);\n\t\trenderer.setRenderTarget( pickState.renderTarget );\n\t\t\n\t\tlet pixelPos = new THREE.Vector3()\n\t\t\t.addVectors(camera.position, ray.direction)\n\t\t\t.project(camera)\n\t\t\t.addScalar(1)\n\t\t\t.multiplyScalar(0.5);\n\t\tpixelPos.x *= width;\n\t\tpixelPos.y *= height;\n\t\t\n\t\trenderer.setScissor(\n\t\t\tparseInt(pixelPos.x - (pickWindowSize - 1) / 2), \n\t\t\tparseInt(pixelPos.y - (pickWindowSize - 1) / 2),\n\t\t\tparseInt(pickWindowSize), parseInt(pickWindowSize));\n\t\trenderer.setScissorTest(true);\n\t\t\n\t\trenderer.state.buffers.depth.setTest(pickMaterial.depthTest);\n\t\trenderer.state.buffers.depth.setMask(pickMaterial.depthWrite);\n\t\trenderer.state.setBlending(THREE.NoBlending);\n\t\t\n\t\trenderer.clearTarget( pickState.renderTarget, true, true, true );\n\t\t\n\t\t//pickState.scene.children = nodes.map(n => n.sceneNode);\n\t\t\n\t\t//let childStates = [];\n\t\tlet tempNodes = [];\n\t\tfor(let i = 0; i < nodes.length; i++){\n\t\t\tlet node = nodes[i];\n\t\t\tnode.pcIndex = i+1;\n\t\t\tlet sceneNode = node.sceneNode;\n\t\t\t\n\t\t\tlet tempNode = new THREE.Points(sceneNode.geometry, pickMaterial);\n\t\t\ttempNode.matrix = sceneNode.matrix;\n\t\t\ttempNode.matrixWorld = sceneNode.matrixWorld;\n\t\t\ttempNode.matrixAutoUpdate = false;\n\t\t\ttempNode.frustumCulled = false;\n\t\t\ttempNode.pcIndex = i+1;\n\t\t\t\n\t\t\tlet geometryNode = node.geometryNode;\n\t\t\tlet material = pickMaterial;\n\t\t\ttempNode.onBeforeRender = (_this, scene, camera, geometry, material, group) => {\n\t\t\t\t\n\t\t\t\tif(material.program){\n\t\t\t\t\t_this.getContext().useProgram(material.program.program);\n\t\t\t\t\t\n\t\t\t\t\tif(material.program.getUniforms().map.level){\n\t\t\t\t\t\tlet level = geometryNode.getLevel();\n\t\t\t\t\t\tmaterial.uniforms.level.value = level;\n\t\t\t\t\t\tmaterial.program.getUniforms().map.level.setValue(_this.getContext(), level);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif(this.visibleNodeTextureOffsets && material.program.getUniforms().map.vnStart){\n\t\t\t\t\t\tlet vnStart = this.visibleNodeTextureOffsets.get(node);\n\t\t\t\t\t\tmaterial.uniforms.vnStart.value = vnStart;\n\t\t\t\t\t\tmaterial.program.getUniforms().map.vnStart.setValue(_this.getContext(), vnStart);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif(material.program.getUniforms().map.pcIndex){\n\t\t\t\t\t\tmaterial.uniforms.pcIndex.value = node.pcIndex;\n\t\t\t\t\t\tmaterial.program.getUniforms().map.pcIndex.setValue(_this.getContext(), node.pcIndex);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t};\n\t\t\ttempNodes.push(tempNode);\n\t\t\t\n\t\t\t//for(let child of nodes[i].sceneNode.children){\n\t\t\t//\tchildStates.push({child: child, visible: child.visible});\n\t\t\t//\tchild.visible = false;\n\t\t\t//}\n\t\t}\n\t\tpickState.scene.autoUpdate = false;\n\t\tpickState.scene.children = tempNodes;\n\t\t//pickState.scene.overrideMaterial = pickMaterial;\n\t\t\n\t\trenderer.state.setBlending(THREE.NoBlending);\n\t\t\n\t\t// RENDER\n\t\trenderer.render(pickState.scene, camera, pickState.renderTarget);\n\t\t\n\t\t//for(let childState of childStates){\n\t\t//\tchildState.child = childState.visible;\n\t\t//}\n\t\t\n\t\t//pickState.scene.overrideMaterial = null;\n\t\t\n\t\t//renderer.context.readPixels(\n\t\t//\tpixelPos.x - (pickWindowSize-1) / 2, pixelPos.y - (pickWindowSize-1) / 2, \n\t\t//\tpickWindowSize, pickWindowSize, \n\t\t//\trenderer.context.RGBA, renderer.context.UNSIGNED_BYTE, pixels);\n\t\t\n\t\tlet clamp = (number, min, max) => Math.min(Math.max(min, number), max);\n\t\t\n\t\tlet x = parseInt(clamp(pixelPos.x - (pickWindowSize-1) / 2, 0, width));\n\t\tlet y = parseInt(clamp(pixelPos.y - (pickWindowSize-1) / 2, 0, height));\n\t\tlet w = parseInt(Math.min(x + pickWindowSize, width) - x);\n\t\tlet h = parseInt(Math.min(y + pickWindowSize, height) - y);\n\t\t\n\t\tlet pixelCount = w * h;\n\t\tlet buffer = new Uint8Array(4 * pixelCount);\n\t\trenderer.readRenderTargetPixels(pickState.renderTarget, \n\t\t\tx, y, w, h, \n\t\t\tbuffer);\n\t\t\n\t\trenderer.setScissorTest(false);\n\t\t\n\t\trenderer.setRenderTarget(null);\n\t\t\n\t\tlet pixels = buffer;\n\t\tlet ibuffer = new Uint32Array(buffer.buffer);\n\t\t\n\t\t// find closest hit inside pixelWindow boundaries\n\t\tlet min = Number.MAX_VALUE;\n\t\tlet hit = null;\n\t\tfor(let u = 0; u < pickWindowSize; u++){\n\t\t\tfor(let v = 0; v < pickWindowSize; v++){\n\t\t\t\tlet offset = (u + v*pickWindowSize);\n\t\t\t\tlet distance = Math.pow(u - (pickWindowSize-1) / 2, 2) + Math.pow(v - (pickWindowSize-1) / 2, 2);\n\t\t\t\t\n\t\t\t\tlet pcIndex = pixels[4*offset + 3];\n\t\t\t\tpixels[4*offset + 3] = 0;\n\t\t\t\tlet pIndex = ibuffer[offset];\n\t\t\t\t\n\t\t\t\t//if((pIndex !== 0 || pcIndex !== 0) && distance < min){\n\t\t\t\tif(pcIndex > 0 && distance < min){\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\thit = {\n\t\t\t\t\t\tpIndex: pIndex,\n\t\t\t\t\t\tpcIndex: pcIndex - 1\n\t\t\t\t\t};\n\t\t\t\t\tmin = distance;\n\t\t\t\t\t\n\t\t\t\t\t//console.log(hit);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t//console.log(pixels);\n\t\t\n\t\t//{ // open window with image\n\t\t//\tlet img = Potree.utils.pixelsArrayToImage(buffer, w, h);\n\t\t//\tlet screenshot = img.src;\n\t\t//\t\n\t\t//\tif(!this.debugDIV){\n\t\t//\t\tthis.debugDIV = $(`\n\t\t//\t\t\t<div id=\"pickDebug\" \n\t\t//\t\t\tstyle=\"position: absolute; \n\t\t//\t\t\tright: 400px; width: 300px;\n\t\t//\t\t\tbottom: 44px; width: 300px;\n\t\t//\t\t\tz-index: 1000;\n\t\t//\t\t\t\"></div>`);\n\t\t//\t\t$(document.body).append(this.debugDIV);\n\t\t//\t}\n\t\t//\t\n\t\t//\tthis.debugDIV.empty();\n\t\t//\tthis.debugDIV.append($(`<img src=\"${screenshot}\"\n\t\t//\t\tstyle=\"transform: scaleY(-1);\"/>`));\n\t\t//\t//$(this.debugWindow.document).append($(`<img src=\"${screenshot}\"/>`));\n\t\t//\t//this.debugWindow.document.write('<img src=\"'+screenshot+'\"/>');\n\t\t//}\n\t\t\n\t\t//return;\n\t\t\n\t\tlet point = null;\n\t\t\n\t\tif(hit){\n\t\t\tpoint = {};\n\t\t\t\n\t\t\tif(!nodes[hit.pcIndex]){\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\t\n\t\t\tlet pc = nodes[hit.pcIndex].sceneNode;\n\t\t\tlet attributes = pc.geometry.attributes;\n\t\t\t\n\t\t\tfor(let property in attributes) {\n\t\t\t\tif (attributes.hasOwnProperty(property)) {\n\t\t\t\t\tlet values = pc.geometry.attributes[property];\n\t\t\t\t\n\t\t\t\t\tif(property === \"position\"){\n\t\t\t\t\t\tlet positionArray = values.array;\n\t\t\t\t\t\tlet x = positionArray[3*hit.pIndex+0];\n\t\t\t\t\t\tlet y = positionArray[3*hit.pIndex+1];\n\t\t\t\t\t\tlet z = positionArray[3*hit.pIndex+2];\n\t\t\t\t\t\tlet position = new THREE.Vector3(x, y, z);\n\t\t\t\t\t\tposition.applyMatrix4(pc.matrixWorld);\n\t\t\t\t\t\n\t\t\t\t\t\tpoint[property] = position;\n\t\t\t\t\t}else if(property === \"indices\"){\n\t\t\t\t\t\n\t\t\t\t\t}else{\n\t\t\t\t\t\tif(values.itemSize === 1){\n\t\t\t\t\t\t\tpoint[property] = values.array[hit.pIndex];\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\tlet value = [];\n\t\t\t\t\t\t\tfor(let j = 0; j < values.itemSize; j++){\n\t\t\t\t\t\t\t\tvalue.push(values.array[values.itemSize*hit.pIndex + j]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tpoint[property] = value;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\t//let end = new Date().getTime();\n\t\t//let duration = end - start;\n\t\t//console.log(`pick duration: ${duration}ms`);\n\t\t\n\t\treturn point;\n\t\t\n\t\t\n\t}\n\t\n\tupdateVisibilityTexture(material, visibleNodes){\n\n\t\tif(!material){\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tvar texture = material.visibleNodesTexture;\n\t\tvar data = texture.image.data;\n\t\t\n\t\t// copy array\n\t\tvisibleNodes = visibleNodes.slice();\n\t\t\n\t\t// sort by level and number\n\t\tvar sort = function(a, b){\n\t\t\tvar la = a.geometryNode.level;\n\t\t\tvar lb = b.geometryNode.level;\n\t\t\tvar na = a.geometryNode.number;\n\t\t\tvar nb = b.geometryNode.number;\n\t\t\tif(la != lb) return la - lb;\n\t\t\tif(na < nb) return -1;\n\t\t\tif(na > nb) return 1;\n\t\t\treturn 0;\n\t\t};\n\t\tvisibleNodes.sort(sort);\n\t\t\n\t\tvar visibleNodeNames = [];\n\t\tfor(var i = 0; i < visibleNodes.length; i++){\n\t\t\t//visibleNodeNames[visibleNodes[i].pcoGeometry.number] = true;\n\t\t\tvisibleNodeNames.push(visibleNodes[i].geometryNode.number);\n\t\t}\n\t\t\n\t\tfor(var i = 0; i < visibleNodes.length; i++){\n\t\t\tvar node = visibleNodes[i];\n\t\t\t\n\t\t\tvar b1 = 0;\t// children\n\t\t\tvar b2 = 0;\t// offset to first child\n\t\t\tvar b3 = 0;\t// split \n\t\t\t\n\t\t\tif(node.geometryNode.left && visibleNodeNames.indexOf(node.geometryNode.left.number) > 0){\n\t\t\t\tb1 += 1;\n\t\t\t\tb2 = visibleNodeNames.indexOf(node.geometryNode.left.number) - i;\n\t\t\t}\n\t\t\tif(node.geometryNode.right && visibleNodeNames.indexOf(node.geometryNode.right.number) > 0){\n\t\t\t\tb1 += 2;\n\t\t\t\tb2 = (b2 === 0) ? visibleNodeNames.indexOf(node.geometryNode.right.number) - i : b2;\n\t\t\t}\n\t\t\t\n\t\t\tif(node.geometryNode.split === \"X\"){\n\t\t\t\tb3 = 1;\n\t\t\t}else if(node.geometryNode.split === \"Y\"){\n\t\t\t\tb3 = 2;\n\t\t\t}else if(node.geometryNode.split === \"Z\"){\n\t\t\t\tb3 = 4;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\tdata[i*3+0] = b1;\n\t\t\tdata[i*3+1] = b2;\n\t\t\tdata[i*3+2] = b3;\n\t\t}\n\t\t\n\t\t\n\t\ttexture.needsUpdate = true;\n\t}\n\t\n\tget progress(){\n\t\tif(this.pcoGeometry.root){\n\t\t\treturn Potree.PointCloudArena4DGeometryNode.nodesLoading > 0 ? 0 : 1;\n\t\t}else{\n\t\t\treturn 0;\n\t\t}\n\t}\n}\n\n\n\nPotree.PointCloudArena4DGeometryNode = function(){\n\tvar scope = this;\n\n\tthis.left = null;\n\tthis.right = null;\n\tthis.boundingBox = null;\n\tthis.number = null;\n\tthis.pcoGeometry = null;\n\tthis.loaded = false;\n\tthis.numPoints = 0;\n\tthis.level = 0;\n\tthis.children = [];\n\tthis.oneTimeDisposeHandlers = [];\n};\n\nPotree.PointCloudArena4DGeometryNode.nodesLoading = 0;\n\nPotree.PointCloudArena4DGeometryNode.prototype.isGeometryNode = function(){\n\treturn true;\n};\n\nPotree.PointCloudArena4DGeometryNode.prototype.isTreeNode = function(){\n\treturn false;\n};\n\nPotree.PointCloudArena4DGeometryNode.prototype.isLoaded = function(){\n\treturn this.loaded;\n};\n\nPotree.PointCloudArena4DGeometryNode.prototype.getBoundingSphere = function(){\n\treturn this.boundingSphere;\n};\n\nPotree.PointCloudArena4DGeometryNode.prototype.getBoundingBox = function(){\n\treturn this.boundingBox;\n};\n\nPotree.PointCloudArena4DGeometryNode.prototype.getChildren = function(){\n\tvar children = [];\n\t\n\tif(this.left){\n\t\tchildren.push(this.left);\n\t} \n\t\n\tif(this.right){\n\t\tchildren.push(this.right);\n\t}\n\t\n\treturn children;\n};\n\nPotree.PointCloudArena4DGeometryNode.prototype.getBoundingBox = function(){\n\treturn this.boundingBox;\n};\n\nPotree.PointCloudArena4DGeometryNode.prototype.getLevel = function(){\n\treturn this.level;\n};\n\nPotree.PointCloudArena4DGeometryNode.prototype.load = function(){\n\n\tif(this.loaded || this.loading){\n\t\treturn;\n\t}\n\t\n\tif(Potree.PointCloudArena4DGeometryNode.nodesLoading >= 5){\n\t\treturn;\n\t}\n\t\n\tthis.loading = true;\n\t\n\tPotree.PointCloudArena4DGeometryNode.nodesLoading++;\n\t\n\tvar url = this.pcoGeometry.url + \"?node=\" + this.number;\n\tvar xhr = new XMLHttpRequest();\n\txhr.open(\"GET\", url, true);\n\txhr.responseType = \"arraybuffer\";\n\t\n\tvar scope = this;\n\t\n\txhr.onreadystatechange = function(){\n\t\tif(!(xhr.readyState === 4 && xhr.status === 200)){\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tvar buffer = xhr.response;\n\t\tvar view = new DataView(buffer);\n\t\tvar numPoints = buffer.byteLength / 17;\n\t\t\n\t\tvar positions = new Float32Array(numPoints*3);\n\t\tvar colors = new Uint8Array(numPoints*3);\n\t\tvar indices = new ArrayBuffer(numPoints*4);\n\t\tvar iIndices = new Uint32Array(indices);\n\t\t\n\t\tfor(var i = 0; i < numPoints; i++){\n\t\t\tvar x = view.getFloat32(i*17 + 0, true) + scope.boundingBox.min.x;\n\t\t\tvar y = view.getFloat32(i*17 + 4, true) + scope.boundingBox.min.y;\n\t\t\tvar z = view.getFloat32(i*17 + 8, true) + scope.boundingBox.min.z;\n\t\t\tvar r = view.getUint8(i*17 + 12, true);\n\t\t\tvar g = view.getUint8(i*17 + 13, true);\n\t\t\tvar b = view.getUint8(i*17 + 14, true);\n\t\t\t\n\t\t\tpositions[i*3+0] = x;\n\t\t\tpositions[i*3+1] = y;\n\t\t\tpositions[i*3+2] = z;\n\t\t\t\n\t\t\tcolors[i*3+0] = r;\n\t\t\tcolors[i*3+1] = g;\n\t\t\tcolors[i*3+2] = b;\n\t\t\t\n\t\t\tiIndices[i] = i;\n\t\t}\n\t\t\n\t\t\n\t\tvar geometry = new THREE.BufferGeometry();\n\t\tgeometry.addAttribute(\"position\", new THREE.BufferAttribute(positions, 3));\n\t\tgeometry.addAttribute(\"color\", new THREE.BufferAttribute(colors, 3, true));\n\t\tgeometry.addAttribute(\"normal\", new THREE.BufferAttribute(new Float32Array(numPoints*3), 3));\n\t\t\n\t\tlet indicesAttribute = new THREE.Uint8BufferAttribute(indices, 4);\n\t\tindicesAttribute.normalized = true;\n\t\tgeometry.addAttribute(\"indices\", indicesAttribute);\n\t\t\n\t\tscope.geometry = geometry;\n\t\tscope.loaded = true;\n\t\tPotree.PointCloudArena4DGeometryNode.nodesLoading--;\n\t\t\n\t\tgeometry.boundingBox = scope.boundingBox;\n\t\tgeometry.boundingSphere = scope.boundingSphere;\n\t\t\n\t\tscope.numPoints = numPoints;\n\n\t\tscope.loading = false;\n\t};\n\t\n\txhr.send(null);\n};\n\nPotree.PointCloudArena4DGeometryNode.prototype.dispose = function(){\n\tif(this.geometry && this.parent != null){\n\t\tthis.geometry.dispose();\n\t\tthis.geometry = null;\n\t\tthis.loaded = false;\n\t\t\n\t\t//this.dispatchEvent( { type: 'dispose' } );\n\t\tfor(var i = 0; i < this.oneTimeDisposeHandlers.length; i++){\n\t\t\tvar handler = this.oneTimeDisposeHandlers[i];\n\t\t\thandler();\n\t\t}\n\t\tthis.oneTimeDisposeHandlers = [];\n\t}\n};\n\nPotree.PointCloudArena4DGeometryNode.prototype.getNumPoints = function(){\n\treturn this.numPoints;\n};\n\n\nPotree.PointCloudArena4DGeometry = function(){\n\tvar scope = this;\n\n\tthis.numPoints = 0;\n\tthis.version = 0;\n\tthis.boundingBox = null;\n\tthis.numNodes = 0;\n\tthis.name = null;\n\tthis.provider = null;\n\tthis.url = null;\n\tthis.root = null;\n\tthis.levels = 0;\n\tthis._spacing = null;\n\tthis.pointAttributes = new Potree.PointAttributes([\n\t\t\"POSITION_CARTESIAN\",\n\t\t\"COLOR_PACKED\"\n\t]);\n};\n\nPotree.PointCloudArena4DGeometry.prototype = Object.create( THREE.EventDispatcher.prototype );\n\nPotree.PointCloudArena4DGeometry.load = function(url, callback){\n\n\tvar xhr = new XMLHttpRequest();\n\txhr.open('GET', url + \"?info\", true);\n\t\n\txhr.onreadystatechange = function(){\n\t\ttry{\n\t\t\tif(xhr.readyState === 4 && xhr.status === 200){\n\t\t\t\tvar response = JSON.parse(xhr.responseText);\n\t\t\t\t\n\t\t\t\tvar geometry = new Potree.PointCloudArena4DGeometry();\n\t\t\t\tgeometry.url = url;\n\t\t\t\tgeometry.name = response.Name;\n\t\t\t\tgeometry.provider = response.Provider;\n\t\t\t\tgeometry.numNodes = response.Nodes;\n\t\t\t\tgeometry.numPoints = response.Points;\n\t\t\t\tgeometry.version = response.Version;\n\t\t\t\tgeometry.boundingBox = new THREE.Box3(\n\t\t\t\t\tnew THREE.Vector3().fromArray(response.BoundingBox.slice(0,3)),\n\t\t\t\t\tnew THREE.Vector3().fromArray(response.BoundingBox.slice(3,6))\n\t\t\t\t);\n\t\t\t\tif(response.Spacing){\n\t\t\t\t\tgeometry.spacing = response.Spacing;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvar offset = geometry.boundingBox.min.clone().multiplyScalar(-1);\n\t\t\t\t\n\t\t\t\tgeometry.boundingBox.min.add(offset);\n\t\t\t\tgeometry.boundingBox.max.add(offset);\n\t\t\t\tgeometry.offset = offset;\n\t\t\t\t\n\t\t\t\tvar center = geometry.boundingBox.getCenter();\n\t\t\t\tvar radius = geometry.boundingBox.getSize().length() / 2;\n\t\t\t\tgeometry.boundingSphere = new THREE.Sphere(center, radius);\n\t\t\t\t\n\t\t\t\tgeometry.loadHierarchy();\n\t\t\t\t\n\t\t\t\tcallback(geometry);\n\t\t\t}else if(xhr.readyState === 4){\n\t\t\t\tcallback(null);\n\t\t\t}\n\t\t}catch(e){\n\t\t\tconsole.error(e.message);\n\t\t\tcallback(null);\n\t\t}\n\t};\n\t\t\n\txhr.send(null);\n\n};\n\nPotree.PointCloudArena4DGeometry.prototype.loadHierarchy = function(){\n\tvar url = this.url + \"?tree\"; \n\tvar xhr = new XMLHttpRequest();\n\txhr.open(\"GET\", url, true);\n\txhr.responseType = \"arraybuffer\";\n\t\n\tvar scope = this;\n\t\n\txhr.onreadystatechange = function(){\n\t\tif(!(xhr.readyState === 4 && xhr.status === 200)){\n\t\t\treturn;\n\t\t}\n\t\n\t\tvar buffer = xhr.response;\n\t\tvar numNodes = buffer.byteLength /\t3;\n\t\tvar view = new DataView(buffer);\n\t\tvar stack = [];\n\t\tvar root = null;\n\t\t\n\t\tvar levels = 0;\n\t\t\n\t\tvar start = new Date().getTime();\n\t\t// read hierarchy\n\t\tfor(var i = 0; i < numNodes; i++){\n\t\t\tvar mask = view.getUint8(i*3+0, true);\n\t\t\tvar numPoints = view.getUint16(i*3+1, true);\n\t\t\n\t\t\t\n\t\t\tvar hasLeft = (mask & 1) > 0;\n\t\t\tvar hasRight = (mask & 2) > 0;\n\t\t\tvar splitX = (mask & 4) > 0;\n\t\t\tvar splitY = (mask & 8) > 0;\n\t\t\tvar splitZ = (mask & 16) > 0;\n\t\t\tvar split = null;\n\t\t\tif(splitX){\n\t\t\t\tsplit = \"X\";\n\t\t\t}else if(splitY){\n\t\t\t\tsplit = \"Y\";\n\t\t\t}if(splitZ){\n\t\t\t\tsplit = \"Z\";\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\tvar node = new Potree.PointCloudArena4DGeometryNode();\n\t\t\tnode.hasLeft = hasLeft;\n\t\t\tnode.hasRight = hasRight;\n\t\t\tnode.split = split;\n\t\t\tnode.isLeaf = !hasLeft && !hasRight;\n\t\t\tnode.number = i;\n\t\t\tnode.left = null;\n\t\t\tnode.right = null;\n\t\t\tnode.pcoGeometry = scope;\n\t\t\tnode.level = stack.length;\n\t\t\tlevels = Math.max(levels, node.level);\n\t\t\t\n\t\t\tif(stack.length > 0){\n\t\t\t\tvar parent = stack[stack.length-1];\n\t\t\t\tnode.boundingBox = parent.boundingBox.clone();\n\t\t\t\tvar parentBBSize = parent.boundingBox.getSize();\n\t\t\t\t\n\t\t\t\tif(parent.hasLeft && !parent.left){\n\t\t\t\t\tparent.left = node;\n\t\t\t\t\tparent.children.push(node);\n\t\t\t\t\t\n\t\t\t\t\tif(parent.split === \"X\"){\n\t\t\t\t\t\tnode.boundingBox.max.x = node.boundingBox.min.x + parentBBSize.x / 2;\n\t\t\t\t\t}else if(parent.split === \"Y\"){\n\t\t\t\t\t\tnode.boundingBox.max.y = node.boundingBox.min.y + parentBBSize.y / 2;\n\t\t\t\t\t}else if(parent.split === \"Z\"){\n\t\t\t\t\t\tnode.boundingBox.max.z = node.boundingBox.min.z + parentBBSize.z / 2;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tvar center = node.boundingBox.getCenter();\n\t\t\t\t\tvar radius = node.boundingBox.getSize().length() / 2;\n\t\t\t\t\tnode.boundingSphere = new THREE.Sphere(center, radius);\n\t\t\t\t\t\n\t\t\t\t}else{\n\t\t\t\t\tparent.right = node;\n\t\t\t\t\tparent.children.push(node);\n\t\t\t\t\t\n\t\t\t\t\tif(parent.split === \"X\"){\n\t\t\t\t\t\tnode.boundingBox.min.x = node.boundingBox.min.x + parentBBSize.x / 2;\n\t\t\t\t\t}else if(parent.split === \"Y\"){\n\t\t\t\t\t\tnode.boundingBox.min.y = node.boundingBox.min.y + parentBBSize.y / 2;\n\t\t\t\t\t}else if(parent.split === \"Z\"){\n\t\t\t\t\t\tnode.boundingBox.min.z = node.boundingBox.min.z + parentBBSize.z / 2;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tvar center = node.boundingBox.getCenter();\n\t\t\t\t\tvar radius = node.boundingBox.getSize().length() / 2;\n\t\t\t\t\tnode.boundingSphere = new THREE.Sphere(center, radius);\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\troot = node;\n\t\t\t\troot.boundingBox = scope.boundingBox.clone();\n\t\t\t\tvar center = root.boundingBox.getCenter();\n\t\t\t\tvar radius = root.boundingBox.getSize().length() / 2;\n\t\t\t\troot.boundingSphere = new THREE.Sphere(center, radius);\n\t\t\t}\n\t\t\t\n\t\t\tvar bbSize = node.boundingBox.getSize();\n\t\t\tnode.spacing = ((bbSize.x + bbSize.y + bbSize.z) / 3) / 75;\n\t\t\t\n\t\t\tstack.push(node);\n\t\t\t\n\t\t\tif(node.isLeaf){\n\t\t\t\tvar done = false;\n\t\t\t\twhile(!done && stack.length > 0){\n\t\t\t\t\tstack.pop();\n\t\t\t\t\t\n\t\t\t\t\tvar top = stack[stack.length-1];\n\t\t\t\t\t\n\t\t\t\t\tdone = stack.length > 0 && top.hasRight && top.right == null;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tvar end = new Date().getTime();\n\t\tvar parseDuration = end - start;\n\t\tvar msg = parseDuration;\n\t\t//document.getElementById(\"lblDebug\").innerHTML = msg;\n\t\t\n\t\tscope.root = root;\n\t\tscope.levels = levels;\n\t\t//console.log(this.root);\n\t\t\n\t\tscope.dispatchEvent({type: \"hierarchy_loaded\"});\n\t\t\n\t};\n\t\n\txhr.send(null);\n\t\n\t\n};\n\nObject.defineProperty(Potree.PointCloudArena4DGeometry.prototype, \"spacing\", {\n\tget: function(){\n\t\tif(this._spacing){\n\t\t\treturn this._spacing;\n\t\t}else if(this.root){\n\t\t\treturn this.root.spacing;\n\t\t}else{\n\t\t\tnull;\n\t\t}\n\t},\n\tset: function(value){\n\t\tthis._spacing = value;\n\t}\n});\n\n\n\n\n\nfunction ProgressBar(){\n\tthis._progress = 0;\n\tthis._message = \"\";\n\t\n\tthis.maxOpacity = 0.6;\n\t\n\tthis.element = document.createElement(\"div\");\n\tthis.elProgress = document.createElement(\"div\");\n\tthis.elProgressMessage = document.createElement(\"div\");\n\t\n\t//this.element.innerHTML = \"element\";\n\t//this.elProgress.innerHTML = \"progress\";\n\t\n\tthis.element.innerHTML = \"\";\n\tthis.element.style.position = \"fixed\";\n\tthis.element.style.bottom = \"40px\";\n\tthis.element.style.width = \"200px\";\n\tthis.element.style.marginLeft = \"-100px\";\n\tthis.element.style.left = \"50%\";\n\tthis.element.style.borderRadius = \"5px\";\n\tthis.element.style.border = \"1px solid #727678\";\n\tthis.element.style.height = \"16px\";\n\tthis.element.style.padding = \"1px\";\n\tthis.element.style.textAlign = \"center\";\n\tthis.element.style.backgroundColor = \"#6ba8e5\";\n\tthis.element.style.opacity = this.maxOpacity;\n\tthis.element.style.pointerEvents = \"none\";\n\t\n\tthis.elProgress.innerHTML = \" \";\n\tthis.elProgress.style.backgroundColor = \"#b8e1fc\";\n\tthis.elProgress.style.position = \"absolute\";\n\tthis.elProgress.style.borderRadius = \"5px\";\n\tthis.elProgress.style.width = \"0%\";\n\tthis.elProgress.style.height = \"100%\";\n\tthis.elProgress.style.margin = \"0px\";\n\tthis.elProgress.style.padding = \"0px\";\n\t\n\tthis.elProgressMessage.style.position = \"absolute\";\n\tthis.elProgressMessage.style.width = \"100%\";\n\tthis.elProgressMessage.innerHTML = \"loading 1 / 10\";\n\t\n\t\n\t\n\tdocument.body.appendChild(this.element);\n\tthis.element.appendChild(this.elProgress);\n\tthis.element.appendChild(this.elProgressMessage);\n\t\n\tthis.hide();\n};\n\nProgressBar.prototype.hide = function(){\n\tthis.element.style.opacity = 0;\n\tthis.element.style.transition = \"all 0.2s ease\";\n};\n\nProgressBar.prototype.show = function(){\n\tthis.element.style.opacity = this.maxOpacity;\n\tthis.element.style.transition = \"all 0.2s ease\";\n};\n\nObject.defineProperty(ProgressBar.prototype, \"progress\", {\n\tget: function(){\n\t\treturn this._progress;\n\t},\n\tset: function(value){\n\t\tthis._progress = value;\n\t\tthis.elProgress.style.width = (value * 100) + \"%\";\n\t}\n});\n\nObject.defineProperty(ProgressBar.prototype, \"message\", {\n\tget: function(){\n\t\treturn this._message;\n\t},\n\tset: function(message){\n\t\tthis._message = message;\n\t\tthis.elProgressMessage.innerHTML = message;\n\t}\n});\n//let getQueryParam = function(name) {\n//    name = name.replace(/[\\[\\]]/g, \"\\\\$&\");\n//    let regex = new RegExp(\"[?&]\" + name + \"(=([^&#]*)|&|#|$)\"),\n//        results = regex.exec(window.location.href);\n//    if (!results) return null;\n//    if (!results[2]) return '';\n//    return decodeURIComponent(results[2].replace(/\\+/g, \" \"));\n//}\n\nPotree.View = class{\n\tconstructor(){\n\t\tthis.position = new THREE.Vector3(0, 0, 0);\n\t\t\n\t\tthis.yaw = Math.PI / 4;\n\t\tthis._pitch = -Math.PI / 4;\n\t\tthis.radius = 1;\n\t\t\n\t\tthis.maxPitch = Math.PI / 2;\n\t\tthis.minPitch = -Math.PI / 2;\n\t\t\n\t\tthis.navigationMode = Potree.OrbitControls;\n\t}\n\t\n\tclone(){\n\t\tlet c = new Potree.View();\n\t\tc.yaw = this.yaw;\n\t\tc._pitch = this.pitch;\n\t\tc.radius = this.radius;\n\t\tc.maxPitch = this.maxPitch;\n\t\tc.minPitch = this.minPitch;\n\t\tc.navigationMode = this.navigationMode;\n\t\t\n\t\treturn c;\n\t}\n\t\n\tget pitch(){\n\t\treturn this._pitch;\n\t}\n\t\n\tset pitch(angle){\n\t\tthis._pitch = Math.max(Math.min(angle, this.maxPitch), this.minPitch);\n\t}\n\t\n\tget direction(){\n\t\tlet dir = new THREE.Vector3(0, 1, 0);\n\t\t\n\t\tdir.applyAxisAngle(new THREE.Vector3(1, 0, 0), this.pitch);\n\t\tdir.applyAxisAngle(new THREE.Vector3(0, 0, 1), this.yaw);\n\t\t\n\t\treturn dir;\n\t}\n\t\n\tset direction(dir){\n\t\tlet yaw = Math.atan2(dir.y, dir.x) - Math.PI / 2;\n\t\tlet pitch = Math.atan2(dir.z, Math.sqrt(dir.x * dir.x + dir.y * dir.y));\n\t\t\n\t\tthis.yaw = yaw;\n\t\tthis.pitch = pitch;\n\t}\n\t\n\tlookAt(t){\n\t\tlet V = new THREE.Vector3().subVectors(t, this.position);\n\t\tlet radius = V.length();\n\t\tlet dir = V.normalize();\n\t\t\n\t\tthis.radius = radius;\n\t\tthis.direction = dir;\n\t}\n\t\n\tgetPivot(){\n\t\treturn new THREE.Vector3().addVectors(this.position, this.direction.multiplyScalar(this.radius));\n\t}\n\t\n\tgetSide(){\n\t\tlet side = new THREE.Vector3(1, 0, 0);\n\t\tside.applyAxisAngle(new THREE.Vector3(0, 0, 1), this.yaw);\n\t\t\n\t\treturn side;\n\t}\n\t\n\tpan(x, y){\n\t\tlet dir = new THREE.Vector3(0, 1, 0);\n\t\tdir.applyAxisAngle(new THREE.Vector3(1, 0, 0), this.pitch);\n\t\tdir.applyAxisAngle(new THREE.Vector3(0, 0, 1), this.yaw);\n\t\t\n\t\t//let side = new THREE.Vector3(1, 0, 0);\n\t\t//side.applyAxisAngle(new THREE.Vector3(0, 0, 1), this.yaw);\n\t\t\n\t\tlet side = this.getSide();\n\t\t\n\t\tlet up = side.clone().cross(dir);\n\t\t\n\t\tlet pan = side.multiplyScalar(x).add(up.multiplyScalar(y));\n\t\t\n\t\tthis.position = this.position.add(pan);\n\t\t//this.target = this.target.add(pan);\n\t}\n\t\n\ttranslate(x, y, z){\n\t\tlet dir = new THREE.Vector3(0, 1, 0);\n\t\tdir.applyAxisAngle(new THREE.Vector3(1, 0, 0), this.pitch);\n\t\tdir.applyAxisAngle(new THREE.Vector3(0, 0, 1), this.yaw);\n\t\t\n\t\tlet side = new THREE.Vector3(1, 0, 0);\n\t\tside.applyAxisAngle(new THREE.Vector3(0, 0, 1), this.yaw);\n\t\t\n\t\tlet up = side.clone().cross(dir);\n\t\t\n\t\tlet t = side.multiplyScalar(x)\n\t\t\t.add(dir.multiplyScalar(y))\n\t\t\t.add(up.multiplyScalar(z));\n\t\t\n\t\tthis.position = this.position.add(t);\n\t}\n\t\n\ttranslateWorld(x, y, z){\n\t\tthis.position.x += x;\n\t\tthis.position.y += y;\n\t\tthis.position.z += z;\n\t}\n\t\n};\n\nPotree.Scene = class extends THREE.EventDispatcher{\n\tconstructor(){\n\t\tsuper();\n\t\t\n\t\tthis.annotations = new Potree.Annotation();\n\t\tthis.scene = new THREE.Scene();\n\t\tthis.scenePointCloud = new THREE.Scene();\n\t\tthis.sceneBG = new THREE.Scene();\n\t\tthis.camera = new THREE.PerspectiveCamera(this.fov, 1, 0.1, 1000*1000);\n\t\tthis.cameraBG = new THREE.Camera();\n\t\tthis.pointclouds = [];\n\t\tthis.referenceFrame;\n\t\t\n\t\tthis.measurements = [];\n\t\tthis.profiles = [];\n\t\tthis.volumes = [];\n\t\t\n\t\tthis.fpControls;\n\t\tthis.orbitControls;\n\t\tthis.earthControls;\n\t\tthis.geoControls;\n\t\tthis.inputHandler;\n\t\tthis.view = new Potree.View();\n\t\t\n\t\tthis.directionalLight = null;\n\t\t\n\t\tthis.initialize();\n\t\t\n\t}\n\t\n\testimateHeightAt(position){\n\t\t\n\t\tlet height = null;\n\t\tlet fromSpacing = Infinity;\n\t\t\n\t\t\n\t\tfor(let pointcloud of this.pointclouds){\n\t\t\t\n\t\t\tif(pointcloud.root.geometryNode === undefined){\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t\n\t\t\tlet pHeight = null;\n\t\t\tlet pFromSpacing = Infinity;\n\t\t\t\n\t\t\tlet lpos = position.clone().sub(pointcloud.position);\n\t\t\tlpos.z = 0;\n\t\t\tlet ray = new THREE.Ray(lpos, new THREE.Vector3(0, 0, 1));\n\t\t\t\n\t\t\tlet stack = [pointcloud.root];\n\t\t\twhile(stack.length > 0){\n\t\t\t\tlet node = stack.pop();\n\t\t\t\tlet box = node.getBoundingBox();\n\t\t\t\t\n\t\t\t\tlet inside = ray.intersectBox(box);\n\t\t\t\t\n\t\t\t\tif(!inside){\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tlet h = node.geometryNode.mean.z \n\t\t\t\t\t+ pointcloud.position.z \n\t\t\t\t\t+ node.geometryNode.boundingBox.min.z;\n\t\t\t\t\t\n\t\t\t\tif(node.geometryNode.spacing <= pFromSpacing){\n\t\t\t\t\tpHeight = h;\n\t\t\t\t\tpFromSpacing = node.geometryNode.spacing;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tfor(let index of Object.keys(node.children)){\n\t\t\t\t\tlet child = node.children[index];\n\t\t\t\t\tif(child.geometryNode){\n\t\t\t\t\t\tstack.push(node.children[index]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif(height === null || pFromSpacing < fromSpacing){\n\t\t\t\theight = pHeight;\n\t\t\t\tfromSpacing = pFromSpacing;\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn height;\n\t}\n\t\n\taddPointCloud(pointcloud){\n\t\tthis.pointclouds.push(pointcloud);\n\t\tthis.scenePointCloud.add(pointcloud);\n\t\t\n\t\tthis.dispatchEvent({\n\t\t\ttype: \"pointcloud_added\",\n\t\t\tpointcloud: pointcloud\n\t\t});\n\t};\n\t\n\taddVolume(volume){\n\t\tthis.volumes.push(volume);\n\t\tthis.dispatchEvent({\n\t\t\t\"type\": \"volume_added\",\n\t\t\t\"scene\": this,\n\t\t\t\"volume\": volume\n\t\t});\n\t};\n\t\n\tremoveVolume(volume){\n\t\tlet index = this.volumes.indexOf(volume);\n\t\tif (index > -1) {\n\t\t\tthis.volumes.splice(index, 1);\n\t\t\tthis.dispatchEvent({\n\t\t\t\t\"type\": \"volume_removed\",\n\t\t\t\t\"scene\": this,\n\t\t\t\t\"volume\": volume\n\t\t\t});\n\t\t}\n\t};\n\t\n\taddMeasurement(measurement){\n\t\tmeasurement.lengthUnit = this.lengthUnit;\n\t\tthis.measurements.push(measurement);\n\t\tthis.dispatchEvent({\n\t\t\t\"type\": \"measurement_added\",\n\t\t\t\"scene\": this,\n\t\t\t\"measurement\": measurement\n\t\t});\n\t};\n\t\n\tremoveMeasurement(measurement){\n\t\tlet index = this.measurements.indexOf(measurement);\n\t\tif (index > -1) {\n\t\t\tthis.measurements.splice(index, 1);\n\t\t\tthis.dispatchEvent({\n\t\t\t\t\"type\": \"measurement_removed\",\n\t\t\t\t\"scene\": this,\n\t\t\t\t\"measurement\": measurement\n\t\t\t});\n\t\t}\n\t}\n\t\n\taddProfile(profile){\n\t\tthis.profiles.push(profile);\n\t\tthis.dispatchEvent({\n\t\t\t\"type\": \"profile_added\",\n\t\t\t\"scene\": this,\n\t\t\t\"profile\": profile\n\t\t});\n\t}\n\t\n\tremoveProfile(profile){\n\t\tlet index = this.profiles.indexOf(profile);\n\t\tif (index > -1) {\n\t\t\tthis.profiles.splice(index, 1);\n\t\t\tthis.dispatchEvent({\n\t\t\t\t\"type\": \"profile_removed\",\n\t\t\t\t\"scene\": this,\n\t\t\t\t\"profile\": profile\n\t\t\t});\n\t\t}\n\t}\n\t\n\tremoveAllMeasurements(){\n\t\twhile(this.measurements.length > 0){\n\t\t\tthis.removeMeasurement(this.measurements[0]);\n\t\t}\n\t\t\n\t\twhile(this.profiles.length > 0){\n\t\t\tthis.removeProfile(this.profiles[0]);\n\t\t}\n\t\t\n\t\twhile(this.volumes.length > 0){\n\t\t\tthis.removeVolume(this.volumes[0]);\n\t\t}\n\t}\n\t\n\tinitialize(){\n\t\t\n\t\tthis.referenceFrame = new THREE.Object3D();\n\t\tthis.referenceFrame.matrixAutoUpdate = false;\n\t\tthis.scenePointCloud.add(this.referenceFrame);\n\n\t\tthis.camera.up.set(0, 0, 1);\n\t\tthis.camera.position.set(1000, 1000, 1000);\n\t\t//this.camera.rotation.y = -Math.PI / 4;\n\t\t//this.camera.rotation.x = -Math.PI / 6;\n\t\t\n\t\tthis.directionalLight = new THREE.DirectionalLight( 0xffffff, 0.5 );\n\t\tthis.directionalLight.position.set( 10, 10, 10 );\n\t\tthis.directionalLight.lookAt( new THREE.Vector3(0, 0, 0));\n\t\tthis.scenePointCloud.add( this.directionalLight );\n\t\t\n\t\tlet light = new THREE.AmbientLight( 0x555555 ); // soft white light\n\t\tthis.scenePointCloud.add( light );\n\t\t\n\t\tlet grid = Potree.utils.createGrid(5, 5, 2);\n\t\tthis.scene.add(grid);\n\t\t\n\t\t{// background\n\t\t// var texture = THREE.ImageUtils.loadTexture( Potree.resourcePath + '/textures/background.gif' );\n\t\t\tlet texture = Potree.utils.createBackgroundTexture(512, 512);\n\t\t\t\n\t\t\ttexture.minFilter = texture.magFilter = THREE.NearestFilter;\n\t\t\ttexture.minFilter = texture.magFilter = THREE.LinearFilter;\n\t\t\tlet bg = new THREE.Mesh(\n\t\t\t\tnew THREE.PlaneBufferGeometry(2, 2, 0),\n\t\t\t\tnew THREE.MeshBasicMaterial({\n\t\t\t\t\tmap: texture\n\t\t\t\t})\n\t\t\t);\n\t\t\tbg.material.depthTest = false;\n\t\t\tbg.material.depthWrite = false;\n\t\t\tthis.sceneBG.add(bg);\n\t\t}\n\t\t\n\t\t{// lights\n\t\t\n\t\t\t{\n\t\t\t\tlet light = new THREE.DirectionalLight( 0xffffff );\n\t\t\t\tlight.position.set( 10, 10, 1 );\n\t\t\t\tlight.target.position.set( 0, 0,0 );\n\t\t\t\tthis.scene.add(light);\n\t\t\t}\n\t\t\t\n\t\t\t{\n\t\t\t\tlet light = new THREE.DirectionalLight( 0xffffff );\n\t\t\t\tlight.position.set( -10, 10, 1 );\n\t\t\t\tlight.target.position.set( 0, 0,0 );\n\t\t\t\tthis.scene.add(light);\n\t\t\t}\n\t\t\t\n\t\t\t{\n\t\t\t\tlet light = new THREE.DirectionalLight( 0xffffff );\n\t\t\t\tlight.position.set( 0, -10, 20 );\n\t\t\t\tlight.target.position.set( 0, 0,0 );\n\t\t\t\tthis.scene.add(light);\n\t\t\t}\n\t\t\t\n\t\t}\n\t}\n\t\n\taddAnnotation(position, args = {}){\n\t\t\n\t\tif(position instanceof Array){\n\t\t\targs.position = new THREE.Vector3().fromArray(position);\n\t\t}else if(position instanceof THREE.Vector3){\n\t\t\targs.position = position;\n\t\t} \n\t\tlet annotation = new Potree.Annotation(args);\n\t\tthis.annotations.add(annotation);\n\t}\n\t\n\tgetAnnotations(){\n\t\treturn this.annotations;\n\t};\n\t\n};\n\nPotree.Viewer = class PotreeViewer extends THREE.EventDispatcher{\n\n\t\n\tconstructor(domElement, args){\n\t\tsuper();\n\t\t\n\t\t\n\t\t{ // generate missing dom hierarchy\n\t\t\tif($(domElement).find(\"#potree_map\").length === 0){\n\t\t\t\tlet potreeMap = $(`\n\t\t\t\t\t<div id=\"potree_map\" class=\"mapBox\" style=\"position: absolute; left: 50px; top: 50px; width: 400px; height: 400px; display: none\">\n\t\t\t\t\t\t<div id=\"potree_map_header\" style=\"position: absolute; width: 100%; height: 25px; top: 0px; background-color: rgba(0,0,0,0.5); z-index: 1000; border-top-left-radius: 3px; border-top-right-radius: 3px;\">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div id=\"potree_map_content\" class=\"map\" style=\"position: absolute; z-index: 100; top: 25px; width: 100%; height: calc(100% - 25px); border: 2px solid rgba(0,0,0,0.5); box-sizing: border-box;\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t`);\n\t\t\t\t$(domElement).append(potreeMap);\n\t\t\t}\n\t\t\t\n\t\t\tif($(domElement).find(\"#potree_description\").length === 0){\n\t\t\t\tlet potreeDescription = $(`<div id=\"potree_description\" class=\"potree_info_text\"></div>`);\n\t\t\t\t$(domElement).append(potreeDescription);\n\t\t\t}\n\t\t}\n\t\t\n\t\t\n\t\tlet a = args || {};\n\t\tthis.pointCloudLoadedCallback = a.onPointCloudLoaded || function(){};\n\t\t\n\t\tthis.renderArea = domElement;\n\t\t\n\t\t//if( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ) {\n\t\t//\tdefaultSettings.navigation = \"Orbit\";\n\t\t//}\n\t\t\n\t\tthis.server = null;\n\t\t\n\t\tthis.fov = 60;\n\t\tthis.clipMode = Potree.ClipMode.HIGHLIGHT_INSIDE;\n\t\tthis.isFlipYZ = false;\n\t\tthis.useDEMCollisions = false;\n\t\tthis.generateDEM = false;\n\t\tthis.minNodeSize = 100;\n\t\tthis.directionalLight;\n\t\tthis.edlStrength = 1.0;\n\t\tthis.edlRadius = 1.4;\n\t\tthis.useEDL = false;\n\t\tthis.classifications = {\n\t\t\t0:  { visible: true, name: \"never classified\" },\n\t\t\t1:  { visible: true, name: \"unclassified\"     },\n\t\t\t2:  { visible: true, name: \"ground\"           },\n\t\t\t3:  { visible: true, name: \"low vegetation\"   },\n\t\t\t4:  { visible: true, name: \"medium vegetation\"},\n\t\t\t5:  { visible: true, name: \"high vegetation\"  },\n\t\t\t6:  { visible: true, name: \"building\"         },\n\t\t\t7:  { visible: true, name: \"low point(noise)\" },\n\t\t\t8:  { visible: true, name: \"key-point\"        },\n\t\t\t9:  { visible: true, name: \"water\"            },\n\t\t\t12: { visible: true, name: \"overlap\"          }\n\t\t};\n\t\t\n\t\tthis.moveSpeed = 10;\t\t\n\n\t\tthis.LENGTH_UNITS = {\n\t\t\tMETER : {code: \"m\"},\n\t\t\tFEET: {code: \"ft\"},\n\t\t\tINCH: {code: \"\\u2033\"}\n\t\t};\n\t\tthis.lengthUnit = this.LENGTH_UNITS.METER;\n\n\t\tthis.showBoundingBox = false;\n\t\tthis.showAnnotations = true;\n\t\tthis.freeze = false;\n\n\t\tthis.mapView;\n\n\t\tthis.progressBar = new ProgressBar();\n\n\t\tthis.stats = new Stats();\n\t\t//this.stats.showPanel( 0 ); // 0: fps, 1: ms, 2: mb, 3+: custom\n\t\t//document.body.appendChild( this.stats.dom );\n\t\t//this.stats.dom.style.left = \"100px\";\n\t\t\n\t\tthis.potreeRenderer = null;\n\t\tthis.edlRenderer = null;\n\t\tthis.renderer = null;\n\t\t\n\t\tthis.scene = null;\n\t\t\n\t\tthis.inputHandler = null;\n\n\t\tthis.measuringTool = null;\n\t\tthis.profileTool = null;\n\t\tthis.volumeTool = null;\n\t\tthis.transformationTool = null;\n\t\t\n\t\tthis.skybox = null;\n\t\tthis.clock = new THREE.Clock();\n\t\tthis.background = null;\n\t\t\n\t\tthis.initThree();\n\t\t\n\t\tlet scene = new Potree.Scene(this.renderer);\n\t\tthis.setScene(scene);\n\t\t\n\t\t{\n\t\t\tthis.inputHandler = new Potree.InputHandler(this);\n\t\t\tthis.inputHandler.setScene(this.scene);\n\t\t\t\n\t\t\tthis.measuringTool = new Potree.MeasuringTool(this);\n\t\t\tthis.profileTool = new Potree.ProfileTool(this);\n\t\t\tthis.volumeTool = new Potree.VolumeTool(this);\n\t\t\tthis.transformationTool = new Potree.TransformationTool(this);\n\t\t\t\n\t\t\tthis.createControls();\n\t\t\t\n\t\t\tthis.measuringTool.setScene(this.scene);\n\t\t\tthis.profileTool.setScene(this.scene);\n\t\t\tthis.volumeTool.setScene(this.scene);\n\t\t\t\n\t\t\tlet onPointcloudAdded = (e) => {\n\t\t\t\tif(this.scene.pointclouds.length === 1){\n\t\t\t\t\tlet speed = e.pointcloud.boundingBox.getSize().length();\n\t\t\t\t\tspeed = speed / 5;\n\t\t\t\t\tthis.setMoveSpeed(speed);\n\t\t\t\t}\t\t\t\t\n\t\t\t};\n\t\t\t\n\t\t\tthis.addEventListener(\"scene_changed\", (e) => {\n\t\t\t\tthis.inputHandler.setScene(e.scene);\n\t\t\t\tthis.measuringTool.setScene(e.scene);\n\t\t\t\tthis.profileTool.setScene(e.scene);\n\t\t\t\tthis.volumeTool.setScene(e.scene);\n\t\t\t\t\n\t\t\t\tif(!e.scene.hasEventListener(\"pointcloud_added\", onPointcloudAdded)){\n\t\t\t\t\te.scene.addEventListener(\"pointcloud_added\", onPointcloudAdded);\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\tthis.scene.addEventListener(\"pointcloud_added\", onPointcloudAdded);\n\t\t}\n\t\t\n\t\t{// set defaults\n\t\t\tthis.setFOV(60);\n\t\t\tthis.setEDLEnabled(false);\n\t\t\tthis.setEDLRadius(1.4);\n\t\t\tthis.setEDLStrength(0.4);\n\t\t\tthis.setClipMode(Potree.ClipMode.HIGHLIGHT_INSIDE);\n\t\t\tthis.setPointBudget(1*1000*1000);\n\t\t\tthis.setShowBoundingBox(false);\n\t\t\tthis.setFreeze(false);\n\t\t\tthis.setNavigationMode(Potree.OrbitControls);\n\t\t\tthis.setBackground(\"gradient\");\n\t\t\t\n\t\t\tthis.scaleFactor = 1;\n\t\t\n\t\t\tthis.loadSettingsFromURL();\n\t\t}\n\n\t\t// start rendering!\n\t\trequestAnimationFrame(this.loop.bind(this));\n\t\t\n\t}\n\n//------------------------------------------------------------------------------------\n// Viewer API \n//------------------------------------------------------------------------------------\n\n\t\n\t\n\tsetScene(scene){\n\t\t\n\t\tif(scene === this.scene){\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tlet oldScene = this.scene;\n\t\tthis.scene = scene;\n\t\t\n\t\tthis.dispatchEvent({\n\t\t\ttype: \"scene_changed\",\n\t\t\toldScene: oldScene,\n\t\t\tscene: scene\n\t\t});\n\t\t\n\t\t\n\t\t{ // Annotations\n\t\t\t$(\".annotation\").detach();\n\t\t\t\n\t\t\t//for(let annotation of this.scene.annotations){\n\t\t\t//\tthis.renderArea.appendChild(annotation.domElement[0]);\n\t\t\t//}\n\t\t\t\n\t\t\tthis.scene.annotations.traverse(annotation => {\n\t\t\t\tthis.renderArea.appendChild(annotation.domElement[0]);\n\t\t\t});\n\t\t\t\n\t\t\tif(!this.onAnnotationAdded){\n\t\t\t\tthis.onAnnotationAdded = e => {\n\n\t\t\t\t//console.log(\"annotation added: \" + e.annotation.title);\n\t\t\t\t\n\t\t\t\te.annotation.traverse(node => {\n\t\t\t\t\tthis.renderArea.appendChild(node.domElement[0]);\n\t\t\t\t\tnode.scene = this.scene;\n\t\t\t\t});\n\n\t\t\t\t};\n\t\t\t}\n\t\t\n\t\t\tif(oldScene){\n\t\t\t\toldScene.annotations.removeEventListener(\"annotation_added\", this.onAnnotationAdded);\n\t\t\t}\n\t\t\tthis.scene.annotations.addEventListener(\"annotation_added\", this.onAnnotationAdded);\n\t\t}\n\t\t\n\t};\n\t\n\tgetControls(navigationMode){\n\t\tif(navigationMode === Potree.OrbitControls){\n\t\t\treturn this.orbitControls;\n\t\t}else if(navigationMode === Potree.FirstPersonControls){\n\t\t\treturn this.fpControls;\n\t\t}else if(navigationMode === Potree.EarthControls){\n\t\t\treturn this.earthControls;\n\t\t}else{\n\t\t\treturn null;\n\t\t}\n\t}\n\t\n\tgetMinNodeSize(){\n\t\treturn this.minNodeSize;\n\t};\n\t\n\tsetMinNodeSize(value){\n\t\tif(this.minNodeSize !== value){\n\t\t\tthis.minNodeSize = value;\n\t\t\tthis.dispatchEvent({\"type\": \"minnodesize_changed\", \"viewer\": this});\n\t\t}\n\t};\n\t\n\tgetBackground(){\n\t\treturn this.background;\n\t};\n\t\n\tsetBackground(bg){\n\t\tif(this.background === bg){\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tthis.background = bg;\n\t\tthis.dispatchEvent({\"type\": \"background_changed\", \"viewer\": this});\n\t}\n\t\n\tsetDescription(value){\n\t\t$('#potree_description')[0].innerHTML = value;\n\t};\n\t\n\tsetNavigationMode(value){\n\t\tthis.scene.view.navigationMode = value;\n\t};\n\t\n\tsetShowBoundingBox(value){\n\t\tif(this.showBoundingBox !== value){\n\t\t\tthis.showBoundingBox = value;\n\t\t\tthis.dispatchEvent({\"type\": \"show_boundingbox_changed\", \"viewer\": this});\n\t\t}\n\t};\n\t\n\tgetShowBoundingBox(){\n\t\treturn showBoundingBox;\n\t};\n\t\n\tsetMoveSpeed(value){\n\t\tif(this.moveSpeed !== value){\n\t\t\tthis.moveSpeed = value;\n\t\t\tthis.dispatchEvent({\"type\": \"move_speed_changed\", \"viewer\": this, \"speed\": value});\n\t\t}\n\t};\n\t\n\tgetMoveSpeed(){\n\t\treturn this.moveSpeed;\n\t};\n\t\n\tsetWeightClassification(w){\n\t\tfor(let i = 0; i < this.scene.pointclouds.length; i++) {\n\t\t\tthis.scene.pointclouds[i].material.weightClassification = w;\t\n\t\t\tthis.dispatchEvent({\"type\": \"attribute_weights_changed\" + i, \"viewer\": this});\t\t\n\t\t}\n\t};\n\t\n\tsetFreeze(value){\n\t\tif(this.freeze != value){\n\t\t\tthis.freeze = value;\n\t\t\tthis.dispatchEvent({\"type\": \"freeze_changed\", \"viewer\": this});\n\t\t}\n\t};\n\t\n\tgetFreeze(){\n\t\treturn this.freeze;\n\t};\n\t\n\tsetPointBudget(value){\n\n\t\tif(Potree.pointBudget !== value){\n\t\t\tPotree.pointBudget = parseInt(value);\n\t\t\tthis.dispatchEvent({\"type\": \"point_budget_changed\", \"viewer\": this});\n\t\t}\n\t};\n\t\n\tgetPointBudget(){\n\t\treturn Potree.pointBudget;\n\t};\n\t\n\tsetShowAnnotations(value){\n\t\tif(this.showAnnotations !== value){\n\t\t\tthis.showAnnotations = value;\n\t\t\tthis.dispatchEvent({\"type\": \"show_annotations_changed\", \"viewer\": this});\n\t\t}\n\t}\n\t\n\tgetShowAnnotations(){\n\t\treturn this.showAnnotations;\n\t}\n\t\n\tsetClipMode(clipMode){\n\t\tif(this.clipMode !== clipMode){\n\t\t\tthis.clipMode = clipMode;\n\t\t\tthis.dispatchEvent({\"type\": \"clip_mode_changed\", \"viewer\": this});\n\t\t}\n\t};\n\t\n\tgetClipMode(){\n\t\treturn this.clipMode;\n\t};\n\t\n\tsetDEMCollisionsEnabled(value){\n\t\tif(this.useDEMCollisions !== value){\n\t\t\tthis.useDEMCollisions = value;\n\t\t\tthis.dispatchEvent({\"type\": \"use_demcollisions_changed\", \"viewer\": this});\n\t\t};\n\t};\n\t\n\tgetDEMCollisionsEnabled(){\n\t\treturn this.useDEMCollisions;\n\t};\n\t\n\tsetEDLEnabled(value){\n\t\tif(this.useEDL != value){\n\t\t\tthis.useEDL = value;\n\t\t\tthis.dispatchEvent({\"type\": \"use_edl_changed\", \"viewer\": this});\n\t\t}\n\t};\n\t\n\tgetEDLEnabled(){\n\t\treturn this.useEDL;\n\t};\n\t\n\tsetEDLRadius(value){\n\t\tif(this.edlRadius !== value){\n\t\t\tthis.edlRadius = value;\n\t\t\tthis.dispatchEvent({\"type\": \"edl_radius_changed\", \"viewer\": this});\n\t\t}\n\t};\n\t\n\tgetEDLRadius(){\n\t\treturn this.edlRadius;\n\t};\n\t\n\tsetEDLStrength(value){\n\t\tif(this.edlStrength !== value){\n\t\t\tthis.edlStrength = value;\n\t\t\tthis.dispatchEvent({\"type\": \"edl_strength_changed\", \"viewer\": this});\n\t\t}\n\t};\n\t\n\tgetEDLStrength(){\n\t\treturn this.edlStrength;\n\t};\n\t\n\tsetFOV(value){\n\t\tif(this.fov !== value){\n\t\t\tthis.fov = value;\n\t\t\tthis.dispatchEvent({\"type\": \"fov_changed\", \"viewer\": this});\n\t\t}\n\t};\n\t\n\tgetFOV(){\n\t\treturn this.fov;\n\t};\n\t\n\tdisableAnnotations(){\n\t\tthis.scene.annotations.traverse(annotation => {\n\t\t\tannotation.domElement.css(\"pointer-events\", \"none\");\n\t\t\t\n\t\t\t//return annotation.visible;\n\t\t});\n\t};\n\t\n\tenableAnnotations(){\n\t\tthis.scene.annotations.traverse(annotation => {\n\t\t\tannotation.domElement.css(\"pointer-events\", \"auto\");\n\t\t\t\n\t\t\t//return annotation.visible;\n\t\t});\n\t};\n\t\n\tsetClassificationVisibility(key, value){\n\t\t\n\t\tif(!this.classifications[key]){\n\t\t\tthis.classifications[key] = {visible: value, name: \"no name\"};\n\t\t\tthis.dispatchEvent({\"type\": \"classification_visibility_changed\", \"viewer\": this});\n\t\t}else if(this.classifications[key].visible !== value){\n\t\t\tthis.classifications[key].visible = value;\n\t\t\tthis.dispatchEvent({\"type\": \"classification_visibility_changed\", \"viewer\": this});\n\t\t}\n\t};\n\n\tsetLengthUnit(value) {\n\t\tswitch(value) {\n\t\t\tcase \"m\":\n\t\t\t\tthis.lengthUnit = this.LENGTH_UNITS.METER;\n\t\t\t\tbreak;\n\t\t\tcase \"ft\":\t\t\t\t\n\t\t\t\tthis.lengthUnit = this.LENGTH_UNITS.FEET;\n\t\t\t\tbreak;\n\t\t\tcase \"in\":\t\t\t\t\n\t\t\t\tthis.lengthUnit = this.LENGTH_UNITS.INCH;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tthis.dispatchEvent({\"type\": \"length_unit_changed\", \"viewer\": this, value: value});\n\t}\n\t\n\ttoMaterialID(materialName){\n\n\t\tif(materialName === \"RGB\"){\n\t\t\treturn Potree.PointColorType.RGB;\n\t\t}else if(materialName === \"Color\"){\n\t\t\treturn Potree.PointColorType.COLOR;\n\t\t}else if(materialName === \"Elevation\"){\n\t\t\treturn Potree.PointColorType.HEIGHT;\n\t\t}else if(materialName === \"Intensity\"){\n\t\t\treturn Potree.PointColorType.INTENSITY;\n\t\t}else if(materialName === \"Intensity Gradient\"){\n\t\t\treturn Potree.PointColorType.INTENSITY_GRADIENT;\n\t\t}else if(materialName === \"Classification\"){\n\t\t\treturn Potree.PointColorType.CLASSIFICATION;\n\t\t}else if(materialName === \"Return Number\"){\n\t\t\treturn Potree.PointColorType.RETURN_NUMBER;\n\t\t}else if(materialName === \"Source\"){\n\t\t\treturn Potree.PointColorType.SOURCE;\n\t\t}else if(materialName === \"Level of Detail\"){\n\t\t\treturn Potree.PointColorType.LOD;\n\t\t}else if(materialName === \"Point Index\"){\n\t\t\treturn Potree.PointColorType.POINT_INDEX;\n\t\t}else if(materialName === \"Normal\"){\n\t\t\treturn Potree.PointColorType.NORMAL;\n\t\t}else if(materialName === \"Phong\"){\n\t\t\treturn Potree.PointColorType.PHONG;\n\t\t}else if(materialName === \"RGB and Elevation\"){\n\t\t\treturn Potree.PointColorType.RGB_HEIGHT;\n\t\t}else if(materialName === \"Composite\"){\n\t\t\treturn Potree.PointColorType.COMPOSITE;\n\t\t}\n\t};\n\t\n\ttoMaterialName(materialID){\n\n\t\tif(materialID === Potree.PointColorType.RGB){\n\t\t\treturn \"RGB\";\n\t\t}else if(materialID === Potree.PointColorType.COLOR){\n\t\t\treturn \"Color\";\n\t\t}else if(materialID === Potree.PointColorType.HEIGHT){\n\t\t\treturn \"Elevation\";\n\t\t}else if(materialID === Potree.PointColorType.INTENSITY){\n\t\t\treturn \"Intensity\";\n\t\t}else if(materialID === Potree.PointColorType.INTENSITY_GRADIENT){\n\t\t\treturn \"Intensity Gradient\";\n\t\t}else if(materialID === Potree.PointColorType.CLASSIFICATION){\n\t\t\treturn \"Classification\";\n\t\t}else if(materialID === Potree.PointColorType.RETURN_NUMBER){\n\t\t\treturn \"Return Number\";\n\t\t}else if(materialID === Potree.PointColorType.SOURCE){\n\t\t\treturn \"Source\";\n\t\t}else if(materialID === Potree.PointColorType.LOD){\n\t\t\treturn \"Level of Detail\";\n\t\t}else if(materialID === Potree.PointColorType.POINT_INDEX){\n\t\t\treturn \"Point Index\";\n\t\t}else if(materialID === Potree.PointColorType.NORMAL){\n\t\t\treturn \"Normal\";\n\t\t}else if(materialID === Potree.PointColorType.PHONG){\n\t\t\treturn \"Phong\";\n\t\t}else if(materialID === Potree.PointColorType.RGB_HEIGHT){\n\t\t\treturn \"RGB and Elevation\";\n\t\t}else if(materialID === Potree.PointColorType.COMPOSITE){\n\t\t\treturn \"Composite\";\n\t\t}\n\t};\n\t\n\tzoomTo(node, factor){\n\t\tlet view = this.scene.view;\n\t\t\n\t\tlet camera = this.scene.camera.clone();\n\t\tcamera.position.copy(view.position);\n\t\tcamera.rotation.order = \"ZXY\";\n\t\tcamera.rotation.x = Math.PI / 2 + view.pitch;\n\t\tcamera.rotation.z = view.yaw;\n\t\tcamera.updateMatrix();\n\t\tcamera.updateMatrixWorld();\n\t\t\n\t\tlet bs;\n\t\tif(node.boundingSphere){\n\t\t\tbs = node.boundingSphere;\n\t\t}else if(node.geometry && node.geometry.boundingSphere){\n\t\t\tbs = node.geometry.boundingSphere;\n\t\t}else{\n\t\t\tbs = node.boundingBox.getBoundingSphere();\n\t\t}\n\t\t\n\t\tbs = bs.clone().applyMatrix4(node.matrixWorld);\n\t\t\n\t\tlet fov = Math.PI * this.scene.camera.fov / 180;\n\t\tlet target = bs.center;\n\t\tlet dir = view.direction;\n\t\tlet radius = bs.radius;\n\t\tlet distance = radius / (Math.tan(fov / 2));\n\t\tlet position = target.clone().sub(dir.clone().multiplyScalar(distance));\n\t\t\n\t\tview.position.copy(position);\n\t\tview.radius = distance;\n\t\t\n\t\tthis.dispatchEvent({\"type\": \"zoom_to\", \"viewer\": this});\n\t};\n\t\n\tshowAbout(){\n\t\t$(function() {\n\t\t\t$( \"#about-panel\" ).dialog();\n\t\t});\n\t};\n\t\n\tgetBoundingBox(pointclouds){\n\t\tpointclouds = pointclouds || this.scene.pointclouds;\n\t\t\n\t\tlet box = new THREE.Box3();\n\t\t\n\t\tthis.scene.scenePointCloud.updateMatrixWorld(true);\n\t\tthis.scene.referenceFrame.updateMatrixWorld(true);\n\t\t\n\t\tfor(let pointcloud of this.scene.pointclouds){\n\t\t\tpointcloud.updateMatrixWorld(true);\n\t\t\t\n\t\t\tlet pointcloudBox = pointcloud.pcoGeometry.tightBoundingBox ?  pointcloud.pcoGeometry.tightBoundingBox : pointcloud.boundingBox;\n\t\t\tlet boxWorld = Potree.utils.computeTransformedBoundingBox(pointcloudBox, pointcloud.matrixWorld)\n\t\t\tbox.union(boxWorld);\n\t\t}\n\n\t\treturn box;\n\t};\n\t\n\tfitToScreen(factor = 1){\n\t\tlet box = this.getBoundingBox(this.scene.pointclouds);\n\t\t\n\t\tlet node = new THREE.Object3D();\n\t\tnode.boundingBox = box;\n\t\t\n\t\tthis.zoomTo(node, factor);\n\t};\n\t\n\tsetTopView(){\n\t\tthis.scene.view.yaw = 0;\n\t\tthis.scene.view.pitch = -Math.PI / 2;\n\t\t\n\t\tthis.fitToScreen();\n\t};\n\t\n\tsetFrontView(){\n\t\tthis.scene.view.yaw = 0;\n\t\tthis.scene.view.pitch = 0;\n\t\t\n\t\tthis.fitToScreen();\n\t};\n\t\n\tsetLeftView(){\n\t\tthis.scene.view.yaw = -Math.PI / 2;\n\t\tthis.scene.view.pitch = 0;\n\t\t\n\t\tthis.fitToScreen();\n\t};\n\t\n\tsetRightView(){\n\t\tthis.scene.view.yaw = Math.PI / 2;\n\t\tthis.scene.view.pitch = 0;\n\t\t\n\t\tthis.fitToScreen();\n\t};\n\t\n\tflipYZ(){\n\t\tthis.isFlipYZ = !this.isFlipYZ\n\t\t\n\t\t// TODO flipyz \n\t\tconsole.log(\"TODO\");\n\t}\n\t\n\tloadSettingsFromURL(){\n\t\tif(Potree.utils.getParameterByName(\"pointSize\")){\n\t\t\tthis.setPointSize(parseFloat(Potree.utils.getParameterByName(\"pointSize\")));\n\t\t}\n\t\t\n\t\tif(Potree.utils.getParameterByName(\"FOV\")){\n\t\t\tthis.setFOV(parseFloat(Potree.utils.getParameterByName(\"FOV\")));\n\t\t}\n\t\t\n\t\tif(Potree.utils.getParameterByName(\"opacity\")){\n\t\t\tthis.setOpacity(parseFloat(Potree.utils.getParameterByName(\"opacity\")));\n\t\t}\n\t\t\n\t\tif(Potree.utils.getParameterByName(\"edlEnabled\")){\n\t\t\tlet enabled = Potree.utils.getParameterByName(\"edlEnabled\") === \"true\";\n\t\t\tthis.setEDLEnabled(enabled);\n\t\t}\n\t\t\n\t\tif(Potree.utils.getParameterByName(\"edlRadius\")){\n\t\t\tthis.setEDLRadius(parseFloat(Potree.utils.getParameterByName(\"edlRadius\")));\n\t\t}\n\t\t\n\t\tif(Potree.utils.getParameterByName(\"edlStrength\")){\n\t\t\tthis.setEDLStrength(parseFloat(Potree.utils.getParameterByName(\"edlStrength\")));\n\t\t}\n\t\t\n\t\tif(Potree.utils.getParameterByName(\"clipMode\")){\n\t\t\tlet clipMode = Potree.utils.getParameterByName(\"clipMode\");\n\t\t\tif(clipMode === \"HIGHLIGHT_INSIDE\"){\n\t\t\t\tthis.setClipMode(Potree.ClipMode.HIGHLIGHT_INSIDE);\n\t\t\t}else if(clipMode === \"CLIP_OUTSIDE\"){\n\t\t\t\tthis.setClipMode(Potree.ClipMode.CLIP_OUTSIDE);\n\t\t\t}else if(clipMode === \"DISABLED\"){\n\t\t\t\tthis.setClipMode(Potree.ClipMode.DISABLED);\n\t\t\t}\n\t\t}\n\n\t\tif(Potree.utils.getParameterByName(\"pointBudget\")){\n\t\t\tthis.setPointBudget(parseFloat(Potree.utils.getParameterByName(\"pointBudget\")));\n\t\t}\n\n\t\tif(Potree.utils.getParameterByName(\"showBoundingBox\")){\n\t\t\tlet enabled = Potree.utils.getParameterByName(\"showBoundingBox\") === \"true\";\n\t\t\tif(enabled){\n\t\t\t\tthis.setShowBoundingBox(true);\n\t\t\t}else{\n\t\t\t\tthis.setShowBoundingBox(false);\n\t\t\t}\n\t\t}\n\n\t\tif(Potree.utils.getParameterByName(\"material\")){\n\t\t\tlet material = Potree.utils.getParameterByName(\"material\");\n\t\t\tthis.setMaterial(material);\n\t\t}\n\n\t\tif(Potree.utils.getParameterByName(\"pointSizing\")){\n\t\t\tlet sizing = Potree.utils.getParameterByName(\"pointSizing\");\n\t\t\tthis.setPointSizing(sizing);\n\t\t}\n\n\t\tif(Potree.utils.getParameterByName(\"quality\")){\n\t\t\tlet quality = Potree.utils.getParameterByName(\"quality\");\n\t\t\tthis.setQuality(quality);\n\t\t}\n\t\t\n\t\tif(Potree.utils.getParameterByName(\"position\")){\n\t\t\tlet value = Potree.utils.getParameterByName(\"position\");\n\t\t\tvalue = value.replace(\"[\", \"\").replace(\"]\", \"\");\n\t\t\tlet tokens = value.split(\";\");\n\t\t\tlet x = parseFloat(tokens[0]);\n\t\t\tlet y = parseFloat(tokens[1]);\n\t\t\tlet z = parseFloat(tokens[2]);\n\t\t\t\n\t\t\tthis.scene.view.position.set(x, y, z);\n\t\t}\n\t\t\n\t\tif(Potree.utils.getParameterByName(\"target\")){\n\t\t\tlet value = Potree.utils.getParameterByName(\"target\");\n\t\t\tvalue = value.replace(\"[\", \"\").replace(\"]\", \"\");\n\t\t\tlet tokens = value.split(\";\");\n\t\t\tlet x = parseFloat(tokens[0]);\n\t\t\tlet y = parseFloat(tokens[1]);\n\t\t\tlet z = parseFloat(tokens[2]);\n\t\t\t\n\t\t\tthis.scene.view.lookAt(new THREE.Vector3(x, y, z));\n\t\t}\n\t\t\n\t\tif(Potree.utils.getParameterByName(\"background\")){\n\t\t\tlet value = Potree.utils.getParameterByName(\"background\");\n\t\t\tthis.setBackground(value);\n\t\t}\n\t\t\n\t\t//if(Potree.utils.getParameterByName(\"elevationRange\")){\n\t\t//\tlet value = Potree.utils.getParameterByName(\"elevationRange\");\n\t\t//\tvalue = value.replace(\"[\", \"\").replace(\"]\", \"\");\n\t\t//\tlet tokens = value.split(\";\");\n\t\t//\tlet x = parseFloat(tokens[0]);\n\t\t//\tlet y = parseFloat(tokens[1]);\n\t\t//\t\n\t\t//\tthis.setElevationRange(x, y);\n\t\t//\t//this.scene.view.target.set(x, y, z);\n\t\t//}\n\t\t\n\t};\n\t\n\t\n\t\n\t\n\n\t\n\t\n\t\n//------------------------------------------------------------------------------------\n// Viewer Internals\n//------------------------------------------------------------------------------------\n\n\tcreateControls(){\n\t\t{ // create FIRST PERSON CONTROLS\n\t\t\tthis.fpControls = new Potree.FirstPersonControls(this);\n\t\t\tthis.fpControls.enabled = false;\n\t\t\tthis.fpControls.addEventListener(\"start\", this.disableAnnotations.bind(this));\n\t\t\tthis.fpControls.addEventListener(\"end\", this.enableAnnotations.bind(this));\n\t\t\t//this.fpControls.addEventListener(\"double_click_move\", (event) => {\n\t\t\t//\tlet distance = event.targetLocation.distanceTo(event.position);\n\t\t\t//\tthis.setMoveSpeed(Math.pow(distance, 0.4));\n\t\t\t//});\n\t\t\t//this.fpControls.addEventListener(\"move_speed_changed\", (event) => {\n\t\t\t//\tthis.setMoveSpeed(this.fpControls.moveSpeed);\n\t\t\t//});\n\t\t}\n\t\t\n\t\t//{ // create GEO CONTROLS\n\t\t//\tthis.geoControls = new Potree.GeoControls(this.scene.camera, this.renderer.domElement);\n\t\t//\tthis.geoControls.enabled = false;\n\t\t//\tthis.geoControls.addEventListener(\"start\", this.disableAnnotations.bind(this));\n\t\t//\tthis.geoControls.addEventListener(\"end\", this.enableAnnotations.bind(this));\n\t\t//\tthis.geoControls.addEventListener(\"move_speed_changed\", (event) => {\n\t\t//\t\tthis.setMoveSpeed(this.geoControls.moveSpeed);\n\t\t//\t});\n\t\t//}\n\t\n\t\t{ // create ORBIT CONTROLS\n\t\t\tthis.orbitControls = new Potree.OrbitControls(this);\n\t\t\tthis.orbitControls.enabled = false;\n\t\t\tthis.orbitControls.addEventListener(\"start\", this.disableAnnotations.bind(this));\n\t\t\tthis.orbitControls.addEventListener(\"end\", this.enableAnnotations.bind(this));\n\t\t}\n\t\t\n\t\t{ // create EARTH CONTROLS\n\t\t\tthis.earthControls = new Potree.EarthControls(this);\n\t\t\tthis.earthControls.enabled = false;\n\t\t\tthis.earthControls.addEventListener(\"start\", this.disableAnnotations.bind(this));\n\t\t\tthis.earthControls.addEventListener(\"end\", this.enableAnnotations.bind(this));\n\t\t}\n\t};\n\n\ttoggleSidebar(){\n\t\t\n\t\tlet renderArea = $('#potree_render_area');\n\t\tlet sidebar = $('#potree_sidebar_container');\n\t\tlet isVisible = renderArea.css(\"left\") !== \"0px\";\n\n\t\tif(isVisible){\n\t\t\trenderArea.css(\"left\", \"0px\");\n\t\t}else{\n\t\t\trenderArea.css(\"left\", \"300px\");\n\t\t}\n\t};\n\t\n\ttoggleMap(){\n\t\t//let map = $('#potree_map');\n\t\t//map.toggle(100);\n\t\t\n\t\tif(this.mapView){\n\t\t\tthis.mapView.toggle();\n\t\t}\n\n\t};\n\n\tloadGUI(callback){\n\t\tlet sidebarContainer = $('#potree_sidebar_container');\n\t\tsidebarContainer.load(new URL(Potree.scriptPath + \"/sidebar.html\").href, () => {\n\t\t\t\n\t\t\tsidebarContainer.css(\"width\", \"300px\");\n\t\t\tsidebarContainer.css(\"height\", \"100%\");\n\t\t\t\n\t\t\tlet imgMenuToggle = document.createElement(\"img\");\n\t\t\timgMenuToggle.src = new URL(Potree.resourcePath + \"/icons/menu_button.svg\").href;\n\t\t\timgMenuToggle.onclick = this.toggleSidebar;\n\t\t\timgMenuToggle.classList.add(\"potree_menu_toggle\");\n\n\t\t\tlet imgMapToggle = document.createElement(\"img\");\n\t\t\timgMapToggle.src = new URL(Potree.resourcePath + \"/icons/map_icon.png\").href;\n\t\t\timgMapToggle.style.display = \"none\";\n\t\t\timgMapToggle.onclick = e => {this.toggleMap()};\n\t\t\timgMapToggle.id = \"potree_map_toggle\";\n\t\t\t\n\t\t\tviewer.renderArea.insertBefore(imgMapToggle, viewer.renderArea.children[0]);\n\t\t\tviewer.renderArea.insertBefore(imgMenuToggle, viewer.renderArea.children[0]);\n\t\t\t\n\t\t\tthis.mapView = new Potree.MapView(this);\n\t\t\tthis.mapView.init();\n\t\t\t\n\t\t\ti18n.init({ \n\t\t\t\tlng: 'en',\n\t\t\t\tresGetPath: Potree.resourcePath + '/lang/__lng__/__ns__.json',\n\t\t\t\tpreload: ['en', 'fr', 'de', 'jp'],\n\t\t\t\tgetAsync: true,\n\t\t\t\tdebug: false\n\t\t\t\t}, function(t) { \n\t\t\t\t// Start translation once everything is loaded\n\t\t\t\t$(\"body\").i18n();\n\t\t\t});\n\t\t\t\n\t\t\t$(function() {\n\t\t\t\tinitSidebar();\n\t\t\t});\n\t\t\t\n\t\t\tlet elProfile = $('<div>').load(new URL(Potree.scriptPath + \"/profile.html\").href, () => {\n\t\t\t\t$(document.body).append(elProfile.children());\n\t\t\t\tthis.profileWindow = new Potree.ProfileWindow(this);\n\t\t\t\tthis.profileWindowController = new Potree.ProfileWindowController(this);\n\t\t\t\t\n\t\t\t\t$(\"#profile_window\").draggable({\n\t\t\t\t\thandle: $(\"#profile_titlebar\"),\n\t\t\t\t\tcontainment: $(document.body)\n\t\t\t\t});\n\t\t\t\t$(\"#profile_window\").resizable({\n\t\t\t\t\tcontainment: $(document.body),\n\t\t\t\t\thandles: \"n, e, s, w\"\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tif(callback){\n\t\t\t\t\t$(callback);\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t});\n\t\t\n\t\t\n\t\t\n\t}\n    \n    setLanguage(lang){\n        i18n.setLng(lang);\n        $(\"body\").i18n();\n    }\n\t\n\tsetServer(server){\n\t\tthis.server = server;\n\t}\n\t\n\tinitThree(){\n\t\tlet width = this.renderArea.clientWidth;\n\t\tlet height = this.renderArea.clientHeight;\n\n\t\tthis.renderer = new THREE.WebGLRenderer({premultipliedAlpha: false});\n\t\tthis.renderer.sortObjects = false;\n\t\tthis.renderer.setSize(width, height);\n\t\tthis.renderer.autoClear = false;\n\t\tthis.renderArea.appendChild(this.renderer.domElement);\n\t\tthis.renderer.domElement.tabIndex = \"2222\";\n\t\tthis.renderer.domElement.addEventListener(\"mousedown\", function(){\n\t\t\tthis.renderer.domElement.focus();\n\t\t}.bind(this));\n\t\t\n\t\tthis.skybox = Potree.utils.loadSkybox(new URL(Potree.resourcePath + \"/textures/skybox2/\").href);\n\n\t\t// enable frag_depth extension for the interpolation shader, if available\n\t\tthis.renderer.context.getExtension(\"EXT_frag_depth\");\n\t}\n\t\n\tupdateAnnotations(){\n\t\t\n\t\tif(!this.getShowAnnotations()){\n\t\t\tthis.scene.annotations.traverseDescendants(descendant => {\n\t\t\t\tdescendant.display = false;\n\t\t\t\t\n\t\t\t\treturn;\n\t\t\t});\n\t\t\t\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tthis.scene.annotations.updateBounds();\n\t\tthis.scene.camera.updateMatrixWorld();\n\t\t\n\t\tlet distances = [];\n\n\t\tlet renderAreaWidth = this.renderArea.clientWidth;\n\t\tlet renderAreaHeight = this.renderArea.clientHeight;\n\t\tthis.scene.annotations.traverse(annotation => {\n\t\t\t\n\t\t\tif(annotation === this.scene.annotations){\n\t\t\t\tannotation.display = false;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\t\n\t\t\tif(!annotation.visible){\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t\n\t\t\tannotation.scene = this.scene;\n\t\t\t\n\t\t\tlet element = annotation.domElement;\n\t\t\t\n\t\t\tlet position = annotation.position;\n\t\t\tif(!position){\n\t\t\t\tposition = annotation.boundingBox.getCenter();\n\t\t\t}\n\t\t\t\n\t\t\tlet distance = viewer.scene.camera.position.distanceTo(position);\n\t\t\tlet radius = annotation.boundingBox.getBoundingSphere().radius;\n\t\t\t\n\t\t\tlet screenPos = new THREE.Vector3();\n\t\t\tlet screenSize = 0;\n\t\t\t{\n\t\t\t\t// SCREEN POS\n\t\t\t\tscreenPos.copy(position).project(this.scene.camera);\n\t\t\t\tscreenPos.x = renderAreaWidth * (screenPos.x + 1) / 2;\n\t\t\t\tscreenPos.y = renderAreaHeight * (1 - (screenPos.y + 1) / 2);\n\t\t\t\t\n\t\t\t\t//screenPos.x = Math.floor(screenPos.x - element[0].clientWidth / 2);\n\t\t\t\t//screenPos.y = Math.floor(screenPos.y - annotation.elTitlebar[0].clientHeight / 2);\n\t\t\t\tscreenPos.x = Math.floor(screenPos.x);\n\t\t\t\tscreenPos.y = Math.floor(screenPos.y);\n\t\t\t\t\n\t\t\t\t// SCREEN SIZE\n\t\t\t\tlet fov = Math.PI * viewer.scene.camera.fov / 180;\n\t\t\t\tlet slope = Math.tan(fov / 2.0);\n\t\t\t\tlet projFactor =  0.5 * renderAreaHeight / (slope * distance);\n\t\t\t\t\n\t\t\t\tscreenSize = radius * projFactor;\n\t\t\t}\n\t\t\t\n\t\t\telement[0].style.left = screenPos.x + \"px\";\n\t\t\telement[0].style.top = screenPos.y + \"px\";\n\t\t\t\n\t\t\tlet zIndex = 10000000 - distance * (10000000 / this.scene.camera.far);\n\t\t\tif(annotation.descriptionVisible){\n\t\t\t\tzIndex += 10000000;\n\t\t\t}\n\n\t\t\tif(annotation.children.length > 0){\n\t\t\t\tlet expand = screenSize > annotation.collapseThreshold || annotation.boundingBox.containsPoint(this.scene.camera.position);\n\t\t\t\tannotation.expand = expand;\n\t\t\t\t\n\t\t\t\tif(!expand){\n\t\t\t\t\tannotation.display = (-1 <= screenPos.z && screenPos.z <= 1);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn expand;\n\t\t\t}else{\n\t\t\t\tannotation.display = (-1 <= screenPos.z && screenPos.z <= 1);\n\t\t\t}\n\t\t});\n\t}\n\n\tupdate(delta, timestamp){\n\t\t\n\t\t//if(window.urlToggle === undefined){\n\t\t//\twindow.urlToggle = 0;\n\t\t//}else{\n\t\t//\t\n\t\t//\tif(window.urlToggle > 1){\n\t\t//\t\t{\n\t\t//\t\t\t\n\t\t//\t\t\tlet currentValue = Potree.utils.getParameterByName(\"position\");\n\t\t//\t\t\tlet strPosition = \"[\"  \n\t\t//\t\t\t\t+ this.scene.view.position.x.toFixed(3) + \";\"\n\t\t//\t\t\t\t+ this.scene.view.position.y.toFixed(3) + \";\"\n\t\t//\t\t\t\t+ this.scene.view.position.z.toFixed(3) + \"]\";\n\t\t//\t\t\tif(currentValue !== strPosition){\n\t\t//\t\t\t\tPotree.utils.setParameter(\"position\", strPosition);\n\t\t//\t\t\t}\n\t\t//\t\t\t\n\t\t//\t\t}\n\t\t//\t\t\n\t\t//\t\t{\n\t\t//\t\t\tlet currentValue = Potree.utils.getParameterByName(\"target\");\n\t\t//\t\t\tlet pivot = this.scene.view.getPivot();\n\t\t//\t\t\tlet strTarget = \"[\"  \n\t\t//\t\t\t\t+ pivot.x.toFixed(3) + \";\"\n\t\t//\t\t\t\t+ pivot.y.toFixed(3) + \";\"\n\t\t//\t\t\t\t+ pivot.z.toFixed(3) + \"]\";\n\t\t//\t\t\tif(currentValue !== strTarget){\n\t\t//\t\t\t\tPotree.utils.setParameter(\"target\", strTarget);\n\t\t//\t\t\t}\n\t\t//\t\t}\n\t\t//\t\t\n\t\t//\t\twindow.urlToggle = 0;\n\t\t//\t}\n\t\t//\t\n\t\t//\twindow.urlToggle += delta;\n\t\t//}\n\t\t\n\t\t\n\t\t\n\t\t\n\t\tlet scene = this.scene;\n\t\tlet camera = this.scene.camera;\n\t\t\n\t\tPotree.pointLoadLimit = Potree.pointBudget * 2;\n\t\t\n\t\tthis.scene.directionalLight.position.copy(camera.position);\n\t\tthis.scene.directionalLight.lookAt(new THREE.Vector3().addVectors(camera.position, camera.getWorldDirection()));\n\t\t\n\t\tlet visibleNodes = 0;\n\t\tlet visiblePoints = 0;\n\t\tlet progress = 0;\n\t\t\n\t\tfor(let pointcloud of this.scene.pointclouds){\n\t\t\tlet bbWorld = Potree.utils.computeTransformedBoundingBox(pointcloud.boundingBox, pointcloud.matrixWorld);\n\t\t\t\t\n\t\t\tif(!pointcloud.material._defaultIntensityRangeChanged){\n\t\t\t\tlet root = pointcloud.pcoGeometry.root;\n\t\t\t\tif(root != null && root.loaded){\n\t\t\t\t\tlet attributes = pointcloud.pcoGeometry.root.geometry.attributes;\n\t\t\t\t\tif(attributes.intensity){\n\t\t\t\t\t\tlet array = attributes.intensity.array;\n            \n\t\t\t\t\t\t// chose max value from the 0.75 percentile\n\t\t\t\t\t\tlet ordered = [];\n\t\t\t\t\t\tfor(let j = 0; j < array.length; j++){\n\t\t\t\t\t\t\tordered.push(array[j]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tordered.sort();\n\t\t\t\t\t\tlet capIndex = parseInt((ordered.length - 1) * 0.75);\n\t\t\t\t\t\tlet cap = ordered[capIndex];\n            \n\t\t\t\t\t\tif(cap <= 1){\n\t\t\t\t\t\t\tpointcloud.material.intensityRange = [0, 1];\n\t\t\t\t\t\t}else if(cap <= 256){\n\t\t\t\t\t\t\tpointcloud.material.intensityRange = [0, 255];\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\tpointcloud.material.intensityRange = [0, cap];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t//pointcloud._intensityMaxEvaluated = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tpointcloud.material.clipMode = this.clipMode;\n\t\t\tpointcloud.showBoundingBox = this.showBoundingBox;\n\t\t\tpointcloud.generateDEM = this.generateDEM;\n\t\t\tpointcloud.minimumNodePixelSize = this.minNodeSize;\n\n\t\t\tvisibleNodes += pointcloud.numVisibleNodes;\n\t\t\tvisiblePoints += pointcloud.numVisiblePoints;\n\n\t\t\tprogress += pointcloud.progress;\n\t\t}\n\t\t\n\t\t// update classification visibility\n\t\tfor(let pointcloud of this.scene.pointclouds){\n\t\t\t\n\t\t\tlet classification = pointcloud.material.classification;\n\t\t\tlet somethingChanged = false;\n\t\t\tfor(let key of Object.keys(this.classifications)){\n\t\t\t\t\n\t\t\t\tlet w = this.classifications[key].visible ? 1 : 0;\n\t\t\t\t\n\t\t\t\tif(classification[key]){\n\t\t\t\t\tif(classification[key].w !== w){\n\t\t\t\t\t\tclassification[key].w = w;\n\t\t\t\t\t\tsomethingChanged = true;\n\t\t\t\t\t}\n\t\t\t\t}else if(classification.DEFAULT){\n\t\t\t\t\tclassification[key] = classification.DEFAULT;\n\t\t\t\t\tsomethingChanged = true;\n\t\t\t\t}else{\n\t\t\t\t\tclassification[key] = new THREE.Vector4(0.3, 0.6, 0.6, 0.5);\n\t\t\t\t\tsomethingChanged = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif(somethingChanged){\n\t\t\t\tpointcloud.material.recomputeClassification();\n\t\t\t}\n\t\t}\n\t\t\n\t\tif(!this.freeze){\n\t\t\tlet result = Potree.updatePointClouds(scene.pointclouds, camera, this.renderer);\n\t\t\tvisibleNodes = result.visibleNodes.length;\n\t\t\tvisiblePoints = result.numVisiblePoints;\n\t\t\tcamera.near = result.lowestSpacing * 10.0;\n\t\t\tcamera.far = -this.getBoundingBox().applyMatrix4(camera.matrixWorldInverse).min.z;\n\t\t\tcamera.far = Math.max(camera.far * 1.5, 1000);\n\t\t}\n\t\t\n\t\tcamera.fov = this.fov;\n\t\t\n\t\t// Navigation mode changed?\n\t\tif(this.getControls(scene.view.navigationMode) !== this.controls){\n\t\t\tif(this.controls){\n\t\t\t\tthis.controls.enabled = false;\n\t\t\t\tthis.inputHandler.removeInputListener(this.controls);\n\t\t\t}\n\t\t\t\n\t\t\tthis.controls = this.getControls(scene.view.navigationMode);\n\t\t\tthis.controls.enabled = true;\n\t\t\tthis.inputHandler.addInputListener(this.controls);\n\t\t}\n\t\t//\n\t\tif(this.controls !== null){\n\t\t\tthis.controls.setScene(scene);\n\t\t\tthis.controls.update(delta);\n\t\t\t\n\t\t\tcamera.position.copy(scene.view.position);\n\t\t\tcamera.rotation.order = \"ZXY\";\n\t\t\tcamera.rotation.x = Math.PI / 2 + this.scene.view.pitch;\n\t\t\tcamera.rotation.z = this.scene.view.yaw;\n\t\t}\n\n\t\t{ // update clip boxes\n\t\t\t//let boxes = this.scene.profiles.reduce( (a, b) => {return a.boxes.concat(b.boxes)}, []);\n\t\t\t//boxes = boxes.concat(this.scene.volumes.filter(v => v.clip));\n\t\t\t\n\t\t\tlet boxes = this.scene.volumes.filter(v => v.clip);\n\t\t\tfor(let profile of this.scene.profiles){\n\t\t\t\tboxes = boxes.concat(profile.boxes);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\tlet clipBoxes = boxes.map( box => {\n\t\t\t\tbox.updateMatrixWorld();\n\t\t\t\tlet boxInverse = new THREE.Matrix4().getInverse(box.matrixWorld);\n\t\t\t\tlet boxPosition = box.getWorldPosition();\n\t\t\t\treturn {matrix: box.matrixWorld, inverse: boxInverse, position: boxPosition};\n\t\t\t});\n\t\t\t\n\t\t\tfor(let pointcloud of this.scene.pointclouds){\n\t\t\t\tpointcloud.material.setClipBoxes(clipBoxes);\n\t\t\t}\n\t\t}\n\n\t\tthis.updateAnnotations();\n\t\t\n\t\tif(this.mapView){\n\t\t\tthis.mapView.update(delta, this.scene.camera);\n\t\t\tif(this.mapView.sceneProjection){\n\t\t\t\t$( \"#potree_map_toggle\" ).css(\"display\", \"block\");\n\t\t\t\t\n\t\t\t}\n\t\t}\n\n\t\tTWEEN.update(timestamp);\n\t\t\n\t\tthis.dispatchEvent({\n\t\t\t\"type\": \"update\", \n\t\t\t\"delta\": delta, \n\t\t\t\"timestamp\": timestamp});\n\t}\n\n\n\tloop(timestamp) {\n\t\t\n\t\trequestAnimationFrame(this.loop.bind(this));\n\t\t\n\t\tthis.stats.begin();\n\t\t\n\t\t//var start = new Date().getTime();\n\t\tthis.update(this.clock.getDelta(), timestamp);\n\t\t//var end = new Date().getTime();\n\t\t//var duration = end - start;\n\t\t//toggleMessage++;\n\t\t//if(toggleMessage > 30){\n\t\t//\tdocument.getElementById(\"lblMessage\").innerHTML = \"update: \" + duration + \"ms\";\n\t\t//\ttoggleMessage = 0;\n\t\t//}\n\t\t\n\t\t//let queryAll = Potree.startQuery(\"All\", viewer.renderer.getContext());\n\t\t\n\t\tif(this.useEDL && Potree.Features.SHADER_EDL.isSupported()){\n\t\t\tif(!this.edlRenderer){\n\t\t\t\tthis.edlRenderer = new EDLRenderer(this);\n\t\t\t}\n\t\t\tthis.edlRenderer.render(this.renderer);\n\t\t}else{\n\t\t\tif(!this.potreeRenderer){\n\t\t\t\tthis.potreeRenderer = new PotreeRenderer(this);\n\t\t\t}\n\t\t\t\n\t\t\tthis.potreeRenderer.render();\n\t\t}\n\t\t\n\t\t//Potree.endQuery(queryAll, viewer.renderer.getContext());\n\t\t//Potree.resolveQueries(viewer.renderer.getContext());\n\t\t\n\t\t//let pointsRendered = viewer.scene.pointclouds[0].visibleNodes.map(n => n.geometryNode.geometry.attributes.position.count).reduce( (a, v) => a + v, 0);\n\t\t//console.log(\"rendered: \", pointsRendered);\n\t\t\n\t\t//if(this.takeScreenshot == true){\n\t\t//\tthis.takeScreenshot = false;\n\t\t//\t\n\t\t//\tlet screenshot = this.renderer.domElement.toDataURL();\n\t\t//\t\n\t\t//\t//document.body.appendChild(screenshot); \n\t\t//\tlet w = this.open();\n\t\t//\tw.document.write('<img src=\"'+screenshot+'\"/>');\n\t\t//}\t\n\t\t\n\t\tthis.stats.end();\n\n\t\t\n\t\tPotree.framenumber++;\n\t};\n\n\t\n};\n\n\n\n\n\n\n\n//------------------------------------------------------------------------------------\n// Renderers\n//------------------------------------------------------------------------------------\n\nclass PotreeRenderer{\n\t\n\tconstructor(viewer){\n\t\tthis.viewer = viewer;\n\t};\n\n\trender(){\n\t\t{// resize\n\t\t\tlet width = viewer.scaleFactor * viewer.renderArea.clientWidth;\n\t\t\tlet height = viewer.scaleFactor * viewer.renderArea.clientHeight;\n\t\t\tlet aspect = width / height;\n\t\t\t\n\t\t\tviewer.scene.camera.aspect = aspect;\n\t\t\tviewer.scene.camera.updateProjectionMatrix();\n\t\t\t\n\t\t\tviewer.renderer.setSize(width, height);\n\t\t}\n\t\t\n\t\t// render skybox\n\t\tif(viewer.background === \"skybox\"){\n\t\t\tviewer.renderer.clear(true, true, false);\n\t\t\tviewer.skybox.camera.rotation.copy(viewer.scene.camera.rotation);\n\t\t\tviewer.skybox.camera.fov = viewer.scene.camera.fov;\n\t\t\tviewer.skybox.camera.aspect = viewer.scene.camera.aspect;\n\t\t\tviewer.skybox.camera.updateProjectionMatrix();\n\t\t\tviewer.renderer.render(viewer.skybox.scene, viewer.skybox.camera);\n\t\t}else if(viewer.background === \"gradient\"){\n\t\t\t//viewer.renderer.clear(true, true, false);\n\t\t\tviewer.renderer.render(viewer.scene.sceneBG, viewer.scene.cameraBG);\n\t\t}else if(viewer.background === \"black\"){\n\t\t\tviewer.renderer.setClearColor(0x000000, 1);\n\t\t\tviewer.renderer.clear(true, true, false);\n\t\t}else if(viewer.background === \"white\"){\n\t\t\tviewer.renderer.setClearColor(0xFFFFFF, 1);\n\t\t\tviewer.renderer.clear(true, true, false);\n\t\t}\n\t\t\n\t\tfor(let pointcloud of this.viewer.scene.pointclouds){\n\t\t\tpointcloud.material.useEDL = false;\n\t\t}\n\t\t\n\t\t//var queryPC = Potree.startQuery(\"PointCloud\", viewer.renderer.getContext());\n\t\tviewer.renderer.render(viewer.scene.scenePointCloud, viewer.scene.camera);\n\t\t//Potree.endQuery(queryPC, viewer.renderer.getContext());\n\t\t\n\t\t// render scene\n\t\tviewer.renderer.render(viewer.scene.scene, viewer.scene.camera);\n\t\t\n\t\tviewer.volumeTool.update();\n\t\tviewer.renderer.render(viewer.volumeTool.sceneVolume, viewer.scene.camera);\n\t\tviewer.renderer.render(viewer.controls.sceneControls, viewer.scene.camera);\n\t\t\n\t\tviewer.renderer.clearDepth();\n\t\t\n\t\tviewer.measuringTool.update();\n\t\tviewer.profileTool.update();\n\t\tviewer.transformationTool.update();\n\t\t\n\t\tviewer.renderer.render(viewer.measuringTool.sceneMeasurement, viewer.scene.camera);\n\t\tviewer.renderer.render(viewer.profileTool.sceneProfile, viewer.scene.camera);\n\t\tviewer.renderer.render(viewer.transformationTool.sceneTransform, viewer.scene.camera);\n\t\t\n\t\t\n\t\t//Potree.endQuery(queryAll, viewer.renderer.getContext());\n\t\t\n\t\t//Potree.resolveQueries(viewer.renderer.getContext());\n\t};\n};\n\n\nclass EDLRenderer{\n\t\n\tconstructor(viewer){\n\t\tthis.viewer = viewer;\n\t\t\n\t\tthis.edlMaterial = null;\n\t\tthis.attributeMaterials = [];\n\t\t\n\t\tthis.rtColor = null;\n\t\tthis.gl = viewer.renderer.context;\n\t}\n\t\n\tinitEDL(){\n\t\tif(this.edlMaterial != null){\n\t\t\treturn;\n\t\t}\n\t\t\n\t\t//var depthTextureExt = gl.getExtension(\"WEBGL_depth_texture\"); \n\t\t\n\t\tthis.edlMaterial = new Potree.EyeDomeLightingMaterial();\n\t\t\n\t\tthis.rtColor = new THREE.WebGLRenderTarget( 1024, 1024, { \n\t\t\tminFilter: THREE.NearestFilter, \n\t\t\tmagFilter: THREE.NearestFilter, \n\t\t\tformat: THREE.RGBAFormat, \n\t\t\ttype: THREE.FloatType\n\t\t} );\n\t\tthis.rtColor.depthTexture = new THREE.DepthTexture();\n        this.rtColor.depthTexture.type = THREE.UnsignedIntType;\n\t\t\n\t};\n\t\n\tresize(){\n\t\tlet width = viewer.scaleFactor * viewer.renderArea.clientWidth;\n\t\tlet height = viewer.scaleFactor * viewer.renderArea.clientHeight;\n\t\tlet aspect = width / height;\n\t\t\n\t\tlet needsResize = (this.rtColor.width != width || this.rtColor.height != height);\n\t\n\t\t// disposal will be unnecessary once this fix made it into three.js master: \n\t\t// https://github.com/mrdoob/three.js/pull/6355\n\t\tif(needsResize){\n\t\t\tthis.rtColor.dispose();\n\t\t}\n\t\t\n\t\tviewer.scene.camera.aspect = aspect;\n\t\tviewer.scene.camera.updateProjectionMatrix();\n\t\t\n\t\tviewer.renderer.setSize(width, height);\n\t\tthis.rtColor.setSize(width, height);\n\t}\n\n\trender(){\n\t\n\t\tthis.initEDL();\n\t\t\n\t\tthis.resize();\n\t\t\n\t\t\n\t\tif(viewer.background === \"skybox\"){\n\t\t\tviewer.renderer.setClearColor(0x000000, 0);\n\t\t\tviewer.renderer.clear();\n\t\t\tviewer.skybox.camera.rotation.copy(viewer.scene.camera.rotation);\n\t\t\tviewer.skybox.camera.fov = viewer.scene.camera.fov;\n\t\t\tviewer.skybox.camera.aspect = viewer.scene.camera.aspect;\n\t\t\tviewer.skybox.camera.updateProjectionMatrix();\n\t\t\tviewer.renderer.render(viewer.skybox.scene, viewer.skybox.camera);\n\t\t}else if(viewer.background === \"gradient\"){\n\t\t\tviewer.renderer.setClearColor(0x000000, 0);\n\t\t\tviewer.renderer.clear();\n\t\t\tviewer.renderer.render(viewer.scene.sceneBG, viewer.scene.cameraBG);\n\t\t}else if(viewer.background === \"black\"){\n\t\t\tviewer.renderer.setClearColor(0x000000, 0);\n\t\t\tviewer.renderer.clear();\n\t\t}else if(viewer.background === \"white\"){\n\t\t\tviewer.renderer.setClearColor(0xFFFFFF, 0);\n\t\t\tviewer.renderer.clear();\n\t\t}\n\t\t\n\t\tviewer.measuringTool.update();\n\t\tviewer.profileTool.update();\n\t\tviewer.transformationTool.update();\n\t\tviewer.volumeTool.update();\n\t\t\n\t\t\n\t\tviewer.renderer.render(viewer.scene.scene, viewer.scene.camera);\n\t\t\n\t\tviewer.renderer.clearTarget( this.rtColor, true, true, true );\n\t\t\n\t\tlet width = viewer.renderArea.clientWidth;\n\t\tlet height = viewer.renderArea.clientHeight;\n\t\t\n\t\t// COLOR & DEPTH PASS\n\t\tfor(let pointcloud of viewer.scene.pointclouds){\n\t\t\tlet octreeSize = pointcloud.pcoGeometry.boundingBox.getSize().x;\n\t\t\n\t\t\tlet material = pointcloud.material;\n\t\t\tmaterial.weighted = false;\n\t\t\tmaterial.useLogarithmicDepthBuffer = false;\n\t\t\tmaterial.useEDL = true;\n\t\t\t\n\t\t\tmaterial.screenWidth = width;\n\t\t\tmaterial.screenHeight = height;\n\t\t\tmaterial.uniforms.visibleNodes.value = pointcloud.material.visibleNodesTexture;\n\t\t\tmaterial.uniforms.octreeSize.value = octreeSize;\n\t\t\tmaterial.fov = viewer.scene.camera.fov * (Math.PI / 180);\n\t\t\tmaterial.spacing = pointcloud.pcoGeometry.spacing * Math.max(pointcloud.scale.x, pointcloud.scale.y, pointcloud.scale.z);\n\t\t\tmaterial.near = viewer.scene.camera.near;\n\t\t\tmaterial.far = viewer.scene.camera.far;\n\t\t}\n\t\t\n\t\tviewer.renderer.render(viewer.scene.scenePointCloud, viewer.scene.camera, this.rtColor);\n\t\tviewer.renderer.render(viewer.scene.scene, viewer.scene.camera, this.rtColor);\n\n\t\t// bit of a hack here. The EDL pass will mess up the text of the volume tool\n\t\t// so volume tool is rendered again afterwards\n\t\t//viewer.volumeTool.render(this.rtColor);\n\t\t\t\t\n\t\t\n\t\tviewer.renderer.render(viewer.volumeTool.sceneVolume, viewer.scene.camera, this.rtColor);\n\t\t\n\t\t{ // EDL OCCLUSION PASS\n\t\t\tthis.edlMaterial.uniforms.screenWidth.value = width;\n\t\t\tthis.edlMaterial.uniforms.screenHeight.value = height;\n\t\t\tthis.edlMaterial.uniforms.colorMap.value = this.rtColor.texture;\n\t\t\tthis.edlMaterial.uniforms.edlStrength.value = viewer.edlStrength;\n\t\t\tthis.edlMaterial.uniforms.radius.value = viewer.edlRadius;\n\t\t\tthis.edlMaterial.uniforms.opacity.value = 1;\n\t\t\tthis.edlMaterial.depthTest = true;\n\t\t\tthis.edlMaterial.depthWrite = true;\n\t\t\tthis.edlMaterial.transparent = true;\n\t\t\n\t\t\tPotree.utils.screenPass.render(viewer.renderer, this.edlMaterial);\n\t\t}\t\n\t\t\n\t\tviewer.renderer.clearDepth();\n\t\tviewer.renderer.render(viewer.controls.sceneControls, viewer.scene.camera);\n\t\t\n\t\tviewer.renderer.render(viewer.measuringTool.sceneMeasurement, viewer.scene.camera);\n\t\tviewer.renderer.render(viewer.profileTool.sceneProfile, viewer.scene.camera);\n\t\tviewer.renderer.render(viewer.transformationTool.sceneTransform, viewer.scene.camera);\n\n\t}\n};\n\n\nPotree.ProfileWindow = class ProfileWindow extends THREE.EventDispatcher{\n\t\n\tconstructor(){\n\t\tsuper();\n\t\t\n\t\tthis.elRoot = $(\"#profile_window\");\n\t\tthis.renderArea = this.elRoot.find(\"#profileCanvasContainer\");\n\t\tthis.svg = d3.select(\"svg#profileSVG\");\n\t\tthis.mouseIsDown = false;\n\t\t\n\t\tthis.projectedBox = new THREE.Box3();\n\t\tthis.pointclouds = new Map();\n\t\tthis.numPoints = 0\n\t\t\n\t\tthis.geometryPool = new class{\n\t\t\tconstructor(){\n\t\t\t\tthis.geometries = [];\n\t\t\t\tthis.maxPoints = 50000;\n\t\t\t}\n\t\t\t\n\t\t\tgetGeometry(){\n\t\t\t\tif(this.geometries.length === 0){\n\t\t\t\t\t\n\t\t\t\t\tlet geometry = new THREE.BufferGeometry();\n\t\t\t\t\tlet buffers = {\n\t\t\t\t\t\tposition: new Float32Array(3 * this.maxPoints),\n\t\t\t\t\t\tcolor: new Uint8Array(3 * this.maxPoints),\n\t\t\t\t\t\tintensity: new Uint16Array(this.maxPoints),\n\t\t\t\t\t\tclassification: new Uint8Array(this.maxPoints),\n\t\t\t\t\t\treturnNumber: new Uint8Array(this.maxPoints),\n\t\t\t\t\t\tnumberOfReturns: new Uint8Array(this.maxPoints),\n\t\t\t\t\t\tpointSourceID: new Uint16Array(this.maxPoints)\n\t\t\t\t\t};\n\t\t\t\t\t\n\t\t\t\t\tgeometry.addAttribute(\"position\", new THREE.BufferAttribute(buffers.position, 3));\n\t\t\t\t\tgeometry.addAttribute(\"color\", new THREE.BufferAttribute(buffers.color, 3, true));\n\t\t\t\t\tgeometry.addAttribute(\"intensity\", new THREE.BufferAttribute(buffers.intensity, 1, false));\n\t\t\t\t\tgeometry.addAttribute(\"classification\", new THREE.BufferAttribute(buffers.classification, 1, false));\n\t\t\t\t\tgeometry.addAttribute(\"returnNumber\", new THREE.BufferAttribute(buffers.returnNumber, 1, false));\n\t\t\t\t\tgeometry.addAttribute(\"numberOfReturns\", new THREE.BufferAttribute(buffers.numberOfReturns, 1, false));\n\t\t\t\t\tgeometry.addAttribute(\"pointSourceID\", new THREE.BufferAttribute(buffers.pointSourceID, 1, false));\n\t\t\t\t\t\n\t\t\t\t\tgeometry.setDrawRange(0, 0);\n\t\t\t\t\t\n\t\t\t\t\tthis.geometries.push(geometry);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn this.geometries.pop();\n\t\t\t}\n\t\t\t\n\t\t\treturnGeometry(geometry){\n\t\t\t\tthis.geometries.push(geometry);\n\t\t\t}\n\t\t};\n\t\t\n\t\tthis.materialPool = new class{\n\t\t\tconstructor(){\n\t\t\t\tthis.materials = [];\n\t\t\t}\n\t\t\t\n\t\t\tgetMaterial(){\n\t\t\t\tif(this.materials.length === 0){\n\t\t\t\t\tlet material = new Potree.PointCloudMaterial();\n\t\t\t\t\tthis.materials.push(material);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn this.materials.pop();\n\t\t\t}\n\t\t\t\n\t\t\treturnMaterial(material){\n\t\t\t\tthis.materials.push(material);\n\t\t\t}\n\t\t};\n\t\t\n\t\tthis.mouse = new THREE.Vector2(0, 0);\n\t\tthis.scale = new THREE.Vector3(1, 1, 1);\n\t\t\n\t\tlet csvIcon = `${Potree.resourcePath}/icons/file_csv_2d.svg`;\n\t\t$(\"#potree_download_csv_icon\").attr(\"src\", csvIcon);\n\t\t\n\t\tlet lasIcon = `${Potree.resourcePath}/icons/file_las_3d.svg`;\n\t\t$(\"#potree_download_las_icon\").attr(\"src\", lasIcon);\n\t\t\n\t\tthis.initTHREE();\n\t\tthis.initSVG();\n\t\tthis.initListeners();\n\t}\n\t\n\tinitListeners(){\n\t\t$(window).resize( () => {\n\t\t\tthis.render();\n\t\t});\n\t\t\n\t\tthis.renderArea.mousedown(e => {\n\t\t\tthis.mouseIsDown = true;\n\t\t});\n\t\t\n\t\tthis.renderArea.mouseup(e => {\n\t\t\tthis.mouseIsDown = false;\n\t\t});\n\t\t\n\t\tthis.renderArea.mousemove( e => {\n\t\t\tif(this.pointclouds.size === 0){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tlet rect = this.renderArea[0].getBoundingClientRect();\n\t\t\tlet x = e.clientX - rect.left;\n\t\t\tlet y = e.clientY - rect.top;\n\t\t\t\n\t\t\tlet newMouse = new THREE.Vector2(x, y);\n\t\t\t\n\t\t\tif(this.mouseIsDown){\n\t\t\t\t// DRAG\n\t\t\t\tthis.autoFit = false;\n\t\t\t\t\n\t\t\t\tlet cPos = [this.scaleX.invert(this.mouse.x), this.scaleY.invert(this.mouse.y)];\n\t\t\t\tlet ncPos = [this.scaleX.invert(newMouse.x), this.scaleY.invert(newMouse.y)];\n\t\t\t\t\n\t\t\t\tthis.camera.position.x -= ncPos[0] - cPos[0];\n\t\t\t\tthis.camera.position.y -= ncPos[1] - cPos[1];\n\t\t\t\t\n\t\t\t\tthis.render();\n\t\t\t}else if(this.pointclouds.size > 0){\n\t\t\t\t// FIND HOVERED POINT \n\t\t\t\tlet pixelRadius = 10;\n\t\t\t\tlet radius = Math.abs(this.scaleX.invert(0) - this.scaleX.invert(5));\n\t\t\t\tlet mileage = this.scaleX.invert(newMouse.x);\n\t\t\t\tlet elevation = this.scaleY.invert(newMouse.y);\n\t\t\t\tlet point = this.selectPoint(mileage, elevation, radius);\n\t\t\t\t\n\t\t\t\tif(point){\n\t\t\t\t\tthis.elRoot.find(\"#profileSelectionProperties\").fadeIn(200);\n\t\t\t\t\tthis.pickSphere.visible = true;\n\t\t\t\t\tthis.pickSphere.scale.set(0.5 * radius, 0.5 * radius, 0.5 * radius);\n\t\t\t\t\tthis.pickSphere.position.set(point.mileage, point.position[2], 0);\n\t\t\t\t\t\n\t\t\t\t\tlet info = this.elRoot.find(\"#profileSelectionProperties\");\n\t\t\t\t\tlet html = \"<table>\";\n\t\t\t\t\tfor(let attribute of Object.keys(point)){\n\t\t\t\t\t\tlet value = point[attribute];\n\t\t\t\t\t\tif(attribute === \"position\"){\n\t\t\t\t\t\t\tlet values = [...value].map(v => Potree.utils.addCommas(v.toFixed(3)));\n\t\t\t\t\t\t\thtml += `\n\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t<td>x</td>\n\t\t\t\t\t\t\t\t\t<td>${values[0]}</td>\n\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t<td>y</td>\n\t\t\t\t\t\t\t\t\t<td>${values[1]}</td>\n\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t<td>z</td>\n\t\t\t\t\t\t\t\t\t<td>${values[2]}</td>\n\t\t\t\t\t\t\t\t</tr>`;\n\t\t\t\t\t\t}else if(attribute === \"color\"){\n\t\t\t\t\t\t\thtml += `\n\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t<td>${attribute}</td>\n\t\t\t\t\t\t\t\t\t<td>${value.join(\", \")}</td>\n\t\t\t\t\t\t\t\t</tr>`;\n\t\t\t\t\t\t}else if(attribute === \"normal\"){\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}else if(attribute === \"mileage\"){\n\t\t\t\t\t\t\thtml += `\n\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t<td>${attribute}</td>\n\t\t\t\t\t\t\t\t\t<td>${value.toFixed(3)}</td>\n\t\t\t\t\t\t\t\t</tr>`;\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\thtml += `\n\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t<td>${attribute}</td>\n\t\t\t\t\t\t\t\t\t<td>${value}</td>\n\t\t\t\t\t\t\t\t</tr>`;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t}\n\t\t\t\t\thtml += \"</table>\"\n\t\t\t\t\tinfo.html(html);\n\t\t\t\t\t\n\t\t\t\t\tthis.selectedPoint = point;\n\t\t\t\t}else{\n\t\t\t\t\t//this.pickSphere.visible = false;\n\t\t\t\t\t//this.selectedPoint = null;\n\t\t\t\t}\n\t\t\t\tthis.render();\n\t\t\t\t\n\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\tthis.mouse.copy(newMouse);\n\t\t});\n\t\t\n\t\t\n\t\tlet onWheel = e => {\n\t\t\tthis.autoFit = false;\n\t\t\tlet delta = 0;\n\t\t\tif( e.wheelDelta !== undefined ) { // WebKit / Opera / Explorer 9\n\t\t\t\tdelta = e.wheelDelta;\n\t\t\t} else if ( e.detail !== undefined ) { // Firefox\n\t\t\t\tdelta = -e.detail;\n\t\t\t}\n\t\t\t\n\t\t\tlet ndelta = Math.sign(delta);\n\t\t\t\n\t\t\t//let sPos = new THREE.Vector3(this.mouse.x, this.mouse.y, 0);\n\t\t\t//let cPos = this.toCamSpace(sPos);\n\t\t\t\n\t\t\tlet cPos = [this.scaleX.invert(this.mouse.x), this.scaleY.invert(this.mouse.y)];\n\t\t\t\n\t\t\tif(ndelta > 0){\n\t\t\t\t// + 10%\n\t\t\t\tthis.scale.multiplyScalar(1.1);\n\t\t\t}else{\n\t\t\t\t// - 10%\n\t\t\t\tthis.scale.multiplyScalar(100/110);\n\t\t\t}\n\t\t\t\n\t\t\t//this.scale.max(new THREE.Vector3(0.5, 0.5, 0.5));\n\t\t\t//this.scale.min(new THREE.Vector3(100, 100, 100));\n\t\t\t\n\t\t\tthis.updateScales();\n\t\t\tlet ncPos = [this.scaleX.invert(this.mouse.x), this.scaleY.invert(this.mouse.y)];\n\t\t\t\n\t\t\tthis.camera.position.x -= ncPos[0] - cPos[0];\n\t\t\tthis.camera.position.y -= ncPos[1] - cPos[1];\n\t\t\t\n\t\t\tthis.render();\n\t\t};\n\t\t$(this.renderArea)[0].addEventListener(\"mousewheel\", onWheel, false );\n\t\t$(this.renderArea)[0].addEventListener(\"DOMMouseScroll\", onWheel, false ); // Firefox\n\t\t\n\t\t$('#closeProfileContainer').click(() => {\n\t\t\tthis.hide();\n\t\t});\n\t\t\n\t\t$('#potree_download_csv_icon').click(() => {\n\t\t\tlet points = new Potree.Points();\n\t\t\tthis.pointclouds.forEach((value, key) => {\n\t\t\t\tpoints.add(value.points);\n\t\t\t});\n\t\t\t\n\t\t\tlet string = Potree.CSVExporter.toString(points);\n\t\t\t\n\t\t\tlet uri = \"data:application/octet-stream;base64,\"+btoa(string);\n\t\t\t$('#potree_download_profile_ortho_link').attr(\"href\", uri);\n\t\t});\n\t\t\n\t\t$('#potree_download_las_icon').click(() => {\n\t\t\tlet points = new Potree.Points();\n\t\t\tthis.pointclouds.forEach((value, key) => {\n\t\t\t\tpoints.add(value.points);\n\t\t\t});\n\t\t\t\n\t\t\tlet buffer = Potree.LASExporter.toLAS(points);\n\t\t\tlet u8view = new Uint8Array(buffer);\n\n\t\t\tlet binString = \"\";\n\t\t\tfor(let i = 0; i < u8view.length; i++){\n\t\t\t\tbinString += String.fromCharCode(u8view[i]);\n\t\t\t}\n\t\t\t\n\t\t\tlet uri = \"data:application/octet-stream;base64,\"+btoa(binString);\n\t\t\t$('#potree_download_profile_link').attr(\"href\", uri);\n\t\t\t\n\t\t\t//let uri = \"data:application/octet-stream;base64,\"+btoa(string);\n\t\t\t//$('#potree_download_profile_ortho_link').attr(\"href\", uri);\n\t\t\t\n\t\t\t//let las = viewer.profileWindow.getPointsInProfileAsLas();\n\t\t\t//let u8view = new Uint8Array(las);\n\t\t\t//\n\t\t\t//let binString = \"\";\n\t\t\t//for(let i = 0; i < u8view.length; i++){\n\t\t\t//\tbinString += String.fromCharCode(u8view[i]);\n\t\t\t//}\n\t\t\t//\n\t\t\t//let uri = \"data:application/octet-stream;base64,\"+btoa(binString);\n\t\t\t//$('#potree_download_profile_link').attr(\"href\", uri);\n\t\t});\n\t}\n\t\n\tselectPoint(mileage, elevation, radius){\n\t\t\n\t\tlet closest = {\n\t\t\tdistance: Infinity,\n\t\t\tpointcloud: null,\n\t\t\tpoints: null,\n\t\t\tindex: null\n\t\t};\n\n\t\tfor(let [pointcloud, entry] of this.pointclouds){\n\t\t\tlet points = entry.points;\n\t\t\t\n\t\t\tfor(let i = 0; i < points.numPoints; i++){\n\t\t\t\t\n\t\t\t\t//let pos = new THREE.Vector3(...points.data.position.subarray(3*i, 3*i+3));\n\t\t\t\tlet m = points.data.mileage[i] - mileage;\n\t\t\t\tlet e = points.data.position[3*i+2] - elevation;\n\t\t\t\t\n\t\t\t\tlet r = Math.sqrt(m*m + e*e);\n\t\t\t\t\n\t\t\t\tif(r < radius && r < closest.distance){\n\t\t\t\t\tclosest = {\n\t\t\t\t\t\tdistance: r,\n\t\t\t\t\t\tpointcloud: pointcloud,\n\t\t\t\t\t\tpoints: points,\n\t\t\t\t\t\tindex: i\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tif(closest.distance < Infinity){\n\t\t\tlet points = closest.points;\n\t\t\t\n\t\t\tlet point = {};\n\t\t\t\n\t\t\tlet attributes = Object.keys(points.data);\n\t\t\tfor(let attribute of attributes){\n\t\t\t\tlet attributeData = points.data[attribute];\n\t\t\t\tlet itemSize = attributeData.length / points.numPoints;\n\t\t\t\tlet value = attributeData.subarray(itemSize * closest.index, itemSize * closest.index + itemSize);\n\t\t\t\t\n\t\t\t\tif(value.length === 1){\n\t\t\t\t\tpoint[attribute] = value[0];\n\t\t\t\t}else{\n\t\t\t\t\tpoint[attribute] = value;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\treturn point;\n\t\t}else{\n\t\t\treturn null;\n\t\t}\n\t}\n\t\n\tinitTHREE(){\n\t\tthis.renderer = new THREE.WebGLRenderer({alpha: true, premultipliedAlpha: false});\n\t\tthis.renderer.setClearColor( 0x000000, 0 );\n\t\tthis.renderer.setSize(10, 10);\n\t\tthis.renderer.autoClear = true;\n\t\tthis.renderArea.append($(this.renderer.domElement));\n\t\tthis.renderer.domElement.tabIndex = \"2222\";\n\t\tthis.renderer.context.getExtension(\"EXT_frag_depth\");\n\t\t$(this.renderer.domElement).css(\"width\", \"100%\");\n\t\t$(this.renderer.domElement).css(\"height\", \"100%\");\n\t\t\n\t\tthis.camera = new THREE.OrthographicCamera(-10, 10, 10, -10, -1000, 1000);\n\t\t\n\t\tthis.scene = new THREE.Scene();\n\t\t\n\t\tlet sg = new THREE.SphereGeometry(1, 16, 16);\n\t\tlet sm = new THREE.MeshNormalMaterial();\n\t\tthis.pickSphere = new THREE.Mesh(sg, sm);\n\t\tthis.pickSphere.visible = false;\n\t\tthis.scene.add(this.pickSphere);\n\t}\n\t\n\tinitSVG(){\n\t\tlet width = this.renderArea[0].clientWidth;\n\t\tlet height = this.renderArea[0].clientHeight;\n\t\tlet marginLeft = this.renderArea[0].offsetLeft;\n\t\t\n\t\tthis.svg.selectAll(\"*\").remove();\n\t\t\n\t\tthis.scaleX = d3.scale.linear()\n\t\t\t.domain([this.camera.left + this.camera.position.x, this.camera.right + this.camera.position.x])\n\t\t\t.range([0, width]);\n\t\tthis.scaleY = d3.scale.linear()\n\t\t\t.domain([this.camera.bottom + this.camera.position.y, this.camera.top + this.camera.position.y])\n\t\t\t.range([height, 0]);\n\t\t\n\t\tthis.xAxis = d3.svg.axis()\n\t\t\t.scale(this.scaleX)\n\t\t\t.orient(\"bottom\")\n\t\t\t.innerTickSize(-height)\n\t\t\t.outerTickSize(1)\n\t\t\t.tickPadding(10)\n\t\t\t.ticks(width / 50);\n\t\t\t\n\t\tthis.yAxis = d3.svg.axis()\n\t\t\t.scale(this.scaleY)\n\t\t\t.orient(\"left\")\n\t\t\t.innerTickSize(-width)\n\t\t\t.outerTickSize(1)\n\t\t\t.tickPadding(10)\n\t\t\t.ticks(height / 20);\n\t\t\n\t\tthis.svg.append(\"g\")\n\t\t\t.attr(\"class\", \"x axis\")\n\t\t\t.attr(\"transform\", `translate(${marginLeft}, ${height})`)\n\t\t\t.call(this.xAxis);\n\t\t\t\n\t\tthis.svg.append(\"g\")\n\t\t\t.attr(\"class\", \"y axis\")\n\t\t\t.attr(\"transform\", `translate(${marginLeft}, 0)`)\n\t\t\t.call(this.yAxis);\n\t}\n\t\n\tsetProfile(profile){\n\t\t\n\t\tthis.render();\n\t}\n\t\n\taddPoints(pointcloud, points){\n\t\t\n\t\tif(this.pointclouds.get(pointcloud) === undefined){\n\t\t\t\n\t\t\tlet material = this.materialPool.getMaterial();\n\t\t\tlet geometry = this.geometryPool.getGeometry();\n\t\t\tlet model = new THREE.Points(geometry, material);\n\t\t\tthis.scene.add(model);\n\t\t\t\n\t\t\tlet materialChanged = e => {\n\t\t\t\tthis.render();\n\t\t\t};\n\t\t\t\n\t\t\tpointcloud.material.addEventListener(\"material_property_changed\", materialChanged);\n\t\t\t\n\t\t\tthis.pointclouds.set(pointcloud, {\n\t\t\t\tpoints: new Potree.Points(),\n\t\t\t\tmaterial: material,\n\t\t\t\tgeometry: geometry,\n\t\t\t\tmodel: model,\n\t\t\t\tlisteners: [{\n\t\t\t\t\ttarget: pointcloud.material, \n\t\t\t\t\ttype: \"material_property_changed\", \n\t\t\t\t\tcallback: materialChanged}]\n\t\t\t});\n\t\t}\n\t\t\n\t\tlet pc = this.pointclouds.get(pointcloud);\n\t\tpc.points.add(points);\n\t\t\n\t\t// rebuild 3d model\n\t\tlet projectedBox = new THREE.Box3();\n\t\t{\n\t\t\tlet geometry = pc.geometry;\n\t\t\t\n\t\t\tfor(let attribute of Object.keys(pc.points.data)){\n\t\t\t\t\n\t\t\t\tlet buffer = pc.points.data[attribute];\n\t\t\t\tlet itemSize = buffer.length / pc.points.numPoints;\n\t\t\t\t\n\t\t\t\tif(attribute === \"position\"){\n\t\t\t\t\t\n\t\t\t\t\tlet posBuffer = new Float32Array(buffer.length);\n\t\t\t\t\t\n\t\t\t\t\tfor(let i = 0; i < pc.points.numPoints; i++){\n\t\t\t\t\t\tlet x = pc.points.data.mileage[i];\n\t\t\t\t\t\tlet y = buffer[3*i + 2];\n\t\t\t\t\t\t\n\t\t\t\t\t\tposBuffer[3*i + 0] = x;\n\t\t\t\t\t\tposBuffer[3*i + 1] = y;\n\t\t\t\t\t\tposBuffer[3*i + 2] = y;\n\t\t\t\t\t\tprojectedBox.expandByPoint(new THREE.Vector3(x, y, 0));\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif(!posBuffer){\n\t\t\t\t\t\tconsole.log(\"wtf\");\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tgeometry.attributes[attribute].array.set(posBuffer);\n\t\t\t\t}else if(attribute === \"color\"){\n\t\t\t\t\tgeometry.attributes[attribute].array.set(buffer);\n\t\t\t\t}else if(attribute === \"mileage\"){\n\t\t\t\t\tcontinue;\n\t\t\t\t}else if(geometry.attributes[attribute] === undefined){\n\t\t\t\t\tcontinue;\n\t\t\t\t}else{\n\t\t\t\t\tgeometry.attributes[attribute].array.set(buffer);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tgeometry.attributes[attribute].needsUpdate = true;\n\t\t\t\tgeometry.setDrawRange(0, pc.points.numPoints);\n\t\t\t}\n\t\t\t\n\t\t\tlet radius = pc.points.boundingBox.getSize().toArray().reduce((a, v) => Math.max(a, v))\n\t\t\tgeometry.boundingSphere = new THREE.Sphere(this.camera.position, radius)\n\t\t\tgeometry.boundingBox = geometry.boundingSphere.getBoundingBox();\n\t\t}\n\t\t\n\t\tthis.projectedBox.union(projectedBox);\n\t\t\n\t\tif(this.autoFit){ // SCALE\n\t\t\tlet width = this.renderArea[0].clientWidth;\n\t\t\tlet height = this.renderArea[0].clientHeight;\n\t\t\t\n\t\t\tlet size = this.projectedBox.getSize();\n\t\t\t\n\t\t\tlet sx = width / size.x;\n\t\t\tlet sy = height / size.y;\n\t\t\tlet scale = Math.min(sx, sy);\n\t\t\t\n\t\t\tlet center = this.projectedBox.getCenter();\n\t\t\tthis.scale.set(scale, scale, 1);\n\t\t\tthis.camera.position.copy(center);\n\t\t}\n\t\t\n\t\tlet numPoints = 0;\n\t\tfor(let entry of this.pointclouds.entries()){\n\t\t\tnumPoints += entry[1].points.numPoints;\n\t\t\t\n\t\t\t$(`#profile_num_points`).html(Potree.utils.addCommas(numPoints));\n\t\t}\n\t\t\n\t\tthis.render();\n\t}\n\t\n\treset(){\n\t\t\n\t\tthis.autoFit = true;\n\t\tthis.projectedBox = new THREE.Box3();\n\t\t\n\t\tfor(let entry of this.pointclouds){\n\t\t\t\n\t\t\tlet pointcloud = entry[0];\n\t\t\tlet material = entry[1].model.material;\n\t\t\tlet geometry = entry[1].model.geometry;\n\t\t\tthis.materialPool.returnMaterial(material);\n\t\t\tthis.geometryPool.returnGeometry(geometry);\n\t\t\tentry[1].model.material = null;\n\t\t\tentry[1].model.geometry = null;\n\t\t\t\n\t\t\tfor(let listener of entry[1].listeners){\n\t\t\t\tlistener.target.removeEventListener(listener.type, listener.callback);\n\t\t\t}\n\t\t\t\n\t\t}\n\t\t\n\t\tthis.pointclouds.clear();\n\t\tthis.mouseIsDown = false;\n\t\tthis.mouse.set(0, 0);\n\t\tthis.scale.set(1, 1, 1);\n\t\tthis.pickSphere.visible = false;\n\t\t\n\t\tthis.scene.children\n\t\t\t.filter(c => c instanceof THREE.Points)\n\t\t\t.forEach(c => this.scene.remove(c));\n\t\t\t\n\t\tthis.elRoot.find(\"#profileSelectionProperties\").hide();\n\t\t\t\n\t\t\n\t\tthis.render();\n\t}\n\t\n\tshow(){\n\t\tthis.elRoot.fadeIn();\n\t\tthis.enabled = true;\n\t}\n\t\n\thide(){\n\t\tthis.elRoot.fadeOut();\n\t\tthis.enabled = false;\n\t}\n\t\n\tupdateScales(){\n\t\tlet width = this.renderArea[0].clientWidth;\n\t\tlet height = this.renderArea[0].clientHeight;\n\t\t\n\t\tlet left   = (-width  / 2) / this.scale.x;\n\t\tlet right  = (+width  / 2) / this.scale.x;\n\t\tlet top    = (+height / 2) / this.scale.y;\n\t\tlet bottom = (-height / 2) / this.scale.y;\n\t\t\n\t\tthis.camera.left = left;\n\t\tthis.camera.right = right;\n\t\tthis.camera.top = top;\n\t\tthis.camera.bottom = bottom;\n\t\tthis.camera.updateProjectionMatrix();\n\t\t\n\t\tthis.scaleX.domain([this.camera.left + this.camera.position.x, this.camera.right + this.camera.position.x])\n\t\t\t.range([0, width]);\n\t\tthis.scaleY.domain([this.camera.bottom + this.camera.position.y, this.camera.top + this.camera.position.y])\n\t\t\t.range([height, 0]);\n\t}\n\t\n\trender(){\n\t\tlet width = this.renderArea[0].clientWidth;\n\t\tlet height = this.renderArea[0].clientHeight;\n\t\t\n\t\tthis.updateScales();\n\t\t\n\t\t{ // THREEJS\n\n\t\t\tlet radius = Math.abs(this.scaleX.invert(0) - this.scaleX.invert(5));\n\t\t\tthis.pickSphere.scale.set(radius, radius, radius);\n\t\t\tthis.pickSphere.position.z = this.camera.far - radius;\n\t\t\t\n\t\t\tfor(let entry of this.pointclouds){\n\t\t\t\tlet pointcloud = entry[0];\n\t\t\t\tlet material = entry[1].material;\n\t\t\t\t\n\t\t\t\tmaterial.pointColorType = pointcloud.material.pointColorType;\n\t\t\t\tmaterial.uniforms.intensityRange.value = pointcloud.material.uniforms.intensityRange.value;\n\t\t\t\tmaterial.heightMin = pointcloud.material.heightMin;\n\t\t\t\tmaterial.heightMax = pointcloud.material.heightMax;\n\t\t\t\tmaterial.rgbGamma = pointcloud.material.rgbGamma;\n\t\t\t\tmaterial.rgbContrast = pointcloud.material.rgbContrast;\n\t\t\t\tmaterial.rgbBrightness = pointcloud.material.rgbBrightness;\n\t\t\t\tmaterial.intensityRange = pointcloud.material.intensityRange;\n\t\t\t\tmaterial.intensityGamma = pointcloud.material.intensityGamma;\n\t\t\t\tmaterial.intensityContrast = pointcloud.material.intensityContrast;\n\t\t\t\tmaterial.intensityBrightness = pointcloud.material.intensityBrightness;\n\t\t\t}\n\t\t\t\n\t\t\tthis.renderer.setSize(width, height);\n\t\t\t\n\t\t\tthis.renderer.render(this.scene, this.camera);\n\t\t}\n\t\t\n\t\t{ // SVG SCALES\n\t\t\tlet marginLeft = this.renderArea[0].offsetLeft;\n\t\t\t\t\n\t\t\tthis.xAxis.scale(this.scaleX)\n\t\t\t\t.orient(\"bottom\")\n\t\t\t\t.innerTickSize(-height)\n\t\t\t\t.outerTickSize(1)\n\t\t\t\t.tickPadding(10)\n\t\t\t\t.ticks(width / 50);\n\t\t\tthis.yAxis.scale(this.scaleY)\n\t\t\t\t.orient(\"left\")\n\t\t\t\t.innerTickSize(-width)\n\t\t\t\t.outerTickSize(1)\n\t\t\t\t.tickPadding(10)\n\t\t\t\t.ticks(height / 20);\n\t\t\t\t\n\t\t\td3.select(\".x,axis\")\n\t\t\t\t.attr(\"transform\", `translate(${marginLeft}, ${height})`)\n\t\t\t\t.call(this.xAxis);\n\t\t\td3.select(\".y,axis\")\n\t\t\t\t.attr(\"transform\", `translate(${marginLeft}, 0)`)\n\t\t\t\t.call(this.yAxis);\n\t\t}\n\t}\n\t\n};\n\nPotree.ProfileWindowController = class ProfileWindowController{\n\t\n\tconstructor(viewer){\n\t\tthis.viewer = viewer;\n\t\tthis.profileWindow = viewer.profileWindow;\n\t\tthis.profile = null;\n\t\tthis.numPoints = 0;\n\t\tthis.threshold = 30*1000;\n\t\tthis.scheduledRecomputeTime = null;\n\t\t\n\t\tthis.enabled = true;\n\t\t\n\t\tthis.requests = [];\n\t\t\n\t\tthis._recompute = () => {this.recompute()};\n\t}\n\t\n\tsetProfile(profile){\n\t\t\n\t\tif(this.profile !== null && this.profile !== profile){\n\t\t\tthis.profile.removeEventListener(\"marker_moved\", this._recompute);\n\t\t\tthis.profile.removeEventListener(\"marker_added\", this._recompute);\n\t\t\tthis.profile.removeEventListener(\"marker_removed\", this._recompute);\n\t\t\tthis.profile.removeEventListener(\"width_changed\", this._recompute);\n\t\t}\n\t\t\n\t\tthis.profile = profile;\n\t\t\n\t\t{\n\t\t\tthis.profile.addEventListener(\"marker_moved\", this._recompute);\n\t\t\tthis.profile.addEventListener(\"marker_added\", this._recompute);\n\t\t\tthis.profile.addEventListener(\"marker_removed\", this._recompute);\n\t\t\tthis.profile.addEventListener(\"width_changed\", this._recompute);\n\n\t\t}\n\t\t\n\t\tthis.recompute();\n\t}\n\t\n\treset(){\n\t\tthis.profileWindow.reset();\n\t\t\n\t\tthis.numPoints = 0;\n\t\t\n\t\tif(this.profile){\n\t\t\tfor(let request of this.requests){\n\t\t\t\trequest.cancel();\n\t\t\t}\n\t\t}\n\t}\n\t\n\tprogressHandler(pointcloud, progress){\n\t\t\n\t\tfor(let segment of progress.segments){\n\t\t\tthis.profileWindow.addPoints(pointcloud, segment.points);\n\t\t\tthis.numPoints += segment.points.numPoints;\n\t\t}\n\t}\n\t\n\tcancel(){\n\t\tfor(let request of this.requests){\n\t\t\trequest.cancel();\n\t\t\t//request.finishLevelThenCancel();\n\t\t}\n\t\t\n\t\tthis.requests = [];\n\t};\n\t\n\trecompute(){\n\t\t\n\t\tif(!this.profile){\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tif(this.scheduledRecomputeTime !== null && this.scheduledRecomputeTime > new Date().getTime()){\n\t\t\treturn;\n\t\t}else{\n\t\t\tthis.scheduledRecomputeTime = new Date().getTime() + 100;\n\t\t}\n\t\tthis.scheduledRecomputeTime = null;\n\t\t\n\t\tthis.reset();\n\t\t\n\t\tfor(let pointcloud of this.viewer.scene.pointclouds.filter(p => p.visible)){\n\t\t\t\n\t\t\tlet request = pointcloud.getPointsInProfile(this.profile, null, {\n\t\t\t\t\"onProgress\": (event) => {\n\t\t\t\t\tif(!this.enabled){\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tthis.progressHandler(pointcloud, event.points);\n\t\t\t\t\t\n\t\t\t\t\tif(this.numPoints > this.threshold){\n\t\t\t\t\t\tthis.cancel();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"onFinish\": (event) => {\n\t\t\t\t\tif(!this.enabled){\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"onCancel\": () => {\n\t\t\t\t\tif(!this.enabled){\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\t\n\t\t\t\n\t\t\tthis.requests.push(request);\n\t\t}\n\t\t\n\t}\n\t\n\t\n};\n\n// http://epsg.io/\nproj4.defs(\"UTM10N\", \"+proj=utm +zone=10 +ellps=GRS80 +datum=NAD83 +units=m +no_defs\");\n\nPotree.MapView = class{\n\t\t\n\tconstructor(viewer){\n\t\tthis.viewer = viewer;\n\t\t\n\t\tthis.webMapService = \"WMTS\";\n\t\tthis.mapProjectionName = \"EPSG:3857\";\n\t\tthis.mapProjection = proj4.defs(this.mapProjectionName);\n\t\tthis.sceneProjection = null;\n\t\t\n\t\tthis.extentsLayer = null;\n\t\tthis.cameraLayer = null;\n\t\tthis.toolLayer = null;\n\t\tthis.sourcesLayer = null;\n\t\tthis.sourcesLabelLayer = null;\n\t\tthis.enabled = false;\n\t\t\n\t\tthis.createAnnotationStyle = (text) => {\n\t\t\treturn [\n\t\t\t\tnew ol.style.Style({\n\t\t\t\t\timage: new ol.style.Circle({\n\t\t\t\t\t\tradius: 10,\n\t\t\t\t\t\tstroke: new ol.style.Stroke({\n\t\t\t\t\t\t\tcolor: [255, 255, 255, 0.5],\n\t\t\t\t\t\t\twidth: 2\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tfill: new ol.style.Fill({\n\t\t\t\t\t\t\tcolor: [0, 0, 0, 0.5]\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t\t})/*,\n\t\t\t\tnew ol.style.Style({\n\t\t\t\t\ttext: new ol.style.Text({\n\t\t\t\t\t\tfont: '12px helvetica,sans-serif',\n\t\t\t\t\t\ttext: text,\n\t\t\t\t\t\tfill: new ol.style.Fill({\n\t\t\t\t\t\t\tcolor: '#000'\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tstroke: new ol.style.Stroke({\n\t\t\t\t\t\t\tcolor: '#fff',\n\t\t\t\t\t\t\twidth: 2\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t\t})*/\n\t\t\t];\n\t\t}\n\t\t\n\t\tthis.createLabelStyle = (text) => {\n\t\t\tlet style = new ol.style.Style({\n\t\t\t\timage: new ol.style.Circle({\n\t\t\t\t\tradius: 6,\n\t\t\t\t\tstroke: new ol.style.Stroke({\n\t\t\t\t\t\tcolor: 'white',\n\t\t\t\t\t\twidth: 2\n\t\t\t\t\t}),\n\t\t\t\t\tfill: new ol.style.Fill({\n\t\t\t\t\t\tcolor: 'green'\n\t\t\t\t\t})\n\t\t\t\t}),\n\t\t\t\ttext: new ol.style.Text({\n\t\t\t\t\tfont: '12px helvetica,sans-serif',\n\t\t\t\t\ttext: text,\n\t\t\t\t\tfill: new ol.style.Fill({\n\t\t\t\t\t\tcolor: '#000'\n\t\t\t\t\t}),\n\t\t\t\t\tstroke: new ol.style.Stroke({\n\t\t\t\t\t\tcolor: '#fff',\n\t\t\t\t\t\twidth: 2\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t});\n\t\t\t\n\t\t\treturn style;\n\t\t}\n\t\t\n\t\t\n\t}\n\t\n\tshowSources(show){\n\t\tthis.sourcesLayer.setVisible(show);\n\t\tthis.sourcesLabelLayer.setVisible(show);\n\t}\n\t\n\tinit(){\n\t\tthis.elMap = $(\"#potree_map\");\n\t\tthis.elMap.draggable({ handle: $('#potree_map_header') });\n\t\tthis.elMap.resizable();\n\t\t\n\t\tthis.elTooltip = $(`<div style=\"position: relative; z-index: 100\"></div>`);\n\t\tthis.elMap.append(this.elTooltip);\n\t\n\t\tlet extentsLayer = this.getExtentsLayer();\n\t\tlet cameraLayer = this.getCameraLayer();\n\t\tlet toolLayer = this.getToolLayer();\n\t\tlet sourcesLayer = this.getSourcesLayer();\n\t\tlet sourcesLabelLayer = this.getSourcesLabelLayer();\n\t\tlet annotationsLayer = this.getAnnotationsLayer();\n\t\t\n\t\tlet mousePositionControl = new ol.control.MousePosition({\n\t\t\tcoordinateFormat: ol.coordinate.createStringXY(5),\n\t\t\tprojection: \"EPSG:4326\",\n\t\t\tundefinedHTML: '&nbsp;'\n\t\t});\n\t\t\n\t\tlet _this = this;\n\t\tlet DownloadSelectionControl = function(opt_options){\n\t\t\tlet options = opt_options || {};\n\t\t\t\n\t\t\t// TOGGLE TILES\n\t\t\tlet btToggleTiles = document.createElement('button');\n\t\t\tbtToggleTiles.innerHTML = 'T';\n\t\t\tbtToggleTiles.addEventListener('click', () => {\n\t\t\t\tlet visible = sourcesLayer.getVisible();\n\t\t\t\t_this.showSources(!visible);\n\t\t\t\t//sourcesLayer.setVisible(!visible);\n\t\t\t\t//sourcesLabelLayer.setVisible(!visible);\n\t\t\t}, false);\n\t\t\tbtToggleTiles.style.float = \"left\";\n\t\t\tbtToggleTiles.title = \"show / hide tiles\";\n\t\t\t\n\t\t\t// DOWNLOAD SELECTED TILES\n\t\t\tlet link = document.createElement(\"a\");\n\t\t\tlink.href = \"#\";\n\t\t\tlink.download = \"list.txt\";\n\t\t\tlink.style.float = \"left\";\n\t\t\t\n\t\t\tlet button = document.createElement('button');\n\t\t\tbutton.innerHTML = 'D';\n\t\t\tlink.appendChild(button);\n\t\t\t\n\t\t\tlet this_ = this;\n\t\t\tlet handleDownload = (e) => {\n\t\t\t\tlet features = selectedFeatures.getArray();\n\t\t\t\t\n\t\t\t\tlet url =  [location.protocol, '//', location.host, location.pathname].join('');\n\t\t\t\t\n\t\t\t\tif(features.length === 0){\n\t\t\t\t\talert(\"No tiles were selected. Select area with ctrl + left mouse button!\");\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\treturn false;\n\t\t\t\t}else if(features.length === 1){\n\t\t\t\t\tlet feature = features[0];\n\t\t\t\t\t\n\t\t\t\t\tif(feature.source){\n\t\t\t\t\t\tlet cloudjsurl = feature.pointcloud.pcoGeometry.url;\n\t\t\t\t\t\tlet sourceurl = new URL(url + '/../' + cloudjsurl + '/../source/' + feature.source.name);\n\t\t\t\t\t\tlink.href = sourceurl.href;\n\t\t\t\t\t\tlink.download = feature.source.name;\n\t\t\t\t\t}\n\t\t\t\t}else{\n\t\t\t\t\tlet content = \"\";\n\t\t\t\t\tfor(var i = 0; i < features.length; i++){\n\t\t\t\t\t\tlet feature = features[i];\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(feature.source){\n\t\t\t\t\t\t\tlet cloudjsurl = feature.pointcloud.pcoGeometry.url;\n\t\t\t\t\t\t\tlet sourceurl = new URL(url + '/../' + cloudjsurl + '/../source/' + feature.source.name);\n\t\t\t\t\t\t\tcontent += sourceurl.href + \"\\n\";\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tlet uri = \"data:application/octet-stream;base64,\"+btoa(content);\n\t\t\t\t\tlink.href = uri;\n\t\t\t\t\tlink.download = \"list_of_files.txt\";\n\t\t\t\t}\n\t\t\t};\n\t\t\t\n\t\t\tbutton.addEventListener('click', handleDownload, false);\n\t\t\t\n\t\t\t// assemble container\n\t\t\tlet element = document.createElement('div');\n\t\t\telement.className = 'ol-unselectable ol-control';\n\t\t\telement.appendChild(link);\n\t\t\telement.appendChild(btToggleTiles);\n\t\t\telement.style.bottom = \"0.5em\";\n\t\t\telement.style.left = \"0.5em\";\n\t\t\telement.title = \"Download file or list of selected tiles. Select tile with left mouse button or area using ctrl + left mouse.\";\n\t\t\t\n\t\t\tol.control.Control.call(this, {\n\t\t\t\telement: element,\n\t\t\t\ttarget: options.target\n\t\t\t});\n\t\t\t\n\t\t};\n\t\tol.inherits(DownloadSelectionControl, ol.control.Control);\n\t\t\n\t\tthis.map = new ol.Map({\n\t\t\tcontrols: ol.control.defaults({\n\t\t\t\tattributionOptions: ({\n\t\t\t\tcollapsible: false\n\t\t\t\t})\n\t\t\t}).extend([\n\t\t\t\t//this.controls.zoomToExtent,\n\t\t\t\tnew DownloadSelectionControl(),\n\t\t\t\tmousePositionControl\n\t\t\t]),\n\t\t\tlayers: [\n\t\t\t\tnew ol.layer.Tile({source: new ol.source.OSM()}),\n\t\t\t\tthis.toolLayer,\n\t\t\t\tthis.annotationsLayer,\n\t\t\t\tthis.sourcesLayer,\n\t\t\t\tthis.sourcesLabelLayer,\n\t\t\t\textentsLayer,\n\t\t\t\tcameraLayer\n\t\t\t],\n\t\t\ttarget: 'potree_map_content',\n\t\t\tview: new ol.View({\n\t\t\t\tcenter: this.olCenter,\n\t\t\t\tzoom: 9\n\t\t\t})\n\t\t});\n\n\t\t// DRAGBOX / SELECTION\n\t\tthis.dragBoxLayer = new ol.layer.Vector({\n\t\t\tsource: new ol.source.Vector({}),\n\t\t\tstyle: new ol.style.Style({\n\t\t\t\tstroke: new ol.style.Stroke({\n\t\t\t\t\t  color: 'rgba(0, 0, 255, 1)',\n\t\t\t\t\t  width: 2\n\t\t\t\t})\n\t\t\t})\n\t\t});\n\t\tthis.map.addLayer(this.dragBoxLayer);\n\t\t\n\t\tlet select = new ol.interaction.Select();\n\t\tthis.map.addInteraction(select);\n\t\t\n\t\tlet selectedFeatures = select.getFeatures();\n        \n\t\tlet dragBox = new ol.interaction.DragBox({\n\t\t  condition: ol.events.condition.platformModifierKeyOnly\n\t\t});\n        \n\t\tthis.map.addInteraction(dragBox);\n\t\t\n\t\tthis.map.on('pointermove', evt => {\n\t\t\tlet pixel = evt.pixel;\n\t\t\tlet feature = this.map.forEachFeatureAtPixel(pixel, function(feature) {\n\t\t\t\treturn feature;\n\t\t\t});\n\t\t\t\n\t\t\t//console.log(feature);\n\t\t\t//this.elTooltip.css(\"display\", feature ? '' : 'none');\n\t\t\tthis.elTooltip.css(\"display\", \"none\");\n\t\t\tif(feature && feature.onHover){\n\t\t\t\tfeature.onHover(evt);\n\t\t\t\t//overlay.setPosition(evt.coordinate);\n\t\t\t\t//tooltip.innerHTML = feature.get('name');\n\t\t\t}\n\t\t});\n\t\t\n\t\tthis.map.on('click', evt => {\n\t\t\tlet pixel = evt.pixel;\n\t\t\tlet feature = this.map.forEachFeatureAtPixel(pixel, function(feature) {\n\t\t\t\treturn feature;\n\t\t\t});\n\t\t\t\n\t\t\tif(feature && feature.onHover){\n\t\t\t\tfeature.onClick(evt);\n\t\t\t}\n\t\t});\n        \n\t\tdragBox.on('boxend', (e) => {\n\t\t\t// features that intersect the box are added to the collection of\n\t\t\t// selected features, and their names are displayed in the \"info\"\n\t\t\t// div\n\t\t\tlet extent = dragBox.getGeometry().getExtent();\n\t\t\tthis.getSourcesLayer().getSource().forEachFeatureIntersectingExtent(extent, (feature) => {\n\t\t\t\tselectedFeatures.push(feature);\n\t\t\t});\n\t\t});\n\t\t\n\t\t// clear selection when drawing a new box and when clicking on the map\n\t\tdragBox.on('boxstart', (e) => {\n\t\t\tselectedFeatures.clear();\n\t\t});\n\t\tthis.map.on('click', () => {\n\t\t\tselectedFeatures.clear();\n\t\t});\n\n\t\tthis.viewer.addEventListener(\"scene_changed\", e => {\n\t\t\tthis.setScene(e.scene);\n\t\t});\n\t\t\n\t\tthis.onPointcloudAdded = e => {\n\t\t\tthis.load(e.pointcloud);\n\t\t};\n\t\t\n\t\tthis.onAnnotationAdded = e => {\n\t\t\tif(!this.sceneProjection){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tlet annotation = e.annotation;\n\t\t\tlet position = annotation.position;\n\t\t\tlet mapPos = this.toMap.forward([position.x, position.y]);\n\t\t\tlet feature = new ol.Feature({\n\t\t\t\t geometry: new ol.geom.Point(mapPos),\n\t\t\t\t name: annotation.title\n\t\t\t});\n\t\t\tfeature.setStyle(this.createAnnotationStyle(annotation.title));\n\t\t\t\n\t\t\tfeature.onHover = evt => {\n\t\t\t\tlet coordinates = feature.getGeometry().getCoordinates();\n\t\t\t\tlet p = this.map.getPixelFromCoordinate(coordinates);\n\t\t\t\t\n\t\t\t\tthis.elTooltip.html(annotation.title);\n\t\t\t\tthis.elTooltip.css(\"display\", \"\");\n\t\t\t\tthis.elTooltip.css(\"left\", `${p[0]}px`);\n\t\t\t\tthis.elTooltip.css(\"top\", `${p[1]}px`);\n\t\t\t};\n\t\t\t\n\t\t\tfeature.onClick = evt => {\n\t\t\t\tannotation.clickTitle();\n\t\t\t};\n\t\t\t\n\t\t\tthis.getAnnotationsLayer().getSource().addFeature(feature);\n\t\t};\n\t\t\n\t\tthis.setScene(this.viewer.scene);\n\t}\n\t\n\tsetScene(scene){\n\t\tif(this.scene === scene){\n\t\t\treturn;\n\t\t};\n\t\t\n\t\tif(this.scene){\n\t\t\tthis.scene.removeEventListener(\"pointcloud_added\", this.onPointcloudAdded);\n\t\t\tthis.scene.annotations.removeEventListener(\"annotation_added\", this.onAnnotationAdded);\n\t\t}\n\t\t\n\t\tthis.scene = scene;\n\t\t\n\t\tthis.scene.addEventListener(\"pointcloud_added\", this.onPointcloudAdded);\n\t\tthis.scene.annotations.addEventListener(\"annotation_added\", this.onAnnotationAdded);\n\t\t\n\t\tfor(let pointcloud of this.viewer.scene.pointclouds){\n\t\t\tthis.load(pointcloud);\n\t\t}\n\t\t\n\t\tthis.viewer.scene.annotations.traverseDescendants(annotation => {\n\t\t\tthis.onAnnotationAdded({annotation: annotation});\n\t\t});\n\t}\n\t\n\tgetExtentsLayer(){\n\t\tif(this.extentsLayer){\n\t\t\treturn this.extentsLayer;\n\t\t}\n\t\t\n\t\tthis.gExtent = new ol.geom.LineString([[0,0], [0,0]]);\n\t\t\n\t\tlet feature = new ol.Feature(this.gExtent);\n\t\tlet featureVector = new ol.source.Vector({\n\t\t\tfeatures: [feature]\n\t\t});\n\t\t\n\t\tthis.extentsLayer = new ol.layer.Vector({\n\t\t\tsource: featureVector,\n\t\t\tstyle: new ol.style.Style({\n\t\t\t\tfill: new ol.style.Fill({\n\t\t\t\t\tcolor: 'rgba(255, 255, 255, 0.2)'\n\t\t\t\t}),\n\t\t\t\tstroke: new ol.style.Stroke({\n\t\t\t\t\t  color: '#0000ff',\n\t\t\t\t\t  width: 2\n\t\t\t\t}),\n\t\t\t\timage: new ol.style.Circle({\n\t\t\t\t\tradius: 3,\n\t\t\t\t\tfill: new ol.style.Fill({\n\t\t\t\t\t\tcolor: '#0000ff'\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t})\n\t\t});\n\t\t\n\t\treturn this.extentsLayer;\n\t}\n\t\n\tgetAnnotationsLayer(){\n\t\tif(this.annotationsLayer){\n\t\t\treturn this.annotationsLayer;\n\t\t}\n\t\t\n\t\tthis.annotationsLayer = new ol.layer.Vector({\n\t\t\tsource: new ol.source.Vector({\n\t\t\t}),\n\t\t\tstyle: new ol.style.Style({\n\t\t\t\tfill: new ol.style.Fill({\n\t\t\t\t\tcolor: 'rgba(255, 0, 0, 1)'\n\t\t\t\t}),\n\t\t\t\tstroke: new ol.style.Stroke({\n\t\t\t\t\t  color: 'rgba(255, 0, 0, 1)',\n\t\t\t\t\t  width: 2\n\t\t\t\t})\n\t\t\t})\n\t\t});\n\t\t\n\t\treturn this.annotationsLayer;\n\t}\n\t\n\tgetCameraLayer(){\n\t\tif(this.cameraLayer){\n\t\t\treturn this.cameraLayer;\n\t\t}\n\t\t\n\t\t// CAMERA LAYER\n\t\tthis.gCamera = new ol.geom.LineString([[0,0], [0,0], [0,0], [0,0]]);\n\t\tlet feature = new ol.Feature(this.gCamera);\n\t\tlet featureVector = new ol.source.Vector({\n\t\t\tfeatures: [feature]\n\t\t});\n\t\t\n\t\tthis.cameraLayer = new ol.layer.Vector({\n\t\t\tsource: featureVector,\n\t\t\tstyle: new ol.style.Style({\n\t\t\t\tstroke: new ol.style.Stroke({\n\t\t\t\t\t  color: '#0000ff',\n\t\t\t\t\t  width: 2\n\t\t\t\t})\n\t\t\t})\n\t\t});\n\t\t\n\t\treturn this.cameraLayer;\n\t}\n\t\n\tgetToolLayer(){\n\t\tif(this.toolLayer){\n\t\t\treturn this.toolLayer;\n\t\t}\n\t\t\n\t\tthis.toolLayer = new ol.layer.Vector({\n\t\t\tsource: new ol.source.Vector({\n\t\t\t}),\n\t\t\tstyle: new ol.style.Style({\n\t\t\t\tfill: new ol.style.Fill({\n\t\t\t\t\tcolor: 'rgba(255, 0, 0, 1)'\n\t\t\t\t}),\n\t\t\t\tstroke: new ol.style.Stroke({\n\t\t\t\t\t  color: 'rgba(255, 0, 0, 1)',\n\t\t\t\t\t  width: 2\n\t\t\t\t})\n\t\t\t})\n\t\t});\n\t\t\n\t\treturn this.toolLayer;\n\t}\n\t\n\tgetSourcesLayer(){\n\t\tif(this.sourcesLayer){\n\t\t\treturn this.sourcesLayer;\n\t\t}\n\t\t\n\t\tthis.sourcesLayer = new ol.layer.Vector({\n\t\t\tsource: new ol.source.Vector({}),\n\t\t\tstyle: new ol.style.Style({\n\t\t\t\tfill: new ol.style.Fill({\n\t\t\t\t\tcolor: 'rgba(0, 0, 150, 0.1)'\n\t\t\t\t}),\n\t\t\t\tstroke: new ol.style.Stroke({\n\t\t\t\t\t  color: 'rgba(0, 0, 150, 1)',\n\t\t\t\t\t  width: 1\n\t\t\t\t})\n\t\t\t})\n\t\t});\n\t\t\n\t\treturn this.sourcesLayer;\n\t}\n\t\n\tgetSourcesLabelLayer(){\n\t\tif(this.sourcesLabelLayer){\n\t\t\treturn this.sourcesLabelLayer;\n\t\t}\n\t\t\n\t\tthis.sourcesLabelLayer = new ol.layer.Vector({\n\t\t\tsource: new ol.source.Vector({\n\t\t\t}),\n\t\t\tstyle: new ol.style.Style({\n\t\t\t\tfill: new ol.style.Fill({\n\t\t\t\t\tcolor: 'rgba(255, 0, 0, 0.1)'\n\t\t\t\t}),\n\t\t\t\tstroke: new ol.style.Stroke({\n\t\t\t\t\t  color: 'rgba(255, 0, 0, 1)',\n\t\t\t\t\t  width: 2\n\t\t\t\t})\n\t\t\t}),\n\t\t\tminResolution: 0.01,\n            maxResolution: 20\n\t\t});\n\t\t\n\t\treturn this.sourcesLabelLayer;\n\t}\n\t\n\tsetSceneProjection(sceneProjection){\n\t\tthis.sceneProjection = sceneProjection;\n\t\tthis.toMap = proj4(this.sceneProjection, this.mapProjection);\n\t\tthis.toScene = proj4(this.mapProjection, this.sceneProjection);\n\t};\n\t\n\tgetMapExtent(){\n\t\tlet bb = this.viewer.getBoundingBox();\n\t\t\n\t\tlet bottomLeft = this.toMap.forward([bb.min.x, bb.min.y]);\n\t\tlet bottomRight = this.toMap.forward([bb.max.x, bb.min.y]);\n\t\tlet topRight = this.toMap.forward([bb.max.x, bb.max.y]);\n\t\tlet topLeft = this.toMap.forward([bb.min.x, bb.max.y]);\n\t\t\n\t\tlet extent = {\n\t\t\tbottomLeft: bottomLeft,\n\t\t\tbottomRight: bottomRight,\n\t\t\ttopRight: topRight,\n\t\t\ttopLeft: topLeft\n\t\t};\n\t\t\n\t\treturn extent;\n\t};\n\t\n\tgetMapCenter(){\n\t\tlet mapExtent = this.getMapExtent();\n\t\t\n\t\tlet mapCenter = [\n\t\t\t(mapExtent.bottomLeft[0] + mapExtent.topRight[0]) / 2, \n\t\t\t(mapExtent.bottomLeft[1] + mapExtent.topRight[1]) / 2\n\t\t];\n\t\t\n\t\treturn mapCenter;\n\t};\t\n\t\n\tupdateToolDrawings(){\n\t\tthis.toolLayer.getSource().clear();\n\t\t\n\t\tlet profiles = this.viewer.profileTool.profiles;\n\t\tfor(var i = 0; i < profiles.length; i++){\n\t\t\tlet profile = profiles[i];\n\t\t\tlet coordinates = [];\n\t\t\t\n\t\t\tfor(var j = 0; j < profile.points.length; j++){\n\t\t\t\tlet point = profile.points[j];\n\t\t\t\tlet pointMap = this.toMap.forward([point.x, point.y]);\n\t\t\t\tcoordinates.push(pointMap);\n\t\t\t}\n\t\t\t\n\t\t\tlet line = new ol.geom.LineString(coordinates);\n\t\t\tlet feature = new ol.Feature(line);\n\t\t\tthis.toolLayer.getSource().addFeature(feature);\n\t\t}\n\t\t\n\t\tlet measurements = this.viewer.measuringTool.measurements;\n\t\tfor(var i = 0; i < measurements.length; i++){\n\t\t\tlet measurement = measurements[i];\n\t\t\tlet coordinates = [];\n\t\t\t\n\t\t\tfor(var j = 0; j < measurement.points.length; j++){\n\t\t\t\tlet point = measurement.points[j].position;\n\t\t\t\tlet pointMap = this.toMap.forward([point.x, point.y]);\n\t\t\t\tcoordinates.push(pointMap);\n\t\t\t}\n\t\t\t\n\t\t\tif(measurement.closed && measurement.points.length > 0){\n\t\t\t\tcoordinates.push(coordinates[0]);\n\t\t\t}\n\t\t\t\n\t\t\tlet line = new ol.geom.LineString(coordinates);\n\t\t\tlet feature = new ol.Feature(line);\n\t\t\tthis.toolLayer.getSource().addFeature(feature);\n\t\t}\n\t}\n\t\n\t\n\tload(pointcloud){\n\t\t\n\t\tif(!pointcloud){\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tif(!pointcloud.projection){\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tif(!this.sceneProjection){\n\t\t\tthis.setSceneProjection(pointcloud.projection);\n\t\t}\n\t\t\n\t\tlet mapExtent = this.getMapExtent();\n\t\tlet mapCenter = this.getMapCenter();\n\t\t\n\t\t\n\t\tlet view = this.map.getView();\n\t\tview.setCenter(mapCenter);\n\t\t\n\t\tthis.gExtent.setCoordinates([\n\t\t\tmapExtent.bottomLeft, \n\t\t\tmapExtent.bottomRight, \n\t\t\tmapExtent.topRight, \n\t\t\tmapExtent.topLeft,\n\t\t\tmapExtent.bottomLeft\n\t\t]);\n\t\t\n\t\tview.fit(this.gExtent, [300, 300], {\n\t\t\tconstrainResolution: false\n\t\t});\n\n\t\t\n\n\t\tlet url = pointcloud.pcoGeometry.url + \"/../sources.json\";\n\t\t$.getJSON(url, (data) => {\n\t\t\tlet sources = data.sources;\n\t\t\t\n\t\t\tfor(var i = 0; i < sources.length; i++){\n\t\t\t\tlet source = sources[i];\n\t\t\t\tlet name = source.name;\n\t\t\t\tlet points = source.points;\n\t\t\t\tlet bounds = source.bounds;\n\n\t\t\t\tlet mapBounds = {\n\t\t\t\t\tmin: this.toMap.forward( [bounds.min[0], bounds.min[1]] ),\n\t\t\t\t\tmax: this.toMap.forward( [bounds.max[0], bounds.max[1]] )\n\t\t\t\t}\n\t\t\t\tlet mapCenter = [\n\t\t\t\t\t(mapBounds.min[0] + mapBounds.max[0]) / 2,\n\t\t\t\t\t(mapBounds.min[1] + mapBounds.max[1]) / 2,\n\t\t\t\t];\n\t\t\t\t\n\t\t\t\tlet p1 = this.toMap.forward( [bounds.min[0], bounds.min[1]] );\n\t\t\t\tlet p2 = this.toMap.forward( [bounds.max[0], bounds.min[1]] );\n\t\t\t\tlet p3 = this.toMap.forward( [bounds.max[0], bounds.max[1]] );\n\t\t\t\tlet p4 = this.toMap.forward( [bounds.min[0], bounds.max[1]] );\n\t\t\t\t\n\t\t\t\tlet boxes = [];\n\t\t\t\t//var feature = new ol.Feature({\n\t\t\t\t//\t'geometry': new ol.geom.LineString([p1, p2, p3, p4, p1])\n\t\t\t\t//});\n\t\t\t\tlet feature = new ol.Feature({\n\t\t\t\t\t'geometry': new ol.geom.Polygon([[p1, p2, p3, p4, p1]])\n\t\t\t\t});\n\t\t\t\tfeature.source = source;\n\t\t\t\tfeature.pointcloud = pointcloud;\n\t\t\t\tthis.getSourcesLayer().getSource().addFeature(feature);\n\t\t\t\t\n                \n\t\t\t\tfeature = new ol.Feature({\n\t\t\t\t\t geometry: new ol.geom.Point(mapCenter),\n\t\t\t\t\t name: name \n\t\t\t\t});\n\t\t\t\tfeature.setStyle(this.createLabelStyle(name));\n\t\t\t\tthis.sourcesLabelLayer.getSource().addFeature(feature);\n\t\t\t}\n\t\t});\n\t\t\n\t}\n\t\n\ttoggle(){\n\t\t\n\t\tif(this.elMap.is(\":visible\")){\n\t\t\tthis.elMap.css(\"display\", \"none\");\n\t\t\tthis.enabled = false;\n\t\t}else{\n\t\t\tthis.elMap.css(\"display\", \"block\");\n\t\t\tthis.enabled = true;\n\t\t}\n\t\t\n\t}\n\t\n\tupdate(delta){\n\t\tif(!this.sceneProjection){\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tlet pm = $( \"#potree_map\" );\n\t\t\n\t\tif(!this.enabled){\n\t\t\treturn;\n\t\t}\n\t\t\n\t\t// resize\n\t\tlet mapSize = this.map.getSize();\n\t\tlet resized = (pm.width() != mapSize[0] || pm.height() != mapSize[1]);\n\t\tif(resized){\n\t\t\tthis.map.updateSize();\n\t\t}\n\t\t\n\t\t// camera\n\t\tlet scale = this.map.getView().getResolution();\n\t\tlet camera = this.viewer.scene.camera;\n\t\tlet campos = camera.position;\n\t\tlet camdir = camera.getWorldDirection();\n\t\tlet sceneLookAt = camdir.clone().multiplyScalar(30 * scale).add(campos);\n\t\tlet geoPos = camera.position;\n\t\tlet geoLookAt = sceneLookAt;\n\t\tlet mapPos = new THREE.Vector2().fromArray(this.toMap.forward([geoPos.x, geoPos.y]));\n\t\tlet mapLookAt = new THREE.Vector2().fromArray(this.toMap.forward([geoLookAt.x, geoLookAt.y]));\n\t\tlet mapDir = new THREE.Vector2().subVectors(mapLookAt, mapPos).normalize();\n\t\tmapLookAt = mapPos.clone().add(mapDir.clone().multiplyScalar(30 * scale));\n\t\tlet mapLength = mapPos.distanceTo(mapLookAt);\n\t\tlet mapSide = new THREE.Vector2(-mapDir.y, mapDir.x);\n\t\t\n\t\tlet p1 = mapPos.toArray();\n\t\tlet p2 = mapLookAt.clone().sub(mapSide.clone().multiplyScalar(0.3 * mapLength)).toArray();\n\t\tlet p3 = mapLookAt.clone().add(mapSide.clone().multiplyScalar(0.3 * mapLength)).toArray();\n\n\t\t\n\t\tthis.gCamera.setCoordinates([p1, p2, p3, p1]);\n\t}\n\t\n\tget sourcesVisible(){\n\t\treturn this.getSourcesLayer().getVisible();\n\t}\n\t\n\tset sourcesVisible(value){\n\t\tthis.getSourcesLayer().setVisible(value);\n\t}\n\t\n};\n\n\n\n\n\n\n\nlet createToolIcon = function(icon, title, callback){\n\tlet element = $(`\n\t\t<img src=\"${icon}\" \n\t\t\tstyle=\"width: 32px; height: 32px\" \n\t\t\tclass=\"button-icon\" \n\t\t\tdata-i18n=\"${title}\" />\n\t`);\n\t\n\telement.click(callback);\n\t\n\treturn element;\n};\n\nfunction initToolbar(){\n\n\t// ANGLE\n\tlet elToolbar = $(\"#tools\");\n\telToolbar.append(createToolIcon(\n\t\tPotree.resourcePath + \"/icons/angle.png\",\n\t\t\"[title]tt.angle_measurement\",\n\t\tfunction(){\n\t\t\t$(\"#menu_measurements\").next().slideDown();\n\t\t\tviewer.measuringTool.startInsertion({\n\t\t\t\tshowDistances: false, \n\t\t\t\tshowAngles: true, \n\t\t\t\tshowArea: false, \n\t\t\t\tclosed: true, \n\t\t\t\tmaxMarkers: 3,\n\t\t\t\tname: \"Angle\"});\n\t\t}\n\t));\n\t\n\t// POINT\n\telToolbar.append(createToolIcon(\n\t\tPotree.resourcePath + \"/icons/point.svg\",\n\t\t\"[title]tt.point_measurement\",\n\t\tfunction(){\n\t\t\t$(\"#menu_measurements\").next().slideDown();\n\t\t\tviewer.measuringTool.startInsertion({\n\t\t\t\tshowDistances: false, \n\t\t\t\tshowAngles: false, \n\t\t\t\tshowCoordinates: true, \n\t\t\t\tshowArea: false, \n\t\t\t\tclosed: true, \n\t\t\t\tmaxMarkers: 1,\n\t\t\t\tname: \"Point\"});\n\t\t}\n\t));\n\t\n\t// DISTANCE\n\telToolbar.append(createToolIcon(\n\t\tPotree.resourcePath + \"/icons/distance.svg\",\n\t\t\"[title]tt.distance_measurement\",\n\t\tfunction(){\n\t\t\t$(\"#menu_measurements\").next().slideDown();\n\t\t\tviewer.measuringTool.startInsertion({\n\t\t\t\tshowDistances: true, \n\t\t\t\tshowArea: false, \n\t\t\t\tclosed: false,\n\t\t\t\tname: \"Distance\"});\n\t\t}\n\t));\n\t\n\t// HEIGHT\n\telToolbar.append(createToolIcon(\n\t\tPotree.resourcePath + \"/icons/height.svg\",\n\t\t\"[title]tt.height_measurement\",\n\t\tfunction(){\n\t\t\t$(\"#menu_measurements\").next().slideDown();\n\t\t\tviewer.measuringTool.startInsertion({\n\t\t\t\tshowDistances: false, \n\t\t\t\tshowHeight: true, \n\t\t\t\tshowArea: false, \n\t\t\t\tclosed: false, \n\t\t\t\tmaxMarkers: 2,\n\t\t\t\tname: \"Height\"});\n\t\t}\n\t));\n\t\n\t// AREA\n\telToolbar.append(createToolIcon(\n\t\tPotree.resourcePath + \"/icons/area.svg\",\n\t\t\"[title]tt.area_measurement\",\n\t\tfunction(){\n\t\t\t$(\"#menu_measurements\").next().slideDown();\n\t\t\tviewer.measuringTool.startInsertion({\n\t\t\t\tshowDistances: true, \n\t\t\t\tshowArea: true, \n\t\t\t\tclosed: true,\n\t\t\t\tname: \"Area\"});\n\t\t}\n\t));\n\t\n\t// VOLUME\n\telToolbar.append(createToolIcon(\n\t\tPotree.resourcePath + \"/icons/volume.svg\",\n\t\t\"[title]tt.volume_measurement\",\n\t\tfunction(){viewer.volumeTool.startInsertion()}\n\t));\n\t\n\t// PROFILE\n\telToolbar.append(createToolIcon(\n\t\tPotree.resourcePath + \"/icons/profile.svg\",\n\t\t\"[title]tt.height_profile\",\n\t\tfunction(){\n\t\t\t$(\"#menu_measurements\").next().slideDown();;\n\t\t\tviewer.profileTool.startInsertion();\n\t\t}\n\t));\n\t\n\t// CLIP VOLUME\n\telToolbar.append(createToolIcon(\n\t\tPotree.resourcePath + \"/icons/clip_volume.svg\",\n\t\t\"[title]tt.clip_volume\",\n\t\tfunction(){viewer.volumeTool.startInsertion({clip: true})}\n\t));\n\t\n\t// REMOVE ALL\n\telToolbar.append(createToolIcon(\n\t\tPotree.resourcePath + \"/icons/reset_tools.svg\",\n\t\t\"[title]tt.remove_all_measurement\",\n\t\tfunction(){\n\t\t\tviewer.scene.removeAllMeasurements();\n\t\t}\n\t));\n}\n\nfunction initClassificationList(){\n\tlet elClassificationList = $(\"#classificationList\");\n\t\n\tlet addClassificationItem = function(code, name){\n\t\t\n\t\tlet inputID = \"chkClassification_\" + code;\n\t\t\n\t\tlet element = $(`\n\t\t\t<li>\n\t\t\t\t<label style=\"whitespace: nowrap\">\n\t\t\t\t\t<input id=\"${inputID}\" type=\"checkbox\" checked/>\n\t\t\t\t\t<span>${name}</span>\n\t\t\t\t</label>\n\t\t\t</li>\n\t\t`);\n\t\t\n\t\tlet elInput = element.find(\"input\");\n\t\t\n\t\telInput.click(event => {\n\t\t\tviewer.setClassificationVisibility(code, event.target.checked);\n\t\t});\n\t\t\n\t\telClassificationList.append(element);\n\t};\n\t\n\taddClassificationItem(0, \"never classified\");\n\taddClassificationItem(1, \"unclassified\");\n\taddClassificationItem(2, \"ground\");\n\taddClassificationItem(3, \"low vegetation\");\n\taddClassificationItem(4, \"medium vegetation\");\n\taddClassificationItem(5, \"high vegetation\");\n\taddClassificationItem(6, \"building\");\n\taddClassificationItem(7, \"low point(noise)\");\n\taddClassificationItem(8, \"key-point\");\n\taddClassificationItem(9, \"water\");\n\taddClassificationItem(12, \"overlap\");\n}\n\nfunction initAccordion(){\n\t\n\t$(\".accordion > h3\").each(function(){\n\t\tlet header = $(this);\n\t\tlet content = $(this).next();\n\t\t\n\t\theader.addClass(\"accordion-header ui-widget\");\n\t\tcontent.addClass(\"accordion-content ui-widget\");\n\t\t\n\t\tcontent.hide();\n\t\t\n\t\theader.click(function(){\n\t\t\tcontent.slideToggle();\n\t\t});\n\t});\n\t\n\t// to close all, call\n\t// $(\".accordion > div\").hide()\n\t\n\t// to open the, for example, tool menu, call: \n\t// $(\"#menu_tools\").next().show()\n\t\n}\n\nfunction initAppearance(){\n\n\t//$( \"#optQuality\" ).selectmenu();\n\t\n\t//$(\"#optQuality\").val(viewer.getQuality()).selectmenu(\"refresh\")\n\t//$(\"#optQuality\").selectmenu({\n\t//\tchange: function(event, ui){\n\t//\t\tviewer.setQuality(ui.item.value);\n\t//\t}\n\t//});\n\n\n\t$( \"#sldPointBudget\" ).slider({\n\t\tvalue: viewer.getPointBudget(),\n\t\tmin: 100*1000,\n\t\tmax: 5*1000*1000,\n\t\tstep: 1000,\n\t\tslide: function( event, ui ) {viewer.setPointBudget(ui.value);}\n\t});\n\t\n\t$( \"#sldFOV\" ).slider({\n\t\tvalue: viewer.getFOV(),\n\t\tmin: 20,\n\t\tmax: 100,\n\t\tstep: 1,\n\t\tslide: function( event, ui ) {viewer.setFOV(ui.value);}\n\t});\n\t\n\t$( \"#sldEDLRadius\" ).slider({\n\t\tvalue: viewer.getEDLRadius(),\n\t\tmin: 1,\n\t\tmax: 4,\n\t\tstep: 0.01,\n\t\tslide: function( event, ui ) {viewer.setEDLRadius(ui.value);}\n\t});\n\t\n\t$( \"#sldEDLStrength\" ).slider({\n\t\tvalue: viewer.getEDLStrength(),\n\t\tmin: 0,\n\t\tmax: 5,\n\t\tstep: 0.01,\n\t\tslide: function( event, ui ) {viewer.setEDLStrength(ui.value);}\n\t});\n\t\n\tviewer.addEventListener(\"point_budget_changed\", function(event){\n\t\t$( '#lblPointBudget')[0].innerHTML = Potree.utils.addCommas(viewer.getPointBudget());\n\t\t$( \"#sldPointBudget\" ).slider({value: viewer.getPointBudget()});\n\t});\n\t\n\tviewer.addEventListener(\"fov_changed\", function(event){\n\t\t$('#lblFOV')[0].innerHTML = parseInt(viewer.getFOV());\n\t\t$( \"#sldFOV\" ).slider({value: viewer.getFOV()});\n\t});\n\n\t//viewer.addEventListener(\"quality_changed\", e => {\n\t//\t\n\t//\tlet name = viewer.quality;\n\t//\t\n\t//\t$( \"#optQuality\" )\n\t//\t\t.selectmenu()\n\t//\t\t.val(name)\n\t//\t\t.selectmenu(\"refresh\");\n\t//});\n\t\n\tviewer.addEventListener(\"edl_radius_changed\", function(event){\n\t\t$('#lblEDLRadius')[0].innerHTML = viewer.getEDLRadius().toFixed(1);\n\t\t$( \"#sldEDLRadius\" ).slider({value: viewer.getEDLRadius()});\n\t});\n\t\n\tviewer.addEventListener(\"edl_strength_changed\", function(event){\n\t\t$('#lblEDLStrength')[0].innerHTML = viewer.getEDLStrength().toFixed(1);\n\t\t$( \"#sldEDLStrength\" ).slider({value: viewer.getEDLStrength()});\n\t});\n\t\n\tviewer.addEventListener(\"background_changed\", function(event){\n\t\t$(\"input[name=background][value='\" + viewer.getBackground() +  \"']\").prop(\"checked\",true);\n\t});\n\t\n\t\n\t$('#lblPointBudget')[0].innerHTML = Potree.utils.addCommas(viewer.getPointBudget());\n\t$('#lblFOV')[0].innerHTML = parseInt(viewer.getFOV());\n\t$('#lblEDLRadius')[0].innerHTML = viewer.getEDLRadius().toFixed(1);\n\t$('#lblEDLStrength')[0].innerHTML = viewer.getEDLStrength().toFixed(1);\n\t$('#chkEDLEnabled')[0].checked = viewer.getEDLEnabled();\n\t$(\"input[name=background][value='\" + viewer.getBackground() +  \"']\").prop(\"checked\",true);\n}\n\t\n\t\nfunction initNavigation(){\n\n\tlet elNavigation = $(\"#navigation\");\n\tlet sldMoveSpeed = $(\"#sldMoveSpeed\");\n\tlet lblMoveSpeed = $('#lblMoveSpeed');\n\t\n\telNavigation.append(createToolIcon(\n\t\tPotree.resourcePath + \"/icons/earth_controls_1.png\",\n        \"[title]tt.earth_control\",\n\t\tfunction(){viewer.setNavigationMode(Potree.EarthControls)}\n\t));\n\t\n\telNavigation.append(createToolIcon(\n\t\tPotree.resourcePath + \"/icons/fps_controls.png\",\n        \"[title]tt.flight_control\",\n\t\tfunction(){viewer.setNavigationMode(Potree.FirstPersonControls)}\n\t));\n\t\n\telNavigation.append(createToolIcon(\n\t\tPotree.resourcePath + \"/icons/orbit_controls.svg\",\n\t\t\"[title]tt.orbit_control\",\n\t\tfunction(){viewer.setNavigationMode(Potree.OrbitControls)}\n\t));\n\t\n\telNavigation.append(createToolIcon(\n\t\tPotree.resourcePath + \"/icons/focus.svg\",\n\t\t\"[title]tt.focus_control\",\n\t\tfunction(){viewer.fitToScreen()}\n\t));\n\t\n\telNavigation.append(createToolIcon(\n\t\tPotree.resourcePath + \"/icons/topview.svg\",\n\t\t\"[title]tt.top_view_control\",\n\t\tfunction(){viewer.setTopView()}\n\t));\n\t\n\telNavigation.append(createToolIcon(\n\t\tPotree.resourcePath + \"/icons/frontview.svg\",\n\t\t\"[title]tt.front_view_control\",\n\t\tfunction(){viewer.setFrontView()}\n\t));\n\t\n\telNavigation.append(createToolIcon(\n\t\tPotree.resourcePath + \"/icons/leftview.svg\",\n\t\t\"[title]tt.left_view_control\",\n\t\tfunction(){viewer.setLeftView()}\n\t));\n\t\n\tlet speedRange = new THREE.Vector2(1, 10*1000);\n\t\n\tlet toLinearSpeed = function(value){\n\t\treturn Math.pow(value, 4) * speedRange.y + speedRange.x;\n\t};\n\t\n\tlet toExpSpeed = function(value){\n\t\treturn Math.pow((value - speedRange.x) / speedRange.y, 1 / 4);\n\t};\n\n\tsldMoveSpeed.slider({\n\t\tvalue: toExpSpeed( viewer.getMoveSpeed() ),\n\t\tmin: 0,\n\t\tmax: 1,\n\t\tstep: 0.01,\n\t\tslide: function( event, ui ) { viewer.setMoveSpeed(toLinearSpeed(ui.value)); }\n\t});\n\t\n\tviewer.addEventListener(\"move_speed_changed\", function(event){\n\t\tlblMoveSpeed.html(viewer.getMoveSpeed().toFixed(1));\n\t\tsldMoveSpeed.slider({value: toExpSpeed(viewer.getMoveSpeed())});\n\t});\n\t\n\tlblMoveSpeed.html(viewer.getMoveSpeed().toFixed(1));\n}\n\nfunction initAnnotationDetails(){\n\t\n\t// annotation_details\n\tlet annotationPanel = $(\"#annotation_details\");\n\t\n\tlet registeredEvents = [];\n\t\n\tlet rebuild = () => {\n\t\tannotationPanel.empty();\n\t\tfor(let registeredEvent of registeredEvents){\n\t\t\tlet {type, dispatcher, callback} = registeredEvent;\n\t\t\tdispatcher.removeEventListener(type, callback);\n\t\t}\n\t\tregisteredEvents = [];\n\t\t\n\t\tlet checked = viewer.getShowAnnotations() ? \"checked\" : \"\";\n\t\t\n\t\tlet chkEnable = $(`\n\t\t\t<li>\n\t\t\t\t<label>\n\t\t\t\t\t<input type=\"checkbox\" id=\"chkShowAnnotations\" ${checked}\n\t\t\t\t\t\tonClick=\"viewer.setShowAnnotations(this.checked)\"/>\n\t\t\t\t\t<span data-i18n=\"annotations.show3D\"></span>\n\t\t\t\t</label>\n\t\t\t\t<label>\n\t\t\t\t\t<input type=\"checkbox\" id=\"chkShowAnnotationsMap\" ${checked}\n\t\t\t\t\t\tonClick=\"viewer.mapView.getAnnotationsLayer().setVisible(this.checked)\"/>\n\t\t\t\t\t<span data-i18n=\"annotations.showMap\"></span>\n\t\t\t\t</label>\n\t\t\t</li>\n\t\t`);\n\t\tannotationPanel.append(chkEnable);\n\t\t\n\t\t\n\t\t//let stack = viewer.scene.annotations.children.reverse().map(\n\t\t//\ta => ({annotation: a, container: annotationPanel}));\n\t\t\n\t\tlet stack = viewer.scene.annotations.children.map(\n\t\t\ta => ({annotation: a, container: annotationPanel}));\n\t\t\n\t\t\n\t\twhile(stack.length > 0){\n\t\t\t\n\t\t\tlet {annotation, container} = stack.shift();\n\t\t\t\n\t\t\t// \tU+25BA\t\\u25BA\n\t\t\t// \tU+25BC\t\\u25BC\n\t\t\t\n\t\t\tlet element = $(`\n\t\t\t\t<div class=\"annotation-item\" style=\"margin: 8px 20px\">\n\t\t\t\t\t<span class=\"annotation-main\">\n\t\t\t\t\t\t<span class=\"annotation-expand\">\\u25BA</span>\n\t\t\t\t\t\t<span class=\"annotation-label\">\n\t\t\t\t\t\t\t${annotation.title}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t`);\n\t\t\t\n\t\t\tlet elMain = element.find(\".annotation-main\");\n\t\t\tlet elExpand = element.find(\".annotation-expand\");\n\t\t\t\n\t\t\telExpand.css(\"display\", annotation.children.length > 0 ? \"block\" : \"none\");\n\t\t\t\n\t\t\tlet actions = [];\n\t\t\t{ // ACTIONS, INCLUDING GOTO LOCATION\n\t\t\t\tif(annotation.hasView()){\n\t\t\t\t\tlet action = new Potree.Action({\n\t\t\t\t\t\t\"icon\": Potree.resourcePath + \"/icons/target.svg\",\n\t\t\t\t\t\t\"onclick\": (e) => {annotation.moveHere(viewer.scene.camera)}\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\tactions.push(action);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tfor(let action of annotation.actions){\n\t\t\t\t\tactions.push(action);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tactions = actions.filter(\n\t\t\t\ta => a.showIn === undefined || a.showIn.includes(\"sidebar\"));\n\t\t\t\n\t\t\t// FIRST ACTION\n\t\t\tif(annotation.children.length === 0 && actions.length > 0){\n\t\t\t\tlet action = actions[0];\n\t\t\t\t\n\t\t\t\tlet elIcon = $(`<img src=\"${action.icon}\" class=\"annotation-icon\">`);\n\t\t\t\t\n\t\t\t\tif(action.tooltip){\n\t\t\t\t\telIcon.attr(\"title\", action.tooltip);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\telMain.append(elIcon);\n\t\t\t\telMain.click(e => action.onclick({annotation: annotation}));\n\t\t\t\telMain.mouseover(e => elIcon.css(\"opacity\", 1));\n\t\t\t\telMain.mouseout(e => elIcon.css(\"opacity\", 0.5));\n\t\t\t\t\n\t\t\t\t{\n\t\t\t\t\tlet iconChanged = e => {\n\t\t\t\t\t\telIcon.attr(\"src\", e.icon);\n\t\t\t\t\t};\n\t\t\t\t\t\n\t\t\t\t\taction.addEventListener(\"icon_changed\", iconChanged);\n\t\t\t\t\tregisteredEvents.push({\n\t\t\t\t\t\ttype: \"icon_changed\",\n\t\t\t\t\t\tdispatcher: action,\n\t\t\t\t\t\tcallback: iconChanged\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tactions.splice(0, 1);\n\t\t\t}\n\t\t\t\n\t\t\t// REMAINING ACTIONS\n\t\t\tfor(let action of actions){\n\t\t\t\t\n\t\t\t\tlet elIcon = $(`<img src=\"${action.icon}\" class=\"annotation-icon\">`);\n\t\t\t\t\n\t\t\t\tif(action.tooltip){\n\t\t\t\t\telIcon.attr(\"title\", action.tooltip);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\telIcon.click(e => {\n\t\t\t\t\taction.onclick({annotation: annotation}); \n\t\t\t\t\treturn false;\n\t\t\t\t});\n\t\t\t\telIcon.mouseover(e => elIcon.css(\"opacity\", 1));\n\t\t\t\telIcon.mouseout(e => elIcon.css(\"opacity\", 0.5));\n\t\t\t\t\n\t\t\t\t{\n\t\t\t\t\tlet iconChanged = e => {\n\t\t\t\t\t\telIcon.attr(\"src\", e.icon);\n\t\t\t\t\t};\n\t\t\t\t\t\n\t\t\t\t\taction.addEventListener(\"icon_changed\", iconChanged);\n\t\t\t\t\tregisteredEvents.push({\n\t\t\t\t\t\ttype: \"icon_changed\",\n\t\t\t\t\t\tdispatcher: action,\n\t\t\t\t\t\tcallback: iconChanged\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\telement.append(elIcon);\n\t\t\t}\n\t\t\t\n\t\t\telement.mouseover(e => annotation.setHighlighted(true));\n\t\t\telement.mouseout(e => annotation.setHighlighted(false));\n\t\t\t\n\t\t\tannotation.setHighlighted(false);\n\t\t\t\n\t\t\tcontainer.append(element);\n\t\t\t\n\t\t\tif(annotation.children.length > 0){\n\t\t\t\t\n\t\t\t\telement.click(e => {\n\t\t\t\t\t\n\t\t\t\t\tif(element.next().is(\":visible\")){\n\t\t\t\t\t\telExpand.html(\"\\u25BA\");\n\t\t\t\t\t}else{\n\t\t\t\t\t\telExpand.html(\"\\u25BC\");\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\telement.next().toggle(100);\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\t//let left = ((annotation.level()) * 20) + \"px\";\n\t\t\t\tlet left = \"20px\";\n\t\t\t\tlet childContainer = $(`<div style=\"margin: 0px; padding: 0px 0px 0px ${left}; display: none\"></div>`);\n\t\t\t\tfor(let child of annotation.children){\n\t\t\t\t\tcontainer.append(childContainer);\n\t\t\t\t\tstack.push({annotation: child, container: childContainer});\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t};\n\t\t\n\t\tannotationPanel.i18n();\n\t};\n\t\n\tlet annotationsChanged = e => {\n\t\trebuild();\n\t};\n\t\n\tviewer.addEventListener(\"scene_changed\", e => {\n\t\te.oldScene.annotations.removeEventListener(\"annotation_added\", annotationsChanged);\n\t\te.scene.annotations.addEventListener(\"annotation_added\", annotationsChanged);\n\t\t\n\t\trebuild();\n\t});\n\t\n\tviewer.scene.annotations.addEventListener(\"annotation_added\", annotationsChanged);\n\t\n\trebuild();\n}\n\nfunction initMeasurementDetails(){\n\t\n\tlet id = 0;\n\tlet trackedItems = new Map();\n\t\n\tlet removeIconPath = Potree.resourcePath + \"/icons/remove.svg\";\n\tlet mlist = $(\"#measurement_list\");\n\t\n\tlet createCoordinatesTable = (measurement) => {\n\t\t\n\t\tlet table = $(`\n\t\t\t<table class=\"measurement_value_table\">\n\t\t\t\t<tr>\n\t\t\t\t\t<th>x</th>\n\t\t\t\t\t<th>y</th>\n\t\t\t\t\t<th>z</th>\n\t\t\t\t</tr>\n\t\t\t</table>\n\t\t`);\n\t\t\n\t\tfor(let point of measurement.points){\n\t\t\tlet position = point instanceof THREE.Vector3 ? point : point.position;\n\t\t\t\n\t\t\tlet x = Potree.utils.addCommas(position.x.toFixed(3));\n\t\t\tlet y = Potree.utils.addCommas(position.y.toFixed(3));\n\t\t\tlet z = Potree.utils.addCommas(position.z.toFixed(3));\n\t\t\t\n\t\t\tlet row = $(`\n\t\t\t\t<tr>\n\t\t\t\t\t<td><span>${x}</span></td>\n\t\t\t\t\t<td><span>${y}</span></td>\n\t\t\t\t\t<td><span>${z}</span></td>\n\t\t\t\t</tr>\n\t\t\t`);\n\t\t\t\n\t\t\ttable.append(row);\n\t\t}\n\t\t\n\t\treturn table;\n\t};\n\t\n\tlet createAttributesTable = (measurement) => {\n\t\t\n\t\tlet elTable = $('<table class=\"measurement_value_table\"></table>');\n\t\t\n\t\tlet point = measurement.points[0];\n\t\t\n\t\tif(point.color){\n\t\t\tlet color = point.color;\n\t\t\tlet text = color.join(\", \");\n\t\t\t\n\t\t\telTable.append($(`\n\t\t\t\t<tr>\n\t\t\t\t\t<td>rgb</td>\n\t\t\t\t\t<td>${text}</td>\n\t\t\t\t</tr>\n\t\t\t`));\n\t\t}\n\t\t\n\t\treturn elTable;\n\t};\n\t\n\tclass MeasurePanel{\n\t\tconstructor(scene, measurement){\n\t\t\tthis.scene = scene;\n\t\t\tthis.measurement = measurement;\n\t\t\tthis.icon = null;\n\t\t\t\n\t\t\tthis.constructor.counter = (this.constructor.counter === undefined) ? 0 : this.constructor.counter + 1;\n\t\t\tthis.id = this.constructor.counter;\n\t\t\t\n\t\t\tlet title = measurement.name;\n\t\t\t\n\t\t\tthis.elPanel = $(`\n\t\t\t\t<span class=\"measurement_item\">\n\t\t\t\t\t<!-- HEADER -->\n\t\t\t\t\t<div class=\"measurement_header\" onclick=\"$(this).next().slideToggle(200)\">\n\t\t\t\t\t\t<span class=\"measurement_icon\"><img src=\"\" class=\"measurement_item_icon\" /></span>\n\t\t\t\t\t\t<span class=\"measurement_header_title\">${title}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t\t<!-- DETAIL -->\n\t\t\t\t\t<div class=\"measurement_content selectable\" style=\"display: none\">\n\t\t\t\t\t\t\n\t\t\t\t\t</div>\n\t\t\t\t</span>\n\t\t\t`);\n\t\t\t\n\t\t\tthis.elContentContainer = this.elPanel.find(\".measurement_content\");\n\t\t\tthis.elIcon = this.elPanel.find(\".measurement_item_icon\");\n\t\t\t\n\t\t\tthis._update = () => {this.update()};\n\t\t}\n\t\t\n\t\tdestroy(){\n\t\t\t\n\t\t}\n\t\t\n\t\tupdate(){\n\t\t\t\n\t\t}\n\t};\n\t\n\tclass DistancePanel extends MeasurePanel{\n\t\tconstructor(scene, measurement){\n\t\t\tsuper(scene, measurement);\n\t\t\t\n\t\t\tthis.typename = \"Distance\";\n\t\t\tthis.icon = Potree.resourcePath + \"/icons/distance.svg\";\n\t\t\tthis.elIcon.attr(\"src\", this.icon);\n\t\t\t\n\t\t\tthis.elContent = $(`\n\t\t\t\t<div>\n\t\t\t\t\t<span class=\"coordinates_table_container\"></span>\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\t<br>\n\t\t\t\t\t<table id=\"distances_table_${this.id}\" class=\"measurement_value_table\">\n\t\t\t\t\t</table>\n\t\t\t\t\t\n\t\t\t\t\t<!-- ACTIONS -->\n\t\t\t\t\t<div style=\"display: flex; margin-top: 12px\">\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t<span style=\"flex-grow: 1\"></span>\n\t\t\t\t\t\t<img class=\"measurement_action_remove\" src=\"${removeIconPath}\" style=\"width: 16px; height: 16px\"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`);\n\t\t\tthis.elContentContainer.append(this.elContent);\n\t\t\t\n\t\t\tlet elRemove = this.elContent.find(\".measurement_action_remove\");\n\t\t\telRemove.click(() => {this.scene.removeMeasurement(measurement)});\n\t\t\t\n\t\t\tthis.measurement.addEventListener(\"marker_added\", this._update);\n\t\t\tthis.measurement.addEventListener(\"marker_removed\", this._update);\n\t\t\tthis.measurement.addEventListener(\"marker_moved\", this._update);\n\t\t\t\n\t\t\tthis.update();\n\t\t}\n\t\t\n\t\tupdate(){\n\t\t\tlet elCoordiantesContainer = this.elContent.find(\".coordinates_table_container\");\n\t\t\telCoordiantesContainer.empty();\n\t\t\telCoordiantesContainer.append(createCoordinatesTable(this.measurement));\n\t\t\t\n\t\t\t\n\t\t\tlet positions = this.measurement.points.map(p => p.position);\n\t\t\tlet distances = [];\n\t\t\tfor(let i = 0; i < positions.length - 1; i++){\n\t\t\t\tlet d = positions[i].distanceTo(positions[i+1]);\n\t\t\t\tdistances.push(d.toFixed(3));\n\t\t\t}\n\t\t\t\n\t\t\tlet totalDistance = this.measurement.getTotalDistance().toFixed(3);\n\t\t\tlet elDistanceTable = this.elContent.find(`#distances_table_${this.id}`);\n\t\t\telDistanceTable.empty();\n\t\t\t\n\t\t\tfor(let i = 0; i < distances.length; i++){\n\t\t\t\tlet label = (i === 0) ? \"Distances: \" : \"\";\n\t\t\t\tlet distance = distances[i];\n\t\t\t\tlet elDistance = $(`\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<th>${label}</th>\n\t\t\t\t\t\t<td style=\"width: 100%; padding-left: 10px\">${distance}</td>\n\t\t\t\t\t</tr>`);\n\t\t\t\telDistanceTable.append(elDistance);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\tlet elTotal = $(`\n\t\t\t\t<tr>\n\t\t\t\t\t<th>Total: </td><td style=\"width: 100%; padding-left: 10px\">${totalDistance}</th>\n\t\t\t\t</tr>`);\n\t\t\telDistanceTable.append(elTotal);\n\t\t\t\n\t\t\t//let elDistance = this.elContent.find(`#distance_${this.id}`);\n\t\t\t//elDistance.html(totalDistance);\n\t\t}\n\t\t\n\t\tdestroy(){\n\t\t\tthis.elPanel.remove();\n\t\t\t\n\t\t\tthis.measurement.removeEventListener(\"marker_added\", this._update);\n\t\t\tthis.measurement.removeEventListener(\"marker_removed\", this._update);\n\t\t\tthis.measurement.removeEventListener(\"marker_moved\", this._update);\n\t\t}\n\t\t\n\t};\n\t\n\tclass PointPanel extends MeasurePanel{\n\t\tconstructor(scene, measurement){\n\t\t\tsuper(scene, measurement);\n\t\t\t\n\t\t\tthis.typename = \"Point\";\n\t\t\tthis.icon = Potree.resourcePath + \"/icons/point.svg\";\n\t\t\t\n\t\t\tthis.elIcon.attr(\"src\", this.icon);\n\t\t\t\n\t\t\tlet totalDistance = this.measurement.getTotalDistance().toFixed(3);\n\t\t\tthis.elContent = $(`\n\t\t\t\t<div>\n\t\t\t\t\t<span class=\"coordinates_table_container\"></span>\n\t\t\t\t\t\n\t\t\t\t\t<br>\n\t\t\t\t\t\n\t\t\t\t\t<span class=\"attributes_table_container\"></span>\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\t<!-- ACTIONS -->\n\t\t\t\t\t<div style=\"display: flex; margin-top: 12px\">\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t<span style=\"flex-grow: 1\"></span>\n\t\t\t\t\t\t<img class=\"measurement_action_remove\" src=\"${removeIconPath}\" style=\"width: 16px; height: 16px\"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`);\n\t\t\tthis.elContentContainer.append(this.elContent);\n\t\t\t\n\t\t\tlet elRemove = this.elContent.find(\".measurement_action_remove\");\n\t\t\telRemove.click(() => {this.scene.removeMeasurement(measurement)});\n\t\t\t\n\t\t\tthis.measurement.addEventListener(\"marker_added\", this._update);\n\t\t\tthis.measurement.addEventListener(\"marker_removed\", this._update);\n\t\t\tthis.measurement.addEventListener(\"marker_moved\", this._update);\n\t\t\t\n\t\t\tthis.update();\n\t\t}\n\t\t\n\t\tupdate(){\n\t\t\tlet elCoordiantesContainer = this.elContent.find(\".coordinates_table_container\");\n\t\t\telCoordiantesContainer.empty();\n\t\t\telCoordiantesContainer.append(createCoordinatesTable(this.measurement));\n\t\t\t\n\t\t\tlet elAttributesContainer = this.elContent.find(\".attributes_table_container\");\n\t\t\telAttributesContainer.empty();\n\t\t\telAttributesContainer.append(createAttributesTable(this.measurement));\n\t\t}\n\t\t\n\t\tdestroy(){\n\t\t\tthis.elPanel.remove();\n\t\t\t\n\t\t\tthis.measurement.removeEventListener(\"marker_added\", this._update);\n\t\t\tthis.measurement.removeEventListener(\"marker_removed\", this._update);\n\t\t\tthis.measurement.removeEventListener(\"marker_moved\", this._update);\n\t\t}\n\t\t\n\t};\n\t\n\tclass AreaPanel extends MeasurePanel{\n\t\tconstructor(scene, measurement){\n\t\t\tsuper(scene, measurement);\n\t\t\t\n\t\t\tthis.typename = \"Area\";\n\t\t\tthis.icon = Potree.resourcePath + \"/icons/area.svg\";\n\t\t\t\n\t\t\tthis.elIcon.attr(\"src\", this.icon);\n\t\t\t\n\t\t\tlet totalDistance = this.measurement.getTotalDistance().toFixed(3);\n\t\t\tthis.elContent = $(`\n\t\t\t\t<div>\n\t\t\t\t\t<span class=\"coordinates_table_container\"></span>\n\t\t\t\t\t\n\t\t\t\t\t<br>\n\t\t\t\t\t\n\t\t\t\t\t<span style=\"font-weight: bold\">Area: </span>\n\t\t\t\t\t<span id=\"measurement_area_${this.id}\"></span>\n\t\t\t\t\t\n\t\t\t\t\t<!-- ACTIONS -->\n\t\t\t\t\t<div style=\"display: flex; margin-top: 12px\">\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t<span style=\"flex-grow: 1\"></span>\n\t\t\t\t\t\t<img class=\"measurement_action_remove\" src=\"${removeIconPath}\" style=\"width: 16px; height: 16px\"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`);\n\t\t\tthis.elContentContainer.append(this.elContent);\n\t\t\t\n\t\t\tlet elRemove = this.elContent.find(\".measurement_action_remove\");\n\t\t\telRemove.click(() => {this.scene.removeMeasurement(measurement)});\n\t\t\t\n\t\t\tthis.measurement.addEventListener(\"marker_added\", this._update);\n\t\t\tthis.measurement.addEventListener(\"marker_removed\", this._update);\n\t\t\tthis.measurement.addEventListener(\"marker_moved\", this._update);\n\t\t\t\n\t\t\tthis.update();\n\t\t}\n\t\t\n\t\tupdate(){\n\t\t\tlet elCoordiantesContainer = this.elContent.find(\".coordinates_table_container\");\n\t\t\telCoordiantesContainer.empty();\n\t\t\telCoordiantesContainer.append(createCoordinatesTable(this.measurement));\n\t\t\t\n\t\t\tlet elArea = this.elContent.find(`#measurement_area_${this.id}`);\n\t\t\telArea.html(this.measurement.getArea().toFixed(3));\n\t\t}\n\t\t\n\t\tdestroy(){\n\t\t\tthis.elPanel.remove();\n\t\t\t\n\t\t\tthis.measurement.removeEventListener(\"marker_added\", this._update);\n\t\t\tthis.measurement.removeEventListener(\"marker_removed\", this._update);\n\t\t\tthis.measurement.removeEventListener(\"marker_moved\", this._update);\n\t\t}\n\t\t\n\t};\n\t\n\tclass AnglePanel extends MeasurePanel{\n\t\tconstructor(scene, measurement){\n\t\t\tsuper(scene, measurement);\n\t\t\t\n\t\t\tthis.typename = \"Angle\";\n\t\t\tthis.icon = Potree.resourcePath + \"/icons/angle.png\";\n\t\t\t\n\t\t\tthis.elIcon.attr(\"src\", this.icon);\n\t\t\t\n\t\t\tlet totalDistance = this.measurement.getTotalDistance().toFixed(3);\n\t\t\tthis.elContent = $(`\n\t\t\t\t<div>\n\t\t\t\t\t<span class=\"coordinates_table_container\"></span>\n\t\t\t\t\t\n\t\t\t\t\t<br>\n\t\t\t\t\t\n\t\t\t\t\t<table class=\"measurement_value_table\">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<th>\\u03b1</th>\n\t\t\t\t\t\t\t<th>\\u03b2</th>\n\t\t\t\t\t\t\t<th>\\u03b3</th>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td align=\"center\" id=\"angle_cell_alpha_${this.id}\" style=\"width: 33%\"></td>\n\t\t\t\t\t\t\t<td align=\"center\" id=\"angle_cell_betta_${this.id}\" style=\"width: 33%\"></td>\n\t\t\t\t\t\t\t<td align=\"center\" id=\"angle_cell_gamma_${this.id}\" style=\"width: 33%\"></td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t\t\n\t\t\t\t\t<!-- ACTIONS -->\n\t\t\t\t\t<div style=\"display: flex; margin-top: 12px\">\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t<span style=\"flex-grow: 1\"></span>\n\t\t\t\t\t\t<img class=\"measurement_action_remove\" src=\"${removeIconPath}\" style=\"width: 16px; height: 16px\"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`);\n\t\t\tthis.elContentContainer.append(this.elContent);\n\t\t\t\n\t\t\tlet elRemove = this.elContent.find(\".measurement_action_remove\");\n\t\t\telRemove.click(() => {this.scene.removeMeasurement(measurement)});\n\t\t\t\n\t\t\tthis.measurement.addEventListener(\"marker_added\", this._update);\n\t\t\tthis.measurement.addEventListener(\"marker_removed\", this._update);\n\t\t\tthis.measurement.addEventListener(\"marker_moved\", this._update);\n\t\t\t\n\t\t\tthis.update();\n\t\t}\n\t\t\n\t\tupdate(){\n\t\t\tlet elCoordiantesContainer = this.elContent.find(\".coordinates_table_container\");\n\t\t\telCoordiantesContainer.empty();\n\t\t\telCoordiantesContainer.append(createCoordinatesTable(this.measurement));\n\t\t\t\n\t\t\tlet angles = [];\n\t\t\tfor(let i = 0; i < this.measurement.points.length; i++){\n\t\t\t\tangles.push(this.measurement.getAngle(i) * (180.0/Math.PI));\n\t\t\t}\n\t\t\tangles = angles.map(a => a.toFixed(1) + '\\u00B0');\n\t\t\t\n\t\t\tlet elAlpha = this.elContent.find(`#angle_cell_alpha_${this.id}`);\n\t\t\tlet elBetta = this.elContent.find(`#angle_cell_betta_${this.id}`);\n\t\t\tlet elGamma = this.elContent.find(`#angle_cell_gamma_${this.id}`);\n\t\t\t\n\t\t\telAlpha.html(angles[0]);\n\t\t\telBetta.html(angles[1]);\n\t\t\telGamma.html(angles[2]);\n\t\t}\n\t\t\n\t\tdestroy(){\n\t\t\tthis.elPanel.remove();\n\t\t\t\n\t\t\tthis.measurement.removeEventListener(\"marker_added\", this._update);\n\t\t\tthis.measurement.removeEventListener(\"marker_removed\", this._update);\n\t\t\tthis.measurement.removeEventListener(\"marker_moved\", this._update);\n\t\t}\n\t\t\n\t};\n\t\n\tclass HeightPanel extends MeasurePanel{\n\t\tconstructor(scene, measurement){\n\t\t\tsuper(scene, measurement);\n\t\t\t\n\t\t\tthis.typename = \"Height\";\n\t\t\tthis.icon = Potree.resourcePath + \"/icons/height.svg\";\n\t\t\t\n\t\t\tthis.elIcon.attr(\"src\", this.icon);\n\t\t\t\n\t\t\tthis.elContent = $(`\n\t\t\t\t<div>\n\t\t\t\t\t<span class=\"coordinates_table_container\"></span>\n\t\t\t\t\t\n\t\t\t\t\t<br>\n\t\t\t\t\t\n\t\t\t\t\t<span id=\"height_label_${this.id}\">Height: </span><br>\n\t\t\t\t\t\n\t\t\t\t\t<!-- ACTIONS -->\n\t\t\t\t\t<div style=\"display: flex; margin-top: 12px\">\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t<span style=\"flex-grow: 1\"></span>\n\t\t\t\t\t\t<img class=\"measurement_action_remove\" src=\"${removeIconPath}\" style=\"width: 16px; height: 16px\"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`);\n\t\t\tthis.elContentContainer.append(this.elContent);\n\t\t\t\n\t\t\tlet elRemove = this.elContent.find(\".measurement_action_remove\");\n\t\t\telRemove.click(() => {this.scene.removeMeasurement(measurement)});\n\t\t\t\n\t\t\tthis.measurement.addEventListener(\"marker_added\", this._update);\n\t\t\tthis.measurement.addEventListener(\"marker_removed\", this._update);\n\t\t\tthis.measurement.addEventListener(\"marker_moved\", this._update);\n\t\t\t\n\t\t\tthis.update();\n\t\t}\n\t\t\n\t\tupdate(){\n\t\t\tlet elCoordiantesContainer = this.elContent.find(\".coordinates_table_container\");\n\t\t\telCoordiantesContainer.empty();\n\t\t\telCoordiantesContainer.append(createCoordinatesTable(this.measurement));\n\t\t\t\n\t\t\t{\n\t\t\t\tlet points = this.measurement.points;\n\t\t\t\t\t\n\t\t\t\tlet sorted = points.slice().sort( (a, b) => a.position.z - b.position.z );\n\t\t\t\tlet lowPoint = sorted[0].position.clone();\n\t\t\t\tlet highPoint = sorted[sorted.length - 1].position.clone();\n\t\t\t\tlet min = lowPoint.z;\n\t\t\t\tlet max = highPoint.z;\n\t\t\t\tlet height = max - min;\n\t\t\t\theight = height.toFixed(3);\n\t\t\t\t\n\t\t\t\tthis.elHeightLabel = this.elContent.find(`#height_label_${this.id}`);\n\t\t\t\tthis.elHeightLabel.html(`<b>Height:</b> ${height}`);\n\t\t\t}\n\t\t}\n\t\t\n\t\tdestroy(){\n\t\t\tthis.elPanel.remove();\n\t\t\t\n\t\t\tthis.measurement.removeEventListener(\"marker_added\", this._update);\n\t\t\tthis.measurement.removeEventListener(\"marker_removed\", this._update);\n\t\t\tthis.measurement.removeEventListener(\"marker_moved\", this._update);\n\t\t}\n\t\t\n\t};\n\t\n\tclass ProfilePanel extends MeasurePanel{\n\t\tconstructor(scene, measurement){\n\t\t\tsuper(scene, measurement);\n\t\t\t\n\t\t\tthis.typename = \"Profile\";\n\t\t\tthis.icon = Potree.resourcePath + \"/icons/profile.svg\";\n\t\t\t\n\t\t\tthis.elIcon.attr(\"src\", this.icon);\n\t\t\t\n\t\t\tlet labelID = \"lblProfileWidth_\" + this.id;\n\t\t\tlet sliderID = \"sldProfileWidth_\" + this.id;\n\t\t\t\n\t\t\tthis.elContent = $(`\n\t\t\t\t<div>\n\t\t\t\t\t<span class=\"coordinates_table_container\"></span>\n\t\t\t\t\t\n\t\t\t\t\t<br>\n\t\t\t\t\t\n\t\t\t\t\t<span style=\"display:flex\">\n\t\t\t\t\t\t<span style=\"display:flex; align-items: center; padding-right: 10px\">Width: </span>\n\t\t\t\t\t\t<input id=\"${sliderID}\" name=\"${sliderID}\" value=\"5.06\" style=\"flex-grow: 1; width:100%\">\n\t\t\t\t\t</span>\n\t\t\t\t\t<br>\n\t\t\t\t\t\n\t\t\t\t\t<input type=\"button\" value=\"Prepare Download\" id=\"download_profile_${this.id}\"/>\n\t\t\t\t\t<span id=\"download_profile_status_${this.id}\"></span>\n\t\t\t\t\t\n\t\t\t\t\t<br>\n\t\t\t\t\t\n\t\t\t\t\t<input type=\"button\" id=\"show_2d_profile_${this.id}\" value=\"show 2d profile\" style=\"width: 100%\"/>\n\t\t\t\t\t\n\t\t\t\t\t<!-- ACTIONS -->\n\t\t\t\t\t<div style=\"display: flex; margin-top: 12px\">\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t<span style=\"flex-grow: 1\"></span>\n\t\t\t\t\t\t<img class=\"measurement_action_remove\" src=\"${removeIconPath}\" style=\"width: 16px; height: 16px\"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`);\n\t\t\tthis.elContentContainer.append(this.elContent);\n\t\t\tthis.elShow2DProfile = this.elContent.find(`#show_2d_profile_${this.id}`);\n\t\t\tthis.elShow2DProfile.click(() => {\n\t\t\t\tviewer.profileWindow.show();\n\t\t\t\tviewer.profileWindowController.setProfile(measurement);\n\t\t\t\t//viewer.profileWindow.draw(measurement);\n\t\t\t});\n\t\t\t\n\t\t\t{ // download\n\t\t\t\tthis.elDownloadButton = this.elContent.find(`#download_profile_${this.id}`);\n\t\t\t\t\n\t\t\t\tif(viewer.server){\n\t\t\t\t\tthis.elDownloadButton.click(() => this.download());\n\t\t\t\t}else{\n\t\t\t\t\tthis.elDownloadButton.hide();\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t{ // width spinner\n\t\t\t\tlet elWidthLabel = this.elContent.find(`#${labelID}`);\n\t\t\t\tlet elWidthSlider = this.elContent.find(`#${sliderID}`);\n\t\t\t\t\n\t\t\t\tlet startValue = 0;\n\t\t\t\t\n\t\t\t\telWidthSlider.spinner({\n\t\t\t\t\tmin: 0,\n\t\t\t\t\tmax: 10*1000*1000,\n\t\t\t\t\tstep: 0.01,\n\t\t\t\t\tnumberFormat: \"n\",\n\t\t\t\t\tstart: (event, ui) => {\n\t\t\t\t\t\tstartValue = measurement.getWidth();\n\t\t\t\t\t},\n\t\t\t\t\tspin: (event, ui) => {\n\t\t\t\t\t\tlet value = elWidthSlider.spinner(\"value\");\n\t\t\t\t\t\tmeasurement.setWidth(value);\n\t\t\t\t\t},\n\t\t\t\t\tchange: (event, ui) => {\n\t\t\t\t\t\tlet value = elWidthSlider.spinner(\"value\");\n\t\t\t\t\t\tmeasurement.setWidth(value);\n\t\t\t\t\t},\n\t\t\t\t\tstop: (event, ui) => {\n\t\t\t\t\t\tlet value = elWidthSlider.spinner(\"value\");\n\t\t\t\t\t\tmeasurement.setWidth(value);\n\t\t\t\t\t},\n\t\t\t\t\tincremental: (count) => {\n\t\t\t\t\t\tlet value = elWidthSlider.spinner(\"value\");\n\t\t\t\t\t\tlet step = elWidthSlider.spinner(\"option\", \"step\");\n\t\t\t\t\t\t\n\t\t\t\t\t\tlet delta = value * 0.05;\n\t\t\t\t\t\tlet increments = Math.max(1, parseInt(delta / step));\n\t\t\t\t\t\t\n\t\t\t\t\t\treturn increments;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\telWidthSlider.spinner(\"value\", measurement.getWidth());\n\t\t\t\telWidthSlider.spinner(\"widget\").css(\"width\", \"100%\");\n\n\t\t\t\tthis.widthListener = (event) => {\n\t\t\t\t\tlet value = elWidthSlider.spinner(\"value\");\n\t\t\t\t\tif(value !== measurement.getWidth()){\n\t\t\t\t\t\telWidthSlider.spinner(\"value\", measurement.getWidth());\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\tmeasurement.addEventListener(\"width_changed\", this.widthListener);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\tlet elRemove = this.elContent.find(\".measurement_action_remove\");\n\t\t\telRemove.click(() => {this.scene.removeProfile(measurement)});\n\t\t\t\n\t\t\tthis.measurement.addEventListener(\"marker_added\", this._update);\n\t\t\tthis.measurement.addEventListener(\"marker_removed\", this._update);\n\t\t\tthis.measurement.addEventListener(\"marker_moved\", this._update);\n\t\t\t\n\t\t\tthis.update();\n\t\t}\n\t\t\n\t\tupdate(){\n\t\t\tlet elCoordiantesContainer = this.elContent.find(\".coordinates_table_container\");\n\t\t\telCoordiantesContainer.empty();\n\t\t\tlet coordinatesTable = createCoordinatesTable(this.measurement);\n\t\t\t\n\t\t\tlet validate = input => {\n\t\t\t\treturn !isNaN(Number(input));\n\t\t\t};\n\t\t\t\n\t\t\tlet cells = coordinatesTable.find(\"span\");\n\t\t\tcells.attr(\"contenteditable\", \"true\");\n\t\t\t\n\t\t\tcells = cells.toArray();\n\t\t\t\n\t\t\tfor(let i = 0; i < cells.length; i++){\n\t\t\t\tlet cell = cells[i];\n\t\t\t\tlet measure = this.measurement;\n\t\t\t\tlet updateCallback = this._update;\n\t\t\t\t\n\t\t\t\tlet assignValue = () => {\n\t\t\t\t\tlet text = Potree.utils.removeCommas($(cell).html());\n\t\t\t\t\t\n\t\t\t\t\tlet num = Number(text);\n\t\t\t\t\t\n\t\t\t\t\tif(!isNaN(num)){\n\t\t\t\t\t\t$(cell).removeClass(\"invalid_value\");\n\t\t\t\t\t\t\n\t\t\t\t\t\tmeasure.removeEventListener(\"marker_moved\", updateCallback);\n\t\t\t\t\t\t\n\t\t\t\t\t\tlet index = parseInt(i / 3);\n\t\t\t\t\t\tlet coordinateComponent = i % 3;\n\t\t\t\t\t\t\n\t\t\t\t\t\tlet position = measure.points[index].clone();\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(coordinateComponent === 0){\n\t\t\t\t\t\t\tposition.x = num;\n\t\t\t\t\t\t} else if(coordinateComponent === 1){\n\t\t\t\t\t\t\tposition.y = num;\n\t\t\t\t\t\t} else if(coordinateComponent === 2){\n\t\t\t\t\t\t\tposition.z = num;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tmeasure.setPosition(index, position);\n\t\t\t\t\t\tmeasure.addEventListener(\"marker_moved\", updateCallback);\n\t\t\t\t\t}else{\n\t\t\t\t\t\t$(cell).addClass(\"invalid_value\");\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\t$(cell).on(\"keypress\", (e) => {\n\t\t\t\t\tif(e.which === 13){\n\t\t\t\t\t\tassignValue();\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\t$(cell).focusout(() => assignValue());\n\t\t\t\t\n\t\t\t\t$(cell).on(\"input\", function(e){\n\t\t\t\t\tlet text = Potree.utils.removeCommas($(this).html());\n\t\t\t\t\t\n\t\t\t\t\tlet num = Number(text);\n\t\t\t\t\t\n\t\t\t\t\tif(!isNaN(num)){\n\t\t\t\t\t\t$(this).removeClass(\"invalid_value\");\n\t\t\t\t\t}else{\n\t\t\t\t\t\t$(this).addClass(\"invalid_value\");\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\telCoordiantesContainer.append(coordinatesTable);\n\t\t}\n\t\t\n\t\tdownload(){\n\t\t\t\n\t\t\tlet profile = this.measurement;\n\t\t\tlet boxes = profile.getSegmentMatrices()\n\t\t\t\t.map(m => m.elements.join(\",\"))\n\t\t\t\t.join(\",\");\n\t\t\t\n\t\t\tlet minLOD = 0;\n\t\t\tlet maxLOD = 100;\n\t\t\t\n\t\t\tlet pcs = [];\n\t\t\tfor(let pointcloud of this.scene.pointclouds){\n\t\t\t\tlet urlIsAbsolute = new RegExp('^(?:[a-z]+:)?//', 'i').test(pointcloud.pcoGeometry.url);\n\t\t\t\tlet pc = \"\";\n\t\t\t\tif(urlIsAbsolute){\n\t\t\t\t\tpc = pointcloud.pcoGeometry.url;\n\t\t\t\t}else{\n\t\t\t\t\tpc = `${window.location.href}/../${pointcloud.pcoGeometry.url}`;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tpcs.push(pc);\n\t\t\t}\n\t\t\t\n\t\t\tlet pc = pcs\n\t\t\t\t.map( v => `pointcloud[]=${v}`)\n\t\t\t\t.join(\"&\");\n\t\t\t\n\t\t\tlet request = `${viewer.server}/start_extract_region_worker?minLOD=${minLOD}&maxLOD=${maxLOD}&box=${boxes}&${pc}`;\n\t\t\t//console.log(request);\n\t\t\t\n\t\t\tlet elMessage = this.elContent.find(`#download_profile_status_${this.id}`);\n\t\t\telMessage.html(\"sending request...\");\n\t\t\t\n\t\t\tlet workerID = null;\n\t\t\t\n\t\t\tlet start = new Date().getTime();\n\t\t\t\n\t\t\tlet observe = () => {\n\t\t\t\tlet request = `${viewer.server}/observe_status?workerID=${workerID}`;\n\t\t\t\t\n\t\t\t\tlet loaded = 0;\n\t\t\t\t\n\t\t\t\tlet xhr = new XMLHttpRequest();\n\t\t\t\txhr.withCredentials = true;\n\t\t\t\txhr.addEventListener(\"progress\", e => {\n\t\t\t\t\tlet nowLoaded = e.loaded;\n\t\t\t\t\t\n\t\t\t\t\tlet response = xhr.responseText.substring(loaded, nowLoaded);\n\t\t\t\t\tresponse = JSON.parse(response);\n\t\t\t\t\t\n\t\t\t\t\tif(response.status === \"FINISHED\"){\n\t\t\t\t\t\telMessage.html(`<br><a href=\"${viewer.server}/get_las?workerID=${workerID}\">Download ready</a>`);\n\t\t\t\t\t}else{\n\t\t\t\t\t\tlet current = new Date().getTime();\n\t\t\t\t\t\tlet duration = (current - start);\n\t\t\t\t\t\tlet seconds = parseInt(duration / 1000);\n\t\t\t\t\t\t\n\t\t\t\t\t\telMessage.html(`processing request... ${seconds}s`);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\tloaded = nowLoaded;\n\t\t\t\t});\n\t\t\t\txhr.open('GET', request, true);\n\t\t\t\txhr.send(null)\n\t\t\t};\n\t\t\t\n\t\t\tlet xhr = new XMLHttpRequest();\n\t\t\txhr.withCredentials = true;\n\t\t\txhr.onreadystatechange = () => {\n\t\t\t\tif (xhr.readyState == XMLHttpRequest.DONE) {\n\t\t\t\t\t//alert(xhr.responseText);\n\t\t\t\t\tlet res = JSON.parse(xhr.responseText);\n\t\t\t\t\tconsole.log(res);\n\t\t\t\t\t\n\t\t\t\t\tif(res.status === \"OK\"){\n\t\t\t\t\t\tworkerID = res.workerID;\n\t\t\t\t\t\telMessage.html(\"request is being processed\");\n\t\t\t\t\t\t//checkUntilFinished();\n\t\t\t\t\t\tobserve();\n\t\t\t\t\t}else if(res.status === \"ERROR_POINT_PROCESSED_ESTIMATE_TOO_LARGE\"){\n\t\t\t\t\t\telMessage.html(\"Too many candidate points in selection.\");\n\t\t\t\t\t}else{\n\t\t\t\t\t\telMessage.html(`${res.status}`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\txhr.open('GET', request, true);\n\t\t\txhr.send(null);\n\t\t\t\n\t\t}\n\t\t\n\t\tdestroy(){\n\t\t\tthis.elPanel.remove();\n\t\t\t\n\t\t\tthis.measurement.removeEventListener(\"marker_added\", this._update);\n\t\t\tthis.measurement.removeEventListener(\"marker_removed\", this._update);\n\t\t\tthis.measurement.removeEventListener(\"marker_moved\", this._update);\n\t\t\tthis.measurement.removeEventListener(\"width_changed\", this.widthListener);\n\t\t}\n\t\t\n\t};\n\t\n\tclass VolumePanel extends MeasurePanel{\n\t\tconstructor(scene, measurement){\n\t\t\tsuper(scene, measurement);\n\t\t\t\n\t\t\tthis.typename = \"Volume\";\n\t\t\tthis.icon = Potree.resourcePath + \"/icons/volume.svg\";\n\t\t\t\n\t\t\tthis.elIcon.attr(\"src\", this.icon);\n\t\t\t\n\t\t\tthis.values = {};\n\t\t\t\n\t\t\tthis.elContent = $(`\n\t\t\t\t<div>\n\n\t\t\t\t\t<div style=\"width: 100%;\">\n\t\t\t\t\t\t<div style=\"display:inline-flex; width: 100%; \">\n\t\t\t\t\t\t\t<span class=\"input-grid-label\">x</span>\n\t\t\t\t\t\t\t<span class=\"input-grid-label\">y</span>\n\t\t\t\t\t\t\t<span class=\"input-grid-label\">z</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div style=\"display:inline-flex; width: 100%;\">\n\t\t\t\t\t\t\t<span class=\"input-grid-cell\"><input type=\"text\" id=\"volume_input_x_${measurement.id}\"/></span>\n\t\t\t\t\t\t\t<span class=\"input-grid-cell\"><input type=\"text\" id=\"volume_input_y_${measurement.id}\"/></span>\n\t\t\t\t\t\t\t<span class=\"input-grid-cell\"><input type=\"text\" id=\"volume_input_z_${measurement.id}\"/></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t\t<div style=\"width: 100%;\">\n\t\t\t\t\t\t<div style=\"display:inline-flex; width: 100%; \">\n\t\t\t\t\t\t\t<span class=\"input-grid-label\">length</span>\n\t\t\t\t\t\t\t<span class=\"input-grid-label\">width</span>\n\t\t\t\t\t\t\t<span class=\"input-grid-label\">height</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div style=\"display:inline-flex; width: 100%;\">\n\t\t\t\t\t\t\t<span class=\"input-grid-cell\"><input type=\"text\" id=\"volume_input_length_${measurement.id}\"/></span>\n\t\t\t\t\t\t\t<span class=\"input-grid-cell\"><input type=\"text\" id=\"volume_input_width_${measurement.id}\"/></span>\n\t\t\t\t\t\t\t<span class=\"input-grid-cell\"><input type=\"text\" id=\"volume_input_height_${measurement.id}\"/></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div style=\"width: 100%;\">\n\t\t\t\t\t\t<div style=\"display:inline-flex; width: 100%; \">\n\t\t\t\t\t\t\t<span class=\"input-grid-label\">&alpha;</span>\n\t\t\t\t\t\t\t<span class=\"input-grid-label\">&beta;</span>\n\t\t\t\t\t\t\t<span class=\"input-grid-label\">&gamma;</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div style=\"display:inline-flex; width: 100%;\">\n\t\t\t\t\t\t\t<span class=\"input-grid-cell\"><input type=\"text\" id=\"volume_input_alpha_${measurement.id}\"/></span>\n\t\t\t\t\t\t\t<span class=\"input-grid-cell\"><input type=\"text\" id=\"volume_input_beta_${measurement.id}\"/></span>\n\t\t\t\t\t\t\t<span class=\"input-grid-cell\"><input type=\"text\" id=\"volume_input_gamma_${measurement.id}\"/></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t\t<label><input type=\"checkbox\" id=\"chkClip_${this.measurement.id}\"/><span data-i18n=\"measurements.clip\"></span></label>\n\t\t\t\t\t<label><input type=\"checkbox\" id=\"chkVisible_${this.measurement.id}\"/><span data-i18n=\"measurements.show\"></span></label>\n\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\t<input type=\"button\" value=\"Prepare Download\" id=\"download_volume_${this.id}\"/>\n\t\t\t\t\t<span id=\"download_volume_status_${this.id}\"></span>\n\t\t\t\t\t\n\t\t\t\t\t<!-- ACTIONS -->\n\t\t\t\t\t<div style=\"display: flex; margin-top: 12px\">\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t<span style=\"flex-grow: 1\"></span>\n\t\t\t\t\t\t<img class=\"measurement_action_remove\" src=\"${removeIconPath}\" style=\"width: 16px; height: 16px\"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`);\n\t\t\tthis.elContentContainer.append(this.elContent);\n\t\t\t\n\t\t\tthis.elClip = this.elContent.find(`#chkClip_${this.measurement.id}`);\n\t\t\tthis.elVisible = this.elContent.find(`#chkVisible_${this.measurement.id}`);\n\t\t\t\n\t\t\tthis.elClip.click( () => {\n\t\t\t\tthis.measurement.clip = this.elClip.is(\":checked\");\n\t\t\t});\n\t\t\t\n\t\t\tthis.elVisible.click( () => {\n\t\t\t\tthis.measurement.visible = this.elVisible.is(\":checked\");\n\t\t\t});\n\t\t\t\n\t\t\tthis.elClip.prop('checked', this.measurement.clip);\n\t\t\tthis.elVisible.prop('checked', this.measurement.visible);\n\t\t\t\n\t\t\tthis.elX = this.elContent.find(`#volume_input_x_${this.measurement.id}`);\n\t\t\tthis.elY = this.elContent.find(`#volume_input_y_${this.measurement.id}`);\n\t\t\tthis.elZ = this.elContent.find(`#volume_input_z_${this.measurement.id}`);\n\t\t\t\n\t\t\tthis.elLength = this.elContent.find(`#volume_input_length_${this.measurement.id}`);\n\t\t\tthis.elWidth  = this.elContent.find(`#volume_input_width_${this.measurement.id}`);\n\t\t\tthis.elHeight = this.elContent.find(`#volume_input_height_${this.measurement.id}`);\n\t\t\t\n\t\t\tthis.elAlpha = this.elContent.find(`#volume_input_alpha_${this.measurement.id}`);\n\t\t\tthis.elBeta = this.elContent.find(`#volume_input_beta_${this.measurement.id}`);\n\t\t\tthis.elGamma = this.elContent.find(`#volume_input_gamma_${this.measurement.id}`);\n\t\t\t\n\t\t\t\n\t\t\tthis.elX.on(\"change\", (e) => {\n\t\t\t\tlet val = this.elX.val();\n\t\t\t\tif($.isNumeric(val)){\n\t\t\t\t\tval = parseFloat(val);\n\t\t\t\t\t\n\t\t\t\t\tthis.measurement.position.x = val;\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\tthis.elY.on(\"change\", (e) => {\n\t\t\t\tlet val = this.elY.val();\n\t\t\t\tif($.isNumeric(val)){\n\t\t\t\t\tval = parseFloat(val);\n\t\t\t\t\t\n\t\t\t\t\tthis.measurement.position.y = val;\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\tthis.elZ.on(\"change\", (e) => {\n\t\t\t\tlet val = this.elZ.val();\n\t\t\t\tif($.isNumeric(val)){\n\t\t\t\t\tval = parseFloat(val);\n\t\t\t\t\t\n\t\t\t\t\tthis.measurement.position.z = val;\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\tthis.elLength.on(\"change\", (e) => {\n\t\t\t\tlet val = this.elLength.val();\n\t\t\t\tif($.isNumeric(val)){\n\t\t\t\t\tval = parseFloat(val);\n\t\t\t\t\t\n\t\t\t\t\tthis.measurement.scale.x = val;\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\tthis.elWidth.on(\"change\", (e) => {\n\t\t\t\tlet val = this.elWidth.val();\n\t\t\t\tif($.isNumeric(val)){\n\t\t\t\t\tval = parseFloat(val);\n\t\t\t\t\t\n\t\t\t\t\tthis.measurement.scale.y = val;\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\tthis.elHeight.on(\"change\", (e) => {\n\t\t\t\tlet val = this.elHeight.val();\n\t\t\t\tif($.isNumeric(val)){\n\t\t\t\t\tval = parseFloat(val);\n\t\t\t\t\t\n\t\t\t\t\tthis.measurement.scale.z = val;\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\tlet toRadians = (d) => Math.PI * d / 180;\n\t\t\t\n\t\t\tthis.elAlpha.on(\"change\", (e) => {\n\t\t\t\tlet val = this.elAlpha.val();\n\t\t\t\tif($.isNumeric(val)){\n\t\t\t\t\tval = parseFloat(val);\n\t\t\t\t\t\n\t\t\t\t\tthis.measurement.rotation.x = toRadians(val);\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\tthis.elBeta.on(\"change\", (e) => {\n\t\t\t\tlet val = this.elBeta.val();\n\t\t\t\tif($.isNumeric(val)){\n\t\t\t\t\tval = parseFloat(val);\n\t\t\t\t\t\n\t\t\t\t\tthis.measurement.rotation.y = toRadians(val);\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\tthis.elGamma.on(\"change\", (e) => {\n\t\t\t\tlet val = this.elGamma.val();\n\t\t\t\tif($.isNumeric(val)){\n\t\t\t\t\tval = parseFloat(val);\n\t\t\t\t\t\n\t\t\t\t\tthis.measurement.rotation.z = toRadians(val);\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tthis.elDownloadButton = this.elContent.find(`#download_volume_${this.id}`);\n\t\t\t\n\t\t\tif(viewer.server){\n\t\t\t\tthis.elDownloadButton.click(() => this.download());\n\t\t\t}else{\n\t\t\t\tthis.elDownloadButton.hide();\n\t\t\t}\n\t\t\t\n\t\t\tlet elRemove = this.elContent.find(\".measurement_action_remove\");\n\t\t\telRemove.click(() => {this.scene.removeVolume(measurement)});\n\t\t\t\n\t\t\tthis.measurement.addEventListener(\"marker_added\", this._update);\n\t\t\tthis.measurement.addEventListener(\"marker_removed\", this._update);\n\t\t\tthis.measurement.addEventListener(\"marker_moved\", this._update);\n\t\t\t\n\t\t\tthis.elContent.i18n();\n\t\t\t\n\t\t\tthis.update();\n\t\t}\n\t\t\n\t\tdownload(){\n\t\t\t\n\t\t\tlet volume = this.measurement;\n\t\t\tlet boxes = volume.matrixWorld.elements.join(\",\");\n\t\t\tlet minLOD = 0;\n\t\t\tlet maxLOD = 100;\n\t\t\t\n\t\t\tlet pcs = [];\n\t\t\tfor(let pointcloud of this.scene.pointclouds){\n\t\t\t\tlet urlIsAbsolute = new RegExp('^(?:[a-z]+:)?//', 'i').test(pointcloud.pcoGeometry.url);\n\t\t\t\tlet pc = \"\";\n\t\t\t\tif(urlIsAbsolute){\n\t\t\t\t\tpc = pointcloud.pcoGeometry.url;\n\t\t\t\t}else{\n\t\t\t\t\tpc = `${window.location.href}/../${pointcloud.pcoGeometry.url}`;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tpcs.push(pc);\n\t\t\t}\n\t\t\t\n\t\t\tlet pc = pcs\n\t\t\t\t.map( v => `pointcloud[]=${v}`)\n\t\t\t\t.join(\"&\");\n\t\t\t\n\t\t\tlet request = `${viewer.server}/start_extract_region_worker?minLOD=${minLOD}&maxLOD=${maxLOD}&box=${boxes}&${pc}`;//&pointCloud=${pc}`;\n\t\t\t//console.log(request);\n\t\t\t\n\t\t\tlet elMessage = this.elContent.find(`#download_volume_status_${this.id}`);\n\t\t\telMessage.html(\"sending request...\");\n\t\t\t\n\t\t\tlet workerID = null;\n\t\t\t\n\t\t\tlet start = new Date().getTime();\n\t\t\t\n\t\t\tlet observe = () => {\n\t\t\t\tlet request = `${viewer.server}/observe_status?workerID=${workerID}`;\n\t\t\t\t\n\t\t\t\tlet loaded = 0;\n\t\t\t\t\n\t\t\t\tlet xhr = new XMLHttpRequest();\n\t\t\t\txhr.withCredentials = true;\n\t\t\t\txhr.addEventListener(\"progress\", e => {\n\t\t\t\t\tlet nowLoaded = e.loaded;\n\t\t\t\t\t\n\t\t\t\t\tlet response = xhr.responseText.substring(loaded, nowLoaded);\n\t\t\t\t\tresponse = JSON.parse(response);\n\t\t\t\t\t\n\t\t\t\t\tif(response.status === \"FINISHED\"){\n\t\t\t\t\t\telMessage.html(`<br><a href=\"${viewer.server}/get_las?workerID=${workerID}\">Download ready</a>`);\n\t\t\t\t\t}else{\n\t\t\t\t\t\tlet current = new Date().getTime();\n\t\t\t\t\t\tlet duration = (current - start);\n\t\t\t\t\t\tlet seconds = parseInt(duration / 1000);\n\t\t\t\t\t\t\n\t\t\t\t\t\telMessage.html(`processing request... ${seconds}s`);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\tloaded = nowLoaded;\n\t\t\t\t});\n\t\t\t\txhr.open('GET', request, true);\n\t\t\t\txhr.send(null)\n\t\t\t};\n\t\t\t\n\t\t\tlet xhr = new XMLHttpRequest();\n\t\t\txhr.withCredentials = true;\n\t\t\txhr.onreadystatechange = () => {\n\t\t\t\tif (xhr.readyState == XMLHttpRequest.DONE) {\n\t\t\t\t\t//alert(xhr.responseText);\n\t\t\t\t\tlet res = JSON.parse(xhr.responseText);\n\t\t\t\t\tconsole.log(res);\n\t\t\t\t\t\n\t\t\t\t\tif(res.status === \"OK\"){\n\t\t\t\t\t\tworkerID = res.workerID;\n\t\t\t\t\t\telMessage.html(\"request is being processed\");\n\t\t\t\t\t\t//checkUntilFinished();\n\t\t\t\t\t\tobserve();\n\t\t\t\t\t}else if(res.status === \"ERROR_POINT_PROCESSED_ESTIMATE_TOO_LARGE\"){\n\t\t\t\t\t\telMessage.html(\"Too many candidate points in selection.\");\n\t\t\t\t\t}else{\n\t\t\t\t\t\telMessage.html(`${res.status}`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\txhr.open('GET', request, true);\n\t\t\txhr.send(null);\n\t\t\t\n\t\t}\n\t\t\n\t\tupdate(){\n\t\t\tif(!this.destroyed){\n\t\t\t\trequestAnimationFrame(this._update);\n\t\t\t}\n\t\t\t\n\t\t\tif(!this.elContent.is(\":visible\")){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tif(this.measurement.position.x !== this.values.x){\n\t\t\t\tthis.elX.val(this.measurement.position.x.toFixed(3));\n\t\t\t\tthis.values.x = this.measurement.position.x;\n\t\t\t}\n\t\t\t\n\t\t\tif(this.measurement.position.y !== this.values.y){\n\t\t\t\tlet elY = this.elContent.find(`#volume_input_y_${this.measurement.id}`);\n\t\t\t\telY.val(this.measurement.position.y.toFixed(3));\n\t\t\t\tthis.values.y = this.measurement.position.y;\n\t\t\t}\n\t\t\t\n\t\t\tif(this.measurement.position.z !== this.values.z){\n\t\t\t\tlet elZ = this.elContent.find(`#volume_input_z_${this.measurement.id}`);\n\t\t\t\telZ.val(this.measurement.position.z.toFixed(3));\n\t\t\t\tthis.values.z = this.measurement.position.z;\n\t\t\t}\n\t\t\t\n\t\t\tif(this.measurement.scale.x !== this.values.length){\n\t\t\t\tthis.elLength.val(this.measurement.scale.x.toFixed(3));\n\t\t\t\tthis.values.length = this.measurement.scale.x;\n\t\t\t}\n\t\t\t\n\t\t\tif(this.measurement.scale.y !== this.values.width){\n\t\t\t\tthis.elWidth.val(this.measurement.scale.y.toFixed(3));\n\t\t\t\tthis.values.width = this.measurement.scale.y;\n\t\t\t}\n\t\t\t\n\t\t\tif(this.measurement.scale.z !== this.values.height){\n\t\t\t\tthis.elHeight.val(this.measurement.scale.z.toFixed(3));\n\t\t\t\tthis.values.height = this.measurement.scale.z;\n\t\t\t}\n\t\t\t\n\t\t\tlet toDegrees = (r) => 180 * r / Math.PI;\n\t\t\t\n\t\t\tif(this.measurement.rotation.x !== this.values.alpha){\n\t\t\t\tthis.elAlpha.val(toDegrees(this.measurement.rotation.x).toFixed(1));\n\t\t\t\tthis.values.alpha = this.measurement.rotation.x;\n\t\t\t}\n\t\t\t\n\t\t\tif(this.measurement.rotation.y !== this.values.beta){\n\t\t\t\tthis.elBeta.val(toDegrees(this.measurement.rotation.y).toFixed(1));\n\t\t\t\tthis.values.beta = this.measurement.rotation.y;\n\t\t\t}\n\t\t\t\n\t\t\tif(this.measurement.rotation.z !== this.values.gamma){\n\t\t\t\tthis.elGamma.val(toDegrees(this.measurement.rotation.z).toFixed(1));\n\t\t\t\tthis.values.gamma = this.measurement.rotation.z;\n\t\t\t}\n\t\t\t\n\t\t}\n\t\t\n\t\tdestroy(){\n\t\t\tthis.elPanel.remove();\n\t\t\t\n\t\t\tthis.measurement.removeEventListener(\"marker_added\", this._update);\n\t\t\tthis.measurement.removeEventListener(\"marker_removed\", this._update);\n\t\t\tthis.measurement.removeEventListener(\"marker_moved\", this._update);\n\t\t\t\n\t\t\tthis.destroyed = true;\n\t\t}\n\t\t\n\t};\n\t\n\tlet TYPE = {\n\t\tDISTANCE: {panel: DistancePanel},\n\t\tAREA: {panel: AreaPanel},\n\t\tPOINT: {panel: PointPanel},\n\t\tANGLE: {panel: AnglePanel},\n\t\tHEIGHT: {panel: HeightPanel},\n\t\tPROFILE: {panel: ProfilePanel},\n\t\tVOLUME: {panel: VolumePanel},\n\t};\n\t\n\tlet getType = (measurement) => {\n\t\tif(measurement instanceof Potree.Measure){\n\t\t\tif(measurement.showDistances && !measurement.showArea && !measurement.showAngles){\n\t\t\t\treturn TYPE.DISTANCE;\n\t\t\t}else if(measurement.showDistances && measurement.showArea && !measurement.showAngles){\n\t\t\t\treturn TYPE.AREA;\n\t\t\t}else if(measurement.maxMarkers === 1){\n\t\t\t\treturn TYPE.POINT;\n\t\t\t}else if(!measurement.showDistances && !measurement.showArea && measurement.showAngles){\n\t\t\t\treturn TYPE.ANGLE;\n\t\t\t}else if(measurement.showHeight){\n\t\t\t\treturn TYPE.HEIGHT;\n\t\t\t}else{\n\t\t\t\treturn TYPE.OTHER;\n\t\t\t}\n\t\t}else if(measurement instanceof Potree.Profile){\n\t\t\treturn TYPE.PROFILE;\n\t\t}else if(measurement instanceof Potree.Volume){\n\t\t\treturn TYPE.VOLUME;\n\t\t}\n\t};\n\t\n\tlet trackMeasurement = (scene, measurement) => {\n\t\tid++;\n\t\t\n\t\tlet type = getType(measurement);\n\t\t\n\t\tlet panel = new type.panel(scene, measurement);\n\t\tmlist.append(panel.elPanel);\n\t\t\n\t\tlet track = {\n\t\t\tscene: scene,\n\t\t\tmeasurement: measurement,\n\t\t\tpanel: panel,\n\t\t\tstopTracking: (e) => {panel.destroy()}\n\t\t};\n\t\ttrackedItems.set(measurement, track);\n\n\t\tlet onremove = (e) => {\n\t\t\t\n\t\t\tlet remove = () => {\n\t\t\t\tpanel.destroy();\n\t\t\t\tscene.removeEventListener(\"measurement_removed\", onremove);\n\t\t\t\tscene.removeEventListener(\"profile_removed\", onremove);\n\t\t\t\tscene.removeEventListener(\"volume_removed\", onremove);\n\t\t\t};\n\t\t\t\n\t\t\tif(e.measurement instanceof Potree.Measure && e.measurement === measurement){\n\t\t\t\tremove();\n\t\t\t}else if(e.profile instanceof Potree.Profile && e.profile === measurement){\n\t\t\t\tremove();\n\t\t\t}else if(e.volume instanceof Potree.Volume && e.volume === measurement){\n\t\t\t\tremove();\n\t\t\t}\n\t\t\t\n\t\t};\n\t\t\n\t\tscene.addEventListener(\"measurement_removed\", onremove);\n\t\tscene.addEventListener(\"profile_removed\", onremove);\n\t\tscene.addEventListener(\"volume_removed\", onremove);\n\t};\n\t\n\tlet scenelistener = (e) => {\n\t\tif(e.measurement){\n\t\t\ttrackMeasurement(e.scene, e.measurement);\n\t\t}else if(e.profile){\n\t\t\ttrackMeasurement(e.scene, e.profile);\n\t\t\t\n\t\t\tviewer.profileWindow.show();\n\t\t\tviewer.profileWindowController.setProfile(e.profile);\n\t\t}else if(e.volume){\n\t\t\ttrackMeasurement(e.scene, e.volume);\n\t\t}\n\t};\n\t\n\tlet trackScene = (scene) => {\n\t\t//$(\"#measurement_details\").empty();\n\t\t\n\t\ttrackedItems.forEach(function(trackedItem, key, map){\n\t\t\ttrackedItem.stopTracking();\n\t\t});\n\t\t\n\t\tlet items = scene.measurements\n\t\t\t.concat(scene.profiles)\n\t\t\t.concat(scene.volumes);\n\t\t\n\t\tfor(let measurement of items){\n\t\t\ttrackMeasurement(scene, measurement);\n\t\t}\n\t\t\n\t\tif(!scene.hasEventListener(\"measurement_added\", scenelistener)){\n\t\t\tscene.addEventListener(\"measurement_added\", scenelistener);\n\t\t}\n\t\t\n\t\tif(!scene.hasEventListener(\"profile_added\", scenelistener)){\n\t\t\tscene.addEventListener(\"profile_added\", scenelistener);\n\t\t}\n\t\t\n\t\tif(!scene.hasEventListener(\"volume_added\", scenelistener)){\n\t\t\tscene.addEventListener(\"volume_added\", scenelistener);\n\t\t}\n\t};\n\t\n\ttrackScene(viewer.scene);\n\t\n\tviewer.addEventListener(\"scene_changed\", (e) => {trackScene(e.scene)});\n\t\n\t\n\t{ // BOTTOM ACTIONS\n\t\tlet elActionsB = $(\"#measurement_list_after\");\n\t\n\t\t{\n\t\t\tlet icon = Potree.resourcePath + \"/icons/file_geojson.svg\";\n\t\t\tlet elDownload = $(`\n\t\t\t\t<a href=\"#\" download=\"measure.json\" class=\"measurepanel_downloads\">\n\t\t\t\t\t<img src=\"${icon}\" style=\"height: 24px\" />\n\t\t\t\t</a>`);\n\t\t\telActionsB.append(elDownload);\n\t\t\t\n\t\t\telDownload.click(function(e){\n\t\t\t\tlet scene = viewer.scene;\n\t\t\t\tlet measurements = [scene.measurements, scene.profiles, scene.volumes].reduce((a, v) => a.concat(v));\n\t\t\t\t\n\t\t\t\tlet geojson = Potree.GeoJSONExporter.toString(measurements);\n\t\t\t\t\n\t\t\t\tlet url = window.URL.createObjectURL(new Blob([geojson], {type: 'data:application/octet-stream'}));\n\t\t\t\telDownload.attr(\"href\", url);\n\t\t\t});\n\t\t}\n\t\t\n\t\t{\n\t\t\tlet icon = Potree.resourcePath + \"/icons/file_dxf.svg\";\n\t\t\tlet elDownload = $(`\n\t\t\t\t<a href=\"#\" download=\"measure.dxf\" class=\"measurepanel_downloads\">\n\t\t\t\t\t<img src=\"${icon}\" style=\"height: 24px\" />\n\t\t\t\t</a>`);\n\t\t\telActionsB.append(elDownload);\n\t\t\t\n\t\t\telDownload.click(function(e){\n\t\t\t\tlet scene = viewer.scene;\n\t\t\t\tlet measurements = [scene.measurements, scene.profiles, scene.volumes].reduce((a, v) => a.concat(v));\n\t\t\t\t\n\t\t\t\tlet dxf = Potree.DXFExporter.toString(measurements);\n\t\t\t\t\n\t\t\t\tlet url = window.URL.createObjectURL(new Blob([dxf], {type: 'data:application/octet-stream'}));\n\t\t\t\telDownload.attr(\"href\", url);\n\t\t\t});\n\t\t}\n\t\n\t}\n\n};\n\nfunction initSceneList(){\n\n\tlet scenelist = $('#scene_list');\n\t\n\t// length units\n\t$(\"#optLengthUnit\").selectmenu({\n\t\tstyle:'popup',\n\t\tposition: { \n\t\t\tmy: \"top\", \n\t\t\tat: \"bottom\", \n\t\t\tcollision: \"flip\" },\n\t\tchange: function(e) {\n\t\t\tlet selectedValue = $(\"#optLengthUnit\").selectmenu().val();\n\t\t\tviewer.setLengthUnit(selectedValue);\n\t\t}\n\t});\t\n\t$(\"#optLengthUnit\").selectmenu().val(viewer.lengthUnit.code);\n\t$(\"#optLengthUnit\").selectmenu(\"refresh\");\n\t\n\tlet initUIElements = function(i) {\n\t\t// scene panel in scene list\n\n\t\tlet pointcloud = viewer.scene.pointclouds[i];\n\t\tlet title = pointcloud.name;\n\t\tlet pcMaterial = pointcloud.material;\n\t\tlet checked = pointcloud.visible ? \"checked\" : \"\";\n\n\t\tlet scenePanel = $(`\n\t\t\t<span class=\"scene_item\">\n\t\t\t\t<!-- HEADER -->\n\t\t\t\t<div style=\"float: right; margin: 6px; margin-right: 15px\"><input id=\"scene_list_item_pointcloud_${i}\" type=\"checkbox\" ${checked} /></div>\n\t\t\t\t<div class=\"scene_header\" onclick=\"$(this).next().slideToggle(200)\">\n\t\t\t\t\t<span class=\"scene_icon\"><img src=\"${Potree.resourcePath + \"/icons/cloud_icon.svg\"}\" class=\"scene_item_icon\" /></span>\n\t\t\t\t\t<span class=\"scene_header_title\">${title}</span>\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t\t<!-- DETAIL -->\n\t\t\t\t<div class=\"scene_content selectable\" style=\"display: none\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<ul class=\"pv-menu-list\">\n\t\t\t\t\t\t\n\t\t\t\t\t\t<li>\n\t\t\t\t\t\t<span data-i18n=\"appearance.point_size\"></span>:<span id=\"lblPointSize_${i}\"></span> <div id=\"sldPointSize_${i}\"></div>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<!-- SIZE TYPE -->\n\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t<label for=\"optPointSizing_${i}\" class=\"pv-select-label\" data-i18n=\"appearance.point_size_type\">Point Sizing </label>\n\t\t\t\t\t\t\t<select id=\"optPointSizing_${i}\" name=\"optPointSizing_${i}\">\n\t\t\t\t\t\t\t\t<option>FIXED</option>\n\t\t\t\t\t\t\t\t<option>ATTENUATED</option>\n\t\t\t\t\t\t\t\t<option>ADAPTIVE</option>\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t</li>\n\t\n\t\t\t\t\t\t<!--\n\t\t\t\t\t\tShape:\n\t\t\t\t\t\t<div id=\"sizing_${i}\">\n\t\t\t\t\t\t\t<label for=\"radio_${i}_1\">FIXED</label>\n\t\t\t\t\t\t\t<input type=\"radio\" name=\"radio_${i}\" id=\"radio_${i}_1\">\n\t\t\t\t\t\t\t<label for=\"radio_${i}_2\">ATTENUATED</label>\n\t\t\t\t\t\t\t<input type=\"radio\" name=\"radio_${i}\" id=\"radio_${i}_2\">\n\t\t\t\t\t\t\t<label for=\"radio_${i}_3\">ADAPTIVE</label>\n\t\t\t\t\t\t\t<input type=\"radio\" name=\"radio_${i}\" id=\"radio_${i}_3\">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t-->\n\t\t\t\t\t\t\n\t\t\t\t\t\t<!-- SHAPE -->\n\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t<label for=\"optShape_\" class=\"pv-select-label\" data-i18n=\"appearance.point_shape\"></label>\n\t\t\t\t\t\t\t<select id=\"optShape_${i}\" name=\"optShape_${i}\">\n\t\t\t\t\t\t\t\t<option>SQUARE</option>\n\t\t\t\t\t\t\t\t<option>CIRCLE</option>\n\t\t\t\t\t\t\t\t<option>PARABOLOID</option>\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t</li>\t\n\t\t\t\t\t\t\n\t\t\t\t\t\t<!-- OPACITY -->\n\t\t\t\t\t\t<li><span data-i18n=\"appearance.point_opacity\"></span>:<span id=\"lblOpacity_${i}\"></span><div id=\"sldOpacity_${i}\"></div></li>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<div class=\"divider\">\n\t\t\t\t\t\t\t<span>Attribute</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<li>\n\t\t\t\t\t\t   <!--<label for=\"optMaterial${i}\" class=\"pv-select-label\">Attributes:</label><br>-->\n\t\t\t\t\t\t   <select id=\"optMaterial${i}\" name=\"optMaterial${i}\">\n\t\t\t\t\t\t   </select>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<div id=\"materials.composite_weight_container${i}\">\n\t\t\t\t\t\t\t<div class=\"divider\">\n\t\t\t\t\t\t\t\t<span>Attribute Weights</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\n\t\t\t\t\t\t\t<li>RGB: <span id=\"lblWeightRGB${i}\"></span> <div id=\"sldWeightRGB${i}\"></div>\t</li>\n\t\t\t\t\t\t\t<li>Intensity: <span id=\"lblWeightIntensity${i}\"></span> <div id=\"sldWeightIntensity${i}\"></div>\t</li>\n\t\t\t\t\t\t\t<li>Elevation: <span id=\"lblWeightElevation${i}\"></span> <div id=\"sldWeightElevation${i}\"></div>\t</li>\n\t\t\t\t\t\t\t<li>Classification: <span id=\"lblWeightClassification${i}\"></span> <div id=\"sldWeightClassification${i}\"></div>\t</li>\n\t\t\t\t\t\t\t<li>Return Number: <span id=\"lblWeightReturnNumber${i}\"></span> <div id=\"sldWeightReturnNumber${i}\"></div>\t</li>\n\t\t\t\t\t\t\t<li>Source ID: <span id=\"lblWeightSourceID${i}\"></span> <div id=\"sldWeightSourceID${i}\"></div>\t</li>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<div id=\"materials.rgb_container${i}\">\n\t\t\t\t\t\t\t<div class=\"divider\">\n\t\t\t\t\t\t\t\t<span>RGB</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\n\t\t\t\t\t\t\t<li>Gamma: <span id=\"lblRGBGamma${i}\"></span> <div id=\"sldRGBGamma${i}\"></div>\t</li>\n\t\t\t\t\t\t\t<li>Brightness: <span id=\"lblRGBBrightness${i}\"></span> <div id=\"sldRGBBrightness${i}\"></div>\t</li>\n\t\t\t\t\t\t\t<li>Contrast: <span id=\"lblRGBContrast${i}\"></span> <div id=\"sldRGBContrast${i}\"></div>\t</li>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<div id=\"materials.color_container${i}\">\n\t\t\t\t\t\t\t<div class=\"divider\">\n\t\t\t\t\t\t\t\t<span>Color</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t<input id=\"materials.color.picker${i}\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t\t\t\n\t\t\t\t\t\t<div id=\"materials.elevation_container${i}\">\n\t\t\t\t\t\t\t<div class=\"divider\">\n\t\t\t\t\t\t\t\t<span>Elevation</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\n\t\t\t\t\t\t\t<li><span data-i18n=\"appearance.elevation_range\"></span>: <span id=\"lblHeightRange${i}\"></span> <div id=\"sldHeightRange${i}\"></div>\t</li>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<div id=\"materials.transition_container${i}\">\n\t\t\t\t\t\t\t<div class=\"divider\">\n\t\t\t\t\t\t\t\t<span>Transition</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\n\t\t\t\t\t\t\t<li>transition: <span id=\"lblTransition${i}\"></span> <div id=\"sldTransition${i}\"></div>\t</li>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<div id=\"materials.intensity_container${i}\">\n\t\t\t\t\t\t\t<div class=\"divider\">\n\t\t\t\t\t\t\t\t<span>Intensity</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\n\t\t\t\t\t\t\t<li>Range: <span id=\"lblIntensityRange${i}\"></span> <div id=\"sldIntensityRange${i}\"></div>\t</li>\n\t\t\t\t\t\t\t<li>Gamma: <span id=\"lblIntensityGamma${i}\"></span> <div id=\"sldIntensityGamma${i}\"></div>\t</li>\n\t\t\t\t\t\t\t<li>Brightness: <span id=\"lblIntensityBrightness${i}\"></span> <div id=\"sldIntensityBrightness${i}\"></div>\t</li>\n\t\t\t\t\t\t\t<li>Contrast: <span id=\"lblIntensityContrast${i}\"></span> <div id=\"sldIntensityContrast${i}\"></div>\t</li>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</span>\n\t\t`);\n\t\t\n\t\t{ // POINT SIZE\n\t\t\tlet sldPointSize = scenePanel.find(`#sldPointSize_${i}`);\n\t\t\tlet lblPointSize = scenePanel.find(`#lblPointSize_${i}`);\n\t\t\t\n\t\t\tsldPointSize.slider({\n\t\t\t\tvalue: pcMaterial.size,\n\t\t\t\tmin: 0,\n\t\t\t\tmax: 3,\n\t\t\t\tstep: 0.01,\n\t\t\t\tslide: function( event, ui ) {pcMaterial.size = ui.value;}\n\t\t\t});\n\t\t\t\n\t\t\tlet update = (e) => {\n\t\t\t\tlblPointSize.html(pcMaterial.size.toFixed(2));\n\t\t\t\tsldPointSize.slider({value: pcMaterial.size});\n\t\t\t};\n\t\t\t\n\t\t\tpcMaterial.addEventListener(\"point_size_changed\", update);\n\t\t\tupdate();\n\t\t}\n\t\t\n\t\t{ // POINT SIZE TYPE\n\t\t\tlet strSizeType = Object.keys(Potree.PointSizeType)[pcMaterial.pointSizeType];\n\t\t\t\n\t\t\tlet opt = scenePanel.find(`#optPointSizing_${i}`);\n\t\t\topt.selectmenu();\n\t\t\topt.val(strSizeType).selectmenu(\"refresh\");\n\t\t\t\n\t\t\topt.selectmenu({\n\t\t\t\tchange: (event, ui) => {\n\t\t\t\t\tpcMaterial.pointSizeType = Potree.PointSizeType[ui.item.value];\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\tpcMaterial.addEventListener(\"point_size_type_changed\", e => {\n\t\t\t\tlet typename = Object.keys(Potree.PointSizeType)[pcMaterial.pointSizeType];\n\t\t\t\t\n\t\t\t\t$( \"#optPointSizing\" ).selectmenu().val(typename).selectmenu(\"refresh\");\n\t\t\t});\n\t\t}\n\t\t\n\t\t{ // SHAPE\n\t\t\t\n\t\t\tlet opt = scenePanel.find(`#optShape_${i}`);\n\t\t\t\n\t\t\topt.selectmenu({\n\t\t\t\tchange: (event, ui) => {\n\t\t\t\t\tlet value = ui.item.value;\n\t\t\t\t\t\n\t\t\t\t\tpcMaterial.shape = Potree.PointShape[value];\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\tpcMaterial.addEventListener(\"point_shape_changed\", e => {\n\t\t\t\tlet typename = Object.keys(Potree.PointShape)[pcMaterial.shape];\n\t\t\t\t\n\t\t\t\topt.selectmenu().val(typename).selectmenu(\"refresh\");\n\t\t\t});\n\t\t}\n\t\t\n\t\t{ // OPACITY\n\t\t\tlet sldOpacity = scenePanel.find(`#sldOpacity_${i}`);\n\t\t\tlet lblOpacity = scenePanel.find(`#lblOpacity_${i}`);\n\t\t\t\n\t\t\tsldOpacity.slider({\n\t\t\t\tvalue: pcMaterial.opacity,\n\t\t\t\tmin: 0,\n\t\t\t\tmax: 1,\n\t\t\t\tstep: 0.001,\n\t\t\t\tslide: function( event, ui ) {pcMaterial.opacity = ui.value;}\n\t\t\t});\n\t\t\t\n\t\t\tlet update = (e) => {\n\t\t\t\tlblOpacity.html(pcMaterial.opacity.toFixed(2));\n\t\t\t\tsldOpacity.slider({value: pcMaterial.opacity});\n\t\t\t};\n\t\t\t\n\t\t\tpcMaterial.addEventListener(\"opacity_changed\", update);\n\t\t\tupdate();\n\t\t}\n\n\t\tlet inputVis = scenePanel.find(\"input[type='checkbox']\");\n\t\t\n\t\tinputVis.click(function(event){\n\t\t\tpointcloud.visible = event.target.checked;\n\t\t\tif(viewer.profileWindowController){\n\t\t\t\tviewer.profileWindowController.recompute();\n\t\t\t}\n\t\t});\n\n\t\tscenelist.append(scenePanel);\n\n\n\t\t// ui elements\n\t\t$( \"#optMaterial\" + i ).selectmenu({\n\t\t\tstyle:'popup',\n\t\t\tposition: { \n\t\t\t\tmy: \"top\", \n\t\t\t\tat: \"bottom\", \n\t\t\t\tcollision: \"flip\" }\t\n\t\t});\n\t\t\t\n\t\t$( \"#sldHeightRange\" + i ).slider({\n\t\t\trange: true,\n\t\t\tmin:\t0,\n\t\t\tmax:\t1000,\n\t\t\tvalues: [0, 1000],\n\t\t\tstep: \t0.01,\n\t\t\tslide: function( event, ui ) {\n\t\t\t\tpcMaterial.heightMin = ui.values[0];\n\t\t\t\tpcMaterial.heightMax = ui.values[1];\n\t\t\t\tviewer.dispatchEvent({\"type\": \"height_range_changed\" + i, \"viewer\": viewer});\n\t\t\t}\n\t\t});\n\t\t\n\t\t$( \"#sldTransition\" + i ).slider({\n\t\t\tvalue: pcMaterial.materialTransition,\n\t\t\tmin: 0,\n\t\t\tmax: 1,\n\t\t\tstep: 0.01,\n\t\t\tslide: function( event, ui ) {\n\t\t\t\tpcMaterial.materialTransition = ui.value;\n\t\t\t\tviewer.dispatchEvent({\"type\": \"material_transition_changed\" + i, \"viewer\": viewer});\n\t\t\t}\n\t\t});\n\t\t\n\t\t$( \"#sldIntensityRange\" + i ).slider({\n\t\t\trange: true,\n\t\t\tmin:\t0,\n\t\t\tmax:\t1,\n\t\t\tvalues: [0, 1],\n\t\t\tstep: \t0.01,\n\t\t\tslide: function( event, ui ) {\n\t\t\t\tlet min = (ui.values[0] == 0) ? 0 : parseInt(Math.pow(2, 16 * ui.values[0]));\n\t\t\t\tlet max = parseInt(Math.pow(2, 16 * ui.values[1]));\n\t\t\t\tpcMaterial.intensityRange = [min, max];\n\t\t\t\t//pcMaterial.intensityRange[0] = min;\n\t\t\t\t//pcMaterial.intensityRange[1] = max;\n\t\t\t\tviewer.dispatchEvent({\"type\": \"intensity_range_changed\" + i, \"viewer\": viewer});\n\t\t\t}\n\t\t});\n\t\t\n\t\t$( \"#sldIntensityGamma\" + i ).slider({\n\t\t\tvalue: pcMaterial.intensityGamma,\n\t\t\tmin: 0,\n\t\t\tmax: 4,\n\t\t\tstep: 0.01,\n\t\t\tslide: function( event, ui ) {\n\t\t\t\tpcMaterial.intensityGamma = ui.value;\n\t\t\t\tviewer.dispatchEvent({\"type\": \"intensity_gamma_changed\" + i, \"viewer\": viewer});\n\t\t\t}\n\t\t});\n\t\t\n\t\t$( \"#sldIntensityContrast\" + i ).slider({\n\t\t\tvalue: pcMaterial.intensityContrast,\n\t\t\tmin: -1,\n\t\t\tmax: 1,\n\t\t\tstep: 0.01,\n\t\t\tslide: function( event, ui ) {\n\t\t\t\tpcMaterial.intensityContrast = ui.value;\n\t\t\t\tviewer.dispatchEvent({\"type\": \"intensity_contrast_changed\" + i, \"viewer\": viewer});\n\t\t\t}\n\t\t});\n\t\t\n\t\t$( \"#sldIntensityBrightness\" + i ).slider({\n\t\t\tvalue: pcMaterial.intensityBrightness,\n\t\t\tmin: -1,\n\t\t\tmax: 1,\n\t\t\tstep: 0.01,\n\t\t\tslide: function( event, ui ) {\n\t\t\t\tpcMaterial.intensityBrightness = ui.value;\n\t\t\t\tviewer.dispatchEvent({\"type\": \"intensity_brightness_changed\" + i, \"viewer\": viewer});\n\t\t\t}\n\t\t});\n\t\t\n\t\t$( \"#sldRGBGamma\" + i ).slider({\n\t\t\tvalue: pcMaterial.rgbGamma,\n\t\t\tmin: 0,\n\t\t\tmax: 4,\n\t\t\tstep: 0.01,\n\t\t\tslide: function( event, ui ) {\n\t\t\t\tpcMaterial.rgbGamma = ui.value;\n\t\t\t\tviewer.dispatchEvent({\"type\": \"rgb_gamma_changed\" + i, \"viewer\": viewer});\n\t\t\t}\n\t\t});\n\t\t\n\t\t$( \"#sldRGBContrast\" + i ).slider({\n\t\t\tvalue: pcMaterial.rgbContrast,\n\t\t\tmin: -1,\n\t\t\tmax: 1,\n\t\t\tstep: 0.01,\n\t\t\tslide: function( event, ui ) {\n\t\t\t\tpcMaterial.rgbContrast = ui.value;\n\t\t\t\tviewer.dispatchEvent({\"type\": \"rgb_contrast_changed\" + i, \"viewer\": viewer});\n\t\t\t}\n\t\t});\n\t\t\n\t\t$( \"#sldRGBBrightness\" + i ).slider({\n\t\t\tvalue: pcMaterial.rgbBrightness,\n\t\t\tmin: -1,\n\t\t\tmax: 1,\n\t\t\tstep: 0.01,\n\t\t\tslide: function( event, ui ) {\n\t\t\t\tpcMaterial.rgbBrightness = ui.value;\n\t\t\t\tviewer.dispatchEvent({\"type\": \"rgb_brightness_changed\" + i, \"viewer\": viewer});\n\t\t\t}\n\t\t});\n\t\t\n\t\t$( \"#sldWeightRGB\" + i ).slider({\n\t\t\tvalue: pcMaterial.weightRGB,\n\t\t\tmin: 0,\n\t\t\tmax: 1,\n\t\t\tstep: 0.01,\n\t\t\tslide: function( event, ui ) {\n\t\t\t\tpcMaterial.weightRGB = ui.value;\n\t\t\t\tviewer.dispatchEvent({\"type\": \"attribute_weights_changed\" + i, \"viewer\": viewer});\n\t\t\t}\n\t\t});\n\t\t\n\t\t$( \"#sldWeightIntensity\" + i ).slider({\n\t\t\tvalue: pcMaterial.weightIntensity,\n\t\t\tmin: 0,\n\t\t\tmax: 1,\n\t\t\tstep: 0.01,\n\t\t\tslide: function( event, ui ) {\n\t\t\t\tpcMaterial.weightIntensity = ui.value;\n\t\t\t\tviewer.dispatchEvent({\"type\": \"attribute_weights_changed\" + i, \"viewer\": viewer});\n\t\t\t}\n\t\t});\n\t\t\n\t\t$( \"#sldWeightElevation\" + i ).slider({\n\t\t\tvalue: pcMaterial.weightElevation,\n\t\t\tmin: 0,\n\t\t\tmax: 1,\n\t\t\tstep: 0.01,\n\t\t\tslide: function( event, ui ) {\n\t\t\t\tpcMaterial.weightElevation = ui.value;\n\t\t\t\tviewer.dispatchEvent({\"type\": \"attribute_weights_changed\" + i, \"viewer\": viewer});\n\t\t\t}\n\t\t});\n\t\t\n\t\t$( \"#sldWeightClassification\" + i ).slider({\n\t\t\tvalue: pcMaterial.weightClassification,\n\t\t\tmin: 0,\n\t\t\tmax: 1,\n\t\t\tstep: 0.01,\n\t\t\tslide: function( event, ui ) {\n\t\t\t\tpcMaterial.weightClassification = ui.value;\n\t\t\t\tviewer.dispatchEvent({\"type\": \"attribute_weights_changed\" + i, \"viewer\": viewer});\n\t\t\t}\n\t\t});\n\t\t\n\t\t$( \"#sldWeightReturnNumber\" + i ).slider({\n\t\t\tvalue: pcMaterial.weightReturnNumber,\n\t\t\tmin: 0,\n\t\t\tmax: 1,\n\t\t\tstep: 0.01,\n\t\t\tslide: function( event, ui ) {\n\t\t\t\tpcMaterial.weightReturnNumber = ui.value;\n\t\t\t\tviewer.dispatchEvent({\"type\": \"attribute_weights_changed\" + i, \"viewer\": viewer});\n\t\t\t}\n\t\t});\n\t\t\n\t\t$( \"#sldWeightSourceID\" + i ).slider({\n\t\t\tvalue: pcMaterial.weightSourceID,\n\t\t\tmin: 0,\n\t\t\tmax: 1,\n\t\t\tstep: 0.01,\n\t\t\tslide: function( event, ui ) {\n\t\t\t\tpcMaterial.weightSourceID = ui.value;\n\t\t\t\tviewer.dispatchEvent({\"type\": \"attribute_weights_changed\" + i, \"viewer\": viewer});\n\t\t\t}\n\t\t});\n\t\t\n\t\t$(`#materials\\\\.color\\\\.picker${i}`).spectrum({\n\t\t\tflat: true,\n\t\t\tshowInput: true,\n\t\t\tpreferredFormat: \"rgb\",\n\t\t\tcancelText: \"\",\n\t\t\tchooseText: \"Apply\",\n\t\t\tcolor: `#${pcMaterial.color.getHexString()}`,\n\t\t\tmove: color => {\n\t\t\t\tlet cRGB = color.toRgb();\n\t\t\t\tlet tc = new THREE.Color().setRGB(cRGB.r / 255, cRGB.g / 255, cRGB.b / 255);\n\t\t\t\tpcMaterial.color = tc;\n\t\t\t}, \n\t\t\tchange: color => {\n\t\t\t\tlet cRGB = color.toRgb();\n\t\t\t\tlet tc = new THREE.Color().setRGB(cRGB.r / 255, cRGB.g / 255, cRGB.b / 255);\n\t\t\t\tpcMaterial.color = tc;\n\t\t\t}\n\t\t});\n\t\t\n\t\tpcMaterial.addEventListener(\"color_changed\", e => {\n\t\t\t$(`#materials\\\\.color\\\\.picker${i}`)\n\t\t\t\t.spectrum(\"set\", `#${pcMaterial.color.getHexString()}`);\n\t\t});\n\n\t\tlet updateHeightRange = function(){\n\t\t\tlet box = [pointcloud.pcoGeometry.tightBoundingBox, pointcloud.getBoundingBoxWorld()]\n\t\t\t\t.find(v => v !== undefined);\n\t\t\t\t\n\t\t\tpointcloud.updateMatrixWorld(true);\n\t\t\tbox = Potree.utils.computeTransformedBoundingBox(box, pointcloud.matrixWorld);\n\t\t\t\n\t\t\tlet bWidth = box.max.z - box.min.z;\n\t\t\tbMin = box.min.z - 0.2 * bWidth;\n\t\t\tbMax = box.max.z + 0.2 * bWidth;\n\t\t\t\n\t\t\t$( \"#lblHeightRange\" + i )[0].innerHTML = pcMaterial.heightMin.toFixed(2) + \" to \" + pcMaterial.heightMax.toFixed(2);\n\t\t\t$( \"#sldHeightRange\" + i ).slider({\n\t\t\t\tmin: bMin,\n\t\t\t\tmax: bMax,\n\t\t\t\tvalues: [pcMaterial.heightMin, pcMaterial.heightMax]\n\t\t\t});\n\t\t};\n\t\t\n\t\tlet updateIntensityRange = function(){\n\t\t\tlet range = pcMaterial.intensityRange;\n\t\t\tlet min = Math.log2(range[0]) / 16;\n\t\t\tlet max = Math.log2(range[1]) / 16;\n\t\t\t\n\t\t\t$( \"#lblIntensityRange\" + i )[0].innerHTML = \n\t\t\t\tparseInt(pcMaterial.intensityRange[0]) + \" to \" + \n\t\t\t\tparseInt(pcMaterial.intensityRange[1]);\n\t\t\t$( \"#sldIntensityRange\" + i ).slider({\n\t\t\t\tvalues: [min, max]\n\t\t\t});\n\t\t};\n\t\t\n\t\t{\n\t\t\tupdateHeightRange();\n\t\t\tlet min =  $(`#sldHeightRange${i}`).slider(\"option\", \"min\");\n\t\t\tlet max =  $(`#sldHeightRange${i}`).slider(\"option\", \"max\");\n\t\t}\n\t\t\n\t\tpcMaterial.addEventListener(\"material_property_changed\", (event) => {\n\t\t\t\n\t\t\tupdateHeightRange();\n\t\t\t\n\t\t\t{ // INTENSITY\n\t\t\t\tlet gamma = pcMaterial.intensityGamma;\n\t\t\t\tlet contrast = pcMaterial.intensityContrast;\n\t\t\t\tlet brightness = pcMaterial.intensityBrightness;\n\t\t\t\t\n\t\t\t\tupdateIntensityRange();\n\t\t\t\t\n\t\t\t\t$('#lblIntensityGamma' + i)[0].innerHTML = gamma.toFixed(2);\n\t\t\t\t$(\"#sldIntensityGamma\" + i).slider({value: gamma});\n\t\t\t\t\n\t\t\t\t$('#lblIntensityContrast' + i)[0].innerHTML = contrast.toFixed(2);\n\t\t\t\t$(\"#sldIntensityContrast\" + i).slider({value: contrast});\n\t\t\t\t\n\t\t\t\t$('#lblIntensityBrightness' + i)[0].innerHTML = brightness.toFixed(2);\n\t\t\t\t$(\"#sldIntensityBrightness\" + i).slider({value: brightness});\n\t\t\t}\n\t\t\t\n\t\t\t{ // RGB\n\t\t\t\tlet gamma = pcMaterial.rgbGamma;\n\t\t\t\tlet contrast = pcMaterial.rgbContrast;\n\t\t\t\tlet brightness = pcMaterial.rgbBrightness;\n\t\t\t\t\n\t\t\t\t$('#lblRGBGamma' + i)[0].innerHTML = gamma.toFixed(2);\n\t\t\t\t$(\"#sldRGBGamma\" + i).slider({value: gamma});\n\t\t\t\n\t\t\t\t$('#lblRGBContrast' + i)[0].innerHTML = contrast.toFixed(2);\n\t\t\t\t$(\"#sldRGBContrast\" + i).slider({value: contrast});\n\t\t\t\t\n\t\t\t\t$('#lblRGBBrightness' + i)[0].innerHTML = brightness.toFixed(2);\n\t\t\t\t$(\"#sldRGBBrightness\" + i).slider({value: brightness});\n\t\t\t}\n\t\t});\n\t\t\n\t\t\n\t\tviewer.addEventListener(\"length_unit_changed\", e => {\n\t\t\t$(\"#optLengthUnit\").selectmenu().val(e.value);\n\t\t\t$(\"#optLengthUnit\").selectmenu(\"refresh\");\n\t\t});\n\t\t\n\t\tviewer.addEventListener(\"pointcloud_loaded\", updateHeightRange);\n\t\t\n\t\tupdateHeightRange();\n\t\tupdateIntensityRange();\n\t\t$('#lblIntensityGamma' + i)[0].innerHTML = pcMaterial.intensityGamma.toFixed(2);\n\t\t$('#lblIntensityContrast' + i)[0].innerHTML = pcMaterial.intensityContrast.toFixed(2);\n\t\t$('#lblIntensityBrightness' + i)[0].innerHTML = pcMaterial.intensityBrightness.toFixed(2);\n\t\t\n\t\t$('#lblRGBGamma' + i)[0].innerHTML = pcMaterial.rgbGamma.toFixed(2);\n\t\t$('#lblRGBContrast' + i)[0].innerHTML = pcMaterial.rgbContrast.toFixed(2);\n\t\t$('#lblRGBBrightness' + i)[0].innerHTML = pcMaterial.rgbBrightness.toFixed(2);\n\n\t\tlet options = [ \n\t\t\t\"RGB\", \n\t\t\t\"RGB and Elevation\",\n\t\t\t\"Color\", \n\t\t\t\"Elevation\", \n\t\t\t\"Intensity\", \n\t\t\t\"Intensity Gradient\", \n\t\t\t\"Classification\", \n\t\t\t\"Return Number\", \n\t\t\t\"Source\", \n\t\t\t\"Phong\",\n\t\t\t\"Level of Detail\",\n\t\t\t\"Composite\",\n\t\t];\n\t\t\n\t\tlet elMaterialList = $(\"#optMaterial\" + i);\n\t\tfor(let i = 0; i < options.length; i++){\n\t\t\tlet option = options[i];\n\t\t\tlet id = \"optMaterial_\" + option + \"_\" + i;\n\n\t\t\tlet elOption = $(`\n\t\t\t\t<option id=\"${id}\">\n\t\t\t\t\t${option}\n\t\t\t\t</option>`);\n\t\t\telMaterialList.append(elOption);\n\t\t}\n\t\t\n\t\tlet updateMaterialPanel = function(event, ui){\t\t\t\n\t\t\tlet selectedValue = $(\"#optMaterial\" + i).selectmenu().val();\n\t\t\tpcMaterial.pointColorType = viewer.toMaterialID(selectedValue);\n\t\t\tviewer.dispatchEvent({\"type\": \"material_changed\" + i, \"viewer\": viewer});\n\t\t\t\n\t\t\tlet blockWeights = $(\"#materials\\\\.composite_weight_container\" + i);\n\t\t\tlet blockElevation = $(\"#materials\\\\.elevation_container\" + i);\n\t\t\tlet blockRGB = $(\"#materials\\\\.rgb_container\" + i);\n\t\t\tlet blockColor = $(\"#materials\\\\.color_container\" + i);\n\t\t\tlet blockIntensity = $(\"#materials\\\\.intensity_container\" + i);\n\t\t\tlet blockTransition = $(\"#materials\\\\.transition_container\" + i);\n\t\t\t\n\t\t\tblockIntensity.css(\"display\", \"none\");\n\t\t\tblockElevation.css(\"display\", \"none\");\n\t\t\tblockRGB.css(\"display\", \"none\");\n\t\t\tblockColor.css(\"display\", \"none\");\n\t\t\tblockWeights.css(\"display\", \"none\");\n\t\t\tblockTransition.css(\"display\", \"none\");\n\t\t\t\n\t\t\tif(selectedValue === \"Composite\"){\n\t\t\t\tblockWeights.css(\"display\", \"block\");\n\t\t\t\tblockElevation.css(\"display\", \"block\");\n\t\t\t\tblockRGB.css(\"display\", \"block\");\n\t\t\t\tblockIntensity.css(\"display\", \"block\");\n\t\t\t}else if(selectedValue === \"Elevation\"){\n\t\t\t\tblockElevation.css(\"display\", \"block\");\n\t\t\t}else if(selectedValue === \"RGB and Elevation\"){\n\t\t\t\tblockRGB.css(\"display\", \"block\");\n\t\t\t\tblockElevation.css(\"display\", \"block\");\n\t\t\t}else if(selectedValue === \"RGB\"){\n\t\t\t\tblockRGB.css(\"display\", \"block\");\n\t\t\t}else if(selectedValue === \"Color\"){\n\t\t\t\tblockColor.css(\"display\", \"block\");\n\t\t\t}else if(selectedValue === \"Intensity\"){\n\t\t\t\tblockIntensity.css(\"display\", \"block\");\n\t\t\t}else if(selectedValue === \"Intensity Gradient\"){\n\t\t\t\tblockIntensity.css(\"display\", \"block\");\n\t\t\t}\n\t\t};\n\t\t\n\t\t$(\"#optMaterial\" + i).selectmenu({change: updateMaterialPanel});\n\t\t$(\"#optMaterial\" + i).val(viewer.toMaterialName(pcMaterial.pointColorType)).selectmenu(\"refresh\");\n\t\tupdateMaterialPanel();\n\t\t\n\t\tviewer.addEventListener(\"material_changed\" + i, e => {\n\t\t\t$(\"#optMaterial\" + i).val(viewer.toMaterialName(pcMaterial.pointColorType)).selectmenu(\"refresh\");\n\t\t});\n\n\t\tscenePanel.i18n();\n\t};\t\n\t\n\tlet buildSceneList = () => {\n\t\tscenelist.empty();\n\t\t\n\t\tfor(let i = 0; i < viewer.scene.pointclouds.length; i++) {\n\t\t\tinitUIElements(i);\n\t\t}\n\t};\n\t\n\tbuildSceneList();\n\n\tviewer.addEventListener(\"scene_changed\", (e) => {\n\t\tbuildSceneList();\n\t\t\n\t\tif(e.oldScene){\n\t\t\te.oldScene.removeEventListener(\"pointcloud_added\", buildSceneList);\n\t\t}\n\t\te.scene.addEventListener(\"pointcloud_added\", buildSceneList);\n\t});\n\t\n\tviewer.scene.addEventListener(\"pointcloud_added\", buildSceneList);\n\t\n\t\n\tlet lastPos = new THREE.Vector3();\n\tlet lastTarget = new THREE.Vector3();\n\tviewer.addEventListener(\"update\", e => {\n\t\tlet pos = viewer.scene.view.position;\n\t\tlet target = viewer.scene.view.getPivot();\n\t\t\n\t\tif(pos.equals(lastPos) && target.equals(lastTarget)){\n\t\t\treturn;\n\t\t}else{\n\t\t\tlastPos.copy(pos);\n\t\t\tlastTarget.copy(target);\n\t\t}\n\t\t\n\t\tlet strCamPos = \"<br>\" + [pos.x, pos.y, pos.z].map(e => e.toFixed(2)).join(\", \");\n\t\tlet strCamTarget = \"<br>\" + [target.x, target.y, target.z].map(e => e.toFixed(2)).join(\", \");\n\t\t\n\t\t$('#lblCameraPosition').html(strCamPos);\n\t\t$('#lblCameraTarget').html(strCamTarget);\n\t\t\n\t\t\n\t});\n};\n\nlet initSettings = function(){\n\t\n\t$( \"#sldMinNodeSize\" ).slider({\n\t\tvalue: viewer.getMinNodeSize(),\n\t\tmin: 0,\n\t\tmax: 1000,\n\t\tstep: 0.01,\n\t\tslide: function( event, ui ) {viewer.setMinNodeSize(ui.value);}\n\t});\n\t\n\tviewer.addEventListener(\"minnodesize_changed\", function(event){\n\t\t$('#lblMinNodeSize').html(parseInt(viewer.getMinNodeSize()));\n\t\t$(\"#sldMinNodeSize\").slider({value: viewer.getMinNodeSize()});\n\t});\n\t$('#lblMinNodeSize').html(parseInt(viewer.getMinNodeSize()));\n\t\n\t\n\tlet toClipModeCode = function(string){\n\t\tif(string === \"No Clipping\"){\n\t\t\treturn Potree.ClipMode.DISABLED;\n\t\t}else if(string === \"Highlight Inside\"){\n\t\t\treturn Potree.ClipMode.HIGHLIGHT_INSIDE;\n\t\t}else if(string === \"Clip Outside\"){\n\t\t\treturn Potree.ClipMode.CLIP_OUTSIDE;\n\t\t}\n\t};\n\t\n\tlet toClipModeString = function(code){\n\t\tif(code === Potree.ClipMode.DISABLED){\n\t\t\treturn \"No Clipping\";\n\t\t}else if(code === Potree.ClipMode.HIGHLIGHT_INSIDE){\n\t\t\treturn \"Highlight Inside\";\n\t\t}else if(code === Potree.ClipMode.CLIP_OUTSIDE){\n\t\t\treturn \"Clip Outside\";\n\t\t}\n\t};\n\t\n\t$(\"#optClipMode\").selectmenu();\n\t$(\"#optClipMode\").val(toClipModeString(viewer.getClipMode())).selectmenu(\"refresh\")\n\t$(\"#optClipMode\").selectmenu({\n\t\tchange: function(event, ui){\n\t\t\tviewer.setClipMode(toClipModeCode(ui.item.value));\n\t\t}\n\t});\n\t\n\tviewer.addEventListener(\"clip_mode_changed\", e => {\n\t\tlet string = toClipModeString(viewer.clipMode);\n\t\t\n\t\t$( \"#optClipMode\" )\n\t\t\t.selectmenu()\n\t\t\t.val(string)\n\t\t\t.selectmenu(\"refresh\");\n\t});\n};\n\nlet initSidebar = function(){\n\tinitAccordion();\n\tinitAppearance();\n\tinitToolbar();\n\tinitNavigation();\n\tinitClassificationList();\n\tinitAnnotationDetails();\n\tinitMeasurementDetails();\n\tinitSceneList();\n\tinitSettings()\n\t\n\t$('#potree_version_number').html(Potree.version.major + \".\" + Potree.version.minor + Potree.version.suffix);\n\t$('.perfect_scrollbar').perfectScrollbar();\n}\n\nclass HoverMenuItem{\n\n\tconstructor(icon, callback){\n\t\tthis.icon = icon;\n\t\tthis.callback = callback;\n\t\t\n\t\tthis.element = $(`\n\t\t\t<span class=\"hover_menu_item\">\n\t\t\t\t<img src=\"${icon}\">\n\t\t\t</span>\n\t\t`);\n\t\t\n\t\tthis.element.click(function(){\n\t\t\tcallback();\n\t\t});\n\t}\n};\n\nclass HoverMenu{\n\n\tconstructor(icon){\n\t\tlet scope = this;\n\t\n\t\tthis.items = [];\n\t\n\t\tthis.x = 0;\n\t\tthis.y = 0;\n\t\tthis.circumference = 32;\n\t\t\n\t\tthis.element = $('<span class=\"hover_menu\"></span>');\n\t\tthis.elIcon = $(`<span class=\"hover_menu_icon\">\n\t\t\t<img src=\"${icon}\">\n\t\t</span>`);\n\t\tthis.element.append(this.elIcon);\n\t\t\n\t\tthis.element.click(function(){\n\t\t\t$(this).find(\".hover_menu_item\").fadeIn(200);\n\t\t\t$(this).find(\".hover_menu_icon\").fadeOut(200);\n\t\t\t\n\t\t\t$(this).css(\"left\", (scope.x - scope.circumference - $(this).width() / 2) + \"px\");\n\t\t\t$(this).css(\"top\", (scope.y - scope.circumference - $(this).height() / 2) + \"px\");\n\t\t\t$(this).css(\"border\", scope.circumference + \"px solid transparent\");\n\t\t}).mouseleave(function(){\n\t\t\t$(this).find(\".hover_menu_item\").fadeOut(200);\n\t\t\t$(this).find(\".hover_menu_icon\").fadeIn(200);\n\t\t\t\n\t\t\t$(this).css(\"left\", (scope.x - $(this).width() / 2) + \"px\");\n\t\t\t$(this).css(\"top\", (scope.y - $(this).height() / 2) + \"px\");\n\t\t\t$(this).css(\"border\", \"0px solid black\");\n\t\t});\n\t}\n\t\n\taddItem(item){\n\t\tthis.items.push(item);\n\t\tthis.element.append(item.element);\n\t\titem.element.hide();\n\t\t\n\t\tthis.arrange();\n\t}\n\t\n\tremoveItem(item){\n\t\tthis.items = this.items.filter(e => e !== item);\n\t\tthis.element.remove(item.element);\n\t\t\n\t\tthis.arrange();\n\t}\n\t\n\tarrange(){\n\t\tlet menuItems = this.element.find(\".hover_menu_item\");\n\t\tmenuItems.each(function(index, value){\n\t\t\tlet u = (index / menuItems.length) * Math.PI * 2;\n\t\t\tlet radius = 22;\n\t\t\tlet x = Math.cos(u) * radius;// + offset ;\n\t\t\tlet y = Math.sin(u) * radius;// + offset ;\n\t\t\t\n\t\t\t$(this).css(\"left\", x).css(\"top\", y);\n\t\t\t\n\t\t});\n\t}\n\t\n\tsetPosition(x, y){\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t\t\n\t\tlet rect = this.element.get(0).getBoundingClientRect();\n\t\t\n\t\tthis.element.css(\"left\", (this.x - rect.width / 2) + \"px\");\n\t\tthis.element.css(\"top\", (this.y - rect.height / 2) + \"px\");\n\t}\n\n};\n\nPotree.GLProgram = class GLProgram{\n\t\n\tconstructor(gl, material){\n\t\tthis.gl = gl;\n\t\tthis.material = material;\n\t\tthis.program = gl.createProgram();;\n\t\t\n\t\tthis.recompile();\n\t}\n\t\n\tcompileShader(type, source){\n\t\tlet gl = this.gl;\n\t\t\n\t\tlet vs = gl.createShader(type);\n\t\t\n\t\tgl.shaderSource(vs, source);\n\t\tgl.compileShader(vs);\n\t\t\n\t\tlet success = gl.getShaderParameter(vs, gl.COMPILE_STATUS);\n\t\tif (!success) {\n\t\t\tconsole.error(\"could not compile shader:\");\n\t\t\t\n\t\t\tlet log = gl.getShaderInfoLog(vs);\n\t\t\tconsole.error(log, source);\n\t\t\t\n\t\t\treturn null;\n\t\t}\n\t\t\n\t\treturn vs;\n\t}\n\t\n\trecompile(){\n\t\tlet gl = this.gl;\n\n\t\tlet vs = this.compileShader(gl.VERTEX_SHADER, this.material.vertexShader);\n\t\tlet fs = this.compileShader(gl.FRAGMENT_SHADER, this.material.fragmentShader);\n\t\t\n\t\tif(vs === null || fs === null){\n\t\t\treturn;\n\t\t}\n\t\t\n\t\t// PROGRAM\n\t\tlet program = this.program;\n\t\tgl.attachShader(program, vs);\n\t\tgl.attachShader(program, fs);\n\t\tgl.linkProgram(program);\n\t\tlet success = gl.getProgramParameter(program, gl.LINK_STATUS);\n\t\tif (!success) {\n\t\t\tconsole.error(\"could not compile/link program:\");\n\t\t\tconsole.error(this.material.vertexShader);\n\t\t\tconsole.error(this.material.fragmentShader);\n\t\t\t\t\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tgl.detachShader(program, vs);\n\t\tgl.detachShader(program, fs);\n\t\tgl.deleteShader(vs);\n\t\tgl.deleteShader(fs);\n\t\t\n\t\tgl.useProgram(program);\n\t\t\n\t\t{ // UNIFORMS\n\t\t\tlet uniforms = {};\n\t\t\tlet n = gl.getProgramParameter(program, gl.ACTIVE_UNIFORMS);\n\n\t\t\tfor(let i = 0; i < n; i++){\n\t\t\t\tvar uniform = gl.getActiveUniform(program, i);\n\t\t\t\tvar name = uniform.name;\n\t\t\t\tvar loc = gl.getUniformLocation(program, name);\n\n\t\t\t\tuniforms[name] = loc;\n\t\t\t}\n\t\t\t\n\t\t\tthis.uniforms = uniforms;\n\t\t}\n\t}\n\t\n};"]}